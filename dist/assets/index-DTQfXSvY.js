import{j as e,S as t,O as s,P as i,C as r,a,T as n,D as o,R as l,b as c,c as d,L as h,I as u,d as f,e as m,f as g,g as p,h as y,i as v,k as x,l as b,m as w,V as E,n as S,o as T,p as _,q as k,r as A,s as L,t as R,u as P,v as N,A as C,w as I,x as D,y as j,z as O,B as M,$ as F,E as $,F as U,G as B,H as V,J as G,K,M as H,N as q,Q as W}from"./radix-v25zf1za.js";import{a as z,r as Y,b as X,g as J,c as Q,L as Z,u as ee,N as te,d as se,e as ie,f as re,B as ae}from"./vendor-DS9cy9Oy.js";var ne;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var oe=z;ne=oe.createRoot,oe.hydrateRoot;const le=Y.createContext({});function ce(e){const t=Y.useRef(null);return null===t.current&&(t.current=e()),t.current}const de=Y.createContext(null),he=Y.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class ue extends Y.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function fe({children:t,isPresent:s}){const i=Y.useId(),r=Y.useRef(null),a=Y.useRef({width:0,height:0,top:0,left:0}),{nonce:n}=Y.useContext(he);return Y.useInsertionEffect((()=>{const{width:e,height:t,top:o,left:l}=a.current;if(s||!r.current||!e||!t)return;r.current.dataset.motionPopId=i;const c=document.createElement("style");return n&&(c.nonce=n),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${i}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${o}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}}),[s]),e.jsx(ue,{isPresent:s,childRef:r,sizeRef:a,children:Y.cloneElement(t,{ref:r})})}const me=({children:t,initial:s,isPresent:i,onExitComplete:r,custom:a,presenceAffectsLayout:n,mode:o})=>{const l=ce(ge),c=Y.useId(),d=Y.useCallback((e=>{l.set(e,!0);for(const t of l.values())if(!t)return;r&&r()}),[l,r]),h=Y.useMemo((()=>({id:c,initial:s,isPresent:i,custom:a,onExitComplete:d,register:e=>(l.set(e,!1),()=>l.delete(e))})),n?[Math.random(),d]:[i,d]);return Y.useMemo((()=>{l.forEach(((e,t)=>l.set(t,!1)))}),[i]),Y.useEffect((()=>{!i&&!l.size&&r&&r()}),[i]),"popLayout"===o&&(t=e.jsx(fe,{isPresent:i,children:t})),e.jsx(de.Provider,{value:h,children:t})};function ge(){return new Map}function pe(e=!0){const t=Y.useContext(de);if(null===t)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,a=Y.useId();Y.useEffect((()=>{e&&r(a)}),[e]);const n=Y.useCallback((()=>e&&i&&i(a)),[a,i,e]);return!s&&i?[!1,n]:[!0]}const ye=e=>e.key||"";function ve(e){const t=[];return Y.Children.forEach(e,(e=>{Y.isValidElement(e)&&t.push(e)})),t}const xe="undefined"!=typeof window,be=xe?Y.useLayoutEffect:Y.useEffect,we=({children:t,custom:s,initial:i=!0,onExitComplete:r,presenceAffectsLayout:a=!0,mode:n="sync",propagate:o=!1})=>{const[l,c]=pe(o),d=Y.useMemo((()=>ve(t)),[t]),h=o&&!l?[]:d.map(ye),u=Y.useRef(!0),f=Y.useRef(d),m=ce((()=>new Map)),[g,p]=Y.useState(d),[y,v]=Y.useState(d);be((()=>{u.current=!1,f.current=d;for(let e=0;e<y.length;e++){const t=ye(y[e]);h.includes(t)?m.delete(t):!0!==m.get(t)&&m.set(t,!1)}}),[y,h.length,h.join("-")]);const x=[];if(d!==g){let e=[...d];for(let t=0;t<y.length;t++){const s=y[t],i=ye(s);h.includes(i)||(e.splice(t,0,s),x.push(s))}return"wait"===n&&x.length&&(e=x),v(ve(e)),void p(d)}const{forceRender:b}=Y.useContext(le);return e.jsx(e.Fragment,{children:y.map((t=>{const g=ye(t),p=!(o&&!l)&&(d===y||h.includes(g));return e.jsx(me,{isPresent:p,initial:!(u.current&&!i)&&void 0,custom:p?void 0:s,presenceAffectsLayout:a,mode:n,onExitComplete:p?void 0:()=>{if(!m.has(g))return;m.set(g,!0);let e=!0;m.forEach((t=>{t||(e=!1)})),e&&(null==b||b(),v(f.current),o&&(null==c||c()),r&&r())},children:t},g)}))})},Ee=e=>e;let Se=Ee;function Te(e){let t;return()=>(void 0===t&&(t=e()),t)}const _e=(e,t,s)=>{const i=t-e;return 0===i?1:(s-e)/i},ke=e=>1e3*e,Ae=e=>e/1e3,Le=!1;const Re=["read","resolveKeyframes","update","preRender","render","postRender"];function Pe(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>s=!0,n=Re.reduce(((e,t)=>(e[t]=function(e){let t=new Set,s=new Set,i=!1,r=!1;const a=new WeakSet;let n={delta:0,timestamp:0,isProcessing:!1};function o(t){a.has(t)&&(l.schedule(t),e()),t(n)}const l={schedule:(e,r=!1,n=!1)=>{const o=n&&i?t:s;return r&&a.add(e),o.has(e)||o.add(e),e},cancel:e=>{s.delete(e),a.delete(e)},process:e=>{n=e,i?r=!0:(i=!0,[t,s]=[s,t],t.forEach(o),t.clear(),i=!1,r&&(r=!1,l.process(e)))}};return l}(a),e)),{}),{read:o,resolveKeyframes:l,update:c,preRender:d,render:h,postRender:u}=n,f=()=>{const a=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1),r.timestamp=a,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),d.process(r),h.process(r),u.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(f))};return{schedule:Re.reduce(((t,a)=>{const o=n[a];return t[a]=(t,a=!1,n=!1)=>(s||(s=!0,i=!0,r.isProcessing||e(f)),o.schedule(t,a,n)),t}),{}),cancel:e=>{for(let t=0;t<Re.length;t++)n[Re[t]].cancel(e)},state:r,steps:n}}const{schedule:Ne,cancel:Ce,state:Ie,steps:De}=Pe("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Ee,!0),je=Y.createContext({strict:!1}),Oe={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Me={};for(const Pk in Oe)Me[Pk]={isEnabled:e=>Oe[Pk].some((t=>!!e[t]))};const Fe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $e(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Fe.has(e)}let Ue=e=>!$e(e);try{(Be=require("@emotion/is-prop-valid").default)&&(Ue=e=>e.startsWith("on")?!$e(e):Be(e))}catch(Ak){}var Be;function Ve(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(s,i)=>"create"===i?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}const Ge=Y.createContext({});function Ke(e){return"string"==typeof e||Array.isArray(e)}function He(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const qe=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],We=["initial",...qe];function ze(e){return He(e.animate)||We.some((t=>Ke(e[t])))}function Ye(e){return Boolean(ze(e)||e.variants)}function Xe(e){const{initial:t,animate:s}=function(e,t){if(ze(e)){const{initial:t,animate:s}=e;return{initial:!1===t||Ke(t)?t:void 0,animate:Ke(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,Y.useContext(Ge));return Y.useMemo((()=>({initial:t,animate:s})),[Je(t),Je(s)])}function Je(e){return Array.isArray(e)?e.join(" "):e}const Qe=Symbol.for("motionComponentSymbol");function Ze(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function et(e,t,s){return Y.useCallback((i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&("function"==typeof s?s(i):Ze(s)&&(s.current=i))}),[t])}const tt=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),st="data-"+tt("framerAppearId"),{schedule:it}=Pe(queueMicrotask,!1),rt=Y.createContext({});function at(e,t,s,i,r){var a,n;const{visualElement:o}=Y.useContext(Ge),l=Y.useContext(je),c=Y.useContext(de),d=Y.useContext(he).reducedMotion,h=Y.useRef(null);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:o,props:s,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:d}));const u=h.current,f=Y.useContext(rt);!u||u.projection||!r||"html"!==u.type&&"svg"!==u.type||function(e,t,s,i){const{layoutId:r,layout:a,drag:n,dragConstraints:o,layoutScroll:l,layoutRoot:c}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:nt(e.parent)),e.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:Boolean(n)||o&&Ze(o),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}(h.current,s,r,f);const m=Y.useRef(!1);Y.useInsertionEffect((()=>{u&&m.current&&u.update(s,c)}));const g=s[st],p=Y.useRef(Boolean(g)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,g))&&(null===(n=window.MotionHasOptimisedAnimation)||void 0===n?void 0:n.call(window,g)));return be((()=>{u&&(m.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),it.render(u.render),p.current&&u.animationState&&u.animationState.animateChanges())})),Y.useEffect((()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask((()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,g)})),p.current=!1))})),u}function nt(e){if(e)return!1!==e.options.allowProjection?e.projection:nt(e.parent)}function ot({preloadedFeatures:t,createVisualElement:s,useRender:i,useVisualState:r,Component:a}){var n,o;function l(t,n){let o;const l={...Y.useContext(he),...t,layoutId:lt(t)},{isStatic:c}=l,d=Xe(t),h=r(t,c);if(!c&&xe){Y.useContext(je).strict;const e=function(e){const{drag:t,layout:s}=Me;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==s?void 0:s.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(l);o=e.MeasureLayout,d.visualElement=at(a,h,l,s,e.ProjectionNode)}return e.jsxs(Ge.Provider,{value:d,children:[o&&d.visualElement?e.jsx(o,{visualElement:d.visualElement,...l}):null,i(a,t,et(h,d.visualElement,n),h,c,d.visualElement)]})}t&&function(e){for(const t in e)Me[t]={...Me[t],...e[t]}}(t),l.displayName=`motion.${"string"==typeof a?a:`create(${null!==(o=null!==(n=a.displayName)&&void 0!==n?n:a.name)&&void 0!==o?o:""})`}`;const c=Y.forwardRef(l);return c[Qe]=a,c}function lt({layoutId:e}){const t=Y.useContext(le).id;return t&&void 0!==e?t+"-"+e:e}const ct=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function dt(e){return"string"==typeof e&&!e.includes("-")&&!!(ct.indexOf(e)>-1||/[A-Z]/u.test(e))}function ht(e){const t=[{},{}];return null==e||e.values.forEach(((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()})),t}function ut(e,t,s,i){if("function"==typeof t){const[r,a]=ht(i);t=t(void 0!==s?s:e.custom,r,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,a]=ht(i);t=t(void 0!==s?s:e.custom,r,a)}return t}const ft=e=>Array.isArray(e),mt=e=>Boolean(e&&e.getVelocity);function gt(e){const t=mt(e)?e.get():e;return s=t,Boolean(s&&"object"==typeof s&&s.mix&&s.toValue)?t.toValue():t;var s}const pt=e=>(t,s)=>{const i=Y.useContext(Ge),r=Y.useContext(de),a=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,a){const n={latestValues:yt(i,r,a,e),renderState:t()};return s&&(n.onMount=e=>s({props:i,current:e,...n}),n.onUpdate=e=>s(e)),n}(e,t,i,r);return s?a():ce(a)};function yt(e,t,s,i){const r={},a=i(e,{});for(const u in a)r[u]=gt(a[u]);let{initial:n,animate:o}=e;const l=ze(e),c=Ye(e);t&&c&&!l&&!1!==e.inherit&&(void 0===n&&(n=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===n;const h=d?o:n;if(h&&"boolean"!=typeof h&&!He(h)){const t=Array.isArray(h)?h:[h];for(let s=0;s<t.length;s++){const i=ut(e,t[s]);if(i){const{transitionEnd:e,transition:t,...s}=i;for(const i in s){let e=s[i];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}const vt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],xt=new Set(vt),bt=e=>t=>"string"==typeof t&&t.startsWith(e),wt=bt("--"),Et=bt("var(--"),St=e=>!!Et(e)&&Tt.test(e.split("/*")[0].trim()),Tt=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_t=(e,t)=>t&&"number"==typeof e?t.transform(e):e,kt=(e,t,s)=>s>t?t:s<e?e:s,At={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Lt={...At,transform:e=>kt(0,1,e)},Rt={...At,default:1},Pt=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),Nt=Pt("deg"),Ct=Pt("%"),It=Pt("px"),Dt=Pt("vh"),jt=Pt("vw"),Ot={...Ct,parse:e=>Ct.parse(e)/100,transform:e=>Ct.transform(100*e)},Mt={borderWidth:It,borderTopWidth:It,borderRightWidth:It,borderBottomWidth:It,borderLeftWidth:It,borderRadius:It,radius:It,borderTopLeftRadius:It,borderTopRightRadius:It,borderBottomRightRadius:It,borderBottomLeftRadius:It,width:It,maxWidth:It,height:It,maxHeight:It,top:It,right:It,bottom:It,left:It,padding:It,paddingTop:It,paddingRight:It,paddingBottom:It,paddingLeft:It,margin:It,marginTop:It,marginRight:It,marginBottom:It,marginLeft:It,backgroundPositionX:It,backgroundPositionY:It},Ft={rotate:Nt,rotateX:Nt,rotateY:Nt,rotateZ:Nt,scale:Rt,scaleX:Rt,scaleY:Rt,scaleZ:Rt,skew:Nt,skewX:Nt,skewY:Nt,distance:It,translateX:It,translateY:It,translateZ:It,x:It,y:It,z:It,perspective:It,transformPerspective:It,opacity:Lt,originX:Ot,originY:Ot,originZ:It},$t={...At,transform:Math.round},Ut={...Mt,...Ft,zIndex:$t,size:It,fillOpacity:Lt,strokeOpacity:Lt,numOctaves:$t},Bt={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Vt=vt.length;function Gt(e,t,s){const{style:i,vars:r,transformOrigin:a}=e;let n=!1,o=!1;for(const l in t){const e=t[l];if(xt.has(l))n=!0;else if(wt(l))r[l]=e;else{const t=_t(e,Ut[l]);l.startsWith("origin")?(o=!0,a[l]=t):i[l]=t}}if(t.transform||(n||s?i.transform=function(e,t,s){let i="",r=!0;for(let a=0;a<Vt;a++){const n=vt[a],o=e[n];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(n.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=_t(o,Ut[n]);l||(r=!1,i+=`${Bt[n]||n}(${e}) `),s&&(t[n]=e)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}(t,e.transform,s):i.transform&&(i.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=a;i.transformOrigin=`${e} ${t} ${s}`}}const Kt={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ht={offset:"strokeDashoffset",array:"strokeDasharray"};function qt(e,t,s){return"string"==typeof e?e:It.transform(t+s*e)}function Wt(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:a,pathLength:n,pathSpacing:o=1,pathOffset:l=0,...c},d,h){if(Gt(e,c,h),d)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:f,dimensions:m}=e;u.transform&&(m&&(f.transform=u.transform),delete u.transform),m&&(void 0!==r||void 0!==a||f.transform)&&(f.transformOrigin=function(e,t,s){return`${qt(t,e.x,e.width)} ${qt(s,e.y,e.height)}`}(m,void 0!==r?r:.5,void 0!==a?a:.5)),void 0!==t&&(u.x=t),void 0!==s&&(u.y=s),void 0!==i&&(u.scale=i),void 0!==n&&function(e,t,s=1,i=0,r=!0){e.pathLength=1;const a=r?Kt:Ht;e[a.offset]=It.transform(-i);const n=It.transform(t),o=It.transform(s);e[a.array]=`${n} ${o}`}(u,n,o,l,!1)}const zt=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Yt=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Xt=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Jt(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const a in s)e.style.setProperty(a,s[a])}const Qt=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Zt(e,t,s,i){Jt(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Qt.has(r)?r:tt(r),t.attrs[r])}const es={};function ts(e,{layout:t,layoutId:s}){return xt.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!es[e]||"opacity"===e)}function ss(e,t,s){var i;const{style:r}=e,a={};for(const n in r)(mt(r[n])||t.style&&mt(t.style[n])||ts(n,e)||void 0!==(null===(i=null==s?void 0:s.getValue(n))||void 0===i?void 0:i.liveStyle))&&(a[n]=r[n]);return a}function is(e,t,s){const i=ss(e,t,s);for(const r in e)if(mt(e[r])||mt(t[r])){i[-1!==vt.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}const rs=["x","y","width","height","cx","cy","r"],as={useVisualState:pt({scrapeMotionValuesFromProps:is,createRenderState:Yt,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let a=!!e.drag;if(!a)for(const o in r)if(xt.has(o)){a=!0;break}if(!a)return;let n=!t;if(t)for(let o=0;o<rs.length;o++){const s=rs[o];e[s]!==t[s]&&(n=!0)}n&&Ne.read((()=>{!function(e,t){try{t.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(s){t.dimensions={x:0,y:0,width:0,height:0}}}(s,i),Ne.render((()=>{Wt(i,r,Xt(s.tagName),e.transformTemplate),Zt(s,i)}))}))}})},ns={useVisualState:pt({scrapeMotionValuesFromProps:ss,createRenderState:zt})};function os(e,t,s){for(const i in t)mt(t[i])||ts(i,s)||(e[i]=t[i])}function ls(e,t){const s={};return os(s,e.style||{},e),Object.assign(s,function({transformTemplate:e},t){return Y.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{}};return Gt(s,t,e),Object.assign({},s.vars,s.style)}),[t])}(e,t)),s}function cs(e,t){const s={},i=ls(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function ds(e,t,s,i){const r=Y.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Wt(s,t,Xt(i),e.transformTemplate),{...s.attrs,style:{...s.style}}}),[t]);if(e.style){const t={};os(t,e.style,e),r.style={...t,...r.style}}return r}function hs(e=!1){return(t,s,i,{latestValues:r},a)=>{const n=(dt(t)?ds:cs)(s,r,a,t),o=function(e,t,s){const i={};for(const r in e)"values"===r&&"object"==typeof e.values||(Ue(r)||!0===s&&$e(r)||!t&&!$e(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(s,"string"==typeof t,e),l=t!==Y.Fragment?{...o,...n,ref:i}:{},{children:c}=s,d=Y.useMemo((()=>mt(c)?c.get():c),[c]);return Y.createElement(t,{...l,children:d})}}function us(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){return ot({...dt(s)?as:ns,preloadedFeatures:e,useRender:hs(i),createVisualElement:t,Component:s})}}function fs(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function ms(e,t,s){const i=e.getProps();return ut(i,t,void 0!==s?s:i.custom,e)}const gs=Te((()=>void 0!==window.ScrollTimeline));class ps{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map((e=>"finished"in e?e.finished:e)))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e,t){const s=this.animations.map((s=>gs()&&s.attachTimeline?s.attachTimeline(e):"function"==typeof t?t(s):void 0));return()=>{s.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class ys extends ps{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function vs(e,t){return e?e[t]||e.default||e:void 0}const xs=2e4;function bs(e){let t=0;let s=e.next(t);for(;!s.done&&t<xs;)t+=50,s=e.next(t);return t>=xs?1/0:t}function ws(e){return"function"==typeof e}function Es(e,t){e.timeline=t,e.onfinish=null}const Ss=e=>Array.isArray(e)&&"number"==typeof e[0],Ts={linearEasing:void 0};function _s(e,t){const s=Te(e);return()=>{var e;return null!==(e=Ts[t])&&void 0!==e?e:s()}}const ks=_s((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),As=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let a=0;a<r;a++)i+=e(_e(0,r-1,a))+", ";return`linear(${i.substring(0,i.length-2)})`};function Ls(e){return Boolean("function"==typeof e&&ks()||!e||"string"==typeof e&&(e in Ps||ks())||Ss(e)||Array.isArray(e)&&e.every(Ls))}const Rs=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,Ps={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Rs([0,.65,.55,1]),circOut:Rs([.55,0,1,.45]),backIn:Rs([.31,.01,.66,-.59]),backOut:Rs([.33,1.53,.69,.99])};function Ns(e,t){return e?"function"==typeof e&&ks()?As(e,t):Ss(e)?Rs(e):Array.isArray(e)?e.map((e=>Ns(e,t)||Ps.easeOut)):Ps[e]:void 0}const Cs={x:!1,y:!1};function Is(){return Cs.x||Cs.y}function Ds(e,t){const s=function(e){if(e instanceof Element)return[e];if("string"==typeof e){const t=document.querySelectorAll(e);return t?Array.from(t):[]}return Array.from(e)}(e),i=new AbortController;return[s,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function js(e){return t=>{"touch"===t.pointerType||Is()||e(t)}}const Os=(e,t)=>!!t&&(e===t||Os(e,t.parentElement)),Ms=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Fs=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const $s=new WeakSet;function Us(e){return t=>{"Enter"===t.key&&e(t)}}function Bs(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Vs(e){return Ms(e)&&!Is()}function Gs(e,t,s={}){const[i,r,a]=Ds(e,s),n=e=>{const i=e.currentTarget;if(!Vs(e)||$s.has(i))return;$s.add(i);const a=t(e),n=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Vs(e)&&$s.has(i)&&($s.delete(i),"function"==typeof a&&a(e,{success:t}))},o=e=>{n(e,s.useGlobalTarget||Os(i,e.target))},l=e=>{n(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return i.forEach((e=>{(function(e){return Fs.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(s.useGlobalTarget?window:e).addEventListener("pointerdown",n,r),e.addEventListener("focus",(e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const i=Us((()=>{if($s.has(s))return;Bs(s,"down");const e=Us((()=>{Bs(s,"up")}));s.addEventListener("keyup",e,t),s.addEventListener("blur",(()=>Bs(s,"cancel")),t)}));s.addEventListener("keydown",i,t),s.addEventListener("blur",(()=>s.removeEventListener("keydown",i)),t)})(e,r)),r)})),a}const Ks=new Set(["width","height","top","left","right","bottom",...vt]);let Hs;function qs(){Hs=void 0}const Ws={now:()=>(void 0===Hs&&Ws.set(Ie.isProcessing||Le?Ie.timestamp:performance.now()),Hs),set:e=>{Hs=e,queueMicrotask(qs)}};function zs(e,t){-1===e.indexOf(t)&&e.push(t)}function Ys(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class Xs{constructor(){this.subscriptions=[]}add(e){return zs(this.subscriptions,e),()=>Ys(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,s);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Js(e,t){return t?e*(1e3/t):0}class Qs{constructor(e,t={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const s=Ws.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Ws.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Xs);const s=this.events[e].add(t);return"change"===e?()=>{s(),Ne.read((()=>{this.events.change.getSize()||this.stop()}))}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ws.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Js(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Zs(e,t){return new Qs(e,t)}function ei(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Zs(s))}function ti(e,t){const s=e.getValue("willChange");if(i=s,Boolean(mt(i)&&i.add))return s.add(t);var i}function si(e){return e.props[st]}const ii=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function ri(e,t,s,i){if(e===t&&s===i)return Ee;const r=t=>function(e,t,s,i,r){let a,n,o=0;do{n=t+(s-t)/2,a=ii(n,i,r)-e,a>0?s=n:t=n}while(Math.abs(a)>1e-7&&++o<12);return n}(t,0,1,e,s);return e=>0===e||1===e?e:ii(r(e),t,i)}const ai=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ni=e=>t=>1-e(1-t),oi=ri(.33,1.53,.69,.99),li=ni(oi),ci=ai(li),di=e=>(e*=2)<1?.5*li(e):.5*(2-Math.pow(2,-10*(e-1))),hi=e=>1-Math.sin(Math.acos(e)),ui=ni(hi),fi=ai(hi),mi=e=>/^0[^.\s]+$/u.test(e);const gi=e=>Math.round(1e5*e)/1e5,pi=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const yi=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,vi=(e,t)=>s=>Boolean("string"==typeof s&&yi.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),xi=(e,t,s)=>i=>{if("string"!=typeof i)return i;const[r,a,n,o]=i.match(pi);return{[e]:parseFloat(r),[t]:parseFloat(a),[s]:parseFloat(n),alpha:void 0!==o?parseFloat(o):1}},bi={...At,transform:e=>Math.round((e=>kt(0,255,e))(e))},wi={test:vi("rgb","red"),parse:xi("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+bi.transform(e)+", "+bi.transform(t)+", "+bi.transform(s)+", "+gi(Lt.transform(i))+")"};const Ei={test:vi("#"),parse:function(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:wi.transform},Si={test:vi("hsl","hue"),parse:xi("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+Ct.transform(gi(t))+", "+Ct.transform(gi(s))+", "+gi(Lt.transform(i))+")"},Ti={test:e=>wi.test(e)||Ei.test(e)||Si.test(e),parse:e=>wi.test(e)?wi.parse(e):Si.test(e)?Si.parse(e):Ei.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?wi.transform(e):Si.transform(e)},_i=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const ki="number",Ai="color",Li=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ri(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let a=0;const n=t.replace(Li,(e=>(Ti.test(e)?(i.color.push(a),r.push(Ai),s.push(Ti.parse(e))):e.startsWith("var(")?(i.var.push(a),r.push("var"),s.push(e)):(i.number.push(a),r.push(ki),s.push(parseFloat(e))),++a,"${}"))).split("${}");return{values:s,split:n,indexes:i,types:r}}function Pi(e){return Ri(e).values}function Ni(e){const{split:t,types:s}=Ri(e),i=t.length;return e=>{let r="";for(let a=0;a<i;a++)if(r+=t[a],void 0!==e[a]){const t=s[a];r+=t===ki?gi(e[a]):t===Ai?Ti.transform(e[a]):e[a]}return r}}const Ci=e=>"number"==typeof e?0:e;const Ii={test:function(e){var t,s;return isNaN(e)&&"string"==typeof e&&((null===(t=e.match(pi))||void 0===t?void 0:t.length)||0)+((null===(s=e.match(_i))||void 0===s?void 0:s.length)||0)>0},parse:Pi,createTransformer:Ni,getAnimatableNone:function(e){const t=Pi(e);return Ni(e)(t.map(Ci))}},Di=new Set(["brightness","contrast","saturate","opacity"]);function ji(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=s.match(pi)||[];if(!i)return e;const r=s.replace(i,"");let a=Di.has(t)?1:0;return i!==s&&(a*=100),t+"("+a+r+")"}const Oi=/\b([a-z-]*)\(.*?\)/gu,Mi={...Ii,getAnimatableNone:e=>{const t=e.match(Oi);return t?t.map(ji).join(" "):e}},Fi={...Ut,color:Ti,backgroundColor:Ti,outlineColor:Ti,fill:Ti,stroke:Ti,borderColor:Ti,borderTopColor:Ti,borderRightColor:Ti,borderBottomColor:Ti,borderLeftColor:Ti,filter:Mi,WebkitFilter:Mi},$i=e=>Fi[e];function Ui(e,t){let s=$i(e);return s!==Mi&&(s=Ii),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Bi=new Set(["auto","none","0"]);const Vi=e=>e===At||e===It,Gi=(e,t)=>parseFloat(e.split(", ")[t]),Ki=(e,t)=>(s,{transform:i})=>{if("none"===i||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return Gi(r[1],t);{const t=i.match(/^matrix\((.+)\)$/u);return t?Gi(t[1],e):0}},Hi=new Set(["x","y","z"]),qi=vt.filter((e=>!Hi.has(e)));const Wi={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Ki(4,13),y:Ki(5,14)};Wi.translateX=Wi.x,Wi.translateY=Wi.y;const zi=new Set;let Yi=!1,Xi=!1;function Ji(){if(Xi){const e=Array.from(zi).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),s=new Map;t.forEach((e=>{const t=function(e){const t=[];return qi.forEach((s=>{const i=e.getValue(s);void 0!==i&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))})),t}(e);t.length&&(s.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=s.get(e);t&&t.forEach((([t,s])=>{var i;null===(i=e.getValue(t))||void 0===i||i.set(s)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Xi=!1,Yi=!1,zi.forEach((e=>e.complete())),zi.clear()}function Qi(){zi.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Xi=!0)}))}class Zi{constructor(e,t,s,i,r,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(zi.add(this),Yi||(Yi=!0,Ne.read(Qi),Ne.resolveKeyframes(Ji))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;for(let r=0;r<e.length;r++)if(null===e[r])if(0===r){const r=null==i?void 0:i.get(),a=e[e.length-1];if(void 0!==r)e[0]=r;else if(s&&t){const i=s.readValue(t,a);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=a),i&&void 0===r&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),zi.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,zi.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const er=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),tr=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function sr(e,t,s=1){const[i,r]=function(e){const t=tr.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${null!=s?s:i}`,r]}(e);if(!i)return;const a=window.getComputedStyle(t).getPropertyValue(i);if(a){const e=a.trim();return er(e)?parseFloat(e):e}return St(r)?sr(r,t,s+1):r}const ir=e=>t=>t.test(e),rr=[At,It,Ct,Nt,jt,Dt,{test:e=>"auto"===e,parse:e=>e}],ar=e=>rr.find(ir(e));class nr extends Zi{constructor(e,t,s,i,r){super(e,t,s,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),St(s))){const i=sr(s,t.current);void 0!==i&&(e[o]=i),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!Ks.has(s)||2!==e.length)return;const[i,r]=e,a=ar(i),n=ar(r);if(a!==n)if(Vi(a)&&Vi(n))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)("number"==typeof(i=e[r])?0===i:null===i||"none"===i||"0"===i||mi(i))&&s.push(r);var i;s.length&&function(e,t,s){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"==typeof t&&!Bi.has(t)&&Ri(t).values.length&&(i=e[r]),r++}if(i&&s)for(const a of t)e[a]=Ui(s,i)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Wi[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(s,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(s);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,n=i[a];i[a]=Wi[s](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((([e,s])=>{t.getValue(e).set(s)})),this.resolveNoneKeyframes()}}const or=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!Ii.test(e)&&"0"!==e||e.startsWith("url(")));function lr(e,t,s,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],n=or(r,t),o=or(a,t);return!(!n||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||ws(s))&&i)}const cr=e=>null!==e;function dr(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(cr),a=t&&"loop"!==s&&t%2==1?0:r.length-1;return a&&void 0!==i?i:r[a]}class hr{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",...n}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Ws.now(),this.options={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:r,repeatType:a,...n},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Qi(),Ji()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Ws.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:r,delay:a,onComplete:n,onUpdate:o,isGenerator:l}=this.options;if(!l&&!lr(e,s,i,r)){if(!a)return o&&o(dr(e,this.options,t)),n&&n(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}const ur=(e,t,s)=>e+(t-e)*s;function fr(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function mr(e,t){return s=>s>0?t:e}const gr=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},pr=[Ei,wi,Si];function yr(e){const t=(s=e,pr.find((e=>e.test(s))));var s;if(!Boolean(t))return!1;let i=t.parse(e);return t===Si&&(i=function({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,s/=100;let r=0,a=0,n=0;if(t/=100){const i=s<.5?s*(1+t):s+t-s*t,o=2*s-i;r=fr(o,i,e+1/3),a=fr(o,i,e),n=fr(o,i,e-1/3)}else r=a=n=s;return{red:Math.round(255*r),green:Math.round(255*a),blue:Math.round(255*n),alpha:i}}(i)),i}const vr=(e,t)=>{const s=yr(e),i=yr(t);if(!s||!i)return mr(e,t);const r={...s};return e=>(r.red=gr(s.red,i.red,e),r.green=gr(s.green,i.green,e),r.blue=gr(s.blue,i.blue,e),r.alpha=ur(s.alpha,i.alpha,e),wi.transform(r))},xr=(e,t)=>s=>t(e(s)),br=(...e)=>e.reduce(xr),wr=new Set(["none","hidden"]);function Er(e,t){return s=>ur(e,t,s)}function Sr(e){return"number"==typeof e?Er:"string"==typeof e?St(e)?mr:Ti.test(e)?vr:kr:Array.isArray(e)?Tr:"object"==typeof e?Ti.test(e)?vr:_r:mr}function Tr(e,t){const s=[...e],i=s.length,r=e.map(((e,s)=>Sr(e)(e,t[s])));return e=>{for(let t=0;t<i;t++)s[t]=r[t](e);return s}}function _r(e,t){const s={...e,...t},i={};for(const r in s)void 0!==e[r]&&void 0!==t[r]&&(i[r]=Sr(e[r])(e[r],t[r]));return e=>{for(const t in i)s[t]=i[t](e);return s}}const kr=(e,t)=>{const s=Ii.createTransformer(t),i=Ri(e),r=Ri(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?wr.has(e)&&!r.values.length||wr.has(t)&&!i.values.length?function(e,t){return wr.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):br(Tr(function(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const n=t.types[a],o=e.indexes[n][r[n]],l=null!==(s=e.values[o])&&void 0!==s?s:0;i[a]=l,r[n]++}return i}(i,r),r.values),s):mr(e,t)};function Ar(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return ur(e,t,s);return Sr(e)(e,t)}function Lr(e,t,s){const i=Math.max(t-5,0);return Js(s-e(i),t-i)}const Rr=100,Pr=10,Nr=1,Cr=0,Ir=800,Dr=.3,jr=.3,Or={granular:.01,default:2},Mr={granular:.005,default:.5},Fr=.01,$r=10,Ur=.05,Br=1;function Vr({duration:e=Ir,bounce:t=Dr,velocity:s=Cr,mass:i=Nr}){let r,a,n=1-t;n=kt(Ur,Br,n),e=kt(Fr,$r,Ae(e)),n<1?(r=t=>{const i=t*n,r=i*e;return.001-(i-s)/Kr(t,n)*Math.exp(-r)},a=t=>{const i=t*n*e,a=i*s+s,o=Math.pow(n,2)*Math.pow(t,2)*e,l=Math.exp(-i),c=Kr(Math.pow(t,2),n);return(.001-r(t)>0?-1:1)*((a-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,a=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let i=s;for(let r=1;r<Gr;r++)i-=e(i)/t(i);return i}(r,a,5/e);if(e=ke(e),isNaN(o))return{stiffness:Rr,damping:Pr,duration:e};{const t=Math.pow(o,2)*i;return{stiffness:t,damping:2*n*Math.sqrt(i*t),duration:e}}}const Gr=12;function Kr(e,t){return e*Math.sqrt(1-t*t)}const Hr=["duration","bounce"],qr=["stiffness","damping","mass"];function Wr(e,t){return t.some((t=>void 0!==e[t]))}function zr(e=jr,t=Dr){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const a=s.keyframes[0],n=s.keyframes[s.keyframes.length-1],o={done:!1,value:a},{stiffness:l,damping:c,mass:d,duration:h,velocity:u,isResolvedFromDuration:f}=function(e){let t={velocity:Cr,stiffness:Rr,damping:Pr,mass:Nr,isResolvedFromDuration:!1,...e};if(!Wr(e,qr)&&Wr(e,Hr))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(1.2*s),r=i*i,a=2*kt(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Nr,stiffness:r,damping:a}}else{const s=Vr(e);t={...t,...s,mass:Nr},t.isResolvedFromDuration=!0}return t}({...s,velocity:-Ae(s.velocity||0)}),m=u||0,g=c/(2*Math.sqrt(l*d)),p=n-a,y=Ae(Math.sqrt(l/d)),v=Math.abs(p)<5;let x;if(i||(i=v?Or.granular:Or.default),r||(r=v?Mr.granular:Mr.default),g<1){const e=Kr(y,g);x=t=>{const s=Math.exp(-g*y*t);return n-s*((m+g*y*p)/e*Math.sin(e*t)+p*Math.cos(e*t))}}else if(1===g)x=e=>n-Math.exp(-y*e)*(p+(m+y*p)*e);else{const e=y*Math.sqrt(g*g-1);x=t=>{const s=Math.exp(-g*y*t),i=Math.min(e*t,300);return n-s*((m+g*y*p)*Math.sinh(i)+e*p*Math.cosh(i))/e}}const b={calculatedDuration:f&&h||null,next:e=>{const t=x(e);if(f)o.done=e>=h;else{let s=0;g<1&&(s=0===e?ke(m):Lr(x,e,t));const a=Math.abs(s)<=i,l=Math.abs(n-t)<=r;o.done=a&&l}return o.value=o.done?n:t,o},toString:()=>{const e=Math.min(bs(b),xs),t=As((t=>b.next(e*t).value),e,30);return e+"ms "+t}};return b}function Yr({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:n,min:o,max:l,restDelta:c=.5,restSpeed:d}){const h=e[0],u={done:!1,value:h},f=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let m=s*t;const g=h+m,p=void 0===n?g:n(g);p!==g&&(m=p-h);const y=e=>-m*Math.exp(-e/i),v=e=>p+y(e),x=e=>{const t=y(e),s=v(e);u.done=Math.abs(t)<=c,u.value=u.done?p:s};let b,w;const E=e=>{var t;(t=u.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(b=e,w=zr({keyframes:[u.value,f(u.value)],velocity:Lr(v,e,u.value),damping:r,stiffness:a,restDelta:c,restSpeed:d}))};return E(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==b||(t=!0,x(e),E(e)),void 0!==b&&e>=b?w.next(e-b):(!t&&x(e),u)}}}const Xr=ri(.42,0,1,1),Jr=ri(0,0,.58,1),Qr=ri(.42,0,.58,1),Zr={linear:Ee,easeIn:Xr,easeInOut:Qr,easeOut:Jr,circIn:hi,circInOut:fi,circOut:ui,backIn:li,backInOut:ci,backOut:oi,anticipate:di},ea=e=>{if(Ss(e)){Se(4===e.length);const[t,s,i,r]=e;return ri(t,s,i,r)}return"string"==typeof e?Zr[e]:e};function ta(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const a=e.length;if(Se(a===t.length),1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const n=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const i=[],r=s||Ar,a=e.length-1;for(let n=0;n<a;n++){let s=r(e[n],e[n+1]);if(t){const e=Array.isArray(t)?t[n]||Ee:t;s=br(e,s)}i.push(s)}return i}(t,i,r),l=o.length,c=s=>{if(n&&s<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(s<e[i+1]);i++);const r=_e(e[i],e[i+1],s);return o[i](r)};return s?t=>c(kt(e[0],e[a-1],t)):c}function sa(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=_e(0,t,i);e.push(ur(s,1,r))}}(t,e.length-1),t}function ia({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(ea):ea(i),a={done:!1,value:t[0]},n=function(e,t){return e.map((e=>e*t))}(s&&s.length===t.length?s:sa(t),e),o=ta(n,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map((()=>c||Qr)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(a.value=o(t),a.done=t>=e,a)}}const ra=e=>{const t=({timestamp:t})=>e(t);return{start:()=>Ne.update(t,!0),stop:()=>Ce(t),now:()=>Ie.isProcessing?Ie.timestamp:Ws.now()}},aa={decay:Yr,inertia:Yr,tween:ia,keyframes:ia,spring:zr},na=e=>e/100;class oa extends hr{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:s,element:i,keyframes:r}=this.options,a=(null==i?void 0:i.KeyframeResolver)||Zi;this.resolver=new a(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=this.options,n=ws(t)?t:aa[t]||ia;let o,l;n!==ia&&"number"!=typeof e[0]&&(o=br(na,Ar(e[0],e[1])),e=[0,100]);const c=n({...this.options,keyframes:e});"mirror"===r&&(l=n({...this.options,keyframes:[...e].reverse(),velocity:-a})),null===c.calculatedDuration&&(c.calculatedDuration=bs(c));const{calculatedDuration:d}=c,h=d+i;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:o,calculatedDuration:d,resolvedDuration:h,totalDuration:h*(s+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:a,mapPercentToKeyframes:n,keyframes:o,calculatedDuration:l,totalDuration:c,resolvedDuration:d}=s;if(null===this.startTime)return r.next(0);const{delay:h,repeat:u,repeatType:f,repeatDelay:m,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),y=this.speed>=0?p<0:p>c;this.currentTime=Math.max(p,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let v=this.currentTime,x=r;if(u){const e=Math.min(this.currentTime,c)/d;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===f?(s=1-s,m&&(s-=m/d)):"mirror"===f&&(x=a)),v=kt(0,1,s)*d}const b=y?{done:!1,value:o[0]}:x.next(v);n&&(b.value=n(b.value));let{done:w}=b;y||null===l||(w=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const E=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return E&&void 0!==i&&(b.value=dr(o,this.options,i)),g&&g(b.value),E&&this.finish(),b}get duration(){const{resolved:e}=this;return e?Ae(e.calculatedDuration):0}get time(){return Ae(this.currentTime)}set time(e){e=ke(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ae(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=ra,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!=s?s:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const la=new Set(["opacity","clipPath","filter","transform"]);function ca(e,t,s,{delay:i=0,duration:r=300,repeat:a=0,repeatType:n="loop",ease:o="easeInOut",times:l}={}){const c={[t]:s};l&&(c.offset=l);const d=Ns(o,r);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:i,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:a+1,direction:"reverse"===n?"alternate":"normal"})}const da=Te((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const ha={anticipate:di,backInOut:ci,circInOut:fi};class ua extends hr{constructor(e){super(e);const{name:t,motionValue:s,element:i,keyframes:r}=this.options;this.resolver=new nr(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:s=300,times:i,ease:r,type:a,motionValue:n,name:o,startTime:l}=this.options;if(!n.owner||!n.owner.current)return!1;if("string"==typeof r&&ks()&&r in ha&&(r=ha[r]),function(e){return ws(e.type)||"spring"===e.type||!Ls(e.ease)}(this.options)){const{onComplete:t,onUpdate:n,motionValue:o,element:l,...c}=this.options,d=function(e,t){const s=new oa({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let a=0;for(;!i.done&&a<2e4;)i=s.sample(a),r.push(i.value),a+=10;return{times:void 0,keyframes:r,duration:a-10,ease:"linear"}}(e,c);1===(e=d.keyframes).length&&(e[1]=e[0]),s=d.duration,i=d.times,r=d.ease,a="keyframes"}const c=ca(n.owner.current,o,e,{...this.options,duration:s,times:i,ease:r});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(Es(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:s}=this.options;n.set(dr(e,this.options,t)),s&&s(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:s,times:i,type:a,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Ae(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Ae(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.currentTime=ke(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return Ee;const{animation:s}=t;Es(s,e)}else this.pendingTimeline=e;return Ee}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:s,duration:i,type:r,ease:a,times:n}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:o,element:l,...c}=this.options,d=new oa({...c,keyframes:s,duration:i,type:r,ease:a,times:n,isGenerator:!0}),h=ke(this.time);e.setWithVelocity(d.sample(h-10).value,d.sample(h).value,10)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:s,repeatDelay:i,repeatType:r,damping:a,type:n}=e;if(!(t&&t.owner&&t.owner.current instanceof HTMLElement))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return da()&&s&&la.has(s)&&!o&&!l&&!i&&"mirror"!==r&&0!==a&&"inertia"!==n}}const fa={type:"spring",stiffness:500,damping:25,restSpeed:10},ma={type:"keyframes",duration:.8},ga={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},pa=(e,{keyframes:t})=>t.length>2?ma:xt.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:fa:ga;const ya=(e,t,s,i={},r,a)=>n=>{const o=vs(i,e)||{},l=o.delay||i.delay||0;let{elapsed:c=0}=i;c-=ke(l);let d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{n(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:a?void 0:r};(function({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:n,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||(d={...d,...pa(e,d)}),d.duration&&(d.duration=ke(d.duration)),d.repeatDelay&&(d.repeatDelay=ke(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let h=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(h=!0)),h&&!a&&void 0!==t.get()){const e=dr(d.keyframes,o);if(void 0!==e)return Ne.update((()=>{d.onUpdate(e),d.onComplete()})),new ys([])}return!a&&ua.supports(d)?new ua(d):new oa(d)};function va({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,i}function xa(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var a;let{transition:n=e.getDefaultTransition(),transitionEnd:o,...l}=t;i&&(n=i);const c=[],d=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const t=e.getValue(h,null!==(a=e.latestValues[h])&&void 0!==a?a:null),i=l[h];if(void 0===i||d&&va(d,h))continue;const r={delay:s,...vs(n||{},h)};let o=!1;if(window.MotionHandoffAnimation){const t=si(e);if(t){const e=window.MotionHandoffAnimation(t,h,Ne);null!==e&&(r.startTime=e,o=!0)}}ti(e,h),t.start(ya(h,t,i,e.shouldReduceMotion&&Ks.has(h)?{type:!1}:r,e,o));const u=t.animation;u&&c.push(u)}return o&&Promise.all(c).then((()=>{Ne.update((()=>{o&&function(e,t){const s=ms(e,t);let{transitionEnd:i={},transition:r={},...a}=s||{};a={...a,...i};for(const o in a)ei(e,o,(n=a[o],ft(n)?n[n.length-1]||0:n));var n}(e,o)}))})),c}function ba(e,t,s={}){var i;const r=ms(e,t,"exit"===s.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(a=s.transitionOverride);const n=r?()=>Promise.all(xa(e,r,s)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:r=0,staggerChildren:n,staggerDirection:o}=a;return function(e,t,s=0,i=0,r=1,a){const n=[],o=(e.variantChildren.size-1)*i,l=1===r?(e=0)=>e*i:(e=0)=>o-e*i;return Array.from(e.variantChildren).sort(wa).forEach(((e,i)=>{e.notify("AnimationStart",t),n.push(ba(e,t,{...a,delay:s+l(i)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(n)}(e,t,r+i,n,o,s)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,t]="beforeChildren"===l?[n,o]:[o,n];return e().then((()=>t()))}return Promise.all([n(),o(s.delay)])}function wa(e,t){return e.sortNodePosition(t)}const Ea=We.length;function Sa(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Sa(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<Ea;s++){const i=We[s],r=e.props[i];(Ke(r)||!1===r)&&(t[i]=r)}return t}const Ta=[...qe].reverse(),_a=qe.length;function ka(e){return t=>Promise.all(t.map((({animation:t,options:s})=>function(e,t,s={}){let i;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>ba(e,t,s)));i=Promise.all(r)}else if("string"==typeof t)i=ba(e,t,s);else{const r="function"==typeof t?ms(e,t,s.custom):t;i=Promise.all(xa(e,r,s))}return i.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,s))))}function Aa(e){let t=ka(e),s=Pa(),i=!0;const r=t=>(s,i)=>{var r;const a=ms(e,i,"exit"===t?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(a){const{transition:e,transitionEnd:t,...i}=a;s={...s,...i,...t}}return s};function a(a){const{props:n}=e,o=Sa(e.parent)||{},l=[],c=new Set;let d={},h=1/0;for(let t=0;t<_a;t++){const u=Ta[t],f=s[u],m=void 0!==n[u]?n[u]:o[u],g=Ke(m),p=u===a?f.isActive:null;!1===p&&(h=t);let y=m===o[u]&&m!==n[u]&&g;if(y&&i&&e.manuallyAnimateOnMount&&(y=!1),f.protectedKeys={...d},!f.isActive&&null===p||!m&&!f.prevProp||He(m)||"boolean"==typeof m)continue;const v=La(f.prevProp,m);let x=v||u===a&&f.isActive&&!y&&g||t>h&&g,b=!1;const w=Array.isArray(m)?m:[m];let E=w.reduce(r(u),{});!1===p&&(E={});const{prevResolvedValues:S={}}=f,T={...S,...E},_=t=>{x=!0,c.has(t)&&(b=!0,c.delete(t)),f.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in T){const t=E[e],s=S[e];if(d.hasOwnProperty(e))continue;let i=!1;i=ft(t)&&ft(s)?!fs(t,s):t!==s,i?null!=t?_(e):c.add(e):void 0!==t&&c.has(e)?_(e):f.protectedKeys[e]=!0}f.prevProp=m,f.prevResolvedValues=E,f.isActive&&(d={...d,...E}),i&&e.blockInitialAnimation&&(x=!1);x&&(!(y&&v)||b)&&l.push(...w.map((e=>({animation:e,options:{type:u}}))))}if(c.size){const t={};c.forEach((s=>{const i=e.getBaseTarget(s),r=e.getValue(s);r&&(r.liveStyle=!0),t[s]=null!=i?i:null})),l.push({animation:t})}let u=Boolean(l.length);return!i||!1!==n.initial&&n.initial!==n.animate||e.manuallyAnimateOnMount||(u=!1),i=!1,u?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,i){var r;if(s[t].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach((e=>{var s;return null===(s=e.animationState)||void 0===s?void 0:s.setActive(t,i)})),s[t].isActive=i;const n=a(t);for(const e in s)s[e].protectedKeys={};return n},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=Pa(),i=!0}}}function La(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!fs(t,e)}function Ra(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Pa(){return{animate:Ra(!0),whileInView:Ra(),whileHover:Ra(),whileTap:Ra(),whileDrag:Ra(),whileFocus:Ra(),exit:Ra()}}class Na{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Ca=0;const Ia={animation:{Feature:class extends Na{constructor(e){super(e),e.animationState||(e.animationState=Aa(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();He(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Na{constructor(){super(...arguments),this.id=Ca++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}};function Da(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function ja(e){return{point:{x:e.pageX,y:e.pageY}}}function Oa(e,t,s,i){return Da(e,t,(e=>t=>Ms(t)&&e(t,ja(t)))(s),i)}const Ma=(e,t)=>Math.abs(e-t);class Fa{constructor(e,t,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Ba(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=Ma(e.x,t.x),i=Ma(e.y,t.y);return Math.sqrt(s**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!s)return;const{point:i}=e,{timestamp:r}=Ie;this.history.push({...i,timestamp:r});const{onStart:a,onMove:n}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),n&&n(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=$a(t,this.transformPagePoint),Ne.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Ba("pointercancel"===e.type?this.lastMoveEventInfo:$a(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,a),i&&i(e,a)},!Ms(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=i||window;const a=$a(ja(e),this.transformPagePoint),{point:n}=a,{timestamp:o}=Ie;this.history=[{...n,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,Ba(a,this.history)),this.removeListeners=br(Oa(this.contextWindow,"pointermove",this.handlePointerMove),Oa(this.contextWindow,"pointerup",this.handlePointerUp),Oa(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ce(this.updatePoint)}}function $a(e,t){return t?{point:t(e.point)}:e}function Ua(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ba({point:e},t){return{point:e,delta:Ua(e,Ga(t)),offset:Ua(e,Va(t)),velocity:Ka(t,.1)}}function Va(e){return e[0]}function Ga(e){return e[e.length-1]}function Ka(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=Ga(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>ke(t)));)s--;if(!i)return{x:0,y:0};const a=Ae(r.timestamp-i.timestamp);if(0===a)return{x:0,y:0};const n={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return n.x===1/0&&(n.x=0),n.y===1/0&&(n.y=0),n}function Ha(e){return e.max-e.min}function qa(e,t,s,i=.5){e.origin=i,e.originPoint=ur(t.min,t.max,e.origin),e.scale=Ha(s)/Ha(t),e.translate=ur(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Wa(e,t,s,i){qa(e.x,t.x,s.x,i?i.originX:void 0),qa(e.y,t.y,s.y,i?i.originY:void 0)}function za(e,t,s){e.min=s.min+t.min,e.max=e.min+Ha(t)}function Ya(e,t,s){e.min=t.min-s.min,e.max=e.min+Ha(t)}function Xa(e,t,s){Ya(e.x,t.x,s.x),Ya(e.y,t.y,s.y)}function Ja(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function Qa(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}const Za=.35;function en(e,t,s){return{min:tn(e,t),max:tn(e,s)}}function tn(e,t){return"number"==typeof e?e:e[t]||0}const sn=()=>({x:{min:0,max:0},y:{min:0,max:0}});function rn(e){return[e("x"),e("y")]}function an({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function nn(e){return void 0===e||1===e}function on({scale:e,scaleX:t,scaleY:s}){return!nn(e)||!nn(t)||!nn(s)}function ln(e){return on(e)||cn(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function cn(e){return dn(e.x)||dn(e.y)}function dn(e){return e&&"0%"!==e}function hn(e,t,s){return s+t*(e-s)}function un(e,t,s,i,r){return void 0!==r&&(e=hn(e,r,i)),hn(e,s,i)+t}function fn(e,t=0,s=1,i,r){e.min=un(e.min,t,s,i,r),e.max=un(e.max,t,s,i,r)}function mn(e,{x:t,y:s}){fn(e.x,t.translate,t.scale,t.originPoint),fn(e.y,s.translate,s.scale,s.originPoint)}const gn=.999999999999,pn=1.0000000000001;function yn(e,t){e.min=e.min+t,e.max=e.max+t}function vn(e,t,s,i,r=.5){fn(e,t,s,ur(e.min,e.max,r),i)}function xn(e,t){vn(e.x,t.x,t.scaleX,t.scale,t.originX),vn(e.y,t.y,t.scaleY,t.scale,t.originY)}function bn(e,t){return an(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const wn=({current:e})=>e?e.ownerDocument.defaultView:null,En=new WeakMap;class Sn{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Fa(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ja(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:i,onDragStart:r}=this.getProps();if(s&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=s)||"y"===a?Cs[a]?null:(Cs[a]=!0,()=>{Cs[a]=!1}):Cs.x||Cs.y?null:(Cs.x=Cs.y=!0,()=>{Cs.x=Cs.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),rn((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Ct.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const i=s.layout.layoutBox[e];if(i){t=Ha(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Ne.postRender((()=>r(e,t))),ti(this.visualElement,"transform");const{animationState:n}=this.visualElement;n&&n.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:s,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:n}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(n),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,n),this.updateAxis("y",t.point,n),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>rn((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:wn(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Ne.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!Tn(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:s},i){return void 0!==t&&e<t?e=i?ur(t,e,i.min):Math.max(e,t):void 0!==s&&e>s&&(e=i?ur(s,e,i.max):Math.min(e,s)),e}(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&Ze(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,{top:t,left:s,bottom:i,right:r}){return{x:Ja(e.x,s,r),y:Ja(e.y,t,i)}}(i.layoutBox,t),this.elastic=function(e=Za){return!1===e?e=0:!0===e&&(e=Za),{x:en(e,"left","right"),y:en(e,"top","bottom")}}(s),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&rn((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(i.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Ze(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,s){const i=bn(e,s),{scroll:r}=t;return r&&(yn(i.x,r.offset.x),yn(i.y,r.offset.y)),i}(s,i.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Qa(e.x,t.x),y:Qa(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=an(e))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:n}=this.getProps(),o=this.constraints||{},l=rn((n=>{if(!Tn(n,t,this.currentDirection))return;let l=o&&o[n]||{};a&&(l={min:0,max:0});const c=i?200:1e6,d=i?40:1e7,h={type:"inertia",velocity:s?e[n]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(n,h)}));return Promise.all(l).then(n)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return ti(this.visualElement,e),s.start(ya(e,s,0,t,this.visualElement,!1))}stopAnimation(){rn((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){rn((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){rn((t=>{const{drag:s}=this.getProps();if(!Tn(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:s,max:a}=i.layout.layoutBox[t];r.set(e[t]-ur(s,a,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Ze(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};rn((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();i[e]=function(e,t){let s=.5;const i=Ha(e),r=Ha(t);return r>i?s=_e(t.min,t.max-i,e.min):i>r&&(s=_e(e.min,e.max-r,t.min)),kt(0,1,s)}({min:s,max:s},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),rn((t=>{if(!Tn(t,e,null))return;const s=this.getAxisMotionValue(t),{min:r,max:a}=this.constraints[t];s.set(ur(r,a,i[t]))}))}addListeners(){if(!this.visualElement.current)return;En.set(this.visualElement,this);const e=Oa(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();Ze(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Ne.read(t);const r=Da(window,"resize",(()=>this.scalePositionWithinConstraints())),a=s.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(rn((t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Za,dragMomentum:n=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:n}}}function Tn(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const _n=e=>(t,s)=>{e&&Ne.postRender((()=>e(t,s)))};const kn={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function An(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ln={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!It.test(e))return e;e=parseFloat(e)}return`${An(e,t.target.x)}% ${An(e,t.target.y)}%`}},Rn={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=Ii.parse(e);if(r.length>5)return i;const a=Ii.createTransformer(e),n="number"!=typeof r[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;r[0+n]/=o,r[1+n]/=l;const c=ur(o,l,.5);return"number"==typeof r[2+n]&&(r[2+n]/=c),"number"==typeof r[3+n]&&(r[3+n]/=c),a(r)}};class Pn extends Y.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:r}=e;var a;a=Cn,Object.assign(es,a),r&&(t.group&&t.group.add(r),s&&s.register&&i&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),kn.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:r}=this.props,a=s.projection;return a?(a.isPresent=r,i||e.layoutDependency!==t||void 0===t?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||Ne.postRender((()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),it.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Nn(t){const[s,i]=pe(),r=Y.useContext(le);return e.jsx(Pn,{...t,layoutGroup:r,switchLayoutGroup:Y.useContext(rt),isPresent:s,safeToRemove:i})}const Cn={borderRadius:{...Ln,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ln,borderTopRightRadius:Ln,borderBottomLeftRadius:Ln,borderBottomRightRadius:Ln,boxShadow:Rn};const In=(e,t)=>e.depth-t.depth;class Dn{constructor(){this.children=[],this.isDirty=!1}add(e){zs(this.children,e),this.isDirty=!0}remove(e){Ys(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(In),this.isDirty=!1,this.children.forEach(e)}}const jn=["TopLeft","TopRight","BottomLeft","BottomRight"],On=jn.length,Mn=e=>"string"==typeof e?parseFloat(e):e,Fn=e=>"number"==typeof e||It.test(e);function $n(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Un=Vn(0,.5,ui),Bn=Vn(.5,.95,Ee);function Vn(e,t,s){return i=>i<e?0:i>t?1:s(_e(e,t,i))}function Gn(e,t){e.min=t.min,e.max=t.max}function Kn(e,t){Gn(e.x,t.x),Gn(e.y,t.y)}function Hn(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function qn(e,t,s,i,r){return e=hn(e-=t,1/s,i),void 0!==r&&(e=hn(e,1/r,i)),e}function Wn(e,t,[s,i,r],a,n){!function(e,t=0,s=1,i=.5,r,a=e,n=e){Ct.test(t)&&(t=parseFloat(t),t=ur(n.min,n.max,t/100)-n.min);if("number"!=typeof t)return;let o=ur(a.min,a.max,i);e===a&&(o-=t),e.min=qn(e.min,t,s,o,r),e.max=qn(e.max,t,s,o,r)}(e,t[s],t[i],t[r],t.scale,a,n)}const zn=["x","scaleX","originX"],Yn=["y","scaleY","originY"];function Xn(e,t,s,i){Wn(e.x,t,zn,s?s.x:void 0,i?i.x:void 0),Wn(e.y,t,Yn,s?s.y:void 0,i?i.y:void 0)}function Jn(e){return 0===e.translate&&1===e.scale}function Qn(e){return Jn(e.x)&&Jn(e.y)}function Zn(e,t){return e.min===t.min&&e.max===t.max}function eo(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function to(e,t){return eo(e.x,t.x)&&eo(e.y,t.y)}function so(e){return Ha(e.x)/Ha(e.y)}function io(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class ro{constructor(){this.members=[]}add(e){zs(this.members,e),e.scheduleRender()}remove(e){if(Ys(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let s;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&s.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const ao={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},no="undefined"!=typeof window&&void 0!==window.MotionDebug,oo=["","X","Y","Z"],lo={visibility:"hidden"};let co=0;function ho(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function uo(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=si(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Ne,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&uo(i)}function fo({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},s=(null==t?void 0:t())){this.id=co++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,no&&(ao.totalNodes=ao.resolvedTargetDeltas=ao.recalculatedProjection=0),this.nodes.forEach(po),this.nodes.forEach(So),this.nodes.forEach(To),this.nodes.forEach(yo),no&&window.MotionDebug.record(ao)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Dn)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Xs),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,s=this.root.hasTreeAnimated){if(this.instance)return;var i;this.isSVG=(i=t)instanceof SVGElement&&"svg"!==i.tagName,this.instance=t;const{layoutId:r,layout:a,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),s&&(a||r)&&(this.isLayoutDirty=!0),e){let s;const i=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Ws.now(),i=({timestamp:r})=>{const a=r-s;a>=t&&(Ce(i),e(a-t))};return Ne.read(i,!0),()=>Ce(i)}(i,250),kn.hasAnimatedSinceResize&&(kn.hasAnimatedSinceResize=!1,this.nodes.forEach(Eo))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&n&&(r||a)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:s,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||n.getDefaultTransition()||Po,{onLayoutAnimationStart:a,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!to(this.targetLayout,i)||s,c=!t&&s;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const t={...vs(r,"layout"),onPlay:a,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||Eo(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ce(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(_o),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&uo(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(xo);this.isUpdating||this.nodes.forEach(bo),this.isUpdating=!1,this.nodes.forEach(wo),this.nodes.forEach(mo),this.nodes.forEach(go),this.clearAllSnapshots();const e=Ws.now();Ie.delta=kt(0,1e3/60,e-Ie.timestamp),Ie.timestamp=e,Ie.isProcessing=!0,De.update.process(Ie),De.preRender.process(Ie),De.render.process(Ie),Ie.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,it.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(vo),this.sharedNodes.forEach(ko)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ne.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ne.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Qn(this.projectionDelta),s=this.getTransformTemplate(),i=s?s(this.latestValues,""):void 0,a=i!==this.prevTransformTemplateValue;e&&(t||ln(this.latestValues)||a)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var i;return e&&(s=this.removeTransform(s)),Io((i=s).x),Io(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const s=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(jo))){const{scroll:e}=this.root;e&&(yn(s.x,e.offset.x),yn(s.y,e.offset.y))}return s}removeElementScroll(e){var t;const s={x:{min:0,max:0},y:{min:0,max:0}};if(Kn(s,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return s;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:a}=t;t!==this.root&&r&&a.layoutScroll&&(r.wasRoot&&Kn(s,e),yn(s.x,r.offset.x),yn(s.y,r.offset.y))}return s}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};Kn(s,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&xn(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),ln(e.latestValues)&&xn(s,e.latestValues)}return ln(this.latestValues)&&xn(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Kn(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!ln(e.latestValues))continue;on(e.latestValues)&&e.updateSnapshot();const i={x:{min:0,max:0},y:{min:0,max:0}};Kn(i,e.measurePageBox()),Xn(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return ln(this.latestValues)&&Xn(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ie.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==s;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=Ie.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Xa(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Kn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var n,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,o=this.relativeTarget,l=this.relativeParent.target,za(n.x,o.x,l.x),za(n.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Kn(this.target,this.layout.layoutBox),mn(this.target,this.targetDelta)):Kn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Xa(this.relativeTargetOrigin,this.target,e.target),Kn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}no&&ao.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!on(this.parent.latestValues)&&!cn(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),s=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Ie.timestamp&&(i=!1),i)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;Kn(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,o=this.treeScale.y;!function(e,t,s,i=!1){const r=s.length;if(!r)return;let a,n;t.x=t.y=1;for(let o=0;o<r;o++){a=s[o],n=a.projectionDelta;const{visualElement:r}=a.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&xn(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),n&&(t.x*=n.x.scale,t.y*=n.y.scale,mn(e,n)),i&&ln(a.latestValues)&&xn(e,a.latestValues))}t.x<pn&&t.x>gn&&(t.x=1),t.y<pn&&t.y>gn&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,s),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(Hn(this.prevProjectionDelta.x,this.projectionDelta.x),Hn(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Wa(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===n&&this.treeScale.y===o&&io(this.projectionDelta.x,this.prevProjectionDelta.x)&&io(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),no&&ao.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,i=s?s.latestValues:{},r={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const n={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Ro));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var l,u,f,m,g,p;Ao(a.x,e.x,s),Ao(a.y,e.y,s),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Xa(n,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,m=this.relativeTargetOrigin,g=n,p=s,Lo(f.x,m.x,g.x,p),Lo(f.y,m.y,g.y,p),h&&(l=this.relativeTarget,u=h,Zn(l.x,u.x)&&Zn(l.y,u.y))&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Kn(h,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,s,i,r,a){r?(e.opacity=ur(0,void 0!==s.opacity?s.opacity:1,Un(i)),e.opacityExit=ur(void 0!==t.opacity?t.opacity:1,0,Bn(i))):a&&(e.opacity=ur(void 0!==t.opacity?t.opacity:1,void 0!==s.opacity?s.opacity:1,i));for(let n=0;n<On;n++){const r=`border${jn[n]}Radius`;let a=$n(t,r),o=$n(s,r);void 0===a&&void 0===o||(a||(a=0),o||(o=0),0===a||0===o||Fn(a)===Fn(o)?(e[r]=Math.max(ur(Mn(a),Mn(o),i),0),(Ct.test(o)||Ct.test(a))&&(e[r]+="%")):e[r]=o)}(t.rotate||s.rotate)&&(e.rotate=ur(t.rotate||0,s.rotate||0,i))}(r,i,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ce(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ne.update((()=>{kn.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,s){const i=mt(e)?e:Zs(e);return i.start(ya("",i,t,s)),i.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:i,latestValues:r}=e;if(t&&s&&i){if(this!==e&&this.layout&&i&&Do(this.options.animationType,this.layout.layoutBox,i.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Ha(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const i=Ha(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+i}Kn(t,s),xn(t,r),Wa(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new ro);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const i=this.getStack();i&&i.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const i={};s.z&&ho("z",e,i,this.animationValues);for(let r=0;r<oo.length;r++)ho(`rotate${oo[r]}`,e,i,this.animationValues),ho(`skew${oo[r]}`,e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}getProjectionStyles(e){var t,s;if(!this.instance||this.isSVG)return;if(!this.isVisible)return lo;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=gt(null==e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=gt(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!ln(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const n=a.animationValues||a.latestValues;this.applyTransformsToTarget(),i.transform=function(e,t,s){let i="";const r=e.x.translate/t.x,a=e.y.translate/t.y,n=(null==s?void 0:s.z)||0;if((r||a||n)&&(i=`translate3d(${r}px, ${a}px, ${n}px) `),1===t.x&&1===t.y||(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:a,skewX:n,skewY:o}=s;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),a&&(i+=`rotateY(${a}deg) `),n&&(i+=`skewX(${n}deg) `),o&&(i+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(i+=`scale(${o}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,n),r&&(i.transform=r(n,i.transform));const{x:o,y:l}=this.projectionDelta;i.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,a.animationValues?i.opacity=a===this?null!==(s=null!==(t=n.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==s?s:1:this.preserveOpacity?this.latestValues.opacity:n.opacityExit:i.opacity=a===this?void 0!==n.opacity?n.opacity:"":void 0!==n.opacityExit?n.opacityExit:0;for(const c in es){if(void 0===n[c])continue;const{correct:e,applyTo:t}=es[c],s="none"===i.transform?n[c]:e(n[c],a);if(t){const e=t.length;for(let r=0;r<e;r++)i[t[r]]=s}else i[c]=s}return this.options.layoutId&&(i.pointerEvents=a===this?gt(null==e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(xo),this.root.sharedNodes.clear()}}}function mo(e){e.updateLayout()}function go(e){var t;const s=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,a=s.source!==e.layout.source;"size"===r?rn((e=>{const i=a?s.measuredBox[e]:s.layoutBox[e],r=Ha(i);i.min=t[e].min,i.max=i.min+r})):Do(r,s.layoutBox,t)&&rn((i=>{const r=a?s.measuredBox[i]:s.layoutBox[i],n=Ha(t[i]);r.max=r.min+n,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+n)}));const n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Wa(n,t,s.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?Wa(o,e.applyTransform(i,!0),s.measuredBox):Wa(o,t,s.layoutBox);const l=!Qn(n);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:a}=i;if(r&&a){const n={x:{min:0,max:0},y:{min:0,max:0}};Xa(n,s.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Xa(o,t,a.layoutBox),to(n,o)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=n,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:s,delta:o,layoutDelta:n,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function po(e){no&&ao.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function yo(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function vo(e){e.clearSnapshot()}function xo(e){e.clearMeasurements()}function bo(e){e.isLayoutDirty=!1}function wo(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Eo(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function So(e){e.resolveTargetDelta()}function To(e){e.calcProjection()}function _o(e){e.resetSkewAndRotation()}function ko(e){e.removeLeadSnapshot()}function Ao(e,t,s){e.translate=ur(t.translate,0,s),e.scale=ur(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Lo(e,t,s,i){e.min=ur(t.min,s.min,i),e.max=ur(t.max,s.max,i)}function Ro(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Po={duration:.45,ease:[.4,0,.1,1]},No=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Co=No("applewebkit/")&&!No("chrome/")?Math.round:Ee;function Io(e){e.min=Co(e.min),e.max=Co(e.max)}function Do(e,t,s){return"position"===e||"preserve-aspect"===e&&(i=so(t),r=so(s),a=.2,!(Math.abs(i-r)<=a));var i,r,a}function jo(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const Oo=fo({attachResizeListener:(e,t)=>Da(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Mo={current:void 0},Fo=fo({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Mo.current){const e=new Oo({});e.mount(window),e.setOptions({layoutScroll:!0}),Mo.current=e}return Mo.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),$o={pan:{Feature:class extends Na{constructor(){super(...arguments),this.removePointerDownListener=Ee}onPointerDown(e){this.session=new Fa(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:wn(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:_n(e),onStart:_n(t),onMove:s,onEnd:(e,t)=>{delete this.session,i&&Ne.postRender((()=>i(e,t)))}}}mount(){this.removePointerDownListener=Oa(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Na{constructor(e){super(e),this.removeGroupControls=Ee,this.removeListeners=Ee,this.controls=new Sn(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ee}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Fo,MeasureLayout:Nn}};function Uo(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===s);const r=i["onHover"+s];r&&Ne.postRender((()=>r(t,ja(t))))}function Bo(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===s);const r=i["onTap"+("End"===s?"":s)];r&&Ne.postRender((()=>r(t,ja(t))))}const Vo=new WeakMap,Go=new WeakMap,Ko=e=>{const t=Vo.get(e.target);t&&t(e)},Ho=e=>{e.forEach(Ko)};function qo(e,t,s){const i=function({root:e,...t}){const s=e||document;Go.has(s)||Go.set(s,{});const i=Go.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Ho,{root:e,...t})),i[r]}(t);return Vo.set(e,s),i.observe(e),()=>{Vo.delete(e),i.unobserve(e)}}const Wo={some:0,all:1};const zo={inView:{Feature:class extends Na{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:r}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof i?i:Wo[i]};return qo(this.node.current,a,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:i}=this.node.getProps(),a=t?s:i;a&&a(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Na{mount(){const{current:e}=this.node;e&&(this.unmount=Gs(e,(e=>(Bo(this.node,e,"Start"),(e,{success:t})=>Bo(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Na{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=br(Da(this.node.current,"focus",(()=>this.onFocus())),Da(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends Na{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[i,r,a]=Ds(e,s),n=js((e=>{const{target:s}=e,i=t(e);if("function"!=typeof i||!s)return;const a=js((e=>{i(e),s.removeEventListener("pointerleave",a)}));s.addEventListener("pointerleave",a,r)}));return i.forEach((e=>{e.addEventListener("pointerenter",n,r)})),a}(e,(e=>(Uo(this.node,e,"Start"),e=>Uo(this.node,e,"End")))))}unmount(){}}}},Yo={layout:{ProjectionNode:Fo,MeasureLayout:Nn}},Xo={current:null},Jo={current:!1};const Qo=[...rr,Ti,Ii],Zo=new WeakMap;const el=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class tl{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},n={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Zi,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Ws.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Ne.render(this.render,!1,!0))};const{latestValues:o,renderState:l,onUpdate:c}=a;this.onUpdate=c,this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=n,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=ze(t),this.isVariantNode=Ye(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const u in h){const e=h[u];void 0!==o[u]&&mt(e)&&e.set(o[u],!1)}}mount(e){this.current=e,Zo.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Jo.current||function(){if(Jo.current=!0,xe)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Xo.current=e.matches;e.addListener(t),t()}else Xo.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Xo.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Zo.delete(this.current),this.projection&&this.projection.unmount(),Ce(this.notifyUpdate),Ce(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=xt.has(e),i=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Ne.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{i(),r(),a&&a(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Me){const t=Me[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<el.length;s++){const t=el[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,s){for(const i in t){const r=t[i],a=s[i];if(mt(r))e.addValue(i,r);else if(mt(a))e.addValue(i,Zs(r,{owner:e}));else if(a!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,Zs(void 0!==t?t:r,{owner:e}))}}for(const i in s)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=Zs(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let i=void 0===this.latestValues[e]&&this.current?null!==(s=this.getBaseTargetFromProps(this.props,e))&&void 0!==s?s:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=i&&("string"==typeof i&&(er(i)||mi(i))?i=parseFloat(i):(r=i,!Qo.find(ir(r))&&Ii.test(t)&&(i=Ui(e,t))),this.setBaseTarget(e,mt(i)?i.get():i)),mt(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:s}=this.props;let i;if("string"==typeof s||"object"==typeof s){const r=ut(this.props,s,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);r&&(i=r[e])}if(s&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||mt(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new Xs),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class sl extends tl{constructor(){super(...arguments),this.KeyframeResolver=nr}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;mt(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}class il extends sl{constructor(){super(...arguments),this.type="html",this.renderInstance=Jt}readValueFromInstance(e,t){if(xt.has(t)){const e=$i(t);return e&&e.default||0}{const i=(s=e,window.getComputedStyle(s)),r=(wt(t)?i.getPropertyValue(t):i[t])||0;return"string"==typeof r?r.trim():r}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return bn(e,t)}build(e,t,s){Gt(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return ss(e,t,s)}}class rl extends sl{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=sn}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(xt.has(t)){const e=$i(t);return e&&e.default||0}return t=Qt.has(t)?t:tt(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return is(e,t,s)}build(e,t,s){Wt(e,t,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,s,i){Zt(e,t,0,i)}mount(e){this.isSVGTag=Xt(e.tagName),super.mount(e)}}const al=Ve(us({...Ia,...zo,...$o,...Yo},((e,t)=>dt(e)?new rl(t):new il(t,{allowProjection:e!==Y.Fragment}))));function nl(e){var t,s,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=nl(e[t]))&&(i&&(i+=" "),i+=s)}else for(s in e)e[s]&&(i&&(i+=" "),i+=s);return i}function ol(){for(var e,t,s=0,i="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=nl(e))&&(i&&(i+=" "),i+=t);return i}const ll=e=>{const t=ul(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),cl(s,t)||hl(e)},getConflictingClassGroupIds:(e,t)=>{const r=s[e]||[];return t&&i[e]?[...r,...i[e]]:r}}},cl=(e,t)=>{if(0===e.length)return t.classGroupId;const s=e[0],i=t.nextPart.get(s),r=i?cl(e.slice(1),i):void 0;if(r)return r;if(0===t.validators.length)return;const a=e.join("-");return t.validators.find((({validator:e})=>e(a)))?.classGroupId},dl=/^\[(.+)\]$/,hl=e=>{if(dl.test(e)){const t=dl.exec(e)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},ul=e=>{const{theme:t,prefix:s}=e,i={nextPart:new Map,validators:[]};return pl(Object.entries(e.classGroups),s).forEach((([e,s])=>{fl(s,i,e,t)})),i},fl=(e,t,s,i)=>{e.forEach((e=>{if("string"!=typeof e){if("function"==typeof e)return gl(e)?void fl(e(i),t,s,i):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach((([e,r])=>{fl(r,ml(t,e),s,i)}))}else{(""===e?t:ml(t,e)).classGroupId=s}}))},ml=(e,t)=>{let s=e;return t.split("-").forEach((e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)})),s},gl=e=>e.isThemeGetter,pl=(e,t)=>t?e.map((([e,s])=>[e,s.map((e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,s])=>[t+e,s]))):e))])):e,yl=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,i=new Map;const r=(r,a)=>{s.set(r,a),t++,t>e&&(t=0,i=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=i.get(e))?(r(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):r(e,t)}}},vl=e=>{const{separator:t,experimentalParseClassName:s}=e,i=1===t.length,r=t[0],a=t.length,n=e=>{const s=[];let n,o=0,l=0;for(let h=0;h<e.length;h++){let c=e[h];if(0===o){if(c===r&&(i||e.slice(h,h+a)===t)){s.push(e.slice(l,h)),l=h+a;continue}if("/"===c){n=h;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:n&&n>l?n-l:void 0}};return s?e=>s({className:e,parseClassName:n}):n},xl=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach((e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)})),t.push(...s.sort()),t},bl=/\s+/;function wl(){let e,t,s=0,i="";for(;s<arguments.length;)(e=arguments[s++])&&(t=El(e))&&(i&&(i+=" "),i+=t);return i}const El=e=>{if("string"==typeof e)return e;let t,s="";for(let i=0;i<e.length;i++)e[i]&&(t=El(e[i]))&&(s&&(s+=" "),s+=t);return s};function Sl(e,...t){let s,i,r,a=function(o){const l=t.reduce(((e,t)=>t(e)),e());return s=(e=>({cache:yl(e.cacheSize),parseClassName:vl(e),...ll(e)}))(l),i=s.cache.get,r=s.cache.set,a=n,n(o)};function n(e){const t=i(e);if(t)return t;const a=((e,t)=>{const{parseClassName:s,getClassGroupId:i,getConflictingClassGroupIds:r}=t,a=[],n=e.trim().split(bl);let o="";for(let l=n.length-1;l>=0;l-=1){const e=n[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:h}=s(e);let u=Boolean(h),f=i(u?d.substring(0,h):d);if(!f){if(!u){o=e+(o.length>0?" "+o:o);continue}if(f=i(d),!f){o=e+(o.length>0?" "+o:o);continue}u=!1}const m=xl(t).join(":"),g=c?m+"!":m,p=g+f;if(a.includes(p))continue;a.push(p);const y=r(f,u);for(let s=0;s<y.length;++s){const e=y[s];a.push(g+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return r(e,a),a}return function(){return a(wl.apply(null,arguments))}}const Tl=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},_l=/^\[(?:([a-z-]+):)?(.+)\]$/i,kl=/^\d+\/\d+$/,Al=new Set(["px","full","screen"]),Ll=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Rl=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Pl=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Nl=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Cl=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Il=e=>jl(e)||Al.has(e)||kl.test(e),Dl=e=>zl(e,"length",Yl),jl=e=>Boolean(e)&&!Number.isNaN(Number(e)),Ol=e=>zl(e,"number",jl),Ml=e=>Boolean(e)&&Number.isInteger(Number(e)),Fl=e=>e.endsWith("%")&&jl(e.slice(0,-1)),$l=e=>_l.test(e),Ul=e=>Ll.test(e),Bl=new Set(["length","size","percentage"]),Vl=e=>zl(e,Bl,Xl),Gl=e=>zl(e,"position",Xl),Kl=new Set(["image","url"]),Hl=e=>zl(e,Kl,Ql),ql=e=>zl(e,"",Jl),Wl=()=>!0,zl=(e,t,s)=>{const i=_l.exec(e);return!!i&&(i[1]?"string"==typeof t?i[1]===t:t.has(i[1]):s(i[2]))},Yl=e=>Rl.test(e)&&!Pl.test(e),Xl=()=>!1,Jl=e=>Nl.test(e),Ql=e=>Cl.test(e),Zl=()=>{const e=Tl("colors"),t=Tl("spacing"),s=Tl("blur"),i=Tl("brightness"),r=Tl("borderColor"),a=Tl("borderRadius"),n=Tl("borderSpacing"),o=Tl("borderWidth"),l=Tl("contrast"),c=Tl("grayscale"),d=Tl("hueRotate"),h=Tl("invert"),u=Tl("gap"),f=Tl("gradientColorStops"),m=Tl("gradientColorStopPositions"),g=Tl("inset"),p=Tl("margin"),y=Tl("opacity"),v=Tl("padding"),x=Tl("saturate"),b=Tl("scale"),w=Tl("sepia"),E=Tl("skew"),S=Tl("space"),T=Tl("translate"),_=()=>["auto",$l,t],k=()=>[$l,t],A=()=>["",Il,Dl],L=()=>["auto",jl,$l],R=()=>["","0",$l],P=()=>[jl,$l];return{cacheSize:500,separator:":",theme:{colors:[Wl],spacing:[Il,Dl],blur:["none","",Ul,$l],brightness:P(),borderColor:[e],borderRadius:["none","","full",Ul,$l],borderSpacing:k(),borderWidth:A(),contrast:P(),grayscale:R(),hueRotate:P(),invert:R(),gap:k(),gradientColorStops:[e],gradientColorStopPositions:[Fl,Dl],inset:_(),margin:_(),opacity:P(),padding:k(),saturate:P(),scale:P(),sepia:R(),skew:P(),space:k(),translate:k()},classGroups:{aspect:[{aspect:["auto","square","video",$l]}],container:["container"],columns:[{columns:[Ul]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",$l]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ml,$l]}],basis:[{basis:_()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",$l]}],grow:[{grow:R()}],shrink:[{shrink:R()}],order:[{order:["first","last","none",Ml,$l]}],"grid-cols":[{"grid-cols":[Wl]}],"col-start-end":[{col:["auto",{span:["full",Ml,$l]},$l]}],"col-start":[{"col-start":L()}],"col-end":[{"col-end":L()}],"grid-rows":[{"grid-rows":[Wl]}],"row-start-end":[{row:["auto",{span:[Ml,$l]},$l]}],"row-start":[{"row-start":L()}],"row-end":[{"row-end":L()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",$l]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",$l]}],gap:[{gap:[u]}],"gap-x":[{"gap-x":[u]}],"gap-y":[{"gap-y":[u]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[p]}],mx:[{mx:[p]}],my:[{my:[p]}],ms:[{ms:[p]}],me:[{me:[p]}],mt:[{mt:[p]}],mr:[{mr:[p]}],mb:[{mb:[p]}],ml:[{ml:[p]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",$l,t]}],"min-w":[{"min-w":[$l,t,"min","max","fit"]}],"max-w":[{"max-w":[$l,t,"none","full","min","max","fit","prose",{screen:[Ul]},Ul]}],h:[{h:[$l,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[$l,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[$l,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[$l,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ul,Dl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ol]}],"font-family":[{font:[Wl]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",$l]}],"line-clamp":[{"line-clamp":["none",jl,Ol]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Il,$l]}],"list-image":[{"list-image":["none",$l]}],"list-style-type":[{list:["none","disc","decimal",$l]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Il,Dl]}],"underline-offset":[{"underline-offset":["auto",Il,$l]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",$l]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",$l]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Gl]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Vl]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Hl]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[Il,$l]}],"outline-w":[{outline:[Il,Dl]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:A()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Il,Dl]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Ul,ql]}],"shadow-color":[{shadow:[Wl]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[i]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ul,$l]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[x]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[x]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[n]}],"border-spacing-x":[{"border-spacing-x":[n]}],"border-spacing-y":[{"border-spacing-y":[n]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",$l]}],duration:[{duration:P()}],ease:[{ease:["linear","in","out","in-out",$l]}],delay:[{delay:P()}],animate:[{animate:["none","spin","ping","pulse","bounce",$l]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Ml,$l]}],"translate-x":[{"translate-x":[T]}],"translate-y":[{"translate-y":[T]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",$l]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",$l]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",$l]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Il,Dl,Ol]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ec=Sl(Zl);function tc(...e){return ec(ol(e))}const sc=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,ic=ol,rc=(e,t)=>s=>{var i;if(null==(null==t?void 0:t.variants))return ic(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:r,defaultVariants:a}=t,n=Object.keys(r).map((e=>{const t=null==s?void 0:s[e],i=null==a?void 0:a[e];if(null===t)return null;const n=sc(t)||sc(i);return r[e][n]})),o=s&&Object.entries(s).reduce(((e,t)=>{let[s,i]=t;return void 0===i||(e[s]=i),e}),{}),l=null==t||null===(i=t.compoundVariants)||void 0===i?void 0:i.reduce(((e,t)=>{let{class:s,className:i,...r}=t;return Object.entries(r).every((e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...o}[t]):{...a,...o}[t]===s}))?[...e,s,i]:e}),[]);return ic(e,n,l,null==s?void 0:s.class,null==s?void 0:s.className)},ac=rc("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),nc=X.forwardRef((({className:s,variant:i,size:r,asChild:a=!1,...n},o)=>{const l=a?t:"button";return e.jsx(l,{className:tc(ac({variant:i,size:r,className:s})),ref:o,...n})}));nc.displayName="Button";const oc={},lc=(e,t,s,i)=>{uc(s)&&oc[s]||(uc(s)&&(oc[s]=new Date),((e,t,s,i)=>{const r=[s,{code:t,...i||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(r,"warn","react-i18next::",!0);uc(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...r):console})(e,t,s,i))},cc=(e,t)=>()=>{if(e.isInitialized)t();else{const s=()=>{setTimeout((()=>{e.off("initialized",s)}),0),t()};e.on("initialized",s)}},dc=(e,t,s)=>{e.loadNamespaces(t,cc(e,s))},hc=(e,t,s,i)=>{if(uc(s)&&(s=[s]),e.options.preload&&e.options.preload.indexOf(t)>-1)return dc(e,s,i);s.forEach((t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)})),e.loadLanguages(t,cc(e,i))},uc=e=>"string"==typeof e,fc=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,mc={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},gc=e=>mc[e];let pc={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(fc,gc)};let yc;const vc={type:"3rdParty",init(e){((e={})=>{pc={...pc,...e}})(e.options.react),(e=>{yc=e})(e)}},xc=Y.createContext();class bc{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach((e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)}))}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const wc=(e,t,s,i)=>e.getFixedT(t,s,i),Ec=(e,t={})=>{const{i18n:s}=t,{i18n:i,defaultNS:r}=Y.useContext(xc)||{},a=s||i||yc;if(a&&!a.reportNamespaces&&(a.reportNamespaces=new bc),!a){lc(a,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const e=(e,t)=>{return uc(t)?t:"object"==typeof(s=t)&&null!==s&&uc(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var s},t=[e,{},!1];return t.t=e,t.i18n={},t.ready=!1,t}a.options.react?.wait&&lc(a,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const n={...pc,...a.options.react,...t},{useSuspense:o,keyPrefix:l}=n;let c=r||a.options?.defaultNS;c=uc(c)?[c]:c||["translation"],a.reportNamespaces.addUsedNamespaces?.(c);const d=(a.isInitialized||a.initializedStoreOnce)&&c.every((e=>((e,t,s={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:s.lng,precheck:(t,i)=>{if(s.bindI18n?.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!i(t.isLanguageChangingTo,e))return!1}}):(lc(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,a,n))),h=((e,t,s,i)=>Y.useCallback(wc(e,t,s,i),[e,t,s,i]))(a,t.lng||null,"fallback"===n.nsMode?c:c[0],l),u=()=>h,f=()=>wc(a,t.lng||null,"fallback"===n.nsMode?c:c[0],l),[m,g]=Y.useState(u);let p=c.join();t.lng&&(p=`${t.lng}${p}`);const y=((e,t)=>{const s=Y.useRef();return Y.useEffect((()=>{s.current=e}),[e,t]),s.current})(p),v=Y.useRef(!0);Y.useEffect((()=>{const{bindI18n:e,bindI18nStore:s}=n;v.current=!0,d||o||(t.lng?hc(a,t.lng,c,(()=>{v.current&&g(f)})):dc(a,c,(()=>{v.current&&g(f)}))),d&&y&&y!==p&&v.current&&g(f);const i=()=>{v.current&&g(f)};return e&&a?.on(e,i),s&&a?.store.on(s,i),()=>{v.current=!1,a&&e?.split(" ").forEach((e=>a.off(e,i))),s&&a&&s.split(" ").forEach((e=>a.store.off(e,i)))}}),[a,p]),Y.useEffect((()=>{v.current&&d&&g(u)}),[a,l,d]);const x=[m,a,d];if(x.t=m,x.i18n=a,x.ready=d,d)return x;if(!d&&!o)return x;throw new Promise((e=>{t.lng?hc(a,t.lng,c,(()=>e())):dc(a,c,(()=>e()))}))},Sc=({className:t})=>{const{t:s}=Ec();return e.jsx("img",{src:"/LOGO UFC.png",alt:s("logo.alt"),className:`h-24 w-auto object-contain ${t}`})};
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Tc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _c=(e,t)=>{const s=Y.forwardRef((({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,...l},c)=>{return Y.createElement("svg",{ref:c,...Tc,width:i,height:i,stroke:s,strokeWidth:a?24*Number(r)/Number(i):r,className:["lucide",`lucide-${d=e,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,n].join(" "),...l},[...t.map((([e,t])=>Y.createElement(e,t))),...Array.isArray(o)?o:[o]]);var d}));return s.displayName=`${e}`,s},kc=_c("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ac=_c("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Lc=_c("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),Rc=_c("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),Pc=_c("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Nc=_c("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Cc=_c("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Ic=_c("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Dc=_c("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),jc=_c("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),Oc=_c("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Mc=_c("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Fc=_c("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),$c=_c("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),Uc=_c("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Bc=_c("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Vc=_c("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Gc=_c("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Kc=_c("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Hc=_c("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),qc=_c("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),Wc=_c("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),zc=_c("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Yc=_c("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Xc=_c("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Jc=_c("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Qc=_c("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Zc=_c("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ed=_c("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),td=_c("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),sd=_c("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),id=_c("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),rd=_c("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ad=_c("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),nd=_c("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),od=_c("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),ld=_c("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),cd=_c("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),dd=_c("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),hd=_c("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),ud=_c("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),fd=_c("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),md=_c("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),gd=_c("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),pd=_c("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),yd=_c("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),vd=_c("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),xd=_c("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),bd=_c("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),wd=l,Ed=c,Sd=a,Td=i,_d=X.forwardRef((({className:t,...i},r)=>e.jsx(s,{className:tc("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i,ref:r})));_d.displayName=s.displayName;const kd=rc("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Ad=X.forwardRef((({side:t="right",className:s,children:i,...n},o)=>e.jsxs(Td,{children:[e.jsx(_d,{}),e.jsxs(r,{ref:o,className:tc(kd({side:t}),s),...n,children:[i,e.jsxs(a,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(xd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Ad.displayName=r.displayName;const Ld=({className:t,...s})=>e.jsx("div",{className:tc("flex flex-col space-y-2 text-center sm:text-left",t),...s});Ld.displayName="SheetHeader";const Rd=X.forwardRef((({className:t,...s},i)=>e.jsx(n,{ref:i,className:tc("text-lg font-semibold text-foreground",t),...s})));Rd.displayName=n.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(o,{ref:i,className:tc("text-sm text-muted-foreground",t),...s}))).displayName=o.displayName;const Pd={},Nd=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");i=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in Pd)return;Pd[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise(((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};class Cd extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Id extends Cd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Dd extends Cd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class jd extends Cd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Od;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Od||(Od={}));var Md=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class Fd{constructor(e,{headers:t={},customFetch:s,region:i=Od.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Nd((async()=>{const{default:e}=await Promise.resolve().then((()=>Jd));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Md(this,void 0,void 0,(function*(){try{const{headers:i,method:r,body:a}=t;let n,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",n=a):"string"==typeof a?(o["Content-Type"]="text/plain",n=a):"undefined"!=typeof FormData&&a instanceof FormData?n=a:(o["Content-Type"]="application/json",n=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:n}).catch((e=>{throw new Id(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new Dd(c);if(!c.ok)throw new jd(c);let h,u=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),{data:h,error:null}}catch(i){return{data:null,error:i}}}))}}var $d={},Ud={},Bd={},Vd={},Gd={},Kd={},Hd=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const qd=Hd.fetch,Wd=Hd.fetch.bind(Hd),zd=Hd.Headers,Yd=Hd.Request,Xd=Hd.Response,Jd=Object.freeze(Object.defineProperty({__proto__:null,Headers:zd,Request:Yd,Response:Xd,default:Wd,fetch:qd},Symbol.toStringTag,{value:"Module"})),Qd=J(Jd);var Zd={};Object.defineProperty(Zd,"__esModule",{value:!0});let eh=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Zd.default=eh;var th=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Kd,"__esModule",{value:!0});const sh=th(Qd),ih=th(Zd);Kd.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=sh.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,i;let r=null,a=null,n=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const i=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");i&&c&&c.length>1&&(n=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(r={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,n=null,o=406,l="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{r=JSON.parse(t),Array.isArray(r)&&404===e.status&&(a=[],r=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):r={message:t}}if(r&&this.isMaybeSingle&&(null===(i=null==r?void 0:r.details)||void 0===i?void 0:i.includes("0 rows"))&&(r=null,o=200,l="OK"),r&&this.shouldThrowOnError)throw new ih.default(r)}return{error:r,data:a,count:n,status:o,statusText:l}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,i;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(i=null==e?void 0:e.code)&&void 0!==i?i:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var rh=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Gd,"__esModule",{value:!0});const ah=rh(Kd);let nh=class extends ah.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:r=i}={}){const a=r?`${r}.order`:"order",n=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const r=void 0===i?"offset":`${i}.offset`,a=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:r=!1,format:a="text"}={}){var n;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.Accept)&&void 0!==n?n:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Gd.default=nh;var oh=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Vd,"__esModule",{value:!0});const lh=oh(Gd);let ch=class extends lh.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let r="";"plain"===i?r="pl":"phrase"===i?r="ph":"websearch"===i&&(r="w");const a=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Vd.default=ch;var dh=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Bd,"__esModule",{value:!0});const hh=dh(Vd);Bd.default=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let r=!1;const a=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e))).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new hh.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new hh.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:r=!0}={}){const a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new hh.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new hh.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new hh.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var uh={},fh={};Object.defineProperty(fh,"__esModule",{value:!0}),fh.version=void 0,fh.version="0.0.0-automated",Object.defineProperty(uh,"__esModule",{value:!0}),uh.DEFAULT_HEADERS=void 0;const mh=fh;uh.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${mh.version}`};var gh=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ud,"__esModule",{value:!0});const ph=gh(Bd),yh=gh(Vd),vh=uh;Ud.default=class e{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},vh.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new ph.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:r}={}){let a;const n=new URL(`${this.url}/rpc/${e}`);let o;s||i?(a=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{n.searchParams.append(e,t)}))):(a="POST",o=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new yh.default({method:a,url:n,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var xh=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($d,"__esModule",{value:!0}),$d.PostgrestError=$d.PostgrestBuilder=$d.PostgrestTransformBuilder=$d.PostgrestFilterBuilder=$d.PostgrestQueryBuilder=$d.PostgrestClient=void 0;const bh=xh(Ud);$d.PostgrestClient=bh.default;const wh=xh(Bd);$d.PostgrestQueryBuilder=wh.default;const Eh=xh(Vd);$d.PostgrestFilterBuilder=Eh.default;const Sh=xh(Gd);$d.PostgrestTransformBuilder=Sh.default;const Th=xh(Kd);$d.PostgrestBuilder=Th.default;const _h=xh(Zd);$d.PostgrestError=_h.default;var kh=$d.default={PostgrestClient:bh.default,PostgrestQueryBuilder:wh.default,PostgrestFilterBuilder:Eh.default,PostgrestTransformBuilder:Sh.default,PostgrestBuilder:Th.default,PostgrestError:_h.default};const{PostgrestClient:Ah,PostgrestQueryBuilder:Lh,PostgrestFilterBuilder:Rh,PostgrestTransformBuilder:Ph,PostgrestBuilder:Nh,PostgrestError:Ch}=kh;let Ih;Ih="undefined"==typeof window?require("ws"):window.WebSocket;const Dh={"X-Client-Info":"realtime-js/2.11.10"};var jh,Oh,Mh,Fh,$h,Uh;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(jh||(jh={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(Oh||(Oh={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(Mh||(Mh={})),function(e){e.websocket="websocket"}(Fh||(Fh={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}($h||($h={}));class Bh{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let a=this.HEADER_LENGTH+2;const n=s.decode(e.slice(a,a+i));a+=i;const o=s.decode(e.slice(a,a+r));a+=r;return{ref:null,topic:n,event:o,payload:JSON.parse(s.decode(e.slice(a,e.byteLength)))}}}class Vh{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(Uh||(Uh={}));const Gh=(e,t,s={})=>{var i;const r=null!==(i=s.skipTypes)&&void 0!==i?i:[];return Object.keys(t).reduce(((s,i)=>(s[i]=Kh(i,e,t,r),s)),{})},Kh=(e,t,s,i)=>{const r=t.find((t=>t.name===e)),a=null==r?void 0:r.type,n=s[e];return a&&!i.includes(a)?Hh(a,n):qh(n)},Hh=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Xh(t,s)}switch(e){case Uh.bool:return Wh(t);case Uh.float4:case Uh.float8:case Uh.int2:case Uh.int4:case Uh.int8:case Uh.numeric:case Uh.oid:return zh(t);case Uh.json:case Uh.jsonb:return Yh(t);case Uh.timestamp:return Jh(t);case Uh.abstime:case Uh.date:case Uh.daterange:case Uh.int4range:case Uh.int8range:case Uh.money:case Uh.reltime:case Uh.text:case Uh.time:case Uh.timestamptz:case Uh.timetz:case Uh.tsrange:case Uh.tstzrange:default:return qh(t)}},qh=e=>e,Wh=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},zh=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Yh=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},Xh=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,i=e[s];if("{"===e[0]&&"}"===i){let i;const a=e.slice(1,s);try{i=JSON.parse("["+a+"]")}catch(r){i=a?a.split(","):[]}return i.map((e=>Hh(t,e)))}return e},Jh=e=>"string"==typeof e?e.replace(" ","T"):e,Qh=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Zh{constructor(e,t,s={},i=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var eu,tu,su,iu;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(eu||(eu={}));class ru{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ru.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=ru.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],i()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=ru.syncDiff(this.state,e,t,s),i())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,i){const r=this.cloneDeep(e),a=this.transformState(t),n={},o={};return this.map(r,((e,t)=>{a[e]||(o[e]=t)})),this.map(a,((e,t)=>{const s=r[e];if(s){const i=t.map((e=>e.presence_ref)),r=s.map((e=>e.presence_ref)),a=t.filter((e=>r.indexOf(e.presence_ref)<0)),l=s.filter((e=>i.indexOf(e.presence_ref)<0));a.length>0&&(n[e]=a),l.length>0&&(o[e]=l)}else n[e]=t})),this.syncDiff(r,{joins:n,leaves:o},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,((t,i)=>{var r;const a=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(i),a.length>0){const s=e[t].map((e=>e.presence_ref)),i=a.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...i)}s(t,a,i)})),this.map(a,((t,s)=>{let r=e[t];if(!r)return;const a=s.map((e=>e.presence_ref));r=r.filter((e=>a.indexOf(e.presence_ref)<0)),e[t]=r,i(t,r,s),0===r.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const i=e[s];return t[s]="metas"in i?i.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):i,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(tu||(tu={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(su||(su={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(iu||(iu={}));class au{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Oh.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Zh(this,Mh.join,this.params,this.timeout),this.rejoinTimer=new Vh((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=Oh.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Oh.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Oh.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Oh.errored,this.rejoinTimer.scheduleTimeout())})),this._on(Mh.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new ru(this),this.broadcastEndpointURL=Qh(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:a,private:n}}=this.params;this._onError((t=>null==e?void 0:e(iu.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(iu.CLOSED)));const o={},l={broadcast:r,presence:a,postgres_changes:null!==(i=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==i?i:[],private:n};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const i=this.bindings.postgres_changes,r=null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0,a=[];for(let s=0;s<r;s++){const r=i[s],{filter:{event:n,schema:o,table:l,filter:c}}=r,d=t&&t[s];if(!d||d.event!==n||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=Oh.errored,void(null==e||e(iu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},r),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(iu.SUBSCRIBED))}null==e||e(iu.SUBSCRIBED)})).receive("error",(t=>{this.state=Oh.errored,null==e||e(iu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(iu.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var i,r,a;const n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(r=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.ack)||s("ok"),n.receive("ok",(()=>s("ok"))),n.receive("error",(()=>s("error"))),n.receive("timeout",(()=>s("timed out")))}));{const{event:a,payload:n}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:n,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(i=e.body)||void 0===i?void 0:i.cancel()),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Oh.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Mh.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise((s=>{const i=new Zh(this,Mh.leave,{},e);i.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),i.send(),this._canPush()||i.trigger("ok",{})}))}teardown(){this.pushBuffer.forEach((e=>e.destroy())),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout((()=>i.abort()),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Zh(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const a=e.toLocaleLowerCase(),{close:n,error:o,leave:l,join:c}=Mh;if(s&&[n,o,l,c].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter((e=>{var t,s,i;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(i=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===i?void 0:i.toLocaleLowerCase())===a})).map((e=>e.callback(d,s))):null===(r=this.bindings[a])||void 0===r||r.filter((e=>{var s,i,r,n,o,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,n=null===(s=e.filter)||void 0===s?void 0:s.event;return a&&(null===(i=t.ids)||void 0===i?void 0:i.includes(a))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const s=null===(o=null===(n=null==e?void 0:e.filter)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:i,type:r,errors:a}=e,n={schema:t,table:s,commit_timestamp:i,eventType:r,new:{},old:{},errors:a};d=Object.assign(Object.assign({},n),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===Oh.closed}_isJoined(){return this.state===Oh.joined}_isJoining(){return this.state===Oh.joining}_isLeaving(){return this.state===Oh.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var i;return!((null===(i=e.type)||void 0===i?void 0:i.toLocaleLowerCase())===s&&au.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Mh.close,{},e)}_onError(e){this._on(Mh.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Oh.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Gh(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Gh(e.columns,e.old_record)),t}}const nu=()=>{};class ou{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=Dh,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=nu,this.ref=0,this.logger=nu,this.conn=null,this.sendBuffer=[],this.serializer=new Bh,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Nd((async()=>{const{default:e}=await Promise.resolve().then((()=>Jd));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Fh.websocket}`,this.httpEndpoint=Qh(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Vh((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Ih),this.transport){const e="undefined"!=typeof window&&this.transport===window.WebSocket;return this.conn=e?new this.transport(this.endpointURL()):new this.transport(this.endpointURL(),void 0,{headers:this.headers}),void this.setupConnection()}this.conn=new lu(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach((e=>e.teardown())))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels=this.channels.filter((t=>t._joinRef!==e._joinRef)),0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case jh.connecting:return $h.Connecting;case jh.open:return $h.Open;case jh.closing:return $h.Closing;default:return $h.Closed}}isConnected(){return this.connectionState()===$h.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find((e=>e.topic===s));if(i)return i;{const s=new au(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:i,ref:r}=e,a=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),e.joinedOnce&&e._isJoined()&&e._push(Mh.access_token,{access_token:t})})))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t.topic!==e.topic))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:i,ref:r}=e;"phoenix"===t&&"phx_reply"===s&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${s} ${r&&"("+r+")"||""}`,i),Array.from(this.channels).filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,i,r))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(Mh.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class lu{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=jh.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class cu extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function du(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class hu extends cu{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class uu extends cu{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fu=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const mu=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Nd((async()=>{const{default:e}=await Promise.resolve().then((()=>Jd));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},gu=e=>{if(Array.isArray(e))return e.map((e=>gu(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const i=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[i]=gu(s)})),t};var pu=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const yu=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),vu=(e,t,s)=>pu(void 0,void 0,void 0,(function*(){const i=yield fu(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield Nd((()=>Promise.resolve().then((()=>Jd))),void 0)).Response:Response}));e instanceof i&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new hu(yu(s),e.status||500))})).catch((e=>{t(new uu(yu(e),e))})):t(new uu(yu(e),e))}));function xu(e,t,s,i,r,a){return pu(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{e(s,((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i&&(r.body=JSON.stringify(i)),Object.assign(Object.assign({},r),s))})(t,i,r,a)).then((e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()})).then((e=>n(e))).catch((e=>vu(e,o,i)))}))}))}function bu(e,t,s,i){return pu(this,void 0,void 0,(function*(){return xu(e,"GET",t,s,i)}))}function wu(e,t,s,i,r){return pu(this,void 0,void 0,(function*(){return xu(e,"POST",t,i,r,s)}))}function Eu(e,t,s,i,r){return pu(this,void 0,void 0,(function*(){return xu(e,"DELETE",t,i,r,s)}))}var Su=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const Tu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_u={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ku{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=mu(i)}uploadOrUpdate(e,t,s,i){return Su(this,void 0,void 0,(function*(){try{let r;const a=Object.assign(Object.assign({},_u),i);let n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const o=a.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(r=new FormData,r.append("cacheControl",a.cacheControl),o&&r.append("metadata",this.encodeMetadata(o)),r.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(r=s,r.append("cacheControl",a.cacheControl),o&&r.append("metadata",this.encodeMetadata(o))):(r=s,n["cache-control"]=`max-age=${a.cacheControl}`,n["content-type"]=a.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==i?void 0:i.headers)&&(n=Object.assign(Object.assign({},n),i.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:r,headers:n},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{})),h=yield d.json();if(d.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(r){if(du(r))return{data:null,error:r};throw r}}))}upload(e,t,s){return Su(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,i){return Su(this,void 0,void 0,(function*(){const r=this._removeEmptyFolders(e),a=this._getFinalPath(r),n=new URL(this.url+`/object/upload/sign/${a}`);n.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:_u.upsert},i),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);const o=yield this.fetch(n.toString(),{method:"PUT",body:e,headers:a}),l=yield o.json();if(o.ok)return{data:{path:r,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(du(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return Su(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(i["x-upsert"]="true");const r=yield wu(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(this.url+r.url),n=a.searchParams.get("token");if(!n)throw new cu("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:n},error:null}}catch(s){if(du(s))return{data:null,error:s};throw s}}))}update(e,t,s){return Su(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return Su(this,void 0,void 0,(function*(){try{return{data:yield wu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(du(i))return{data:null,error:i};throw i}}))}copy(e,t,s){return Su(this,void 0,void 0,(function*(){try{return{data:{path:(yield wu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(du(i))return{data:null,error:i};throw i}}))}createSignedUrl(e,t,s){return Su(this,void 0,void 0,(function*(){try{let i=this._getFinalPath(e),r=yield wu(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${a}`)},{data:r,error:null}}catch(i){if(du(i))return{data:null,error:i};throw i}}))}createSignedUrls(e,t,s){return Su(this,void 0,void 0,(function*(){try{const i=yield wu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:i.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${r}`):null}))),error:null}}catch(i){if(du(i))return{data:null,error:i};throw i}}))}download(e,t){return Su(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),r=i?`?${i}`:"";try{const t=this._getFinalPath(e),i=yield bu(this.fetch,`${this.url}/${s}/${t}${r}`,{headers:this.headers,noResolveJson:!0});return{data:yield i.blob(),error:null}}catch(a){if(du(a))return{data:null,error:a};throw a}}))}info(e){return Su(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield bu(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:gu(e),error:null}}catch(s){if(du(s))return{data:null,error:s};throw s}}))}exists(e){return Su(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,i){return pu(this,void 0,void 0,(function*(){return xu(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),i)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(du(s)&&s instanceof uu){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==r&&i.push(r);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&i.push(n);let o=i.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${o}`)}}}remove(e){return Su(this,void 0,void 0,(function*(){try{return{data:yield Eu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(du(t))return{data:null,error:t};throw t}}))}list(e,t,s){return Su(this,void 0,void 0,(function*(){try{const i=Object.assign(Object.assign(Object.assign({},Tu),t),{prefix:e||""});return{data:yield wu(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(du(i))return{data:null,error:i};throw i}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Au={"X-Client-Info":"storage-js/2.7.1"};var Lu=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class Ru{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Au),t),this.fetch=mu(s)}listBuckets(){return Lu(this,void 0,void 0,(function*(){try{return{data:yield bu(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(du(e))return{data:null,error:e};throw e}}))}getBucket(e){return Lu(this,void 0,void 0,(function*(){try{return{data:yield bu(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(du(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return Lu(this,void 0,void 0,(function*(){try{return{data:yield wu(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(du(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return Lu(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,i,r){return pu(this,void 0,void 0,(function*(){return xu(e,"PUT",t,i,r,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(du(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return Lu(this,void 0,void 0,(function*(){try{return{data:yield wu(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(du(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return Lu(this,void 0,void 0,(function*(){try{return{data:yield Eu(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(du(t))return{data:null,error:t};throw t}}))}}class Pu extends Ru{constructor(e,t={},s){super(e,t,s)}from(e){return new ku(this.url,this.headers,e,this.fetch)}}let Nu="";Nu="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Cu={headers:{"X-Client-Info":`supabase-js-${Nu}/2.50.0`}},Iu={schema:"public"},Du={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ju={};var Ou=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const Mu=e=>{let t;return t=e||("undefined"==typeof fetch?Wd:fetch),(...e)=>t(...e)},Fu=(e,t,s)=>{const i=Mu(s),r="undefined"==typeof Headers?zd:Headers;return(s,a)=>Ou(void 0,void 0,void 0,(function*(){var n;const o=null!==(n=yield t())&&void 0!==n?n:e;let l=new r(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),i(s,Object.assign(Object.assign({},a),{headers:l}))}))};var $u=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const Uu="2.70.0",Bu=3e4,Vu=9e4,Gu={"X-Client-Info":`gotrue-js/${Uu}`},Ku="X-Supabase-Api-Version",Hu={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},qu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Wu extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function zu(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Yu extends Wu{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Xu extends Wu{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ju extends Wu{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class Qu extends Ju{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Zu extends Ju{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ef extends Ju{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class tf extends Ju{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class sf extends Ju{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class rf extends Ju{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function af(e){return zu(e)&&"AuthRetryableFetchError"===e.name}class nf extends Ju{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class of extends Ju{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const lf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),cf=" \t\n\r=".split(""),df=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<cf.length;t+=1)e[cf[t].charCodeAt(0)]=-2;for(let t=0;t<lf.length;t+=1)e[lf[t].charCodeAt(0)]=t;return e})();function hf(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(lf[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(lf[e]),t.queuedBits-=6}}function uf(e,t,s){const i=df[e];if(!(i>-1)){if(-2===i)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function ff(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},a=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,i,s)};for(let n=0;n<e.length;n+=1)uf(e.charCodeAt(n),r,a);return t.join("")}function mf(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function gf(e){const t=[],s={queue:0,queuedBits:0},i=e=>{t.push(e)};for(let r=0;r<e.length;r+=1)uf(e.charCodeAt(r),s,i);return new Uint8Array(t)}function pf(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let i=e.charCodeAt(s);if(i>55295&&i<=56319){const t=1024*(i-55296)&65535;i=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}mf(i,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}function yf(e){const t=[],s={queue:0,queuedBits:0},i=e=>{t.push(e)};return e.forEach((e=>hf(e,s,i))),hf(null,s,i),t.join("")}const vf=()=>"undefined"!=typeof window&&"undefined"!=typeof document,xf={tested:!1,writable:!1},bf=()=>{if(!vf())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(xf.tested)return xf.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),xf.tested=!0,xf.writable=!0}catch(t){xf.tested=!0,xf.writable=!1}return xf.writable};const wf=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Nd((async()=>{const{default:e}=await Promise.resolve().then((()=>Jd));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Ef=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Sf=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(Ak){return s}},Tf=async(e,t)=>{await e.removeItem(t)};class _f{constructor(){this.promise=new _f.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function kf(e){const t=e.split(".");if(3!==t.length)throw new of("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!qu.test(t[s]))throw new of("JWT not in base64url format");return{header:JSON.parse(ff(t[0])),payload:JSON.parse(ff(t[1])),signature:gf(t[2]),raw:{header:t[0],payload:t[1]}}}function Af(e){return("0"+e.toString(16)).substr(-2)}async function Lf(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Rf(e,t,s=!1){const i=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let i=0;i<56;i++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Af).join("")}();let r=i;s&&(r+="/PASSWORD_RECOVERY"),await Ef(e,`${t}-code-verifier`,r);const a=await Lf(i);return[a,i===a?"plain":"s256"]}_f.promiseConstructor=Promise;const Pf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Nf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Cf(e){if(!Nf.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var If=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};const Df=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),jf=[502,503,504];async function Of(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new rf(Df(e),0);if(jf.includes(e.status))throw new rf(Df(e),e.status);let i,r;try{i=await e.json()}catch(n){throw new Xu(Df(n),n)}const a=function(e){const t=e.headers.get(Ku);if(!t)return null;if(!t.match(Pf))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(n){return null}}(e);if(a&&a.getTime()>=Hu.timestamp&&"object"==typeof i&&i&&"string"==typeof i.code?r=i.code:"object"==typeof i&&i&&"string"==typeof i.error_code&&(r=i.error_code),r){if("weak_password"===r)throw new nf(Df(i),e.status,(null===(t=i.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new Qu}else if("object"==typeof i&&i&&"object"==typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new nf(Df(i),e.status,i.weak_password.reasons);throw new Yu(Df(i),e.status||500,r)}async function Mf(e,t,s,i){var r;const a=Object.assign({},null==i?void 0:i.headers);a[Ku]||(a[Ku]=Hu.name),(null==i?void 0:i.jwt)&&(a.Authorization=`Bearer ${i.jwt}`);const n=null!==(r=null==i?void 0:i.query)&&void 0!==r?r:{};(null==i?void 0:i.redirectTo)&&(n.redirect_to=i.redirectTo);const o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await async function(e,t,s,i,r,a){const n=((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),s))})(t,i,r,a);let o;try{o=await e(s,Object.assign({},n))}catch(l){throw new rf(Df(l),0)}o.ok||await Of(o);if(null==i?void 0:i.noResolveJson)return o;try{return await o.json()}catch(l){await Of(l)}}(e,t,s+o,{headers:a,noResolveJson:null==i?void 0:i.noResolveJson},{},null==i?void 0:i.body);return(null==i?void 0:i.xform)?null==i?void 0:i.xform(l):{data:Object.assign({},l),error:null}}function Ff(e){var t;let s=null;var i;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(i=e.expires_in,Math.round(Date.now()/1e3)+i)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function $f(e){const t=Ff(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function Uf(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Bf(e){return{data:e,error:null}}function Vf(e){const{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:a}=e,n=If(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:a},user:Object.assign({},n)},error:null}}function Gf(e){return e}const Kf=["global","local","others"];var Hf=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};class qf{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=wf(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Kf[0]){if(Kf.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Kf.join(", ")}`);try{return await Mf(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(zu(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Mf(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Uf})}catch(s){if(zu(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Hf(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=null==s?void 0:s.newEmail,delete i.newEmail),await Mf(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Vf,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(zu(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Mf(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Uf})}catch(t){if(zu(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,a,n,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Mf(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(i=null==e?void 0:e.perPage)||void 0===i?void 0:i.toString())&&void 0!==r?r:""},xform:Gf});if(c.error)throw c.error;const d=await c.json(),h=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,u=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return u.length>0&&(u.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(zu(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Cf(e);try{return await Mf(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Uf})}catch(t){if(zu(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Cf(e);try{return await Mf(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Uf})}catch(s){if(zu(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Cf(e);try{return await Mf(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Uf})}catch(s){if(zu(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Cf(e.userId);try{const{data:t,error:s}=await Mf(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(zu(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Cf(e.userId),Cf(e.id);try{return{data:await Mf(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(zu(t))return{data:null,error:t};throw t}}}const Wf={getItem:e=>bf()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{bf()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{bf()&&globalThis.localStorage.removeItem(e)}};function zf(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Yf=!!(globalThis&&bf()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Xf extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Jf extends Xf{}async function Qf(e,t,s){const i=new globalThis.AbortController;return t>0&&setTimeout((()=>{i.abort()}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},(async i=>{if(!i){if(0===t)throw new Jf(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Yf)try{await globalThis.navigator.locks.query()}catch(r){}return await s()}try{return await s()}finally{}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Zf={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Gu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function em(e,t,s){return await s()}class tm{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=tm.nextInstanceID,tm.nextInstanceID+=1,this.instanceID>0&&vf();const i=Object.assign(Object.assign({},Zf),e);if(this.logDebugMessages=!!i.debug,"function"==typeof i.debug&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new qf({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=wf(i.fetch),this.lock=i.lock||em,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:vf()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Qf:this.lock=em,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:bf()?this.storage=Wf:(this.memoryStorage={},this.storage=zf(this.memoryStorage)):(this.memoryStorage={},this.storage=zf(this.memoryStorage)),vf()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Uu}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(i){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),vf()&&this.detectSessionInUrl&&"none"!==s){const{data:i,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return zu(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return await this._removeSession(),{error:r}}const{session:a,redirectType:n}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",n),await this._saveSession(a),setTimeout((async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return zu(t)?{error:t}:{error:new Xu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await Mf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken}},xform:Ff}),{data:a,error:n}=r;if(n||!a)return{data:{user:null,session:null},error:n};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(zu(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:s,password:i,options:a}=e;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await Rf(this.storage,this.storageKey)),r=await Mf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:s,password:i,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:o},xform:Ff})}else{if(!("phone"in e))throw new ef("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:n}=e;r=await Mf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},channel:null!==(i=null==n?void 0:n.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Ff})}}const{data:a,error:n}=r;if(n||!a)return{data:{user:null,session:null},error:n};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(zu(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:i,options:r}=e;t=await Mf(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:$f})}else{if(!("phone"in e))throw new ef("You must provide either an email or phone number and a password");{const{phone:s,password:i,options:r}=e;t=await Mf(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:$f})}}const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i}):{data:{user:null,session:null},error:new Zu}}catch(t){if(zu(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,r,a,n,o,l,c,d,h,u;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:h,wallet:u,statement:g,options:p}=e;let y;if(vf())if("object"==typeof u)y=u;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof u||!(null==p?void 0:p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=u}const v=new URL(null!==(t=null==p?void 0:p.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==p?void 0:p.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),m=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(i=null===(s=null==p?void 0:p.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:(new Date).toISOString()}`,...(null===(r=null==p?void 0:p.signInWithSolana)||void 0===r?void 0:r.notBefore)?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...(null===(a=null==p?void 0:p.signInWithSolana)||void 0===a?void 0:a.expirationTime)?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...(null===(n=null==p?void 0:p.signInWithSolana)||void 0===n?void 0:n.chainId)?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...(null===(o=null==p?void 0:p.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...(null===(l=null==p?void 0:p.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==p?void 0:p.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...p.signInWithSolana.resources.map((e=>`- ${e}`))]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=e}}try{const{data:t,error:s}=await Mf(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:yf(m)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:Ff});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Zu}}catch(g){if(zu(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await Sf(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(null!=t?t:"").split("/");try{const{data:t,error:r}=await Mf(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Ff});if(await Tf(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=i?i:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Zu}}catch(r){if(zu(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:a}=e,n=await Mf(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Ff}),{data:o,error:l}=n;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Zu}}catch(t){if(zu(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,a;try{if("email"in e){const{email:i,options:r}=e;let a=null,n=null;"pkce"===this.flowType&&([a,n]=await Rf(this.storage,this.storageKey));const{error:o}=await Mf(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:a,code_challenge_method:n},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:n,error:o}=await Mf(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(i=null==s?void 0:s.data)&&void 0!==i?i:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(a=null==s?void 0:s.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new ef("You must provide either an email or phone number.")}catch(n){if(zu(n))return{data:{user:null,session:null},error:n};throw n}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:a,error:n}=await Mf(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:Ff});if(n)throw n;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(zu(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,a=null;return"pkce"===this.flowType&&([r,a]=await Rf(this.storage,this.storageKey)),await Mf(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:a}),headers:this.headers,xform:Bf})}catch(r){if(zu(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Qu;const{error:i}=await Mf(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}}))}catch(e){if(zu(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:a}=await Mf(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:s,type:i,options:r}=e,{data:a,error:n}=await Mf(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:n}}throw new ef("You must provide either an email or phone number and a type")}catch(t){if(zu(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Sf(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<Vu;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,i)=>(t||"user"!==s||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,i))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await Mf(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Uf}):await this._useSession((async e=>{var t,s,i;const{data:r,error:a}=e;if(a)throw a;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Mf(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0,xform:Uf}):{data:{user:null},error:new Qu}}))}catch(t){if(zu(t))return function(e){return zu(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Tf(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new Qu;const a=i.session;let n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await Rf(this.storage,this.storageKey));const{data:l,error:c}=await Mf(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:a.access_token,xform:Uf});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}}))}catch(s){if(zu(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Qu;const t=Date.now()/1e3;let s=t,i=!0,r=null;const{payload:a}=kf(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:i,error:a}=await this._getUser(e.access_token);if(a)throw a;r={access_token:e.access_token,refresh_token:e.refresh_token,user:i.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(zu(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:i,error:r}=t;if(r)throw r;e=null!==(s=i.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Qu;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(zu(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!vf())throw new tf("No browser detected.");if(e.error||e.error_description||e.error_code)throw new tf(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new sf("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new tf("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new sf("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:a,expires_in:n,expires_at:o,token_type:l}=e;if(!(r&&n&&a&&l))throw new tf("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(n);let h=c+d;o&&(h=parseInt(o));const{data:u,error:f}=await this._getUser(r);if(f)throw f;const m={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:d,expires_at:h,refresh_token:a,token_type:l,user:u.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(s){if(zu(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Sf(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const a=null===(s=i.session)||void 0===s?void 0:s.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return zu(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Tf(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,i;try{const{data:{session:i},error:r}=t;if(r)throw r;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(r){await(null===(i=this.stateChangeEmitters.get(e))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r)}}))}async resetPasswordForEmail(e,t={}){let s=null,i=null;"pkce"===this.flowType&&([s,i]=await Rf(this.storage,this.storageKey,!0));try{return await Mf(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(zu(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(zu(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession((async t=>{var s,i,r,a,n;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(i=e.options)||void 0===i?void 0:i.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await Mf(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==n?n:void 0})}));if(i)throw i;return vf()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(zu(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:a}=t;if(a)throw a;return await Mf(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0})}))}catch(t){if(zu(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Mf(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ff})),i=(e,t)=>{const s=200*Math.pow(2,e);return t&&af(t)&&Date.now()+s-r<Bu},new Promise(((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await s(a);if(!i(a,null,t))return void e(t)}catch(r){if(!i(a,r))return void t(r)}})()})))}catch(r){if(this._debug(t,"error",r),zu(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}var s,i}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),vf()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Sf(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const i=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<Vu;if(this._debug(t,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(af(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return void this._debug(t,"error",s)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Qu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new _f;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Qu;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const i={session:t.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(r){if(this._debug(i,"error",r),zu(r)){const e={session:null,error:r};return af(r)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],r=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(r){i.push(r)}}));if(await Promise.all(r),i.length>0){for(let e=0;e<i.length;e+=1);throw i[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ef(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Tf(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vf()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),Bu);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*s.expires_at-t)/Bu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof Xf))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!vf()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Rf(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});i.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);i.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Mf(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(zu(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await Mf(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(i=null==o?void 0:o.totp)||void 0===i?void 0:i.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(zu(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:a,error:n}=await Mf(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return n?{data:null,error:n}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:n})}))}catch(t){if(zu(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Mf(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(zu(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],i=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),r=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=kf(i.access_token);let n=null;a.aal&&(n=a.aal);let o=n;(null!==(s=null===(t=i.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:n,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:i,error:r}=await Mf(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;if(!i.keys||0===i.keys.length)throw new of("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find((t=>t.kid===e)),!s)throw new of("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:i,payload:r,signature:a,raw:{header:n,payload:o}}=kf(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp),!i.kid||"HS256"===i.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:r,header:i,signature:a},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(i.alg),c=await this.fetchJwk(i.kid,t),d=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,d,a,pf(`${n}.${o}`))))throw new of("Invalid JWT signature");return{data:{claims:r,header:i,signature:a},error:null}}catch(s){if(zu(s))return{data:null,error:s};throw s}}}tm.nextInstanceID=0;const sm=tm;class im extends sm{constructor(e){super(e)}}var rm=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class am{constructor(e,t,s){var i,r,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const n=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(n);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,i;const{db:r,auth:a,realtime:n,global:o}=e,{db:l,auth:c,realtime:d,global:h}=t,u={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},d),n),global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},null!==(s=null==h?void 0:h.headers)&&void 0!==s?s:{}),null!==(i=null==o?void 0:o.headers)&&void 0!==i?i:{})}),accessToken:()=>$u(this,void 0,void 0,(function*(){return""}))};return e.accessToken?u.accessToken=e.accessToken:delete u.accessToken,u}(null!=s?s:{},{db:Iu,realtime:ju,auth:Object.assign(Object.assign({},Du),{storageKey:c}),global:Cu});this.storageKey=null!==(i=d.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(r=d.global.headers)&&void 0!==r?r:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=d.auth)&&void 0!==a?a:{},this.headers,d.global.fetch),this.fetch=Fu(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ah(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Fd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Pu(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return rm(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:a,lock:n,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new im({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,lock:n,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ou(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){let e=this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}));return e}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const nm=((e,t,s)=>new am(e,t,s))("https://gqylknstxjwlybyvvcvx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdxeWxrbnN0eGp3bHlieXZ2Y3Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwOTMyNzIsImV4cCI6MjA2NTY2OTI3Mn0.fdOlalxcPaKzpjaUnFowsY3gz6f0LYmCdE--aJ76zc8");async function om(e,t,s="ingreso"){const{data:i,error:r}=await nm.from("usuario").select("saldo").eq("id",e).single();if(r)throw r;const a=Number(i.saldo)+Number(t),{error:n}=await nm.from("usuario").update({saldo:a}).eq("id",e);if(n)throw n;try{await nm.from("transacciones_moneda").insert([{usuario_id:e,tipo:"ingreso",cantidad:t,motivo:s}])}catch(o){}return a}async function lm(e,t,s="egreso"){const{data:i,error:r}=await nm.from("usuario").select("saldo").eq("id",e).single();if(r)throw r;if(Number(i.saldo)<Number(t))throw new Error("Saldo insuficiente");const a=Number(i.saldo)-Number(t),{error:n}=await nm.from("usuario").update({saldo:a}).eq("id",e);if(n)throw n;try{await nm.from("transacciones_moneda").insert([{usuario_id:e,tipo:"egreso",cantidad:t,motivo:s}])}catch(o){}return a}const cm=[{id:"basico",nombre:"Paquete Básico",monedas:100,precio:2.99,descuento:0,popular:!1,descripcion:"Perfecto para empezar"},{id:"estandar",nombre:"Paquete Estándar",monedas:500,precio:9.99,descuento:17,popular:!0,descripcion:"El más popular"},{id:"premium",nombre:"Paquete Premium",monedas:1200,precio:19.99,descuento:33,popular:!1,descripcion:"Mejor valor"},{id:"pro",nombre:"Paquete Pro",monedas:2500,precio:34.99,descuento:44,popular:!1,descripcion:"Para usuarios avanzados"}];const dm=Y.createContext(),hm=({children:t})=>{const[s,i]=Y.useState(null),[r,a]=Y.useState(!0),n=Y.useCallback((async()=>{a(!0);const{data:{user:e}}=await nm.auth.getUser();if(e){const{data:t}=await nm.from("usuario").select("*").eq("correo",e.email).single();i(t?{...t,auth:e}:null)}else i(null);a(!1)}),[]),o=Y.useCallback((async()=>{if(s?.id)try{const e=await async function(e){const{data:t,error:s}=await nm.from("usuario").select("saldo").eq("id",e).single();if(s)throw s;return Number(t.saldo)}(s.id);i((t=>t?{...t,saldo:e}:null))}catch(e){}}),[s?.id]),l=Y.useCallback((async(e,t="ingreso")=>{if(!s?.id)throw new Error("Usuario no autenticado");try{const r=await om(s.id,e,t);return i((e=>e?{...e,saldo:r}:null)),r}catch(r){throw r}}),[s?.id]),c=Y.useCallback((async(e,t="egreso")=>{if(!s?.id)throw new Error("Usuario no autenticado");try{const r=await lm(s.id,e,t);return i((e=>e?{...e,saldo:r}:null)),r}catch(r){throw r}}),[s?.id]),d=Y.useCallback((e=>s?.saldo>=e),[s?.saldo]);Y.useEffect((()=>{n();const{data:e}=nm.auth.onAuthStateChange((()=>{n()}));return()=>{e?.subscription.unsubscribe()}}),[n]);const h={user:s,loading:r,refreshUser:n,updateUserBalance:o,addCoins:l,spendCoins:c,hasEnoughCoins:d};return e.jsx(dm.Provider,{value:h,children:t})},um=()=>Y.useContext(dm),fm=({trigger:t,navItems:s})=>{const{t:i}=Ec(),{user:r,refreshUser:a}=um(),n=[...(s||[]).map((e=>({icon:e.icon,label:e.label||e.name,path:e.path}))),{icon:pd,label:i("nav.profile"),path:"/profile"},{icon:$c,label:i("nav.buy_coins"),path:"/coins"}];return e.jsxs(wd,{children:[e.jsx(Ed,{asChild:!0,children:t}),e.jsxs(Ad,{side:"left",className:"bg-black border-gray-800 text-white w-[280px] sm:w-[320px] flex flex-col",children:[e.jsx(Ld,{className:"mb-6 border-b border-gray-700 pb-4",children:e.jsx(Rd,{children:e.jsxs(Z,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(Sc,{className:"h-8 w-auto"}),e.jsx("span",{className:"font-bold text-xl text-white",children:"SMASH"})]})})}),e.jsxs("div",{className:"flex flex-col h-full pb-10 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6 px-4 py-3 bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-300",children:i("sidebar.my_points")}),e.jsxs("div",{className:"flex items-center text-yellow-400 font-bold text-lg",children:[e.jsx($c,{className:"h-5 w-5 mr-2"}),1250..toLocaleString()]})]}),e.jsx("nav",{className:"flex-grow space-y-1",children:n.map((t=>e.jsx(Sd,{asChild:!0,children:e.jsxs(Z,{to:t.path,className:"flex items-center px-4 py-2.5 rounded-md text-gray-300 hover:bg-gray-800 hover:text-white transition-colors duration-200",children:[t.icon&&e.jsx(t.icon,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium text-sm",children:t.label})]})},t.label)))}),e.jsx("div",{className:"mt-auto space-y-2 border-t border-gray-700 pt-4",children:!r&&e.jsxs(e.Fragment,{children:[e.jsx(Sd,{asChild:!0,children:e.jsx(nc,{variant:"ghost",className:"w-full justify-start",asChild:!0,children:e.jsx(Z,{to:"/login",children:i("auth.login")})})}),e.jsx(Sd,{asChild:!0,children:e.jsx(nc,{className:"w-full bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(Z,{to:"/register",children:i("auth.register")})})})]})}),r&&e.jsx("div",{className:"mt-4 border-t border-gray-700 pt-4",children:e.jsx(Sd,{asChild:!0,children:e.jsxs(nc,{variant:"ghost",className:"w-full flex items-center justify-start text-red-500 hover:bg-red-900/50 hover:text-red-400",onClick:async()=>{await nm.auth.signOut({redirectTo:window.location.origin+"/login"}),localStorage.removeItem("user"),localStorage.removeItem("access_token"),sessionStorage.clear(),a&&a()},children:[e.jsx(Yc,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium",children:i("auth.logout")})]})})})]})]})]})},mm=m,gm=g,pm=Y.forwardRef((({className:t,...s},i)=>e.jsx(d,{ref:i,className:`z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-700 bg-black p-1 text-white shadow-md ${t||""}`,...s})));pm.displayName=d.displayName;Y.forwardRef((({className:t,...s},i)=>e.jsx(h,{ref:i,className:`px-2 py-1.5 text-sm font-semibold ${t||""}`,...s}))).displayName=h.displayName;const ym=Y.forwardRef((({className:t,...s},i)=>e.jsx(u,{ref:i,className:`flex cursor-pointer select-none items-center rounded-sm px-2 py-2 text-sm outline-none transition-colors hover:bg-gray-800 ${t||""}`,...s})));ym.displayName=u.displayName;const vm=Y.forwardRef((({className:t,...s},i)=>e.jsx(f,{ref:i,className:`my-1 h-px bg-gray-700 ${t||""}`,...s})));vm.displayName=f.displayName;const xm=L,bm=R,wm=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(p,{ref:r,className:tc("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[s,e.jsx(y,{asChild:!0,children:e.jsx(Ic,{className:"h-4 w-4 opacity-50"})})]})));wm.displayName=p.displayName;const Em=X.forwardRef((({className:t,...s},i)=>e.jsx(v,{ref:i,className:tc("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Dc,{className:"h-4 w-4"})})));Em.displayName=v.displayName;const Sm=X.forwardRef((({className:t,...s},i)=>e.jsx(x,{ref:i,className:tc("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Ic,{className:"h-4 w-4"})})));Sm.displayName=x.displayName;const Tm=X.forwardRef((({className:t,children:s,position:i="popper",...r},a)=>e.jsx(b,{children:e.jsxs(w,{ref:a,className:tc("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-gray-900 text-white shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[e.jsx(Em,{}),e.jsx(E,{className:tc("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Sm,{})]})})));Tm.displayName=w.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(S,{ref:i,className:tc("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}))).displayName=S.displayName;const _m=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(T,{ref:r,className:tc("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(_,{children:e.jsx(Cc,{className:"h-4 w-4"})})}),e.jsx(k,{children:s})]})));_m.displayName=T.displayName;async function km(){try{const{data:e,error:t}=await nm.from("insignias_catalogo").select("*").eq("disponible",!0).order("orden",{ascending:!0});if(t)throw t;return e||[]}catch(e){throw e}}async function Am(e,t){try{const{data:i}=await nm.from("insignias_usuario").select("id").eq("usuario_id",e).eq("insignia_id",t).single();if(i)throw new Error("Ya tienes esta insignia");const r=await async function(e){try{const{data:t,error:s}=await nm.from("insignias_catalogo").select("*").eq("id",e).single();if(s)throw s;return t}catch(t){throw t}}(t);if(!r)throw new Error("Insignia no encontrada");if(!r.disponible)throw new Error("Esta insignia no está disponible");const{data:a,error:n}=await nm.from("usuario").select("saldo").eq("id",e).single();if(n)throw n;if(Number(a.saldo)<Number(r.precio))throw new Error("Saldo insuficiente para comprar esta insignia");const o=Number(a.saldo)-Number(r.precio),{error:l}=await nm.from("usuario").update({saldo:o}).eq("id",e);if(l)throw l;const c=r.fecha_expira?new Date(r.fecha_expira).toISOString():null,{error:d}=await nm.from("insignias_usuario").insert([{usuario_id:e,insignia_id:t,precio_pagado:r.precio,fecha_expira:c}]);if(d)throw d;try{await nm.from("transacciones_moneda").insert([{usuario_id:e,tipo:"egreso",cantidad:r.precio,motivo:`compra_insignia_${r.codigo}`}])}catch(s){}return{success:!0,nuevoSaldo:o,insignia:r}}catch(i){throw i}}async function Lm(e){try{const{data:t,error:s}=await nm.from("insignias_usuario").select("\n        *,\n        insignias_catalogo(*)\n      ").eq("usuario_id",e).order("fecha_compra",{ascending:!1});if(s)throw s;return t||[]}catch(t){return[]}}async function Rm(e){try{const{data:t,error:s}=await nm.from("insignias_usuario").select("\n        *,\n        insignias_catalogo(*)\n      ").eq("usuario_id",e).eq("equipada",!0).single();if(s&&"PGRST116"!==s.code)throw s;return t||null}catch(t){return null}}X.forwardRef((({className:t,...s},i)=>e.jsx(A,{ref:i,className:tc("-mx-1 my-1 h-px bg-muted",t),...s}))).displayName=A.displayName;const Pm=Y.createContext(),Nm=({children:t})=>{const[s,i]=Y.useState(0);return e.jsx(Pm.Provider,{value:{triggerBadgeUpdate:()=>{i((e=>e+1))},badgeUpdateTrigger:s},children:t})},Cm=()=>{const e=Y.useContext(Pm);if(!e)throw new Error("useBadgeEvents must be used within a BadgeEventProvider");return e},Im=e=>{const[t,s]=Y.useState(null),[i,r]=Y.useState(!1),{badgeUpdateTrigger:a}=Cm();return Y.useEffect((()=>{(async()=>{if(e)try{r(!0);const t=await Rm(e);s(t)}catch(t){s(null)}finally{r(!1)}else s(null)})()}),[e,a]),{equippedBadge:t,loading:i}},Dm=({equippedBadge:t,className:s=""})=>{if(!t?.insignias_catalogo)return null;const i=t.insignias_catalogo;return e.jsx("div",{className:`inline-flex items-center justify-center bg-gradient-to-r from-gray-900/80 to-gray-800/80 border rounded-full p-1 shadow-lg ${(e=>{switch(e){case"comun":default:return"border-gray-500 shadow-gray-500/20";case"rara":return"border-blue-500 shadow-blue-500/20";case"legendaria":return"border-yellow-500 shadow-yellow-500/20"}})(i.rareza)} ${s}`,title:`${i.nombre} - ${i.descripcion}`,style:{verticalAlign:"top"},children:e.jsx("span",{className:"text-sm animate-glow",style:{lineHeight:"1"},children:i.icono})})},jm=()=>{ee();const{user:t,loading:s,refreshUser:i}=um(),{t:r,i18n:a}=Ec(),[n,o]=Y.useState(a.language||"es"),{equippedBadge:l}=Im(t?.id);Y.useEffect((()=>{const e=async()=>{const e=JSON.parse(localStorage.getItem("user"));if(!e)return;const{data:t}=await nm.from("usuario").select("*").eq("correo",e.email).single();t&&setUserData(t)};e();const t=()=>e();return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)}),[]),Y.useEffect((()=>{a.changeLanguage(n)}),[n,a]);return e.jsxs(mm,{onOpenChange:e=>{e&&i&&i()},children:[e.jsx(gm,{asChild:!0,children:e.jsx(nc,{variant:"ghost",size:"icon",className:"relative",children:e.jsx(Oc,{className:"h-8 w-8"})})}),e.jsxs(pm,{className:"w-72",align:"end",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-red-900/20 to-black border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t?.avatar||"/pain.png",alt:t?.nombre_usuario||r("user.default"),className:"h-20 w-20 rounded-full object-cover ring-2 ring-red-600"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-yellow-500 text-black text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:t?.nivel||1})]}),e.jsxs("div",{className:"flex flex-col space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-lg font-bold text-white",children:t?.nombre_usuario||r("user.default")}),e.jsx(Dm,{equippedBadge:l,className:"flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-400",children:t?.correo||"-"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($c,{className:"h-4 w-4 text-yellow-400"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-400",children:[t?.saldo?.toLocaleString()||0," Monedas"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-gray-900/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx(Lc,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:r("user.win_rate")}),e.jsx("p",{className:"text-sm font-medium text-white",children:t?.winRate||"-"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx(cd,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:r("user.predictions")}),e.jsx("p",{className:"text-sm font-medium text-white",children:t?.predictions||"-"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx(ym,{asChild:!0,children:e.jsxs(Z,{to:"/profile",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(Oc,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:r("user.profile")})]})}),e.jsx(ym,{asChild:!0,children:e.jsxs(Z,{to:"/coins",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx($c,{className:"mr-2 h-4 w-4 text-yellow-400"}),e.jsx("span",{children:r("nav.buy_coins")})]})}),e.jsx(ym,{asChild:!0,children:e.jsxs(Z,{to:"/badges",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(Bc,{className:"mr-2 h-4 w-4 text-purple-400"}),e.jsx("span",{children:"Canjear Recompensas"})]})}),e.jsx("div",{className:"mt-3 px-2",children:e.jsxs(xm,{value:n,onValueChange:o,children:[e.jsx(wm,{className:"w-full bg-gray-800 border-gray-700 text-white",children:e.jsx(bm,{children:r("profile.language")})}),e.jsxs(Tm,{children:[e.jsx(_m,{value:"es",children:"Español"}),e.jsx(_m,{value:"en",children:"English"}),e.jsx(_m,{value:"pt",children:"Português"})]})]})})]}),e.jsx(vm,{}),e.jsx("div",{className:"p-2",children:e.jsxs(ym,{className:"text-red-500 hover:text-red-400 hover:bg-red-900/20 rounded-md",onClick:async()=>{await nm.auth.signOut({redirectTo:window.location.origin+"/login"}),localStorage.removeItem("user"),localStorage.removeItem("access_token"),sessionStorage.clear(),i&&i()},children:[e.jsx(Yc,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:r("auth.logout")})]})})]})]})},Om=()=>{const{t:t}=Ec(),s=[{name:t("nav.home"),path:"/",icon:null},{name:t("nav.forum"),path:"/forum",icon:Qc},{name:t("nav.fighters"),path:"/fighters",icon:yd},{name:t("nav.compare"),path:"/compare",icon:Hc},{name:t("nav.highlights"),path:"/highlights",icon:cd},{name:t("nav.events"),path:"/events",icon:Pc},{name:t("nav.saved_clips"),path:"/clips",icon:sd},{name:t("nav.live"),path:"/live",icon:ed}],[i,r]=Y.useState(!1),{user:a,loading:n}=um();return Y.useEffect((()=>{const e=()=>r(!!localStorage.getItem("user"));return e(),window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),e.jsx(al.header,{initial:{y:-100},animate:{y:0},transition:{duration:.5},className:"fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-gray-800",children:e.jsxs("nav",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsx(Z,{to:"/",className:"flex items-center",children:e.jsx(Sc,{className:"h-12 w-auto"})}),e.jsx("div",{className:"hidden lg:flex items-center space-x-1",children:s.map((t=>e.jsxs(te,{to:t.path,className:({isActive:e})=>"px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center "+(e?"text-red-500 bg-red-900/20":"text-gray-300 hover:text-white hover:bg-gray-800"),children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4 mr-2"}),t.name]},t.path)))})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsx(nc,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(Z,{to:"/login",children:t("auth.login")})}),e.jsx(nc,{size:"sm",className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(Z,{to:"/register",children:t("auth.register")})})]}),e.jsx(jm,{})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(fm,{trigger:e.jsx(nc,{variant:"ghost",size:"icon",children:e.jsx(Oc,{className:"h-6 w-6"})}),navItems:s})})]})]})})},Mm=O,Fm=X.forwardRef((({className:t,...s},i)=>e.jsx(P,{ref:i,className:tc("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s})));Fm.displayName=P.displayName;const $m=rc("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-gray-900 border-gray-700 text-white",destructive:"group destructive border-red-500 bg-red-900 text-red-100"}},defaultVariants:{variant:"default"}}),Um=X.forwardRef((({className:t,variant:s,...i},r)=>e.jsx(N,{ref:r,className:tc($m({variant:s}),t),...i})));Um.displayName=N.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(C,{ref:i,className:tc("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}))).displayName=C.displayName;const Bm=X.forwardRef((({className:t,...s},i)=>e.jsx(I,{ref:i,className:tc("absolute right-2 top-2 rounded-md p-1 text-gray-400 opacity-0 transition-opacity hover:text-white focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(xd,{className:"h-4 w-4"})})));Bm.displayName=I.displayName;const Vm=X.forwardRef((({className:t,...s},i)=>e.jsx(D,{ref:i,className:tc("text-sm font-semibold",t),...s})));Vm.displayName=D.displayName;const Gm=X.forwardRef((({className:t,...s},i)=>e.jsx(j,{ref:i,className:tc("text-sm opacity-90",t),...s})));Gm.displayName=j.displayName;let Km=0;const Hm={state:{toasts:[]},listeners:[],getState:()=>Hm.state,setState:e=>{Hm.state="function"==typeof e?e(Hm.state):{...Hm.state,...e},Hm.listeners.forEach((e=>e(Hm.state)))},subscribe:e=>(Hm.listeners.push(e),()=>{Hm.listeners=Hm.listeners.filter((t=>t!==e))})},qm=({...e})=>{const t=(Km=(Km+1)%Number.MAX_VALUE,Km.toString()),s=()=>Hm.setState((e=>({...e,toasts:e.toasts.filter((e=>e.id!==t))})));return Hm.setState((i=>({...i,toasts:[{...e,id:t,dismiss:s},...i.toasts].slice(0,1)}))),{id:t,dismiss:s,update:e=>Hm.setState((s=>({...s,toasts:s.toasts.map((s=>s.id===t?{...s,...e}:s))})))}};function Wm(){const[e,t]=Y.useState(Hm.getState());return Y.useEffect((()=>{const e=Hm.subscribe((e=>{t(e)}));return e}),[]),Y.useEffect((()=>{const t=[];return e.toasts.forEach((e=>{if(e.duration===1/0)return;const s=setTimeout((()=>{e.dismiss()}),e.duration||5e3);t.push(s)})),()=>{t.forEach((e=>clearTimeout(e)))}}),[e.toasts]),{toast:qm,toasts:e.toasts}}function zm(){const{toasts:t}=Wm();return e.jsxs(Mm,{children:[t.map((({id:t,title:s,description:i,action:r,...a})=>e.jsxs(Um,{...a,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Vm,{children:s}),i&&e.jsx(Gm,{children:i})]}),r,e.jsx(Bm,{})]},t))),e.jsx(Fm,{})]})}const Ym=({children:t})=>e.jsxs("div",{className:"min-h-screen bg-black text-white font-sans",children:[e.jsx(Om,{}),e.jsx("main",{className:"pt-16",children:t}),e.jsx(zm,{})]}),Xm=()=>{const{t:t,i18n:s}=Ec(),i=(new Date).getFullYear(),r=new Date(`${i+1}-06-29`).toLocaleDateString(s.language,{month:"long",day:"numeric",year:"numeric"});return e.jsxs(al.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"relative flex flex-col items-center",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"bg-gradient-to-r from-red-700 via-red-600 to-red-700 rounded-full p-1",children:e.jsx("div",{className:"bg-black rounded-full p-4",children:e.jsx("span",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-700 filter drop-shadow-lg",children:t("vs")})})})}),e.jsx(al.div,{animate:{scale:[1,1.2,1]},transition:{duration:10,repeat:1/0,ease:"linear",repeatType:"mirror"},className:"absolute inset-x-0 top-0 h-full bg-gradient-to-r from-red-600/20 to-red-800/20 rounded-full blur-xl",style:{top:"-10%",height:"120%"}}),e.jsx("p",{className:"mt-3 text-sm font-semibold text-gray-400 uppercase tracking-wider z-10",children:r})]})},Jm={A:62,B:38},Qm=()=>{const{t:t}=Ec(),[s,i]=Y.useState(null),[r,a]=Y.useState(Jm),[n,o]=Y.useState(!1),l=e=>{const t=s===e?null:e;i(t),o(!0),t&&a((e=>"A"===t&&e.A<95?{A:e.A+1,B:e.B-1}:"B"===t&&e.B<95?{A:e.A-1,B:e.B+1}:e))};return Y.useEffect((()=>{let e;return n&&!s&&(e=setTimeout((()=>o(!1)),3e3)),()=>clearTimeout(e)}),[n,s]),e.jsxs("section",{className:"relative min-h-[90vh] mt-16 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:t("home.featured_fight_bg"),src:"https://images.unsplash.com/photo-1687519930490-db2e9a2efa03"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/60 to-transparent"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-5xl mx-auto px-4 py-8",children:e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs("div",{className:"bg-black/70 p-6 md:p-8 rounded-xl backdrop-blur-md border border-gray-800 shadow-lg shadow-red-900/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gd,{className:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"text-lg font-bold tracking-wide uppercase",children:t("home.event_principal")})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400 animate-pulse",children:[e.jsx(md,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:t("home.open_predictions")})]})]}),e.jsx("h2",{className:"text-3xl md:text-5xl font-black mb-2 text-center uppercase tracking-wider",children:t("home.ufc_300_title")}),e.jsx("p",{className:"text-lg md:text-xl mb-8 text-center text-gray-300 font-light",children:t("home.star_fight_description")}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-4 md:gap-8 mb-8 items-center",children:[e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>l("A"),className:tc("absolute -top-2 -left-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","A"===s&&"medal-selected"),"aria-label":t("home.select_fav_a"),children:e.jsx(Ac,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:t("home.fighter_a"),src:"/foto_jon.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"Jon "}),e.jsxs("p",{className:"text-gray-400 text-sm mb-2",children:[t("home.champion")," | 28-0-0"]}),e.jsx(we,{children:n&&e.jsxs(al.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(yd,{className:"w-4 h-4 mr-1.5"}),r.A,t("home.vote_percent")]})})]}),e.jsx("div",{className:"flex flex-col items-center justify-center self-center pt-8 md:pt-0",children:e.jsx(Xm,{})}),e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>l("B"),className:tc("absolute -top-2 -right-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","B"===s&&"medal-selected"),"aria-label":t("home.select_fav_b"),children:e.jsx(Ac,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:t("home.fighter_b"),src:"/foto_khabib.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"khabib "}),e.jsxs("p",{className:"text-gray-400 text-sm mb-2",children:[t("home.challenger")," | 25-2-0"]}),e.jsx(we,{children:n&&e.jsxs(al.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(yd,{className:"w-4 h-4 mr-1.5"}),r.B,t("home.vote_percent")]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 md:gap-4 justify-center mt-6",children:[e.jsx(nc,{size:"lg",className:"bg-red-600 hover:bg-red-700 text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(Z,{to:"/live",children:t("home.see_more")})}),e.jsx(nc,{size:"lg",variant:"outline",className:"border-red-600 text-red-600 hover:bg-red-600 hover:text-white text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(Z,{to:"/predict",children:t("home.make_prediction")})})]})]})})})]})},Zm=async()=>{try{const{data:e,error:t}=await nm.from("evento").select("*").eq("activo",!0).order("orden_mostrar",{ascending:!0}).order("fecha",{ascending:!0});if(t)throw new Error(`Error al obtener eventos: ${t.message}`);return e||[]}catch(e){throw e}},eg=t=>{const{t:s}=Ec(),[i,r]=Y.useState([]),[a,n]=Y.useState(!0);Y.useEffect((()=>{(async()=>{try{n(!0);const e=await Zm();r(e.slice(0,3))}catch(e){}finally{n(!1)}})()}),[]);const o=e=>e.detalles_url||`/event/${e.id}`;return a?e.jsx("section",{className:"py-16 px-4 bg-gradient-to-b from-black via-gray-950 to-black",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex justify-center items-center py-20",children:[e.jsx(Wc,{className:"w-8 h-8 animate-spin text-red-500 mr-4"}),e.jsx("span",{className:"text-gray-400",children:"Cargando eventos..."})]})})}):e.jsxs("section",{className:"py-16 px-4 bg-gradient-to-b from-black via-gray-950 to-black",children:[" ",e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center text-white",children:[e.jsx(Pc,{className:"mr-3 text-red-500"})," ",s("home.upcoming_events")]}),e.jsx(nc,{variant:"link",className:"text-red-400 hover:text-red-300",asChild:!0,children:e.jsx(Z,{to:"/events",children:s("home.see_all")})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:i.map(((t,i)=>{return e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i},className:"bg-black/60 rounded-lg overflow-hidden card-hover border border-gray-800 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:t.texto_alternativo||t.titulo,src:t.imagen||"https://images.unsplash.com/photo-1649190800807-6f1d42a4bc05"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h4",{className:"text-lg font-bold text-white shadow-text",children:t.titulo})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-400 mb-2",children:[e.jsx(Pc,{className:"w-4 h-4 mr-2 text-red-500"}),(r=t.fecha,new Date(r).toLocaleDateString("es-ES",{month:"short",day:"numeric"}))]}),e.jsxs("p",{className:"text-gray-300 mb-3 text-sm flex items-center",children:[e.jsx(yd,{className:"w-4 h-4 mr-2 text-red-500"}),t.pelea_principal_participantes||"TBD"]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(nc,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 hover:bg-red-900/30",asChild:!0,children:e.jsx(Z,{to:o(t),children:s("home.see_details")})})})]})]},t.id);var r}))})]})]})},tg=()=>e.jsxs(al.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"bg-black text-white",children:[e.jsx(Qm,{}),e.jsx(eg,{})]}),sg=X.forwardRef((({className:t,type:s,...i},r)=>e.jsx("input",{type:s,className:tc("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})));sg.displayName="Input";const ig=rc("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),rg=X.forwardRef((({className:t,...s},i)=>e.jsx(M,{ref:i,className:tc(ig(),t),...s})));rg.displayName=M.displayName;const ag=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})));ag.displayName="Card";const ng=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("flex flex-col space-y-1.5 p-6",t),...s})));ng.displayName="CardHeader";const og=X.forwardRef((({className:t,...s},i)=>e.jsx("h3",{ref:i,className:tc("text-2xl font-semibold leading-none tracking-tight",t),...s})));og.displayName="CardTitle";const lg=X.forwardRef((({className:t,...s},i)=>e.jsx("p",{ref:i,className:tc("text-sm text-muted-foreground",t),...s})));lg.displayName="CardDescription";const cg=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("p-6 pt-0",t),...s})));cg.displayName="CardContent";const dg=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("flex items-center p-6 pt-0",t),...s})));dg.displayName="CardFooter";const hg=()=>{const{t:t}=Ec(),[s,i]=Y.useState(!1),[r,a]=Y.useState(!1),[n,o]=Y.useState({correo:"","contraseña":""}),[l,c]=Y.useState(""),d=ee(),h=e=>{o({...n,[e.target.name]:e.target.value})};return e.jsxs(ag,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(ng,{className:"space-y-3",children:[e.jsx(og,{className:"text-3xl font-black text-red-600 tracking-wider",children:t("auth.login")}),e.jsx(lg,{className:"text-gray-400 text-base",children:t("auth.login_subtitle")})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(""),a(!0);try{const{data:e,error:t}=await nm.auth.signInWithPassword({email:n.correo,password:n.contraseña});if(t)throw new Error(t.message);localStorage.setItem("user",JSON.stringify(e.user)),localStorage.setItem("access_token",e.session?.access_token||""),window.dispatchEvent(new Event("storage")),d("/")}catch(t){c(t.message)}finally{a(!1)}},children:[l&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:l})}),e.jsxs(cg,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"correo",className:"text-sm font-medium text-gray-300",children:t("auth.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"correo",name:"correo",type:"email",placeholder:t("auth.email_placeholder"),required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:n.correo,onChange:h})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"contraseña",className:"text-sm font-medium text-gray-300",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(zc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"contraseña",name:"contraseña",type:s?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:n.contraseña,onChange:h}),e.jsx("button",{type:"button",onClick:()=>i(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:s?e.jsx(Gc,{className:"h-5 w-5"}):e.jsx(Kc,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"remember",className:"rounded border-gray-700 bg-gray-900/50 text-red-600 focus:ring-red-600"}),e.jsx("label",{htmlFor:"remember",className:"text-gray-400",children:t("auth.remember")})]}),e.jsx(Z,{to:"/forgot-password",className:"text-red-500 hover:text-red-400 hover:underline",children:t("auth.forgot_password")})]})]}),e.jsxs(dg,{className:"flex flex-col space-y-4",children:[e.jsx(nc,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-lg py-3 font-bold uppercase tracking-wider",disabled:r,children:t(r?"auth.logging_in":"auth.login")}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-black/80 px-2 text-gray-400",children:t("auth.or_continue_with")})})]}),e.jsxs(nc,{type:"button",onClick:async()=>{a(!0);try{const{error:e}=await nm.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});e&&c(e.message)}catch(e){c(e.message)}finally{a(!1)}},className:"w-full bg-white hover:bg-gray-100 text-gray-900 font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2",disabled:r,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{children:t("auth.continue_with_google")})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:[t("auth.no_account")," ",e.jsx(Z,{to:"/register",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:t("auth.register_here")})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t("auth.accept_terms"),e.jsx(Z,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:t("auth.terms_conditions")})]})]})]})]})]})},ug=()=>{const{t:t}=Ec();return e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(al.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(Sc,{className:"h-72 w-auto mx-auto"})}),e.jsxs(al.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:[t("login.welcome")," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(al.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:t("login.subtitle")})]}),e.jsx(al.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(hg,{})})]})})]})},fg=()=>{const{t:t}=Ec(),[s,i]=Y.useState(!1),[r,a]=Y.useState(!1),[n,o]=Y.useState(!1),[l,c]=Y.useState({nombre_usuario:"",correo:"","contraseña":"","confirmar_contraseña":""}),[d,h]=Y.useState(""),u=ee(),f=e=>{c({...l,[e.target.name]:e.target.value})};return e.jsxs(ag,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(ng,{className:"space-y-3",children:[e.jsx(og,{className:"text-3xl font-black text-red-600 tracking-wider",children:t("auth.create_account")}),e.jsx(lg,{className:"text-gray-400 text-base",children:t("auth.complete_data_join_community")})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h(""),l.contraseña===l.confirmar_contraseña){o(!0);try{const{data:e,error:t}=await nm.auth.signUp({email:l.correo,password:l.contraseña,options:{data:{nombre_usuario:l.nombre_usuario}}});if(t)throw new Error(t.message);const{user:s}=e,{error:i}=await nm.from("usuario").insert([{nombre_usuario:l.nombre_usuario,correo:l.correo,fecha_registro:(new Date).toISOString(),puntos:0,rango:"Novato",avatar:null,notificaciones:!0,tema:"dark","contraseña":"",saldo:0}]);if(i)throw new Error(i.message);u("/login")}catch(s){h(s.message)}finally{o(!1)}}else h(t("auth.passwords_no_match"))},children:[e.jsxs(cg,{className:"space-y-4",children:[d&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:d})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"nombre_usuario",className:"text-sm font-medium text-gray-300",children:t("auth.username")}),e.jsxs("div",{className:"relative",children:[e.jsx(pd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"nombre_usuario",name:"nombre_usuario",placeholder:t("auth.username_placeholder"),required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:l.nombre_usuario,onChange:f})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"correo",className:"text-sm font-medium text-gray-300",children:t("auth.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"correo",name:"correo",type:"email",placeholder:t("auth.email_placeholder"),required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:l.correo,onChange:f})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"contraseña",className:"text-sm font-medium text-gray-300",children:t("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(zc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"contraseña",name:"contraseña",type:s?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10",value:l.contraseña,onChange:f}),e.jsx("button",{type:"button",onClick:()=>i(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:s?e.jsx(Gc,{className:"h-5 w-5"}):e.jsx(Kc,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(rg,{htmlFor:"confirmar_contraseña",className:"text-sm font-medium text-gray-300",children:t("auth.confirm_password")}),e.jsxs("div",{className:"relative",children:[e.jsx(zc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(sg,{id:"confirmar_contraseña",name:"confirmar_contraseña",type:r?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10",value:l.confirmar_contraseña,onChange:f}),e.jsx("button",{type:"button",onClick:()=>a(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:r?e.jsx(Gc,{className:"h-5 w-5"}):e.jsx(Kc,{className:"h-5 w-5"})})]})]})]}),e.jsxs(dg,{className:"flex flex-col space-y-4",children:[e.jsx(nc,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-lg py-3 font-bold uppercase tracking-wider",disabled:n,children:t(n?"auth.registering":"auth.register")}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:[t("auth.already_have_account")," ",e.jsx(Z,{to:"/login",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:t("auth.login_here")})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t("auth.accept_terms"),e.jsx(Z,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:t("auth.terms_conditions")})]})]})]})]})]})},mg=()=>{const{t:t}=Ec();return e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(al.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(Sc,{className:"h-72 w-auto mx-auto"})}),e.jsxs(al.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:[t("register.title")," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(al.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:t("register.subtitle")})]}),e.jsx(al.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(fg,{})})]})})]})},gg=X.forwardRef((({className:t,...s},i)=>e.jsx(F,{className:tc("grid gap-2",t),...s,ref:i})));gg.displayName=F.displayName;const pg=X.forwardRef((({className:t,...s},i)=>e.jsx($,{ref:i,className:tc("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(U,{className:"flex items-center justify-center",children:e.jsx(Mc,{className:"h-2.5 w-2.5 fill-current text-current"})})})));pg.displayName=$.displayName;const yg=X.forwardRef((({className:t,...s},i)=>e.jsxs(B,{ref:i,className:tc("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(V,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(G,{className:"absolute h-full bg-primary"})}),e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}),Array.isArray(s.value)&&s.value.length>1&&e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})));yg.displayName=B.displayName;const vg=rc("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function xg({className:t,variant:s,...i}){return e.jsx("div",{className:tc(vg({variant:s}),t),...i})}const bg=()=>{const[e,t]=Y.useState(!1),{toast:s}=Wm();return{loading:e,purchaseBadge:async(e,i,r=[])=>{t(!0);try{const t=await Am(e,i);return s({title:"¡Insignia comprada con éxito!",description:`Has adquirido la insignia por ${t.insignia.precio} monedas`}),r.forEach((e=>{"function"==typeof e&&e()})),t}catch(a){throw s({title:"Error al comprar insignia",description:a.message||"No se pudo completar la compra",variant:"destructive"}),a}finally{t(!1)}}}},wg=({userId:t})=>{const{t:s}=Ec(),{toast:i}=Wm(),{refreshUser:r}=um(),{triggerBadgeUpdate:a}=Cm(),[n,o]=Y.useState([]),[l,c]=Y.useState(null),[d,h]=Y.useState([]),[u,f]=Y.useState(!0),[m,g]=Y.useState(!1),{loading:p,purchaseBadge:y}=bg();Y.useEffect((()=>{t&&(v(),x(),m&&b())}),[t,m]),Y.useEffect((()=>{t&&(v(),x())}),[t]);const v=async()=>{try{const e=await Lm(t);o(e)}catch(e){}},x=async()=>{try{const e=await Rm(t);c(e)}catch(e){}},b=async()=>{try{const e=await km(),t=n.map((e=>e.insignias_catalogo?.id)),s=e.filter((e=>!t.includes(e.id)));h(s)}catch(e){}},w=async e=>{try{const s=n.find((t=>t.insignias_catalogo?.id===e));await async function(e,t){try{const{data:s,error:i}=await nm.from("insignias_usuario").select("*").eq("usuario_id",e).eq("insignia_id",t).single();if(i)throw new Error("No tienes esta insignia");await nm.from("insignias_usuario").update({equipada:!1}).eq("usuario_id",e).eq("equipada",!0);const{error:r}=await nm.from("insignias_usuario").update({equipada:!0}).eq("usuario_id",e).eq("insignia_id",t);if(r)throw r;return{success:!0}}catch(s){throw s}}(t,e),await x(),await v(),r&&r(),a(),i({title:"✨ Insignia equipada",description:`Has equipado la insignia ${s?.insignias_catalogo?.nombre}`})}catch(s){i({title:"Error",description:s.message||"No se pudo equipar la insignia",variant:"destructive"})}},E=async()=>{try{await async function(e){try{const{error:t}=await nm.from("insignias_usuario").update({equipada:!1}).eq("usuario_id",e).eq("equipada",!0);if(t)throw t;return{success:!0}}catch(t){throw t}}(t),await x(),r&&r(),a(),i({title:"Insignia desequipada",description:"Has desequipado tu insignia actual"})}catch(e){i({title:"Error",description:e.message||"No se pudo desequipar la insignia",variant:"destructive"})}},S=e=>{switch(e){case"comun":default:return{badge:"bg-gray-600 text-white",border:"border-gray-600"};case"rara":return{badge:"bg-blue-600 text-white",border:"border-blue-600"};case"legendaria":return{badge:"bg-yellow-600 text-black",border:"border-yellow-600"}}},T=t=>{switch(t){case"comun":default:return e.jsx(cd,{className:"h-3 w-3"});case"rara":return e.jsx(Ac,{className:"h-3 w-3"});case"legendaria":return e.jsx(Bc,{className:"h-3 w-3"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ag,{className:"bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:[e.jsx(ng,{children:e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(Bc,{className:"h-5 w-5 text-yellow-400"}),e.jsx("span",{children:"Insignia Equipada"})]})}),e.jsx(cg,{children:l?e.jsxs("div",{className:"group relative p-4 bg-gradient-to-r from-green-900/30 to-emerald-900/20 rounded-xl border-2 border-green-500 shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 via-emerald-500/5 to-green-500/10 rounded-xl opacity-50 animate-pulse"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"text-4xl transform transition-transform group-hover:scale-110 animate-glow flex-shrink-0",children:l.insignias_catalogo?.icono||"🏆"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-bold text-white text-xl",children:l.insignias_catalogo?.nombre}),e.jsxs(xg,{className:"bg-green-500 text-white text-xs animate-pulse shadow-lg",children:[e.jsx(Bc,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Equipada"})]})]}),e.jsx("p",{className:"text-base text-gray-300 mb-3",children:l.insignias_catalogo?.descripcion}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(xg,{className:`${S(l.insignias_catalogo?.rareza).badge} text-sm`,children:[T(l.insignias_catalogo?.rareza),e.jsx("span",{className:"ml-1 capitalize",children:l.insignias_catalogo?.rareza})]}),e.jsxs("span",{className:"text-sm text-yellow-400",children:["Comprada por ",l.precio_pagado," monedas"]})]})]})]}),e.jsxs(nc,{variant:"outline",size:"sm",onClick:E,className:"border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition-all duration-300 hover:shadow-lg flex-shrink-0",children:[e.jsx(Bc,{className:"h-4 w-4 mr-1"}),"Desequipar"]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Ac,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No tienes ninguna insignia equipada"}),e.jsx("p",{className:"text-sm mt-2",children:"Compra y equipa insignias para mostrar tu estilo"})]})})]}),e.jsxs(ag,{className:"bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:[e.jsxs(ng,{className:"flex flex-row items-center justify-between",children:[e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(Ac,{className:"h-5 w-5 text-blue-400"}),e.jsx("span",{children:"Mis Insignias"})]}),e.jsxs(wd,{open:m,onOpenChange:g,children:[e.jsx(Ed,{asChild:!0,children:e.jsxs(nc,{className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(od,{className:"h-4 w-4 mr-2"}),"Comprar"]})}),e.jsxs(Ad,{className:"w-96 bg-gray-900 border-gray-700",children:[e.jsx(Ld,{children:e.jsxs(Rd,{className:"text-white flex items-center space-x-2",children:[e.jsx(od,{className:"h-5 w-5"}),e.jsx("span",{children:"Tienda de Insignias"})]})}),e.jsxs("div",{className:"space-y-4 mt-6 max-h-96 overflow-y-auto",children:[d.map((s=>e.jsxs("div",{className:"p-4 bg-gray-800/50 rounded-lg border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:s.icono}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.nombre}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(xg,{className:S(s.rareza).badge,children:[T(s.rareza),e.jsx("span",{className:"ml-1 capitalize",children:s.rareza})]})})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-400",children:[e.jsx($c,{className:"h-4 w-4"}),e.jsx("span",{className:"font-bold",children:s.precio.toLocaleString()})]})})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:s.descripcion}),e.jsx(nc,{className:"w-full bg-green-600 hover:bg-green-700",size:"sm",disabled:p,onClick:()=>(async e=>{try{await y(t,e,[v,b])}catch(s){}})(s.id),children:p?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Comprando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($c,{className:"h-4 w-4 mr-2"}),"Comprar por ",s.precio.toLocaleString()," monedas"]})})]},s.id))),0===d.length&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("span",{children:"Ya tienes todas las insignias disponibles"})})]})]})]})]}),e.jsx(cg,{children:0===n.length?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Ac,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No tienes insignias compradas"}),e.jsx("p",{className:"text-sm mt-2",children:"Compra tu primera insignia para empezar"})]}):e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto pr-2",children:n.map((t=>{const s=t.insignias_catalogo,i=t.equipada;return e.jsxs("div",{className:`group relative p-4 rounded-xl border-2 transition-all duration-300 hover:scale-105 hover:shadow-lg ${i?"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border-green-500 shadow-green-500/20":"bg-gradient-to-r from-gray-800/50 to-gray-800/30 border-gray-600 hover:border-gray-500"} ${S(s?.rareza).border}`,children:[i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 via-emerald-500/5 to-green-500/10 rounded-xl opacity-50 animate-pulse"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:`text-3xl transform transition-transform group-hover:scale-110 ${i?"animate-glow":""} flex-shrink-0`,children:s?.icono}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-white text-base leading-tight",children:s?.nombre}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s?.descripcion})]})]}),e.jsxs(xg,{className:`${S(s?.rareza).badge} text-xs px-2 py-1 flex-shrink-0`,children:[T(s?.rareza),e.jsx("span",{className:"ml-1 capitalize",children:s?.rareza})]})]}),i&&e.jsx("div",{className:"mb-3",children:e.jsx(xg,{className:"bg-green-500 text-white text-xs px-2 py-1 animate-pulse shadow-lg",children:e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Bc,{className:"h-3 w-3"}),e.jsx("span",{children:"Equipada"})]})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-3",children:[e.jsxs("span",{children:["Comprada: ",new Date(t.fecha_compra).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($c,{className:"h-3 w-3 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400 font-medium",children:t.precio_pagado})]})]}),e.jsx("div",{className:"flex space-x-2",children:i?e.jsxs(nc,{size:"sm",variant:"outline",className:"flex-1 border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition-colors text-xs",onClick:E,children:[e.jsx(Bc,{className:"h-3 w-3 mr-1"}),"Desequipar"]}):e.jsxs(nc,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs transition-all duration-300 hover:shadow-lg",onClick:()=>w(s.id),children:[e.jsx(Bc,{className:"h-3 w-3 mr-1"}),"Equipar"]})})]})]},`${t.id}-${s?.id}`)}))})})]})]})};const Eg=({userId:t,username:s,className:i="",showBadge:r=!0,badgePosition:a="right"})=>{const[n,o]=Y.useState(t),{equippedBadge:l}=Im(n);return Y.useEffect((()=>{(async()=>{if(!t&&s){const e=await async function(e){try{if(!e)return null;const{data:t,error:s}=await nm.from("usuario").select("id").eq("nombre_usuario",e).single();return s?null:t.id}catch(t){return null}}(s);o(e)}else o(t)})()}),[t,s]),s?r&&l?"below"===a?e.jsxs("div",{className:`flex flex-col space-y-1 ${i}`,children:[e.jsx("span",{children:s}),e.jsx(Dm,{equippedBadge:l,className:"self-start"})]}):e.jsxs("div",{className:`flex items-start space-x-2 ${i}`,children:[e.jsx("span",{className:"leading-tight",children:s}),e.jsx(Dm,{equippedBadge:l,className:"flex-shrink-0"})]}):e.jsx("span",{className:i,children:s}):null},Sg=()=>{const{user:t,loading:s,refreshUser:i}=um(),[r,a]=Y.useState(!1),[n,o]=Y.useState("dark"),[l,c]=Y.useState("public"),[d,h]=Y.useState(!1),[u,f]=Y.useState(""),m=Y.useRef(),[g,p]=Y.useState(null),[y,v]=Y.useState(null),{t:x,i18n:b}=Ec(),[w,E]=Y.useState(b.language||"es");Y.useEffect((()=>{b.changeLanguage(w)}),[w,b]),Y.useEffect((()=>{(async()=>{const e=JSON.parse(localStorage.getItem("user"));if(!e)return;const{data:t,error:s}=await nm.from("usuario").select("*").eq("correo",e.email).single();t&&(setUserData(t),a(t.notificaciones),o(t.tema),f(t.nombre_usuario))})()}),[]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx(al.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(ag,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsxs(ng,{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("img",{className:"w-32 h-32 rounded-full mx-auto border-4 border-red-600 object-cover",alt:"User Avatar",src:y||t?.avatar||"/pain.png"}),e.jsx(nc,{variant:"ghost",size:"icon",className:"absolute bottom-0 right-0 bg-gray-700/80 rounded-full hover:bg-red-600",onClick:()=>m.current.click(),children:e.jsx(ld,{className:"w-4 h-4"})}),d&&e.jsx("input",{type:"file",accept:"image/*",ref:m,style:{display:"none"},onChange:e=>{const t=e.target.files[0];t&&(p(t),v(URL.createObjectURL(t)))}})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(og,{className:"text-3xl font-black uppercase tracking-wider text-red-500",children:t?.nombre_usuario||x("profile.username")}),e.jsx(Eg,{userId:t?.id,username:t?.nombre_usuario,badgePosition:"right",className:"text-center"})]}),e.jsxs(lg,{className:"text-gray-300",children:[x("profile.member_since")," ",t?new Date(t.fecha_registro).toLocaleDateString():"-"]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs(xm,{value:w,onValueChange:E,children:[e.jsx(wm,{className:"w-48 bg-gray-800 border-gray-700 text-white",children:e.jsx(bm,{children:x("profile.language")})}),e.jsxs(Tm,{children:[e.jsx(_m,{value:"es",children:"Español"}),e.jsx(_m,{value:"en",children:"English"}),e.jsx(_m,{value:"pt",children:"Português"})]})]})})]}),e.jsxs(cg,{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(pd,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:x("profile.username")}),d?e.jsx(sg,{className:"font-semibold text-white bg-gray-800 border-gray-700",value:u,onChange:e=>f(e.target.value)}):e.jsx("p",{className:"font-semibold text-white",children:t?.nombre_usuario})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(Xc,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:x("profile.email")}),e.jsx("p",{className:"font-semibold text-white",children:t?.correo})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx($c,{className:"w-6 h-6 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Monedas"}),e.jsx("p",{className:"font-semibold text-xl text-white",children:t?.saldo?.toLocaleString()??0})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(gd,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:x("profile.ranking")}),e.jsx("p",{className:"font-semibold text-xl text-white",children:t?.rango??"-"})]})]})]})]}),e.jsx(dg,{className:"flex justify-between",children:e.jsx(nc,{className:"bg-red-600 hover:bg-red-700 font-bold uppercase tracking-wider",onClick:async()=>{if(d){let e=t?.avatar;if(g){const s=g.name.split(".").pop(),i=`${t.id}_${Date.now()}.${s}`,{data:r,error:a}=await nm.storage.from("avatars").upload(i,g,{upsert:!0});if(!a){const{data:t}=nm.storage.from("avatars").getPublicUrl(i);e=t.publicUrl}}const{error:s}=await nm.from("usuario").update({nombre_usuario:u,avatar:e}).eq("correo",t.correo);s?alert("Error al guardar los cambios: "+s.message):(p(null),v(null),h(!1),i&&i())}else f(t?.nombre_usuario||""),h(!0)},children:x("profile.edit_profile")})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(wg,{userId:t?.id})})]})})})};async function Tg(e){const{data:t,error:s}=await nm.from("peleador").select("\n      *,\n      estadisticas:peleador_estadisticas(*)\n    ").eq("id",e).single();if(s)throw s;return t}function _g(){const[e,t]=Y.useState([]),[s,i]=Y.useState(!0),[r,a]=Y.useState(null),n=Y.useCallback((async()=>{try{i(!0),a(null);const e=await async function(){const{data:e,error:t}=await nm.from("peleador").select("\n      *,\n      estadisticas:peleador_estadisticas(*)\n    ").eq("activo",!0).order("nombre",{ascending:!0});if(t)throw t;return e||[]}();t(e)}catch(e){a(e.message)}finally{i(!1)}}),[]);return Y.useEffect((()=>{n()}),[n]),{fighters:e,loading:s,error:r,refetch:n}}function kg(){const[e,t]=Y.useState(null),[s,i]=Y.useState(null),[r,a]=Y.useState(null),[n,o]=Y.useState(!1),[l,c]=Y.useState(null),d=Y.useCallback((async(e,t)=>{if(e&&t)try{o(!0),c(null);const s=await async function(e,t){const[s,i]=await Promise.all([Tg(e),Tg(t)]);if(!s||!i)throw new Error("Uno o ambos peleadores no fueron encontrados");const r=s.estadisticas?.[0]||{},a=i.estadisticas?.[0]||{},n=(e,t=!0)=>{const s=r[e]||0,i=a[e]||0;return s===i?"tie":t?s>i?"fighter1":"fighter2":s<i?"fighter1":"fighter2"};return{fighter1:s,fighter2:i,comparison:{golpes_por_minuto:n("golpes_por_minuto"),precision_golpes:n("precision_golpes"),precision_defensa:n("precision_defensa"),takedowns_por_15_min:n("takedowns_por_15_min"),precision_takedowns:n("precision_takedowns"),defensa_takedowns:n("defensa_takedowns"),tiempo_promedio_pelea:n("tiempo_promedio_pelea",!1),kos_por_pelea:n("kos_por_pelea"),decisiones_ganadas:n("decisiones_ganadas")}}}(e,t);a(s)}catch(s){c(s.message)}finally{o(!1)}else a(null)}),[]),h=Y.useCallback((e=>{t(e),s&&d(e.id,s.id)}),[s,d]),u=Y.useCallback((t=>{i(t),e&&d(e.id,t.id)}),[e,d]),f=Y.useCallback((()=>{t(null),i(null),a(null),c(null)}),[]);return{fighter1:e,fighter2:s,comparison:r,loading:n,error:l,selectFighter1:h,selectFighter2:u,clearComparison:f,compareFighters:d}}const Ag=({icon:t,label:s,value:i,unit:r="",highlight:a="none"})=>{const n="better"===a?"text-green-400":"worse"===a?"text-red-500":"text-white",o="better"===a?md:"worse"===a?fd:Zc;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded mb-2 border-l-4 border-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{className:"w-5 h-5 mr-3 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:s})]}),e.jsxs("div",{className:`flex items-center font-semibold ${n}`,children:[e.jsx(o,{className:"w-4 h-4 mr-1 "+("none"===a?"opacity-0":"")}),i," ",r]})]})},Lg=()=>{const{t:t}=Ec(),{fighters:s,loading:i,error:r}=_g(),{fighter1:a,fighter2:n,loading:o,error:l,selectFighter1:c,selectFighter2:d}=kg(),{formatStats:h,getStatComparison:u}=function(){const e=Y.useCallback((e=>{if(!e?.estadisticas?.[0])return{strikesLanded:0,accuracy:0,takedowns:0,defense:0,avgFightTime:0};const t=e.estadisticas[0];return{strikesLanded:t.golpes_por_minuto||0,accuracy:t.precision_golpes||0,takedowns:t.takedowns_por_15_min||0,defense:t.precision_defensa||0,avgFightTime:t.tiempo_promedio_pelea||0}}),[]);return{formatStats:e,getStatComparison:Y.useCallback(((e,t,s,i=!0)=>{const r=t[e]||0,a=s[e]||0;return r===a?"none":i?r>a?"better":"worse":r<a?"better":"worse"}),[])}}(),f=(e,t)=>{const i=s.find((t=>t.id===parseInt(e)));i&&(1===t?c(i):d(i))},m=e=>h(e),g=(e,t=!0)=>{if(!a||!n)return"none";const s=m(a),i=m(n);return u(e,s,i,t)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(al.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"container mx-auto max-w-5xl",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider",children:t("compare.title")}),(r||l)&&e.jsx("div",{className:"mb-6 p-4 bg-red-900/50 border border-red-500 rounded-lg",children:e.jsx("p",{className:"text-red-400",children:r||l})}),i&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(Wc,{className:"w-8 h-8 animate-spin text-red-500"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Cargando peleadores..."})]}),!i&&0===s.length&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400 text-lg",children:"No hay peleadores disponibles"})}),!i&&s.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-6 md:gap-10 items-start",children:[e.jsx("div",{children:e.jsxs(ag,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(ng,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:e.jsxs(xm,{onValueChange:e=>f(e,1),value:a?.id?.toString()||"",children:[e.jsx(wm,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(bm,{placeholder:"Seleccionar Peleador 1"})}),e.jsx(Tm,{className:"bg-black border-gray-700 text-white",children:s.map((t=>e.jsx(_m,{value:t.id.toString(),disabled:t.id===n?.id,children:t.nombre},t.id)))})]},a?.id)}),e.jsx(cg,{className:"p-4 text-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.foto||"https://images.unsplash.com/photo-1545191488-2682adc1dfe4",alt:a.nombre,className:"w-48 h-48 mx-auto mb-4 object-cover rounded-lg"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:a.nombre}),a.division&&e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:a.division}),a.record&&e.jsxs("p",{className:"text-sm text-gray-300 mb-4",children:["Record: ",a.record]}),o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Wc,{className:"w-6 h-6 animate-spin text-red-500"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ag,{icon:Rc,label:t("compare.strikes_per_min"),value:m(a).strikesLanded.toFixed(1),highlight:g("strikesLanded")}),e.jsx(Ag,{icon:dd,label:t("compare.accuracy"),value:m(a).accuracy,unit:"%",highlight:g("accuracy")}),e.jsx(Ag,{icon:bd,label:t("compare.takedowns_per_15"),value:m(a).takedowns.toFixed(1),highlight:g("takedowns")}),e.jsx(Ag,{icon:nd,label:t("compare.defense"),value:m(a).defense,unit:"%",highlight:g("defense")}),e.jsx(Ag,{icon:Fc,label:t("compare.avg_fight_time"),value:m(a).avgFightTime.toFixed(1),unit:"min",highlight:g("avgFightTime",!1)})]})]}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"w-48 h-48 mx-auto mb-4 bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 text-lg",children:"Selecciona un peleador"})}),e.jsx("p",{className:"text-gray-400",children:"Elige un peleador del menú superior"})]})})]})}),e.jsx("div",{className:"hidden md:flex items-center justify-center h-full pt-24",children:e.jsx(Xm,{})}),e.jsx("div",{children:e.jsxs(ag,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(ng,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:e.jsxs(xm,{onValueChange:e=>f(e,2),value:n?.id?.toString()||"",children:[e.jsx(wm,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(bm,{placeholder:"Seleccionar Peleador 2"})}),e.jsx(Tm,{className:"bg-black border-gray-700 text-white",children:s.map((t=>e.jsx(_m,{value:t.id.toString(),disabled:t.id===a?.id,children:t.nombre},t.id)))})]},n?.id)}),e.jsx(cg,{className:"p-4 text-center",children:n?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.foto||"https://images.unsplash.com/photo-1656968385791-eff0b664d0ba",alt:n.nombre,className:"w-48 h-48 mx-auto mb-4 object-cover rounded-lg"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:n.nombre}),n.division&&e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:n.division}),n.record&&e.jsxs("p",{className:"text-sm text-gray-300 mb-4",children:["Record: ",n.record]}),o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Wc,{className:"w-6 h-6 animate-spin text-red-500"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ag,{icon:Rc,label:t("compare.strikes_per_min"),value:m(n).strikesLanded.toFixed(1),highlight:"better"===g("strikesLanded")?"worse":"worse"===g("strikesLanded")?"better":"none"}),e.jsx(Ag,{icon:dd,label:t("compare.accuracy"),value:m(n).accuracy,unit:"%",highlight:"better"===g("accuracy")?"worse":"worse"===g("accuracy")?"better":"none"}),e.jsx(Ag,{icon:bd,label:t("compare.takedowns_per_15"),value:m(n).takedowns.toFixed(1),highlight:"better"===g("takedowns")?"worse":"worse"===g("takedowns")?"better":"none"}),e.jsx(Ag,{icon:nd,label:t("compare.defense"),value:m(n).defense,unit:"%",highlight:"better"===g("defense")?"worse":"worse"===g("defense")?"better":"none"}),e.jsx(Ag,{icon:Fc,label:t("compare.avg_fight_time"),value:m(n).avgFightTime.toFixed(1),unit:"min",highlight:"better"===g("avgFightTime",!1)?"worse":"worse"===g("avgFightTime",!1)?"better":"none"})]})]}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"w-48 h-48 mx-auto mb-4 bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 text-lg",children:"Selecciona un peleador"})}),e.jsx("p",{className:"text-gray-400",children:"Elige un peleador del menú superior"})]})})]})})]})]})})},Rg=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:i,className:tc("w-full caption-bottom text-sm",t),...s})})));Rg.displayName="Table";const Pg=X.forwardRef((({className:t,...s},i)=>e.jsx("thead",{ref:i,className:tc("[&_tr]:border-b",t),...s})));Pg.displayName="TableHeader";const Ng=X.forwardRef((({className:t,...s},i)=>e.jsx("tbody",{ref:i,className:tc("[&_tr:last-child]:border-0",t),...s})));Ng.displayName="TableBody";X.forwardRef((({className:t,...s},i)=>e.jsx("tfoot",{ref:i,className:tc("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}))).displayName="TableFooter";const Cg=X.forwardRef((({className:t,...s},i)=>e.jsx("tr",{ref:i,className:tc("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s})));Cg.displayName="TableRow";const Ig=X.forwardRef((({className:t,...s},i)=>e.jsx("th",{ref:i,className:tc("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s})));Ig.displayName="TableHead";const Dg=X.forwardRef((({className:t,...s},i)=>e.jsx("td",{ref:i,className:tc("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s})));Dg.displayName="TableCell";X.forwardRef((({className:t,...s},i)=>e.jsx("caption",{ref:i,className:tc("mt-4 text-sm text-muted-foreground",t),...s}))).displayName="TableCaption";const jg=({peleador:t,visible:s,position:i={top:0,left:0}})=>{const{t:r}=Ec();return t&&s?e.jsx("div",{className:"fixed z-50 bg-gray-900 rounded-lg shadow-lg p-4 w-72 border-2 border-red-500",style:{top:i.top,left:i.left,transition:"opacity 0.2s",pointerEvents:"none"},children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:t.avatar||t.foto,alt:t.nombre,className:"w-24 h-24 rounded-full object-cover border-4 border-red-500 mb-2"}),e.jsx("h2",{className:"text-xl font-bold mb-1 text-yellow-400 text-center",children:t.nombre}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:r("fighter.division")})," ",t.division]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:r("fighter.country")})," ",t.pais]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:r("fighter.record")})," ",t.record]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:r("fighter.status")})," ",t.status]}),e.jsx("p",{className:"mt-2 text-sm text-gray-300 italic text-center",children:t.descripcion})]})}):null},Og=e=>{switch(e){case"Campeón":return"destructive";case"Top Contender":return"secondary";default:return"outline"}},Mg={top:40,left:40},Fg=()=>{const{t:t}=Ec(),[s,i]=X.useState(null),[r,a]=X.useState(null),[n,o]=X.useState({top:0,left:0}),[l,c]=X.useState(!1),[d,h]=X.useState([]),[u,f]=X.useState(null);X.useEffect((()=>{(async()=>{const{data:e,error:t}=await nm.from("peleador").select("*").order("puntos",{ascending:!1});t?(f(t.message||"Error al cargar peleadores"),h([])):h(e)})()}),[]),X.useEffect((()=>{if(!l)return;const e=e=>{e.target.closest(".hovercard-peleador")||e.target.closest(".peleador-nombre")||(c(!1),a(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[l]);const m=(e,t)=>{a(e),c(!0)},g=()=>{a(null),c(!1)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:[e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(qc,{className:"w-10 h-10 mr-4 text-yellow-400"}),t("fighters.title")]}),e.jsx("div",{className:"bg-black/70 rounded-lg border border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:u?e.jsx("p",{className:"p-6 text-center text-red-500",children:u}):0===d.length?e.jsx("p",{className:"p-6 text-center text-gray-400",children:t("fighters.no_table")}):e.jsxs(Rg,{children:[e.jsx(Pg,{children:e.jsxs(Cg,{className:"border-gray-700 hover:bg-gray-800/50",children:[e.jsx(Ig,{className:"w-[80px] text-center font-bold text-red-500",children:t("fighters.rank")}),e.jsx(Ig,{className:"font-bold text-red-500",children:t("fighters.name")}),e.jsx(Ig,{className:"font-bold text-red-500 hidden md:table-cell",children:t("fighters.division")}),e.jsx(Ig,{className:"font-bold text-red-500 hidden lg:table-cell",children:t("fighters.record")}),e.jsx(Ig,{className:"text-center font-bold text-red-500",children:t("fighters.status_col")}),e.jsxs(Ig,{className:"text-right font-bold text-red-500",children:[t("fighters.points_col")," ",e.jsx(cd,{className:"inline w-4 h-4 mb-1 ml-1 text-yellow-400"})]})]})}),e.jsx(Ng,{children:d.map(((s,i)=>e.jsxs(Cg,{className:"border-gray-800 hover:bg-gray-700/50 transition-colors cursor-pointer",children:[e.jsx(Dg,{className:"text-center font-medium",children:i+1}),e.jsx(Dg,{className:"font-semibold relative peleador-nombre",onMouseEnter:e=>m(s),onMouseMove:e=>m(s),onMouseLeave:g,onClick:()=>(e=>{a(e),c(!0)})(s),tabIndex:0,style:{outline:"none"},children:s.nombre}),e.jsx(Dg,{className:"hidden md:table-cell text-gray-400",children:t(`weight.${s.division}`)}),e.jsx(Dg,{className:"hidden lg:table-cell text-gray-400",children:s.record}),e.jsx(Dg,{className:"text-center",children:e.jsxs(xg,{variant:Og(s.status),className:"uppercase text-xs px-2 py-0.5",children:["Campeón"===s.status&&e.jsx(ad,{className:"w-3 h-3 mr-1 inline"}),t(`fighters.status.${s.status}`)]})}),e.jsx(Dg,{className:"text-right font-bold text-yellow-300",children:s.puntos?.toLocaleString()})]},s.id||i)))})]})}),e.jsx("p",{className:"text-center text-gray-500 mt-6 text-sm",children:t("fighters.note")})]}),e.jsx(jg,{peleador:r,visible:l&&!!r,position:Mg,className:"hovercard-peleador"})]})},$g=()=>{const{t:t}=Ec(),[s,i]=Y.useState([]),[r,a]=Y.useState(!0),[n,o]=Y.useState(null);Y.useEffect((()=>{(async()=>{try{a(!0),o(null);const e=await Zm();i(e)}catch(e){o(e.message)}finally{a(!1)}})()}),[]);const l=e=>e.detalles_url||`/event/${e.id}`;return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsxs("div",{className:"flex justify-center items-center py-20",children:[e.jsx(Wc,{className:"w-8 h-8 animate-spin text-red-500 mr-4"}),e.jsx("span",{className:"text-gray-400",children:"Cargando eventos..."})]})})}):n?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(kc,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Error al cargar eventos"}),e.jsx("p",{className:"text-gray-400",children:n})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-10 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Pc,{className:"w-10 h-10 mr-4 text-yellow-400"}),t("events.title")]}),0===s.length?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Pc,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-400 mb-2",children:"No hay eventos disponibles"}),e.jsx("p",{className:"text-gray-500",children:"Próximamente se agregarán nuevos eventos."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8",children:s.map(((s,i)=>{return e.jsx(al.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1*i},children:e.jsxs(ag,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col card-hover",children:[e.jsxs("div",{className:"relative h-48 md:h-56",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:s.texto_alternativo||s.titulo,src:s.imagen||"https://images.unsplash.com/photo-1696407254550-989e4543dc11"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"}),e.jsx("div",{className:"absolute bottom-4 left-4",children:e.jsx("h2",{className:"text-2xl font-bold text-white shadow-text",children:s.titulo})})]}),e.jsxs(cg,{className:"p-6 flex-grow flex flex-col",children:[e.jsxs("div",{className:"space-y-3 text-gray-300 mb-5 flex-grow",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(Pc,{className:"w-4 h-4 mr-2 text-red-500"}),(r=s.fecha,new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx(Jc,{className:"w-4 h-4 mr-2 text-red-500"}),s.ubicacion," (",s.sede,")"]}),e.jsxs("p",{className:"flex items-start",children:[e.jsx(yd,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"}),e.jsxs("span",{className:"font-semibold",children:[s.pelea_principal_titulo,":"]})," ",s.pelea_principal_participantes]}),s.pelea_co_estelar_participantes&&"TBD"!==s.pelea_co_estelar_participantes&&e.jsxs("p",{className:"flex items-start",children:[e.jsx(yd,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"}),e.jsxs("span",{className:"font-semibold",children:[s.pelea_co_estelar_titulo,":"]})," ",s.pelea_co_estelar_participantes]})]}),e.jsx("div",{className:"mt-auto flex justify-end",children:e.jsx(nc,{className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsxs(Z,{to:l(s),children:[e.jsx(hd,{className:"w-4 h-4 mr-2"}),t("events.details")]})})})]})]})},s.id);var r}))})]})})},Ug=l,Bg=i,Vg=Y.forwardRef((({className:t,...i},r)=>e.jsx(s,{ref:r,className:tc("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i})));Vg.displayName=s.displayName;const Gg=Y.forwardRef((({className:t,children:s,...i},n)=>e.jsxs(Bg,{children:[e.jsx(Vg,{}),e.jsxs(r,{ref:n,className:tc("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[s,e.jsxs(a,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(xd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Gg.displayName=r.displayName;const Kg=({className:t,...s})=>e.jsx("div",{className:tc("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Kg.displayName="DialogHeader";const Hg=Y.forwardRef((({className:t,...s},i)=>e.jsx(n,{ref:i,className:tc("text-lg font-semibold leading-none tracking-tight",t),...s})));Hg.displayName=n.displayName;const qg=Y.forwardRef((({className:t,...s},i)=>e.jsx(o,{ref:i,className:tc("text-sm text-muted-foreground",t),...s})));async function Wg(e){try{return[]}catch(t){return[]}}qg.displayName=o.displayName;const zg=e=>{const[t,s]=Y.useState(!1),[i,r]=Y.useState([]),[a,n]=Y.useState(!1);Y.useEffect((()=>{(async()=>{if(!e)return s(!1),void r([]);try{n(!0);const e=await async function(){try{return!1}catch(e){return!1}}();s(e);const t=await Wg();r(t)}catch(t){s(!1),r([])}finally{n(!1)}})()}),[e]);return{tieneAccesoClipsDestacados:t,recompensas:i,loading:a,comprarAccesoClips:async(e=500)=>{try{n(!0);const t=await async function(){try{throw new Error("Esta funcionalidad estará disponible próximamente")}catch(e){throw e}}(0,e);s(!0);const i=await Wg();return r(i),t}catch(t){throw t}finally{n(!1)}}}},Yg=({children:t})=>{const{user:s}=um(),{tieneAccesoClipsDestacados:i,loading:r}=zg(s?.id);return r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Verificando acceso..."})]})}):i?t:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center",children:e.jsxs(ag,{className:"max-w-md mx-auto bg-gradient-to-br from-gray-900/50 to-black border-purple-500/50",children:[e.jsxs(ng,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 p-4 bg-purple-500/20 rounded-full w-fit",children:e.jsx(zc,{className:"h-12 w-12 text-purple-400"})}),e.jsx(og,{className:"text-2xl font-bold text-white",children:"Contenido Premium"})]}),e.jsxs(cg,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"Este contenido es exclusivo para usuarios premium. Desbloquea el acceso para disfrutar de clips destacados."}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(Bc,{className:"h-5 w-5 text-purple-400"}),e.jsx("span",{className:"text-white font-semibold",children:"Acceso a Clips Destacados"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx($c,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400 font-semibold",children:"500 monedas"})]})]}),e.jsx(nc,{asChild:!0,className:"w-full bg-purple-600 hover:bg-purple-700",children:e.jsxs(Z,{to:"/badges",children:[e.jsx(Bc,{className:"h-4 w-4 mr-2"}),"Desbloquear Acceso"]})})]})]})})};async function Xg(e,t){const s=await async function(e,t){const{data:s,error:i}=await nm.from("clip_views").select("id").eq("user_id",e).eq("clip_id",t).single();if(i&&"PGRST116"!==i.code)throw i;return!!s}(e,t);if(!s){const{error:s}=await nm.from("clip_views").insert([{user_id:e,clip_id:t}]);if(s)throw s;return await nm.rpc("increment_featured_clip_views",{clip_id:t}),!0}return!1}const Jg=()=>{const{t:t}=Ec(),[s,i]=Y.useState([]),[r,a]=Y.useState(!0),[n,o]=Y.useState(null),[l,c]=Y.useState(null),[d,h]=Y.useState(!1),u=async()=>{try{a(!0),o(null);const e=await async function(){try{const{data:e,error:t}=await nm.from("featured_clips").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(n){throw n}}();i(e)}catch(e){o("Error inesperado al cargar los clips")}finally{a(!1)}},f=async e=>{try{const{data:{user:t}}=await nm.auth.getUser();if(t){await Xg(t.id,e.id)&&i((t=>t.map((t=>t.id===e.id?{...t,vistas:t.vistas+1}:t))))}c(e),h(!0)}catch(t){c(e),h(!0)}};return Y.useEffect((()=>{u()}),[]),r?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-7xl flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Wc,{className:"w-12 h-12 animate-spin text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400",children:t("highlights.loading")})]})})}):n?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-7xl flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-red-500 mb-4",children:n}),e.jsx(nc,{onClick:u,variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",children:t("highlights.retry")})]})})}):e.jsx(Yg,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:[e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(cd,{className:"w-10 h-10 mr-4 text-yellow-400"}),t("highlights.title")]}),e.jsx("p",{className:"text-gray-400 mt-4 text-lg",children:"Los mejores momentos del UFC, seleccionados por nuestro equipo"})]}),0===s.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-gray-400 mb-4",children:t("highlights.no_clips")}),e.jsx(nc,{onClick:u,variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",children:t("highlights.refresh")})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:s.map(((s,i)=>{return e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*i},className:"card-hover",children:e.jsxs(ag,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col",children:[e.jsxs("div",{className:"relative group aspect-video cursor-pointer",onClick:()=>f(s),children:[e.jsx("video",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",src:s.url_video,controls:!1,preload:"metadata",muted:!0,playsInline:!0}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(ed,{className:"w-16 h-16 text-white/80 drop-shadow-lg"})}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h3",{className:"text-lg font-bold text-white shadow-text",children:s.titulo})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(Kc,{className:"w-3 h-3 mr-1 text-red-500"})," ",(r=s.vistas,r>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(1)}K`:r?.toString()||"0")]})]}),e.jsxs(cg,{className:"p-4 flex-grow flex flex-col",children:[s.descripcion&&e.jsx("p",{className:"text-sm text-gray-400 mb-3 flex-grow",children:s.descripcion}),s.peleadores&&s.peleadores.length>0&&e.jsxs("p",{className:"text-sm text-gray-400 mb-3 flex-grow",children:[t("highlights.fighters"),": ",s.peleadores.join(", ")]}),e.jsx(nc,{variant:"outline",className:"w-full border-red-600 text-red-500 hover:bg-red-600 hover:text-white mt-auto",onClick:()=>f(s),children:t("highlights.watch_clip")})]})]})},s.id);var r}))})]}),e.jsx(Ug,{open:d,onOpenChange:h,children:e.jsxs(Gg,{className:"max-w-4xl bg-black/90 border-gray-800",children:[e.jsx(Kg,{children:e.jsx(Hg,{className:"text-white text-xl",children:l?.titulo})}),e.jsxs("div",{className:"relative",children:[e.jsx(nc,{variant:"ghost",size:"sm",className:"absolute top-2 right-2 z-10 bg-black/50 hover:bg-black/70",onClick:()=>h(!1),children:e.jsx(xd,{className:"w-4 h-4"})}),l&&e.jsx("video",{className:"w-full h-auto max-h-[70vh] rounded",controls:!0,autoPlay:!0,src:l.url_video,children:"Tu navegador no soporta el elemento de video."}),l?.descripcion&&e.jsx("p",{className:"text-gray-300 mt-4",children:l.descripcion}),l?.peleadores&&l.peleadores.length>0&&e.jsxs("p",{className:"text-gray-400 mt-2",children:[e.jsxs("strong",{children:[t("highlights.fighters"),":"]})," ",l.peleadores.join(", ")]})]})]})})]})})},Qg=X.forwardRef((({className:t,...s},i)=>e.jsx("textarea",{className:tc("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:i,...s})));async function Zg(){const{data:e,error:t}=await nm.from("forum_categories").select("*").order("id",{ascending:!0});if(t)throw t;return e||[]}Qg.displayName="Textarea";const ep=({categories:t,categoryId:s,onThreadCreated:i})=>{const[r,a]=Y.useState(!1),[n,o]=Y.useState(""),[l,c]=Y.useState(""),[d,h]=Y.useState(s||(t?.[0]?.id??"")),[u,f]=Y.useState(!1),{user:m}=um(),g=m?.auth?.id,p=m?.nombre_usuario,y=m?.avatar;Y.useEffect((()=>{t&&t.length>0?h(t[0].id):s&&h(s)}),[t,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(nc,{className:"bg-red-600 hover:bg-red-700",onClick:()=>a(!0),disabled:!m||t&&0===t.length,children:[e.jsx(td,{className:"w-5 h-5 mr-2"}),"Crear Nuevo Hilo"]}),r&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70",children:e.jsxs("div",{className:"bg-gray-900 p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-500 mb-4",children:"Crear Nuevo Hilo"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!p)return alert("Debes completar tu nombre en el perfil para crear hilos."),void f(!1);f(!0);try{const e=await async function({title:e,content:t,user_id:s,username:i,avatar:r,category_id:a}){const{data:n,error:o}=await nm.from("forum_threads").insert([{title:e,content:t,user_id:s,username:i,avatar:r,category_id:a}]).select().single();if(o)throw o;return n}({title:n,content:l,user_id:g,username:p,avatar:y,category_id:t?d:s});o(""),c(""),a(!1),i&&i(e)}catch(r){alert("Error al crear hilo: "+r.message)}finally{f(!1)}},children:[t&&e.jsxs("select",{className:"w-full mb-3 p-2 rounded bg-gray-800 border border-gray-700 text-white",value:d,onChange:e=>h(e.target.value),required:!0,disabled:0===t.length,children:[e.jsx("option",{value:"",disabled:!0,selected:""===d,children:"Selecciona una categoría"}),t.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]}),e.jsx("input",{className:"w-full mb-3 p-2 rounded bg-gray-800 border border-gray-700 text-white",placeholder:"Título del hilo",value:n,onChange:e=>o(e.target.value),required:!0}),e.jsx("textarea",{className:"w-full mb-3 p-2 rounded bg-gray-800 border border-gray-700 text-white",placeholder:"Contenido del hilo",value:l,onChange:e=>c(e.target.value),rows:5,required:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(nc,{type:"button",className:"bg-gray-700",onClick:()=>a(!1),disabled:u,children:"Cancelar"}),e.jsx(nc,{type:"submit",className:"bg-red-600 hover:bg-red-700",disabled:u,children:u?"Creando...":"Crear"})]})]})]})})]})},tp=()=>{const{t:t}=Ec(),[s,i]=Y.useState([]),[r,a]=Y.useState([]);return Y.useEffect((()=>{Zg().then(i),async function(e=10){const{data:t,error:s}=await nm.from("forum_threads").select("*, forum_categories(name)").order("created_at",{ascending:!1}).limit(e);if(s)throw s;return t||[]}(10).then(a)}),[]),e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-6 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Qc,{className:"w-10 h-10 mr-4 text-yellow-400"}),t("forum.title")]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(sg,{type:"text",placeholder:t("forum.search_placeholder"),className:"pl-10 bg-gray-900/50 border-gray-700 focus:border-red-500 focus:ring-red-500"}),e.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsx(ep,{categories:s,onThreadCreated:e=>a([e,...r])})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:t("forum.categories")}),s.map((t=>e.jsx(al.div,{whileHover:{scale:1.03},transition:{type:"spring",stiffness:300},children:e.jsxs(Z,{to:`/category/${t.id}`,children:[" ",e.jsxs(ag,{className:"bg-black/60 border-gray-800 hover:border-red-600/50 transition-colors duration-200 cursor-pointer",children:[e.jsxs(ng,{className:"flex flex-row items-center gap-4 pb-2",children:[e.jsx(Qc,{className:"w-6 h-6 text-red-500"}),e.jsx(og,{className:"text-lg text-white",children:t.name})]}),e.jsx(cg,{children:e.jsx(lg,{className:"text-gray-400",children:t.description})})]})]})},t.id)))]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:t("forum.recent_threads")}),e.jsx(ag,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx(cg,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:r.map((s=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(Z,{to:`/thread/${s.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t("forum.by")," ",e.jsx(Eg,{username:s.username,className:"font-medium text-gray-400"}),s.forum_categories?.name&&e.jsxs(e.Fragment,{children:[" ",t("forum.in")," ",e.jsx("span",{className:"text-red-400",children:s.forum_categories.name})]})," - ",new Date(s.created_at).toLocaleString()]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(Z,{to:`/thread/${s.id}`,children:e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded flex items-center",children:"Ver Hilo"})})})]},s.id)))})})})]})]})]})})},sp={id:1,fighter1:"Conor McGregor",fighter2:"Michael Chandler",event:"UFC 302: McGregor vs. Chandler",rounds:5},ip={winner:1.8,method:2.5,round:3,firstStrike:1.5,firstTakedown:2,willBeKO:1.6,willBeSub:3.5,goToDecision:2.2,mostSignificantStrikes:1.9},rp=["KO/TKO","Submission","Decision"],ap=({predictionKey:t,value:s,onChange:i,fighters:r,label:a,icon:n,iconColor:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(rg,{className:"text-lg font-semibold flex items-center text-gray-200",children:[n&&e.jsx(n,{className:`w-5 h-5 mr-2 ${o||"text-gray-400"}`}),a]}),e.jsxs(gg,{value:s,onValueChange:e=>i(t,e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pg,{value:r.fighter1,id:`${t}-${r.fighter1}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(rg,{htmlFor:`${t}-${r.fighter1}`,className:"text-gray-300",children:r.fighter1})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pg,{value:r.fighter2,id:`${t}-${r.fighter2}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(rg,{htmlFor:`${t}-${r.fighter2}`,className:"text-gray-300",children:r.fighter2})]})]})]}),np=({value:t,onChange:s})=>{const{t:i}=Ec();return e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:e.jsxs(gg,{value:t,onValueChange:e=>s("method",e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pg,{value:"KO/TKO",id:"method-KO/TKO",className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(rg,{htmlFor:"method-KO/TKO",className:"text-gray-300",children:i("prediction.ko_tko")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pg,{value:"Submission",id:"method-Submission",className:"border-gray-600 text-blue-500 focus:ring-blue-500"}),e.jsx(rg,{htmlFor:"method-Submission",className:"text-gray-300",children:i("prediction.submission")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pg,{value:"Decision",id:"method-Decision",className:"border-gray-600 text-green-500 focus:ring-green-500"}),e.jsx(rg,{htmlFor:"method-Decision",className:"text-gray-300",children:i("prediction.decision")})]})]})})},op=({value:t,onChange:s,maxRounds:i})=>{const{t:r}=Ec();return e.jsxs("div",{className:"space-y-4",children:[e.jsx(rg,{htmlFor:"round",className:"text-lg font-semibold text-gray-200",children:r("prediction.round_label")}),e.jsxs("div",{className:"flex items-center space-x-4 pt-1",children:[e.jsx(yg,{id:"round",min:1,max:i,step:1,value:t,onValueChange:s,className:"flex-grow [&>span:first-child]:bg-red-600"}),e.jsx("span",{className:"font-bold text-xl text-red-400 w-8 text-center",children:t[0]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:r("prediction.round_hint")})]})},lp=({betAmount:t,balance:s,potentialWinnings:i,onBetChange:r})=>{const{t:a}=Ec();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs(rg,{htmlFor:"betAmount",className:"text-lg font-semibold flex items-center text-gray-200",children:[e.jsx($c,{className:"w-5 h-5 mr-2 text-yellow-500"})," ",a("prediction.bet_amount")]}),e.jsxs("div",{className:"relative",children:[e.jsx(sg,{type:"text",id:"betAmount",value:t,onChange:r,placeholder:"0",className:"w-full bg-gray-900/50 border-gray-700 pl-4 pr-24 text-lg text-white",inputMode:"numeric"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-yellow-400 font-bold",children:a("prediction.coins")})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm mt-2",children:[e.jsxs("p",{className:"text-gray-400",children:[a("prediction.balance"),": ",e.jsx("span",{className:"font-semibold text-gray-200",children:s.toLocaleString()})," ",e.jsx($c,{className:"inline h-3 w-3 ml-0.5 text-yellow-400"})]}),e.jsxs("p",{className:"text-gray-400",children:[a("prediction.potential_win"),": ",e.jsx("span",{className:"font-bold text-green-400",children:i.toLocaleString()})," ",e.jsx($c,{className:"inline h-4 w-4 ml-1 text-yellow-400"})]})]})]})},cp=()=>{const{t:t}=Ec(),{user:s,refreshUser:i}=um(),[r,a]=Y.useState(sp),[n,o]=Y.useState(!1),[l,c]=Y.useState({winner:void 0,method:void 0,round:[Math.ceil(sp.rounds/2)],firstStrike:void 0,firstTakedown:void 0,willBeKO:void 0,willBeSub:void 0,goToDecision:void 0,mostSignificantStrikes:void 0}),[d,h]=Y.useState(""),[u,f]=Y.useState(0),[m,g]=Y.useState(!1),[p,y]=Y.useState([]),[v,x]=Y.useState(null),[b,w]=Y.useState(!1),[E,S]=Y.useState(!1);Y.useEffect((()=>{(async()=>{try{const e=(await Zm())[0];if(e){const t=e.pelea_principal_participantes?.split(" vs ")||["TBD","TBD"];a({id:e.id,fighter1:t[0]?.trim()||"TBD",fighter2:t[1]?.trim()||"TBD",event:e.titulo,rounds:5})}}catch(e){}})()}),[]);const[T,_]=Y.useState(!1),[k,A]=Y.useState(!1),[L,R]=Y.useState(""),[P,N]=Y.useState(""),[C,I]=Y.useState((()=>localStorage.getItem("ultimaApuestaPagada")||null));Y.useEffect((()=>{h(""),f(0)}),[s]),Y.useEffect((()=>{(async()=>{if(!s)return;const{data:e,error:t}=await nm.from("predicciones").select("*").eq("user_id",s.auth.id).order("created_at",{ascending:!1});if(!t&&e){y(e);const t=`${r.event}: ${r.fighter1} vs. ${r.fighter2}`,s=e.find((e=>e.evento===t));x(s||null)}})()}),[s,m]),Y.useEffect((()=>{(async()=>{if(p&&s)for(const t of p){if(t.pagada){t.evento===`${r.event}: ${r.fighter1} vs. ${r.fighter2}`&&_(!0);continue}if(!t.resultados_prediccion)continue;const a=Object.values(t.resultados_prediccion);if(0===a.length)continue;const n=a.every((e=>!0===e));try{n?(C!==String(t.id)&&(await om(s.id,t.ganancia_potencial,"ganancia_apuesta"),await nm.from("predicciones").update({pagada:!0}).eq("id",t.id),await i(),R(`¡Felicidades! Acertaste TODAS las predicciones y ganaste ${t.ganancia_potencial} monedas.`),N("success"),A(!0),I(String(t.id)),localStorage.setItem("ultimaApuestaPagada",String(t.id))),t.evento===`${r.event}: ${r.fighter1} vs. ${r.fighter2}`&&_(!0)):(C!==String(t.id)&&(await nm.from("predicciones").update({pagada:!0}).eq("id",t.id),R("No acertaste todas las predicciones. ¡Suerte para la próxima!"),N("fail"),A(!0),I(String(t.id)),localStorage.setItem("ultimaApuestaPagada",String(t.id))),t.evento===`${r.event}: ${r.fighter1} vs. ${r.fighter2}`&&_(!0))}catch(e){}}})()}),[p,s]);const D=()=>l.winner?"winner":l.method?"method":l.round?"round":"winner",j=(e,t)=>{const s=D(),i=ip[s]||1;return!e||e<=0?0:Math.floor(e*i)},O=(e,t)=>{try{let s=t;"method"!==e||rp.includes(t)||(s=void 0),"round"!==e||Array.isArray(t)&&0!==t.length||(s=[Math.ceil(r.rounds/2)]),c((t=>{const i={...t,[e]:s},r=parseInt(d,10)||0;return f(j(r)),i}))}catch(s){return}},M=async(e,t)=>{g(!0);try{await om(s.id,t,"cancelacion_apuesta");const{error:r}=await nm.from("predicciones").delete().eq("id",e);if(g(!1),r)return void alert("Error al borrar la apuesta: "+r.message);await i(),x(null),h(""),f(0),w(!1),_(!1)}catch(r){g(!1),alert("Error al cancelar la apuesta: "+r.message)}},F=({value:t})=>!0===t?e.jsx(Nc,{className:"inline w-5 h-5 text-green-500 ml-1",title:"¡Acertaste!"}):!1===t?e.jsx(vd,{className:"inline w-5 h-5 text-red-500 ml-1",title:"No acertaste"}):e.jsx("span",{className:"inline text-gray-400 text-xs ml-1",children:"Pendiente"});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:[e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-2xl",children:e.jsxs(ag,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsxs(ng,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(og,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:t("prediction.title")}),e.jsxs(lg,{className:"text-base sm:text-lg text-gray-300 mt-1",children:[r.event,": ",r.fighter1," vs. ",r.fighter2]})]}),e.jsx(cg,{className:"pt-6 space-y-8",children:T?e.jsxs("div",{className:"bg-gray-900/60 rounded-lg p-4 border border-gray-800 mb-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-400 mb-2",children:"Ya participaste en este evento"}),e.jsx("div",{className:"text-gray-300 mb-2",children:"No puedes realizar otra apuesta para este evento."}),v&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-white mb-1",children:v.evento}),e.jsxs("div",{className:"text-gray-400 text-sm mb-1",children:["Apuesta: ",e.jsx("span",{className:"text-yellow-400 font-bold",children:v.monto_apuesta})," | Ganancia: ",e.jsx("span",{className:"text-green-400 font-bold",children:v.ganancia_potencial})]}),e.jsx("div",{className:"text-gray-500 text-xs mb-2",children:new Date(v.created_at).toLocaleString()}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center text-sm mb-4",children:[v.prediccion?.winner&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Ganador:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:v.prediccion.winner})]}),v.prediccion?.method&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Método:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:v.prediccion.method})]}),v.prediccion?.round&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Round:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:Array.isArray(v.prediccion.round)?v.prediccion.round[0]:v.prediccion.round})]}),v.prediccion?.firstStrike&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"1er Golpe:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:v.prediccion.firstStrike})]}),v.prediccion?.firstTakedown&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"1er Derribo:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:v.prediccion.firstTakedown})]}),v.prediccion?.mostSignificantStrikes&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Más Golpes:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:v.prediccion.mostSignificantStrikes})]})]}),v&&!0!==v.pagada&&!v.resultados_prediccion&&e.jsx(nc,{onClick:()=>M(v.id,v.monto_apuesta),className:"bg-red-700 hover:bg-red-800 w-full",disabled:m,children:m?"Eliminando...":"Cancelar apuesta"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ap,{predictionKey:"winner",value:l.winner,onChange:O,fighters:r,label:t("prediction.who_wins"),icon:Ac,iconColor:"text-yellow-400"}),e.jsx(np,{value:l.method,onChange:O}),e.jsx(op,{value:l.round,onChange:e=>{O("round",e)},maxRounds:r.rounds}),e.jsx("hr",{className:"border-gray-700"}),e.jsx("h3",{className:"text-xl font-semibold text-center text-gray-300 pt-2 mb-6",children:"Predicciones Adicionales"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ap,{predictionKey:"firstStrike",value:l.firstStrike,onChange:O,fighters:r,label:t("prediction.first_strike"),icon:dd,iconColor:"text-blue-400"}),e.jsx(ap,{predictionKey:"firstTakedown",value:l.firstTakedown,onChange:O,fighters:r,label:t("prediction.first_takedown"),icon:jc,iconColor:"text-green-400"}),e.jsx(ap,{predictionKey:"mostSignificantStrikes",value:l.mostSignificantStrikes,onChange:O,fighters:r,label:t("prediction.most_significant_strikes"),icon:yd,iconColor:"text-purple-400"})]}),e.jsx("hr",{className:"border-gray-700 mt-8"}),e.jsx(lp,{betAmount:d,balance:s?.saldo??0,potentialWinnings:u,onBetChange:e=>{const t=e.target.value;if(/^\d*$/.test(t)){const e=parseInt(t,10)||0,i=Math.min(e,s?.saldo??0),r=i>0?i.toString():"";h(r),f(j(i))}}}),e.jsx(dg,{className:"border-t border-gray-700 pt-6",children:e.jsx(nc,{type:"submit",onClick:async e=>{if(e.preventDefault(),v)return void alert("Ya tienes una apuesta para este evento. Elimínala si quieres cambiarla.");const a=parseInt(d,10)||0;if(a<=0)alert(t("prediction.alert_invalid_bet"));else if(a>(s?.saldo??0))alert(t("prediction.alert_no_coins"));else if(s){g(!0);try{await lm(s.id,a,"apuesta");const e=D(),t=ip[e]||1,n=j(a),o={winner:l.winner,method:l.method,round:l.round,firstStrike:l.firstStrike,firstTakedown:l.firstTakedown,mostSignificantStrikes:l.mostSignificantStrikes},{error:c}=await nm.from("predicciones").insert([{user_id:s.auth.id,evento:`${r.event}: ${r.fighter1} vs. ${r.fighter2}`,prediccion:o,monto_apuesta:a,cuota:t,ganancia_potencial:n,pagada:!1}]);if(c)return alert("Error al guardar la predicción: "+c.message),void g(!1);await i(),h(""),f(0)}catch(n){alert("Error al apostar: "+n.message)}g(!1)}else alert("Debes iniciar sesión para apostar.")},className:"w-full bg-red-600 hover:bg-red-700 text-lg py-3 font-bold uppercase tracking-wider",disabled:!d||parseInt(d,10)<=0||m,children:m?t("prediction.sending")||"Enviando...":t("prediction.send")})})]})}),p.length>0&&e.jsxs("div",{className:"mt-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-200 mb-4",children:"Historial de Predicciones"}),e.jsx("div",{className:"space-y-4",children:p.map((t=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg p-4 border border-gray-800 mb-2 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-white mb-1",children:t.evento}),e.jsxs("div",{className:"text-gray-400 text-sm mb-1",children:["Apuesta: ",e.jsx("span",{className:"text-yellow-400 font-bold",children:t.monto_apuesta})," | Ganancia: ",e.jsx("span",{className:"text-green-400 font-bold",children:t.ganancia_potencial})]}),e.jsx("div",{className:"text-gray-500 text-xs mb-2",children:new Date(t.created_at).toLocaleString()}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center text-sm",children:[t.prediccion?.winner&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Ganador:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:t.prediccion.winner})," ",e.jsx(F,{value:t.resultados_prediccion?.winner})]}),t.prediccion?.method&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Método:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:t.prediccion.method})," ",e.jsx(F,{value:t.resultados_prediccion?.method})]}),t.prediccion?.round&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Round:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:Array.isArray(t.prediccion.round)?t.prediccion.round[0]:t.prediccion.round})," ",e.jsx(F,{value:t.resultados_prediccion?.round})]}),t.prediccion?.firstStrike&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"1er Golpe:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:t.prediccion.firstStrike})," ",e.jsx(F,{value:t.resultados_prediccion?.firstStrike})]}),t.prediccion?.firstTakedown&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"1er Derribo:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:t.prediccion.firstTakedown})," ",e.jsx(F,{value:t.resultados_prediccion?.firstTakedown})]}),t.prediccion?.mostSignificantStrikes&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-white",children:"Más Golpes:"})," ",e.jsx("span",{className:"ml-1 font-bold text-white",children:t.prediccion.mostSignificantStrikes})," ",e.jsx(F,{value:t.resultados_prediccion?.mostSignificantStrikes})]})]})]}),!0!==t.pagada&&!t.resultados_prediccion&&e.jsx(nc,{onClick:()=>M(t.id,t.monto_apuesta),className:"bg-red-700 hover:bg-red-800 w-full sm:w-auto mt-4 sm:mt-0",children:m?"Eliminando...":"Cancelar apuesta"})]},t.id)))})]})]})}),e.jsx(Ug,{open:k,onOpenChange:e=>{A(e)},children:e.jsxs(Gg,{className:"max-w-md mx-auto text-center bg-black border border-gray-700",children:[e.jsx(Hg,{className:"success"===P?"text-green-400":"text-red-400",children:"success"===P?"¡Apuesta Ganada!":"Apuesta No Acertada"}),e.jsx(qg,{className:"text-lg mt-2 mb-4 text-white",children:L}),e.jsx(nc,{onClick:()=>A(!1),className:"mt-2 w-full bg-red-700 hover:bg-red-800",children:"Cerrar"})]})})]})},dp=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},hp=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=up},up=Number.MAX_SAFE_INTEGER||9007199254740991;let fp=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),mp=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),gp=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var pp="manifest",yp="level",vp="audioTrack",xp="subtitleTrack",bp="main",wp="audio",Ep="subtitle";class Sp{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Tp{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Sp(e),this.fast_=new Sp(t),this.defaultTTFB_=i,this.ttfb_=new Sp(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Sp(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Sp(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Sp(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function _p(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function kp(){return kp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},kp.apply(null,arguments)}function Ap(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function Lp(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ap(Object(s),!0).forEach((function(t){_p(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ap(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}let Rp=class{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Pp,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}};const Pp=function(){},Np={trace:Pp,debug:Pp,log:Pp,warn:Pp,info:Pp,error:Pp};function Cp(){return kp({},Np)}function Ip(e,t,s){return t[e]?t[e].bind(t):function(e,t){const s=self.console[e];return s?s.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):Pp}(e,s)}const Dp=Cp();const jp=Dp;function Op(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Mp(e,t){const s=Object.keys(e),i=Object.keys(t),r=s.length,a=i.length;return!r||!a||r===a&&!s.some((e=>-1===i.indexOf(e)))}function Fp(e,t=!1){if("undefined"!=typeof TextDecoder){const s=new TextDecoder("utf-8").decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let i,r,a,n="",o=0;for(;o<s;){if(i=e[o++],0===i&&t)return n;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=e[o++],n+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[o++],a=e[o++],n+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&a)}}return n}const $p=function(e){let t="";for(let s=0;s<e.length;s++){let i=e[s].toString(16);i.length<2&&(i="0"+i),t+=i}return t};function Up(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bp,Vp={exports:{}};var Gp,Kp,Hp,qp,Wp,zp=Bp?Vp.exports:(Bp=1,Gp=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Kp=/^(?=([^\/?#]*))\1([^]*)$/,Hp=/(?:\/|^)\.(?=\/)/g,qp=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Wp={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var i=Wp.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=Wp.normalizePath(i.path),Wp.buildURLFromParts(i)}var r=Wp.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return s.alwaysNormalize?(r.path=Wp.normalizePath(r.path),Wp.buildURLFromParts(r)):t;var a=Wp.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var n=Kp.exec(a.path);a.netLoc=n[1],a.path=n[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=a.netLoc,"/"!==r.path[0]))if(r.path){var l=a.path,c=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=Wp.normalizePath(c)}else o.path=a.path,r.params||(o.params=a.params,r.query||(o.query=a.query));return null===o.path&&(o.path=s.alwaysNormalize?Wp.normalizePath(r.path):r.path),Wp.buildURLFromParts(o)},parseURL:function(e){var t=Gp.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(Hp,"");e.length!==(e=e.replace(qp,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},Vp.exports=Wp);class Yp{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Xp="audio",Jp="video",Qp="audiovideo";class Zp{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const s=iy(e,t);s&&(s.enumerable=!0,Object.defineProperty(e,t,s))}(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;i=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[Xp]:null,[Jp]:null,[Qp]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Yp),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=zp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Xp]=null,e[Jp]=null,e[Qp]=null}}function ey(e){return"initSegment"!==e.sn}class ty extends Zp{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(dp(e)&&dp(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=dp(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){dp(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return ey(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,s,i,r,a=!1){const{elementaryStreams:n}=this,o=n[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):n[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:a}}}class sy extends Zp{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function iy(e,t){const s=Object.getPrototypeOf(e);if(s){const e=Object.getOwnPropertyDescriptor(s,t);return e||iy(s,t)}}const ry=Math.pow(2,32)-1,ay=[].push,ny={video:1,audio:2,id3:3,text:4};function oy(e){return String.fromCharCode.apply(null,e)}function ly(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function cy(e,t){const s=hy(e,t);return s<0?4294967296+s:s}function dy(e,t){let s=cy(e,t);return s*=Math.pow(2,32),s+=cy(e,t+4),s}function hy(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function uy(e,t,s){e[t]=s>>24,e[t+1]=s>>16&255,e[t+2]=s>>8&255,e[t+3]=255&s}function fy(e,t){const s=[];if(!t.length)return s;const i=e.byteLength;for(let r=0;r<i;){const a=cy(e,r),n=a>1?r+a:i;if(oy(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,n));else{const i=fy(e.subarray(r+8,n),t.slice(1));i.length&&ay.apply(s,i)}r=n}return s}function my(e){const t=[],s=e[0];let i=8;const r=cy(e,i);i+=4;let a=0,n=0;0===s?(a=cy(e,i),n=cy(e,i+4),i+=8):(a=dy(e,i),n=dy(e,i+8),i+=16),i+=2;let o=e.length+n;const l=ly(e,i);i+=2;for(let c=0;c<l;c++){let s=i;const a=cy(e,s);s+=4;const n=2147483647&a;if(1===(2147483648&a)>>>31)return jp.warn("SIDX has hierarchical references (not supported)"),null;const l=cy(e,s);s+=4,t.push({referenceSize:n,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+n-1}}),o+=n,s+=4,i=s}return{earliestPresentationTime:a,timescale:r,version:s,referencesCount:l,references:t}}function gy(e){const t=[],s=fy(e,["moov","trak"]);for(let i=0;i<s.length;i++){const e=s[i],r=fy(e,["tkhd"])[0];if(r){let s=r[0];const i=cy(r,0===s?12:20),a=fy(e,["mdia","mdhd"])[0];if(a){s=a[0];const r=cy(a,0===s?12:20),n=fy(e,["mdia","hdlr"])[0];if(n){const s=oy(n.subarray(8,12)),a={soun:Xp,vide:Jp}[s],o=py(fy(e,["mdia","minf","stbl","stsd"])[0]);a?(t[i]={timescale:r,type:a,stsd:o},t[a]=Lp({timescale:r,id:i},o)):t[i]={timescale:r,type:s,stsd:o}}}}}return fy(e,["moov","mvex","trex"]).forEach((e=>{const s=cy(e,4),i=t[s];i&&(i.default={duration:cy(e,12),flags:cy(e,20)})})),t}function py(e){const t=e.subarray(8),s=t.subarray(86),i=oy(t.subarray(4,8));let r,a=i;const n="enca"===i||"encv"===i;if(n){const e=fy(t,[i])[0];fy(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=fy(e,["schm"])[0];if(t){const s=oy(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=fy(e,["frma"])[0];t&&(a=oy(t))}}}))}const o=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const e=fy(s,["avcC"])[0];e&&e.length>3&&(a+="."+xy(e[1])+xy(e[2])+xy(e[3]),r=yy("avc1"===o?"dva1":"dvav",s));break}case"mp4a":{const e=fy(t,[i])[0],s=fy(e.subarray(28),["esds"])[0];if(s&&s.length>7){let e=4;if(3!==s[e++])break;e=vy(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=vy(s,e);const i=s[e++];if(64!==i)break;if(a+="."+xy(i),e+=12,5!==s[e++])break;e=vy(s,e);const r=s[e++];let n=(248&r)>>3;31===n&&(n+=1+((7&r)<<3)+((224&s[e])>>5)),a+="."+n}break}case"hvc1":case"hev1":{const e=fy(s,["hvcC"])[0];if(e&&e.length>12){const t=e[1],s=["","A","B","C"][t>>6],i=31&t,r=cy(e,2),n=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);a+="."+s+i,a+="."+r.toString(16).toUpperCase(),a+="."+n+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}a+=c}r=yy("hev1"==o?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=yy(a,s)||a;break;case"vp09":{const e=fy(s,["vpcC"])[0];if(e&&e.length>6){const t=e[4],s=e[5],i=e[6]>>4&15;a+="."+by(t)+"."+by(s)+"."+by(i)}break}case"av01":{const e=fy(s,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],n=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,d=(16&e[2])>>4,h=(8&e[2])>>3,u=(4&e[2])>>2,f=3&e[2],m=1,g=1,p=1,y=0;a+="."+t+"."+by(i)+n+"."+by(c)+"."+d+"."+h+u+f+"."+by(m)+"."+by(g)+"."+by(p)+"."+y,r=yy("dav1",s)}break}}return{codec:a,encrypted:n,supplemental:r}}function yy(e,t){const s=fy(t,["dvvC"]),i=s.length?s[0]:fy(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return e+"."+by(t)+"."+by(s)}}function vy(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function xy(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function by(e){return(e<10?"0":"")+e}function wy(e){const t=fy(e,["schm"])[0];if(t){const s=oy(t.subarray(4,8));if("cbcs"===s||"cenc"===s)return fy(e,["schi","tenc"])[0]}return null}function Ey(e){const t=cy(e,0);let s=8;1&t&&(s+=4),4&t&&(s+=4);let i=0;const r=cy(e,4);for(let a=0;a<r;a++){if(256&t){i+=cy(e,s),s+=4}512&t&&(s+=4),1024&t&&(s+=4),2048&t&&(s+=4)}return i}function Sy(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function Ty(e,t){const s=[],i=t.samples,r=t.timescale,a=t.id;let n=!1;return fy(i,["moof"]).map((o=>{const l=o.byteOffset-8;fy(o,["traf"]).map((o=>{const c=fy(o,["tfdt"]).map((e=>{const t=e[0];let s=cy(e,4);return 1===t&&(s*=Math.pow(2,32),s+=cy(e,8)),s/r}))[0];return void 0!==c&&(e=c),fy(o,["tfhd"]).map((c=>{const d=cy(c,4),h=16777215&cy(c,0);let u=0;const f=!!(16&h);let m=0;const g=!!(32&h);let p=8;d===a&&(!!(1&h)&&(p+=8),!!(2&h)&&(p+=4),!!(8&h)&&(u=cy(c,p),p+=4),f&&(m=cy(c,p),p+=4),g&&(p+=4),"video"===t.type&&(n=_y(t.codec)),fy(o,["trun"]).map((a=>{const o=a[0],c=16777215&cy(a,0),d=!!(1&c);let h=0;const f=!!(4&c),g=!!(256&c);let p=0;const y=!!(512&c);let v=0;const x=!!(1024&c),b=!!(2048&c);let w=0;const E=cy(a,4);let S=8;d&&(h=cy(a,S),S+=4),f&&(S+=4);let T=h+l;for(let l=0;l<E;l++){if(g?(p=cy(a,S),S+=4):p=u,y?(v=cy(a,S),S+=4):v=m,x&&(S+=4),b&&(w=0===o?cy(a,S):hy(a,S),S+=4),t.type===Jp){let t=0;for(;t<v;){const a=cy(i,T);if(T+=4,ky(n,i[T])){Ay(i.subarray(T,T+a),n?2:1,e+w/r,s)}T+=a,t+=a+4}}e+=p/r}})))}))}))})),s}function _y(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function ky(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Ay(e,t,s,i){const r=Ly(e);let a=0;a+=t;let n=0,o=0,l=0;for(;a<r.length;){n=0;do{if(a>=r.length)break;l=r[a++],n+=l}while(255===l);o=0;do{if(a>=r.length)break;l=r[a++],o+=l}while(255===l);const e=r.length-a;let t=a;if(o<e)a+=o;else if(o>e){jp.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===n){if(181===r[t++]){const e=ly(r,t);if(t+=2,49===e){const e=cy(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const a=r[t++],o=64&a,l=o?2+3*(31&a):0,c=new Uint8Array(l);if(o){c[0]=a;for(let e=1;e<l;e++)c[e]=r[t++]}i.push({type:e,payloadType:n,pts:s,bytes:c})}}}}}else if(5===n&&o>16){const e=[];for(let s=0;s<16;s++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const a=o-16,l=new Uint8Array(a);for(let s=0;s<a;s++)l[s]=r[t++];i.push({payloadType:n,pts:s,uuid:e.join(""),userData:Fp(l),userDataBytes:l})}}}function Ly(e){const t=e.byteLength,s=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(s.push(i+2),i+=2):i++;if(0===s.length)return e;const r=t-s.length,a=new Uint8Array(r);let n=0;for(i=0;i<r;n++,i++)n===s[0]&&(n++,s.shift()),a[i]=e[n];return a}function Ry(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,a;i=0,r=new Uint8Array,a=new Uint8Array;const n=new Uint8Array(4);return s&&s.byteLength>0&&new DataView(n.buffer).setUint32(0,s.byteLength,!1),function(e,...t){const s=t.length;let i=8,r=s;for(;r--;)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4),r=0,i=8;r<s;r++)a.set(t[r],i),i+=t[r].byteLength;return a}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,r,n,s||new Uint8Array)}function Py(e){const t=e.getUint32(0),s=e.byteOffset,i=e.byteLength;if(i<t)return{offset:s,size:i};if(1886614376!==e.getUint32(4))return{offset:s,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:s,size:t};const a=e.buffer,n=$p(new Uint8Array(a,s+12,16)),o=e.getUint32(28);let l=null,c=null;if(0===r){if(t-32<o||o<22)return{offset:s,size:t};c=new Uint8Array(a,s+32,o)}else if(1===r){if(!o||i<s+32+16*o+16)return{offset:s,size:t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(a,s+32+16*e,16))}return{version:r,systemId:n,kids:l,data:c,offset:s,size:t}}const Ny=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Cy={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Iy(e,t){const s=Cy[t];return!!s&&!!s[e.slice(0,4)]}function Dy(e,t,s=!0){return!e.split(",").some((e=>!jy(e,t,s)))}function jy(e,t,s=!0){var i;const r=Op(s);return null!=(i=null==r?void 0:r.isTypeSupported(Oy(e,t)))&&i}function Oy(e,t){return`${t}/mp4;codecs=${e}`}function My(e){if(e){const t=e.substring(0,4);return Cy.video[t]}return 2}function Fy(e){const t=Ny();return e.split(",").reduce(((e,s)=>{const i=t&&_y(s)?9:Cy.video[s];return i?(2*i+e)/(e?3:2):(Cy.audio[s]+e)/(e?2:1)}),0)}const $y={};const Uy=/flac|opus|mp4a\.40\.34/i;function By(e,t=!0){return e.replace(Uy,(e=>function(e,t=!0){if($y[e])return $y[e];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<s.length;r++){var i;if(jy(s[r],"audio",t))return $y[e]=s[r],s[r];if("mp3"===s[r]&&null!=(i=Op(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t)))}function Vy(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e)))return e;if(t){const s=t.split(",");if(s.length>1){if(e)for(let t=s.length;t--;)if(s[t].substring(0,4)===e.substring(0,4))return s[t];return s[0]}}return t||e}function Gy(e){if(e.startsWith("av01.")){const t=e.split("."),s=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=s[e-4];return t.join(".")}return e}function Ky(e){const t=Op(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Hy(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const qy={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Wy(e,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:e}}const zy={};function Yy(e,t,s,i,r,a){const n=e.audioCodec?e.audioGroups:null,o=null==a?void 0:a.audioCodec,l=null==a?void 0:a.channels,c=l?parseInt(l):o?1/0:2;let d=null;if(null!=n&&n.length)try{d=1===n.length&&n[0]?t.groups[n[0]].channels:n.reduce(((e,s)=>{if(s){const i=t.groups[s];if(!i)throw new Error(`Audio track group ${s} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{2:0})}catch(h){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(r,8e6))||!!d&&dp(c)&&Object.keys(d).some((e=>parseInt(e)>c))}function Xy(e,t,s){const i=e.videoCodec,r=e.audioCodec;if(!i&&!r||!s)return Promise.resolve(qy);const a=[];if(i){const t={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},s=e.videoRange;"SDR"!==s&&(t.transferFunction=s.toLowerCase());const r=i.split(","),n=navigator.userAgent;if(r.some((e=>_y(e)))&&Ny())return Promise.resolve(Wy(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${n})`),a));a.push.apply(a,r.map((e=>({type:"media-source",video:Lp(Lp({},t),{},{contentType:Oy(Gy(e),"video")})}))))}return r&&e.audioGroups&&e.audioGroups.forEach((e=>{var s;e&&(null==(s=t.groups[e])||s.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",s=parseFloat(e);dp(s)&&s>2&&a.push.apply(a,r.split(",").map((e=>({type:"media-source",audio:{contentType:Oy(e,"audio"),channels:""+s}}))))}})))})),Promise.all(a.map((e=>{const t=function(e){const{audio:t,video:s}=e,i=s||t;if(i){const e=Hy(i.contentType);if(s)return`r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${e}_${Math.ceil(s.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return zy[t]||(zy[t]=s.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:a,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e})))}const Jy=["NONE","TYPE-0","TYPE-1",null];const Qy=["SDR","PQ","HLG"];var Zy="",ev="YES",tv="v2";function sv(e){const{canSkipUntil:t,canSkipDateRanges:s,age:i}=e;return t&&i<t/2?s?tv:ev:Zy}class iv{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class rv{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=null==(t=e.supplemental)?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return av(this._audioGroups,e)}hasSubtitleGroup(e){return av(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function av(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function nv(e,t){let s=!1,i=[];if(e&&(s="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||Qy.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;s=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),s||(i=["SDR"])}return{preferHDR:s,allowedVideoRanges:i}}const ov=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(s,i)=>{if(e&&(i=e(s,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function lv(e,t){jp.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function cv(e){return e.reduce(((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function dv(e){if(!e)return e;const{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:a}=e;return{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:a}}function hv(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let i=0;i<t.length;i++){if(uv(e,t[i],s))return i}return-1}function uv(e,t,s){const{groupId:i,name:r,lang:a,assocLang:n,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===a||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===n)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const s=e.split(","),i=t.split(",");return s.length===i.length&&!s.some((e=>-1===i.indexOf(e)))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function fv(e,t){const{audioCodec:s,channels:i}=e;return!(void 0!==s&&(t.audioCodec||"").substring(0,4)!==s.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function mv(e,t,s){for(let i=t;i>-1;i--)if(s(e[i]))return i;for(let i=t+1;i<e.length;i++)if(s(e[i]))return i;return-1}function gv(e,t){var s;return!!e&&e!==(null==(s=t.loadLevelObj)?void 0:s.uri)}const pv=function(e,t){let s=0,i=e.length-1,r=null,a=null;for(;s<=i;){r=(s+i)/2|0,a=e[r];const n=t(a);if(n>0)s=r+1;else{if(!(n<0))return a;i=r-1}}return null};function yv(e,t,s=0,i=0,r=.005){let a=null;if(e){a=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-s;i>0&&i<15e-7&&(s+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===s&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===vv(s,i,a)||function(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),s);return e.start<=i}return!1}(a,e,Math.min(r,i))))return a;const n=pv(t,vv.bind(null,s,i));return!n||n===e&&a?a:n}function vv(e=0,t=0,s){if(s.start<=e&&s.start+s.duration>e)return 0;const i=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-i<=e?1:s.start-i>e&&s.start?-1:0}function xv(e,t,s){const i=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-i>e}function bv(e,t){return pv(e,(e=>e.cc<t?1:e.cc>t?-1:0))}function wv(e){switch(e.details){case mp.FRAG_LOAD_TIMEOUT:case mp.KEY_LOAD_TIMEOUT:case mp.LEVEL_LOAD_TIMEOUT:case mp.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ev(e,t){const s=wv(t);return e.default[(s?"timeout":"error")+"Retry"]}function Sv(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function Tv(e){return Lp(Lp({},e),{errorRetry:null,timeoutRetry:null})}function _v(e,t,s,i){if(!e)return!1;const r=null==i?void 0:i.code,a=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,i,a):a}var kv=0,Av=2,Lv=3,Rv=5,Pv=0,Nv=1,Cv=2;function Iv(e){const t={action:kv,flags:Pv};return e&&(t.resolved=!0),t}var Dv="NOT_LOADED",jv="APPENDING",Ov="PARTIAL",Mv="OK";class Fv{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.BUFFER_APPENDED,this.onBufferAppended,this),e.on(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.on(gp.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.BUFFER_APPENDED,this.onBufferAppended,this),e.off(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.off(gp.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const t=s[i];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const n=i[r[a]];if((null==n?void 0:n.body.type)===t&&(!s||n.buffered)){const t=n.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const n=this.fragments[i];if(!n)return;if(a>=n.body.sn)return;if(!n.buffered&&(!n.loaded||r))return void(n.body.type===s&&this.removeFragment(n.body));const o=n.range[e];o&&(0!==o.time.length?o.time.some((e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(n.body),s})):this.removeFragment(n.body))}))}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const s=e.frag,i=Uv(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const a=!s.relurl;if(Object.keys(t).forEach((i=>{const n=s.elementaryStreams[i];if(!n)return;const o=t[i],l=a||!0===n.partial;r.range[i]=this.getBufferedTimes(s,e.part,l,o)})),r.loaded=null,Object.keys(r.range).length){r.buffered=!0;(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),$v(r)||this.removeParts(s.sn-1,s.type)}else this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Bv(s,(t=>t.fragment.sn>=e)))}fragBuffered(e,t){const s=Uv(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},a=e.start,n=e.end,o=e.minEndPTS||n,l=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const e=i.start(c)-this.bufferPadding,t=i.end(c)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(n,i.end(c))});break}if(a<t&&n>e){const e=Math.max(a,i.start(c)),t=Math.min(n,i.end(c));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(n<=e)break}return r}getPartialFragment(e){let t,s,i,r=null,a=0;const{bufferPadding:n,fragments:o}=this;return Object.keys(o).forEach((l=>{const c=o[l];c&&$v(c)&&(s=c.body.start-n,i=c.body.end+n,e>=s&&e<=i&&(t=Math.min(e-s,i-e),a<=t&&(r=c.body,a=t)))})),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||$v(t))}getState(e){const t=Uv(e),s=this.fragments[t];return s?s.buffered?$v(s)?Ov:Mv:jv:Dv}isTimeBuffered(e,t,s){let i,r;for(let a=0;a<s.length;a++){if(i=s.start(a)-this.bufferPadding,r=s.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=Uv(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:a}=t;if("initSegment"===s.sn)return;const n=s.type;if(i){let e=this.activePartLists[n];e||(this.activePartLists[n]=e=[]),e.push(i)}this.timeRanges=r;const o=r[a];this.detectEvictedFragments(a,o,n,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Uv(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach((a=>{const n=this.fragments[a];if(!n)return;const o=n.body;o.type!==s||i&&!o.gap||o.start<t&&o.end>e&&(n.buffered||r)&&this.removeFragment(o)}))}removeFragment(e){const t=Uv(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=Bv(s,(e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=null==(e=this.hls)||null==(t=e.latestLevelDetails)?void 0:t.partList;s&&s.forEach((e=>e.clearElementaryStreamInfo()))}}function $v(e){var t,s,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(s=e.range.audio)?void 0:s.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function Uv(e){return`${e.type}_${e.level}_${e.sn}`}function Bv(e,t){return e.filter((e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s}))}var Vv=0,Gv=1;class Kv{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Vv:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Gv:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class Hv{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(4*i);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],a=s[2],n=s[3],o=this.invSubMix,l=o[0],c=o[1],d=o[2],h=o[3],u=new Uint32Array(256);let f=0,m=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let s=m^m<<1^m<<2^m<<3^m<<4;s=s>>>8^255&s^99,e[f]=s,t[s]=f;const o=u[f],g=u[o],p=u[g];let y=257*u[s]^16843008*s;i[f]=y<<24|y>>>8,r[f]=y<<16|y>>>16,a[f]=y<<8|y>>>24,n[f]=y,y=16843009*p^65537*g^257*o^16843008*f,l[s]=y<<24|y>>>8,c[s]=y<<16|y>>>16,d[s]=y<<8|y>>>24,h[s]=y,f?(f=o^u[u[u[p^o]]],m^=u[u[m]]):f=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const a=this.ksRows=4*(r+6+1);let n,o;const l=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,u=this.invSubMix,f=u[0],m=u[1],g=u[2],p=u[3];let y,v;for(n=0;n<a;n++)n<r?y=l[n]=t[n]:(v=y,n%r==0?(v=v<<8|v>>>24,v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v],v^=h[n/r|0]<<24):r>6&&n%r==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v]),l[n]=y=(l[n-r]^v)>>>0);for(o=0;o<a;o++)n=a-o,v=3&o?l[n]:l[n-4],c[o]=o<4||n<=4?v:f[d[v>>>24]]^m[d[v>>>16&255]]^g[d[v>>>8&255]]^p[d[255&v]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,n=this.invSubMix,o=n[0],l=n[1],c=n[2],d=n[3],h=this.uint8ArrayToUint32Array_(s);let u=h[0],f=h[1],m=h[2],g=h[3];const p=new Int32Array(e),y=new Int32Array(p.length);let v,x,b,w,E,S,T,_,k,A,L,R,P,N;const C=this.networkToHostOrderSwap;for(;t<p.length;){for(k=C(p[t]),A=C(p[t+1]),L=C(p[t+2]),R=C(p[t+3]),E=k^r[0],S=R^r[1],T=L^r[2],_=A^r[3],P=4,N=1;N<i;N++)v=o[E>>>24]^l[S>>16&255]^c[T>>8&255]^d[255&_]^r[P],x=o[S>>>24]^l[T>>16&255]^c[_>>8&255]^d[255&E]^r[P+1],b=o[T>>>24]^l[_>>16&255]^c[E>>8&255]^d[255&S]^r[P+2],w=o[_>>>24]^l[E>>16&255]^c[S>>8&255]^d[255&T]^r[P+3],E=v,S=x,T=b,_=w,P+=4;v=a[E>>>24]<<24^a[S>>16&255]<<16^a[T>>8&255]<<8^a[255&_]^r[P],x=a[S>>>24]<<24^a[T>>16&255]<<16^a[_>>8&255]<<8^a[255&E]^r[P+1],b=a[T>>>24]<<24^a[_>>16&255]<<16^a[E>>8&255]<<8^a[255&S]^r[P+2],w=a[_>>>24]<<24^a[E>>16&255]<<16^a[S>>8&255]<<8^a[255&T]^r[P+3],y[t]=C(v^u),y[t+1]=C(w^f),y[t+2]=C(b^m),y[t+3]=C(x^g),u=k,f=A,m=L,g=R,t+=4}return y.buffer}}class qv{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=function(e){switch(e){case Vv:return"AES-CBC";case Gv:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Wv{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(s){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?e.slice(0,t-s):e}(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise(((r,a)=>{const n=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(n,t,s,i);const o=this.flush();o?r(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:a,remainderData:n}=this;if(i!==Vv||16!==t.byteLength)return jp.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),n&&(e=Sy(n,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(s=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Hv),l.expandKey(t);const c=a;return this.currentResult=l.decrypt(o.buffer,0,s),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new qv(this.subtle,t,i)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new Kv(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,t)})).catch((r=>(jp.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i))))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(jp.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const zv=Math.pow(2,17);class Yv{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Qv({type:fp.NETWORK_ERROR,details:mp.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(s?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise(((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(Jv(e));e.gap=!1}const l=this.loader=r?new r(i):new a(i),c=Xv(e);e.loader=l;const d=Tv(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:zv};e.stats=l.stats;const u={onSuccess:(t,s,i,r)=>{this.resetLoader(e,l);let a=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),n({frag:e,part:null,payload:a,networkDetails:r})},onError:(t,i,r,a)=>{this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Lp({url:s,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:a}))},onAbort:(t,s,i)=>{this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,s,i)=>{this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:t}))}};t&&(u.onProgress=(s,i,r,a)=>t({frag:e,part:null,payload:r,networkDetails:a})),l.load(c,h,u)}))}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise(((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Jv(e,t));const l=this.loader=r?new r(i):new a(i),c=Xv(e,t);e.loader=l;const d=Tv(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:zv};t.stats=l.stats,l.load(c,h,{onSuccess:(i,r,a,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:i.data,networkDetails:o};s(c),n(c)},onError:(s,i,r,a)=>{this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Lp({url:c.url,data:void 0},s),error:new Error(`HTTP Error ${s.code} ${s.text}`),networkDetails:r,stats:a}))},onAbort:(s,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:s}))},onTimeout:(s,i,r)=>{this.resetLoader(e,l),o(new Qv({type:fp.NETWORK_ERROR,details:mp.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:s}))}})}))}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),a=Math.min(Math.round(s.loaded/r),i),n=(i-a)*Math.round(s.loaded/a);s.total=s.loaded+n}else s.total=Math.max(s.loaded,s.total);const a=s.loading,n=i.loading;a.start?a.first+=n.first-n.start:(a.start=n.start,a.first=n.first),a.end=n.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Xv(e,t=null){const s=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},r=s.byteRangeStartOffset,a=s.byteRangeEndOffset;if(dp(r)&&dp(a)){var n;let t=r,s=a;if("initSegment"===e.sn&&("AES-128"===(o=null==(n=e.decryptdata)?void 0:n.method)||"AES-256"===o)){const e=a-r;e%16&&(s=a+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=s}var o;return i}function Jv(e,t){const s=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:fp.MEDIA_ERROR,details:mp.FRAG_GAP,fatal:!1,frag:e,error:s,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Qv(i)}class Qv extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Zv extends Rp{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ex{constructor(e,t,s,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=a}}const tx={length:0,start:()=>0,end:()=>0};class sx{static isBuffered(e,t){if(e){const s=sx.getBuffered(e);for(let e=s.length;e--;)if(t>=s.start(e)&&t<=s.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=sx.getBuffered(e);return sx.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=sx.bufferedRanges(e);if(i.length)return sx.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort(((e,t)=>e.start-t.start||t.end-e.end));let i=-1,r=[];if(s)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const a=r.length;if(a){const t=r[a-1].end;e[c].start-t<s?e[c].end>t&&(r[a-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let a,n=0,o=t,l=t;for(let c=0;c<r.length;c++){const e=r[c].start,d=r[c].end;if(-1===i&&t>=e&&t<=d&&(i=c),t+s>=e&&t<d)o=e,l=d,n=l-t;else if(t+s<e){a=e;break}}return{len:n,start:o||0,end:l||0,nextStart:a,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||tx}catch(t){return jp.log("failed to get media.buffered",t),tx}}}const ix=/\{\$([a-zA-Z0-9-_]+)\}/g;function rx(e){return ix.test(e)}function ax(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(ix,(t=>{const i=t.substring(2,t.length-1),r=null==s?void 0:s[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r}))}return t}function nx(e,t,s){let i,r,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`);r=e.get(i)}catch(n){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else i=t.NAME,r=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):a[i]=r||""}function ox(e,t,s){const i=t.IMPORT;if(s&&i in s){let t=e.variableList;t||(e.variableList=t={}),t[i]=s[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const lx=/^(\d+)x(\d+)$/,cx=/(.+?)=(".*?"|.*?)(?:,|$)/g;class dx{constructor(e,t){"string"==typeof e&&(e=dx.parseAttrList(e,t)),kp(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce(((e,t)=>(e[t.toLowerCase()]=!0,e)),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=lx.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(cx.lastIndex=0;null!==(s=cx.exec(e));){const r=s[1].trim();let a=s[2];const n=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1;let o=!1;if(n)a=a.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(n||o))a=ax(t,a);else if(!o&&!n)switch(r){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":jp.warn(`${e}: attribute ${r} is missing quotes`)}i[r]=a}return i}}function hx(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class ux{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(i=null==t?void 0:t.tagOrder)?i:s,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){jp.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=kp(new dx({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);dp(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(jp.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(dp(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&dp(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class fx{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}get hasProgramDateTime(){return!!this.fragments.length&&dp(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function mx(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function gx(e){switch(e){case"AES-128":case"AES-256":return Vv;case"AES-256-CTR":return Gv;default:throw new Error(`invalid full segment method ${e}`)}}function px(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function yx(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}function vx(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),s=px(r)):s=function(e){const t=yx(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}const xx="undefined"!=typeof self?self:void 0;var bx={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},wx="org.w3.clearkey",Ex="com.apple.streamingkeydelivery",Sx="com.microsoft.playready",Tx="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function _x(e){switch(e){case Ex:return bx.FAIRPLAY;case Sx:return bx.PLAYREADY;case Tx:return bx.WIDEVINE;case wx:return bx.CLEARKEY}}var kx="1077efecc0b24d02ace33c1e52e2fb4b",Ax="e2719d58a985b3c9781ab030af78d30e",Lx="9a04f07998404286ab92e65be0885f95",Rx="edef8ba979d64acea3c827dcd51d21ed";function Px(e){return e===Rx?bx.WIDEVINE:e===Lx?bx.PLAYREADY:e===kx||e===Ax?bx.CLEARKEY:void 0}function Nx(e){switch(e){case bx.FAIRPLAY:return Ex;case bx.PLAYREADY:return Sx;case bx.WIDEVINE:return Tx;case bx.CLEARKEY:return wx}}function Cx(e){const{drmSystems:t,widevineLicenseUrl:s}=e,i=t?[bx.FAIRPLAY,bx.WIDEVINE,bx.PLAYREADY,bx.CLEARKEY].filter((e=>!!t[e])):[];return!i[bx.WIDEVINE]&&s&&i.push(bx.WIDEVINE),i}const Ix=null!=xx&&null!=(Dx=xx.navigator)&&Dx.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Dx;function jx(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),i=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=px(e).subarray(0,16);return function(e){const t=function(e,t,s){const i=e[t];e[t]=e[s],e[s]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}let Ox={};class Mx{static clearKeyUriToKeyIdMap(){Ox={}}constructor(e,t,s,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!mx(e)}isSupported(){if(this.method){if(mx(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Ex:case Tx:case Sx:case wx:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(mx(this.method)&&this.uri&&!this.iv){"number"!=typeof e&&(jp.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e);return new Mx(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=vx(this.uri);if(t)switch(this.keyFormat){case Tx:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Sx:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ry(e,0,t),this.keyId=jx(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Ox[this.uri];if(!e){const t=Object.keys(Ox).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),Ox[this.uri]=e}this.keyId=e}return this}}const Fx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,$x=/#EXT-X-MEDIA:(.*)/g,Ux=/^#EXT(?:INF|-X-TARGETDURATION):/m,Bx=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Vx=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Gx{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return zp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ux.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:rx(e)},i=[];let r;for(Fx.lastIndex=0;null!=(r=Fx.exec(e));)if(r[1]){var a;const e=new dx(r[1],s),n=ax(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:Gx.resolve(n,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),zx(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},zx(c,o.supplemental)),null!=(a=o.unknownCodecs)&&a.length||i.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new dx(i,s),t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=qx(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):jp.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":nx(s,new dx(i,s),t);break;case"CONTENT-STEERING":{const e=new dx(i,s);s.contentSteering={uri:Gx.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=Wx(i)}}const n=i.length>0&&i.length<s.levels.length;return s.levels=n?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,s){let i;const r={},a=s.levels,n={AUDIO:a.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:a.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for($x.lastIndex=0;null!==(i=$x.exec(e));){const e=new dx(i[1],s),a=e.TYPE;if(a){const s=n[a],i=r[a]||[];r[a]=i;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],d=e.CHANNELS,h=e.CHARACTERISTICS,u=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?Gx.resolve(e.URI,t):""};if(c&&(f.assocLang=c),d&&(f.channels=d),h&&(f.characteristics=h),u&&(f.instreamId=u),null!=s&&s.length){const e=Gx.findGroup(s,f.groupId)||s[0];Yx(f,e,"audioCodec"),Yx(f,e,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(e,t,s,i,r,a){var n;const o={url:t},l=new fx(t),c=l.fragments,d=[];let h,u,f,m,g=null,p=0,y=0,v=0,x=0,b=0,w=null,E=new ty(i,o),S=-1,T=!1,_=null;if(Bx.lastIndex=0,l.m3u8=e,l.hasVariableRefs=rx(e),"#EXTM3U"!==(null==(n=Bx.exec(e))?void 0:n[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=Bx.exec(e));){T&&(T=!1,E=new ty(i,o),E.playlistOffset=v,E.start=v,E.sn=p,E.cc=x,b&&(E.bitrate=b),E.level=s,g&&(E.initSegment=g,g.rawProgramDateTime&&(E.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),_&&(E.setByteRange(_),_=null)));const e=h[1];if(e){E.duration=parseFloat(e);const t=(" "+h[2]).slice(1);E.title=t||null,E.tagList.push(t?["INF",e,t]:["INF",e])}else if(h[3]){if(dp(E.duration)){E.playlistOffset=v,E.start=v,f&&Qx(E,f,l),E.sn=p,E.level=s,E.cc=x,c.push(E);const e=(" "+h[3]).slice(1);E.relurl=ax(l,e),Xx(E,w,d),w=E,v+=E.duration,p++,y=0,T=!0}}else{if(h=h[0].match(Vx),!h){jp.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<h.length&&void 0===h[u];u++);const e=(" "+h[u]).slice(1),r=(" "+h[u+1]).slice(1),n=h[u+2]?(" "+h[u+2]).slice(1):null;switch(e){case"BYTERANGE":w?E.setByteRange(r,w):E.setByteRange(r);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=r,E.tagList.push(["PROGRAM-DATE-TIME",r]),-1===S&&(S=c.length);break;case"PLAYLIST-TYPE":l.type&&Zx(l,e,h),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?Zx(l,e,h):c.length>0&&eb(l,e,h),p=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&Zx(l,e,h);const t=new dx(r,l),s=t.decimalInteger("SKIPPED-SEGMENTS");if(dp(s)){l.skippedSegments+=s;for(let e=s;e--;)c.push(null);p+=s}const i=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(i.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&Zx(l,e,h),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&Zx(l,e,h),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Zx(l,e,h),l.live=!1;break;case"#":(r||n)&&E.tagList.push(n?[r,n]:[r]);break;case"DISCONTINUITY":x++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([e]);break;case"BITRATE":E.tagList.push([e,r]),b=1e3*parseInt(r),dp(b)?E.bitrate=b:b=0;break;case"DATERANGE":{const e=new dx(r,l),t=new ux(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:jp.warn(`Ignoring invalid DATERANGE tag: "${r}"`),E.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new dx(r,l);"IMPORT"in e?ox(l,e,a):nx(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?Zx(l,e,h):c.length>0&&eb(l,e,h),l.startCC=x=parseInt(r);break;case"KEY":{const e=qx(r,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={}),f[e.keyFormat]&&(f=kp({},f)),f[e.keyFormat]=e}else jp.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":l.startTimeOffset=Wx(r);break;case"MAP":{const e=new dx(r,l);if(E.duration){const t=new ty(i,o);Jx(t,e,s,f),g=t,E.initSegment=g,g.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=g.rawProgramDateTime)}else{const t=E.byteRangeEndOffset;if(t){const e=E.byteRangeStartOffset;_=`${t-e}@${e}`}else _=null;Jx(E,e,s,f),g=E,T=!0}g.cc=x;break}case"SERVER-CONTROL":m&&Zx(l,e,h),m=new dx(r),l.canBlockReload=m.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=m.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&m.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=m.optionalFloat("PART-HOLD-BACK",0),l.holdBack=m.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&Zx(l,e,h);const t=new dx(r);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=y>0?e[e.length-1]:void 0,s=y++,i=new dx(r,l),a=new sy(i,E,o,s,t);e.push(a),E.duration+=a.duration;break}case"PRELOAD-HINT":{const e=new dx(r,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new dx(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:jp.warn(`line parsed but not handled: ${h}`)}}}w&&!w.relurl?(c.pop(),v-=w.duration,l.partList&&(l.fragmentHint=w)):l.partList&&(Xx(E,w,d),E.cc=x,l.fragmentHint=E,f&&Qx(E,f,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const k=c.length,A=c[0],L=c[k-1];if(v+=l.skippedSegments*l.targetduration,v>0&&k&&L){l.averagetargetduration=v/k;const e=L.sn;l.endSN="initSegment"!==e?e:0,l.live||(L.endList=!0),A&&void 0===l.startCC&&(l.startCC=A.cc),S>0&&(!function(e,t){let s=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(c,S),A&&d.unshift(A))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(v+=l.fragmentHint.duration),l.totalduration=v,d.length&&l.dateRangeTagCount&&A&&Kx(d,l),l.endCC=x,l}}function Kx(e,t){const s=e.length,i=e[s-1],r=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let n=a.length;n--;){const o=t.dateRanges[a[n]],l=o.startDate.getTime();o.tagAnchor=i.ref;for(let i=s;i--;){const s=Hx(t,l,e,i,r);if(-1!==s){o.tagAnchor=t.fragments[s].ref;break}}}}function Hx(e,t,s,i,r){const a=s[i];if(a){const o=a.programDateTime;if(t>=o||0===i){var n;if(t<=o+1e3*(((null==(n=s[i+1])?void 0:n.start)||r)-a.start)){const r=s[i].sn-e.startSN,a=e.fragments;if(a.length>s.length){for(let n=(s[i+1]||a[a.length-1]).sn-e.startSN;n>r;n--){const e=a[n].programDateTime;if(t>=e&&t<e+1e3*a[n].duration)return n}}return r}}}return-1}function qx(e,t,s){var i,r;const a=new dx(e,s),n=null!=(i=a.METHOD)?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),c=a.KEYFORMATVERSIONS,d=null!=(r=a.KEYFORMAT)?r:"identity";o&&a.IV&&!l&&jp.error(`Invalid IV: ${a.IV}`);const h=o?Gx.resolve(o,t):"",u=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Mx(n,h,d,u,l)}function Wx(e){const t=new dx(e).decimalFloatingPoint("TIME-OFFSET");return dp(t)?t:null}function zx(e,t){let s=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=s.filter((t=>Iy(t,e)));i.length&&(t[`${e}Codec`]=i.map((e=>e.split("/")[0])).join(","),s=s.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=s}function Yx(e,t,s){const i=t[s];i&&(e[s]=i)}function Xx(e,t,s){e.rawProgramDateTime?s.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function Jx(e,t,s,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Qx(e,t,s){e.levelkeys=t;const{encryptedFragments:i}=s;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}function Zx(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${s[0]})`)}function eb(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${s[0]})`)}function tb(e,t){const s=t.startPTS;if(dp(s)){let i,r=0;t.sn>e.sn?(r=s-e.start,i=e):(r=e.start-s,i=t),i.duration!==r&&i.setDuration(r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function sb(e,t,s,i,r,a){i-s<=0&&(jp.warn("Fragment should have a positive duration",t),i=s+t.duration,a=r+t.duration);let n=s,o=i;const l=t.startPTS,c=t.endPTS;if(dp(l)){const e=Math.abs(l-s);dp(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,n=Math.max(s,l),s=Math.min(s,l),r=Math.min(r,t.startDTS),o=Math.min(i,c),i=Math.max(i,c),a=Math.max(a,t.endDTS)}const d=s-t.start;0!==t.start&&t.setStart(s),t.setDuration(i-t.start),t.startPTS=s,t.maxStartPTS=n,t.startDTS=r,t.endPTS=i,t.minEndPTS=o,t.endDTS=a;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;const f=h-e.startSN,m=e.fragments;for(m[f]=t,u=f;u>0;u--)tb(m[u],m[u-1]);for(u=f;u<m.length-1;u++)tb(m[u],m[u+1]);return e.fragmentHint&&tb(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function ib(e,t){if(e===t)return;let s=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){s=e;break}}let r;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,s){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,n=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=a;c++){const r=l[n+c];let a=o[c];if(i&&!a&&r&&(a=t.fragments[c]=r),r&&a){if(s(r,a,c,o),r.url&&r.url!==a.url)return void(t.playlistParsingError=rb(`media sequence mismatch ${a.sn}:`,e,t,r,a));if(r.cc!==a.cc)return void(t.playlistParsingError=rb(`discontinuity sequence mismatch (${r.cc}!=${a.cc})`,e,t,r,a))}}}(e,t,((i,a,n,o)=>{if(!t.startCC&&a.cc!==i.cc){var l,c;const s=i.cc-a.cc;for(let e=n;e<o.length;e++)o[e].cc+=s;t.startCC=null!=(l=null==(c=lb(e,t.startSN-1))?void 0:c.cc)?l:o[0].cc,t.endCC=o[o.length-1].cc}dp(i.startPTS)&&dp(i.endPTS)&&(a.setStart(a.startPTS=i.startPTS),a.startDTS=i.startDTS,a.maxStartPTS=i.maxStartPTS,a.endPTS=i.endPTS,a.endDTS=i.endDTS,a.minEndPTS=i.minEndPTS,a.setDuration(i.endPTS-i.startPTS),a.duration&&(r=a),t.PTSKnown=t.alignedSliding=!0),i.hasStreams&&(a.elementaryStreams=i.elementaryStreams),a.loader=i.loader,i.hasStats&&(a.stats=i.stats),i.initSegment&&(a.initSegment=i.initSegment,s=i.initSegment)}));const a=t.fragments,n=t.fragmentHint?a.concat(t.fragmentHint):a;if(s&&n.forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)})),t.skippedSegments)if(t.deltaUpdateFailed=a.some((e=>!e)),t.deltaUpdateFailed){jp.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.endCC=a[a.length-1].cc,t.canSkipDateRanges&&(t.dateRanges=function(e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=t,r=kp({},e);i&&i.forEach((e=>{delete r[e]}));const a=Object.keys(r).length;a&&Object.keys(s).forEach((e=>{const t=r[e],i=new ux(s[e].attr,t);i.isValid?(r[e]=i,t||(i.tagOrder+=a)):jp.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ov(s[e].attr)}"`)}));return r}(e.dateRanges,t));const s=e.fragments.filter((e=>e.rawProgramDateTime));if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<n.length;e++)null===n[e].programDateTime&&Xx(n[e],n[e-1],s);Kx(s,t)}!function(e,t,s){if(e&&t){let i=0;for(let r=0,a=e.length;r<=a;r++){const a=e[r],n=t[r+i];a&&n&&a.index===n.index&&a.fragment.sn===n.fragment.sn?s(a,n):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),r?sb(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):ab(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function rb(e,t,s,i,r){return new Error(`${e} ${r.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${s.startSN}\n${s.m3u8}`)}function ab(e,t,s=!0){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,a=i>=0;let n=0;if(a&&i<r.length)n=r[i].start;else if(a&&t.startSN===e.endSN+1)n=e.fragmentEnd;else if(a&&s)n=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;n=e.fragmentStart}nb(t,n)}function nb(e,t){if(t){const s=e.fragments;for(let i=e.skippedSegments;i<s.length;i++)s[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function ob(e,t=1/0){let s=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&s*r>t){const e=1e3*i[i.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}function lb(e,t,s){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t?i:t<e.startSN&&s&&s.sn===t?s:null)}function cb(e,t,s){return e?db(e.partList,t,s):null}function db(e,t,s){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===s&&r.fragment.sn===t)return r}return null}function hb(e){e.forEach(((e,t)=>{var s;null==(s=e.details)||s.fragments.forEach((e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)}))}))}function ub(e,t){for(let i=0,r=e.length;i<r;i++){var s;if((null==(s=e[i])?void 0:s.cc)===t)return e[i]}return null}function fb(e,t){if(e){const s=e.start+t;e.start=e.startPTS=s,e.endPTS=s+e.duration}}function mb(e,t){const s=t.fragments;for(let i=0,r=s.length;i<r;i++)fb(s[i],e);t.fragmentHint&&fb(t.fragmentHint,e),t.alignedSliding=!0}function gb(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const s=Math.min(t.endCC,e.endCC),i=ub(t.fragments,s),r=ub(e.fragments,s);if(!i||!r)return;jp.log(`Aligning playlist at start of dicontinuity sequence ${s}`);mb(i.start-r.start,e)}function pb(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,i=t.fragments;if(!s.length||!i.length)return;let r,a;const n=Math.min(t.endCC,e.endCC);t.startCC<n&&e.startCC<n&&(r=ub(i,n),a=ub(s,n)),r&&a||(r=i[Math.floor(i.length/2)],a=ub(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=a.programDateTime;if(!o||!l)return;mb((l-o)/1e3-(a.start-r.start),e)}const yb=function(e){let t="";const s=e.length;for(let i=0;i<s;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t},vb="STOPPED",xb="IDLE",bb="KEY_LOADING",wb="FRAG_LOADING",Eb="FRAG_LOADING_WAITING_RETRY",Sb="WAITING_TRACK",Tb="PARSING",_b="PARSED",kb="ENDED",Ab="ERROR",Lb="WAITING_INIT_PTS",Rb="WAITING_LEVEL";class Pb extends Zv{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=vb,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:s,mediaBuffer:i,state:r}=this,a=s?s.currentTime:0,n=sx.bufferInfo(i||s,a,e.maxBufferHole);if(this.log(`media seeking to ${dp(a)?a.toFixed(3):a}, state: ${r}`),this.state===kb)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,i=t.start-s,r=t.start+t.duration+s;if(!n.len||r<n.start||i>n.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(s){this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0);if(a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts){const e=Math.max(n.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${a.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||n.len||(this.log(`setting startPosition to ${a} because of seek before start`),this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new Yv(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Wv(e.config)}registerListeners(){const{hls:e}=this;e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(gp.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===vb)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=vb}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.nextStart;if(r&&r>i&&r<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return sx.isBuffered(this.media,e.start+e.duration/2)}const n=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===vb&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=vb,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){this._doFragLoad(e,t,s,(e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)})).then((e=>{if(!e)return;const t=this.state,s=e.frag;this.fragContextChanged(s)?(t===wb||!this.fragCurrent&&t===Tb)&&(this.fragmentTracker.removeFragment(s),this.state=xb):("payload"in e&&(this.log(`Loaded ${s.type} sn: ${s.sn} of ${this.playlistLabel()} ${s.level}`),this.hls.trigger(gp.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))})).catch((t=>{this.state!==vb&&this.state!==Ab&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===jv){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),a=this.backtrackFragment;(1===(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Ov&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(gp.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e})).then((e=>{const{hls:t}=this,{frag:s,payload:i}=e,r=s.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&mx(r.method)){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,gx(r.method)).catch((e=>{throw t.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e})).then((i=>{const r=self.performance.now();return t.trigger(gp.FRAG_DECRYPTED,{frag:s,payload:i,stats:{tstart:a,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)}))}return this.completeInitSegmentLoad(e)})).catch((t=>{this.state!==vb&&this.state!==Ab&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==vb&&(this.state=xb),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?yb(sx.getBuffered(s)):"(detached)"})`),ey(e)){var i;if(e.type!==Ep){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=xb)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=xb}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,a=!r||0===r.length||r.some((e=>!e)),n=new ex(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(n)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let n=null;!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=bb,this.fragCurrent=e,n=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(gp.KEY_LOADED,e),this.state===bb&&(this.state=xb),e})),this.hls.trigger(gp.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(n=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));const o=this.fragPrevious;if(ey(e)&&(!o||e.sn!==o.sn)){const s=this.shouldLoadParts(t.details,e.end);s!==this.loadingParts&&(this.log(`LL-Part loading ${s?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=s)}if(s=Math.max(e.start,s||0),this.loadingParts&&ey(e)){const r=a.partList;if(r&&i){s>e.end&&a.fragmentHint&&(e=a.fragmentHint);const o=this.getNextPart(r,e,s);if(o>-1){const l=r[o];let c;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${r.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=wb,c=n?n.then((s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,l,t,i))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,i).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(gp.FRAG_LOADING,{frag:e,part:l,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(r,s))return Promise.resolve(null)}}if(ey(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),dp(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=wb;const l=this.config.progressive;let c;return c=l&&n?n.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,l?i:void 0),n]).then((([e])=>(!l&&e&&i&&i(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(gp.FRAG_LOADING,{frag:e,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,s,i){return new Promise(((r,a)=>{var n;const o=[],l=null==(n=s.details)?void 0:n.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const a=i.part;this.hls.trigger(gp.FRAG_LOADED,i);const n=cb(s.details,e.sn,t.index+1)||db(l,e.sn,t.index+1);if(!n)return r({frag:e,part:a,partsLoaded:o});c(n)})).catch(a)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===mp.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(gp.ERROR,t)}else this.hls.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Tb)return void(this.fragCurrent||this.state===vb||this.state===Ab||(this.state=xb));const{frag:s,part:i,level:r}=t,a=self.performance.now();s.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const n=this.getLevelDetails(),o=n&&s.sn>n.endSN||this.shouldLoadParts(n,s.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(null!=e&&e.partList){var s;const r=e.partList[0];if(t>=r.end+((null==(s=e.fragmentHint)?void 0:s.duration)||0)){var i;if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:a}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const n=t[i],o=n.details,l=a>-1?cb(o,r,a):null,c=l?l.fragment:lb(o,r,s);return c?(s&&s!==c&&(c.stats=s.stats),{frag:c,part:l,level:n}):null}bufferFragmentData(e,t,s,i,r){var a;if(!e||this.state!==Tb)return;const{data1:n,data2:o}=e;let l=n;if(n&&o&&(l=Sy(n,o)),null==(a=l)||!a.length)return;const c={type:e.type,frag:t,part:s,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(gp.BUFFER_APPENDING,c),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!sx.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,i=sx.bufferInfo(t,s,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),n=Math.max(Math.min(e.start-a,i.end-a),s+a);e.start-n>a&&this.flushMainBuffer(n,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!dp(i))return null;const r=this.lastCurrentTime>i||null!=(s=this.media)&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}getFwdBufferInfoAtPos(e,t,s,i){const r=sx.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(r.nextStart<=a.end||a.gap)){const s=Math.max(Math.min(r.nextStart,a.end)-t,i);return sx.bufferInfo(e,t,s)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,i);return r>=i&&(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=bp){var s;const i=null==(s=this.fragmentTracker)?void 0:s.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,a=s[0].start,n=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const c=r.initialLiveManifestSize;if(i<c)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${c})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){var l;n&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t,s);const i=this.hls.startPosition,r=this.hls.liveSyncPosition,c=o?(-1!==i&&i>=a?i:r)||o.start:e;this.log(`Setting startPosition to ${c} to match start frag at live edge. mainStart: ${i} liveSyncPosition: ${r} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=c}}else e<=a&&(o=s[0]);if(!o){const s=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,s,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(s[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Mv||s===Ov&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(null!==e&&s.len+e.len>=r){const e=a.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Nb(this.hls.config)){var e,t;if(null==(e=this.hls.interstitialsManager)||null==(t=e.playingItem)?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Nb(this.hls.config)&&e.type!==Ep){const s=this.hls.interstitialsManager,i=null==s?void 0:s.bufferingItem;if(i){const s=i.event;if(s){if(s.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else{if(e.end<=i.start&&!1===(null==t?void 0:t.live))return null;if(e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}}const r=null==s?void 0:s.playerQueue;if(r)for(let t=r.length;t--;){const s=r[t].interstitial;if(s.appendInPlace&&e.start>=s.startTime&&e.end<=s.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,s){let i=-1,r=!1,a=!0;for(let n=0,o=e.length;n<o;n++){const o=e[n];if(a=a&&!o.independent,i>-1&&s<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||a)&&o.fragment===t&&(i=n),r=l}return i}loadedEndOfParts(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}getInitialLiveFragment(e,t){const s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=function(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!dp(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;s=s||0;for(let i=0;i<e.length;++i){const r=e[i];if(xv(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];s.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=bv(t,s.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:n}=s;const{fragmentHint:o}=s,{maxFragLookUpTolerance:l}=i,c=s.partList,d=!!(this.loadingParts&&null!=c&&c.length&&o);let h;if(d&&o&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(a=a.concat(o),n=o.sn),e<t){var u;h=yv(r,a,e,e<this.lastCurrentTime||e>t-l||null!=(u=this.media)&&u.paused||!this.startFragRequested?0:l)}else h=a[a.length-1];if(h){const e=h.sn-s.startSN,t=this.fragmentTracker.getState(h);if((t===Mv||t===Ov&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!d||c[0].fragment.sn>h.sn||!s.live&&!d)){if(r&&h.level===r.level){const t=a[e+1];h=h.sn<n&&this.fragmentTracker.getState(t)!==Mv?t:null}}}return h}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,n=e.alignedSliding&&dp(r);if(a||!n&&!r){!function(e,t){e&&(gb(t,e),!t.alignedSliding&&e&&pb(t,e),t.alignedSliding||!e||t.skippedSegments||ab(e,t,!1))}(s,e);const r=e.fragmentStart;return this.log(`Live playlist sliding: ${r.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),r}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(-1===s){const r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&dp(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&ey(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Eb)||(this.state=xb)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var i;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===mp.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction,{action:n,flags:o,retryCount:l=0,retryConfig:c}=a||{},d=!!a&&!!c,h=d&&n===Rv,u=d&&!a.resolved&&o===Nv;if(!h&&u&&ey(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((h||u)&&l<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=Sv(c,l);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${i}ms`),a.resolved=!0,this.retryDate=self.performance.now()+i,this.state=Eb}else if(c&&a){if(this.resetFragmentErrors(e),!(l<c.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${l})`);r||n===Lv||(a.resolved=!0)}else this.state=n===Av?Rb:Ab;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Tb||this.state===_b){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===wp&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==vb&&(this.state=xb)}afterBufferFlushed(e,t,s){if(!e)return;const i=sx.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===kb&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==vb&&(this.state=xb)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r)return void this.warn("level.details undefined");var a;if(!Object.keys(e.elementaryStreams).reduce(((t,a)=>{const n=e.elementaryStreams[a];if(n){const o=n.endPTS-n.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;const l=i?0:sb(r,e,n.startPTS,n.endPTS,n.startDTS,n.endDTS);return this.hls.trigger(gp.LEVEL_PTS_UPDATED,{details:r,level:s,drift:l,type:a,frag:e,start:n.startPTS,end:n.endPTS}),!0}return t}),!1)&&(0===s.fragmentError&&this.treatAsGap(e,s),null===(null==(a=this.transmuxer)?void 0:a.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=_b,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(gp.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===bp?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${(null!=(i=t&&!s?e.startPTS:(s||e).start)?i:NaN).toFixed(3)}-${(null!=(r=t&&!s?e.endPTS:(s||e).end)?r:NaN).toFixed(3)}]${s&&"main"===e.type?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Nb(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class Cb{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;return e.length?(s=1===e.length?e[0]:function(e,t){const s=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];s.set(t,i),i+=t.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Ib,Db={exports:{}};var jb=(Ib||(Ib=1,function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function a(e,t,i,a,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,a||e,n),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,n=new Array(a);r<a;r++)n[r]=i[r].fn;return n},o.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,a,n){var o=s?s+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,r),!0;case 5:return d.fn.call(d.context,t,i,r,a),!0;case 6:return d.fn.call(d.context,t,i,r,a,n),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var u,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,r);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];d[c].fn.apply(d[c].context,l)}}return!0},o.prototype.on=function(e,t,s){return a(this,e,t,s,!1)},o.prototype.once=function(e,t,s){return a(this,e,t,s,!0)},o.prototype.removeListener=function(e,t,i,r){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return n(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||n(this,a);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&c.push(o[l]);c.length?this._events[a]=1===c.length?c[0]:c:n(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&n(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}(Db)),Db.exports),Ob=Up(jb);const Mb="1.6.2",Fb={};function $b(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Ub(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Bb(e,t){let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s}function Vb(e,t){const s=t;let i=0;for(;Ub(e,t);){i+=10;i+=Bb(e,t+6),$b(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(s,s+i)}function Gb(e,t){return 255===e[t]&&240==(246&e[t+1])}function Kb(e,t){return 1&e[t+1]?7:9}function Hb(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function qb(e,t){return t+1<e.length&&Gb(e,t)}function Wb(e,t){if(qb(e,t)){const s=Kb(e,t);if(t+s>=e.length)return!1;const i=Hb(e,t);if(i<=s)return!1;const r=t+i;return r===e.length||qb(e,r)}return!1}function zb(e,t,s,i,r){if(!e.samplerate){const a=function(e,t,s,i){const r=t[s+2],a=r>>2&15;if(a>12){const t=new Error(`invalid ADTS sampling index:${a}`);return void e.emit(gp.ERROR,gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const n=1+(r>>6&3),o=t[s+3]>>6&3|(1&r)<<2,l="mp4a.40."+n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a];let d=a;5!==n&&29!==n||(d-=3);const h=[n<<3|(14&d)>>1,(1&d)<<7|o<<3];return jp.log(`manifest codec:${i}, parsed codec:${l}, channels:${o}, rate:${c} (ADTS object type:${n} sampling index:${a})`),{config:h,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:i}}(t,s,i,r);if(!a)return;kp(e,a)}}function Yb(e){return 9216e4/e}function Xb(e,t,s,i,r){const a=i+r*Yb(e.samplerate),n=function(e,t){const s=Kb(e,t);if(t+s<=e.length){const i=Hb(e,t)-s;if(i>0)return{headerLength:s,frameLength:i}}}(t,s);let o;if(n){const{frameLength:i,headerLength:r}=n,l=r+i,c=Math.max(0,s+l-t.length);c?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const d={unit:o,pts:a};return c||e.samples.push(d),{sample:d,length:l,missing:c}}const l=t.length-s;o=new Uint8Array(l),o.set(t.subarray(s,t.length),0);return{sample:{unit:o,pts:a},length:l,missing:-1}}function Jb(e,t){return Ub(e,t)&&Bb(e,t+6)+10<=e.length-t}function Qb(e,t){if(e<0)return-Qb(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2==0?t:t+1)/s}return Math.round(e*s)/s}function Zb(e,t=0,s=1/0){return function(e,t,s,i){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const n=(h=e,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?e.byteOffset:0),o=(n+e.byteLength)/a,l=(n+t)/a,c=Math.floor(Math.max(0,Math.min(l,o))),d=Math.floor(Math.min(c+Math.max(s,0),o));var h;return new i(r,c,d-c)}(e,t,s,Uint8Array)}function ew(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return;const s=e.data.subarray(1).indexOf(0);if(-1===s)return;const i=Fp(Zb(e.data,1,s)),r=e.data[2+s],a=e.data.subarray(3+s).indexOf(0);if(-1===a)return;const n=Fp(Zb(e.data,3+s,a));let o;return o="--\x3e"===i?Fp(Zb(e.data,4+s+a)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+s+a)),t.mimeType=i,t.pictureType=r,t.description=n,t.data=o,t}function tw(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=Fp(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:s.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=Fp(e.data.subarray(t),!0);t+=s.length+1;const i=Fp(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=Fp(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?ew(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=Fp(e.data.subarray(t),!0);t+=s.length+1;const i=Fp(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=Fp(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function sw(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=Bb(e,4);return{type:t,size:s,data:e.subarray(10,10+s)}}function iw(e){let t=0;const s=[];for(;Ub(e,t);){const i=Bb(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const i=sw(e.subarray(t)),r=tw(i);r&&s.push(r),t+=i.size+10}$b(e,t)&&(t+=10)}return s}function rw(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function aw(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,s&&(i+=47721858.84),Math.round(i)}}function nw(e){const t=iw(e);for(let s=0;s<t.length;s++){const e=t[s];if(rw(e))return aw(e)}}let ow=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function lw(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class cw{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Sy(this.cachedData,e),this.cachedData=null);let s,i=Vb(e,0),r=i?i.length:0;const a=this._audioTrack,n=this._id3Track,o=i?nw(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&dp(o))&&(this.basePTS=dw(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ow.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(a,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,s=r):r=l}else Jb(e,r)?(i=Vb(e,r),n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ow.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const t=e.slice(s);this.cachedData?this.cachedData=Sy(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:lw(),id3Track:n,textTrack:lw()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:lw(),id3Track:this._id3Track,textTrack:lw()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const dw=(e,t,s)=>{if(dp(e))return 90*e;return 9e4*t+(s?9e4*s.baseTime/s.timescale:0)};let hw=null;const uw=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fw=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],mw=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],gw=[0,1,1,4];function pw(e,t,s,i,r){if(s+24>t.length)return;const a=yw(t,s);if(a&&s+a.frameLength<=t.length){const n=i+r*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(s,s+a.frameLength),pts:n,dts:n};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}function yw(e,t){const s=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==a){const n=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*uw[14*(3===s?3-i:3===i?3:4)+r-1],c=fw[3*(3===s?0:2===s?1:2)+a],d=3===o?1:2,h=mw[s][i],u=gw[i],f=8*h*u,m=Math.floor(h*l/c+n)*u;if(null===hw){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);hw=e?parseInt(e[1]):0}return!!hw&&hw<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:m,samplesPerFrame:f}}}function vw(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function xw(e,t){return t+1<e.length&&vw(e,t)}function bw(e,t){if(t+1<e.length&&vw(e,t)){const s=4,i=yw(e,t);let r=s;null!=i&&i.frameLength&&(r=i.frameLength);const a=t+r;return a===e.length||xw(e,a)}return!1}const ww=(e,t)=>{let s=0,i=5;t+=i;const r=new Uint32Array(1),a=new Uint32Array(1),n=new Uint8Array(1);for(;i>0;){n[0]=e[t];const o=Math.min(i,8),l=8-o;a[0]=4278190080>>>24+l<<l,r[0]=(n[0]&a[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,i-=o}return s};class Ew extends cw{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=Sw(e,t,s,this.basePTS,this.frameIndex);if(-1!==i){return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}static probe(e){if(!e)return!1;const t=Vb(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==nw(t)&&ww(e,s)<16}}function Sw(e,t,s,i,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const a=t[s+4]>>6;if(a>=3)return-1;const n=[48e3,44100,32e3][a],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+a];if(s+l>t.length)return-1;const c=t[s+6]>>5;let d=0;2===c?d+=2:(1&c&&1!==c&&(d+=2),4&c&&(d+=2));const h=(t[s+6]<<8|t[s+7])>>12-d&1,u=[2,1,2,3,3,4,4,5][c]+h,f=t[s+5]>>3,m=7&t[s+5],g=new Uint8Array([a<<6|f<<1|m>>2,(3&m)<<6|c<<3|h<<2|o>>4,o<<4&224]),p=i+r*(1536/n*9e4),y=t.subarray(s,s+l);return e.config=g,e.channelCount=u,e.samplerate=n,e.samples.push({unit:y,pts:p}),l}const Tw=/\/emsg[-/]ID3/i;function _w(e,t){return dp(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class kw{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Wv(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Vv)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then((r=>{const a=new Uint8Array(r);i.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}))}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const a=Ly(r.data),n=this.getAvcEncryptedData(a);this.decryptBuffer(n.buffer).then((n=>{r.data=this.getAvcDecryptedUnit(a,n),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}))}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(s>=r.length);s++){const a=r[s];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,s,i,a),this.decrypter.isSync())))return}}}}class Aw{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;s=e[e.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,i=s.length;if(!i)return void t.dropped++;{const t=s[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const a=r,n=[];let o,l,c,d=0,h=-1,u=0;for(-1===r&&(h=0,u=this.getNALuType(t,0),r=0,d=1);d<i;)if(o=t[d++],r)if(1!==r)if(o)if(1===o){if(l=d-r-1,h>=0){const e={data:t.subarray(h,l),type:u};n.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(a&&d<=4-a&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-a)),l>0&&(s.data=Sy(s.data,t.subarray(0,l)),s.state=0))}d<i?(c=this.getNALuType(t,d),h=d,u=c,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(h>=0&&r>=0){const e={data:t.subarray(h,i),type:u,state:r};n.push(e)}if(0===n.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=Sy(s.data,t))}return e.naluState=r,n}}class Lw{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&jp.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Rw extends Aw{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a,n=this.VideoSample,o=!1;s.data=null,n&&r.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 1:{let t=!1;a=!0;const r=i.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=n)&&c.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null);n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.frame=!0,n.key=t;break}case 5:a=!0,null!=(r=n)&&r.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 6:a=!0,Ay(i.data,1,s.pts,t.samples);break;case 7:{var d,h;a=!0,o=!0;const t=i.data,s=this.readSPS(t);if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(d=e.pixelRatio)?void 0:d[0])!==s.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,null!=(l=n)&&l.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1}if(n&&a){n.units.push(i)}})),i&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new Lw(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s,i=8,r=8;for(let a=0;a<e;a++)0!==r&&(s=t.readEG(),r=(i+s+256)%256),i=0===r?i:r}readSPS(e){const t=new Lw(e);let s,i,r,a=0,n=0,o=0,l=0;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),u=t.readBoolean.bind(t),f=t.skipBits.bind(t),m=t.skipEG.bind(t),g=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);c();const y=c();if(d(5),f(3),c(),g(),100===y||110===y||122===y||244===y||44===y||83===y||86===y||118===y||128===y){const e=h();if(3===e&&f(1),g(),g(),f(1),u())for(i=3!==e?8:12,r=0;r<i;r++)u()&&p(r<6?16:64,t)}g();const v=h();if(0===v)h();else if(1===v)for(f(1),m(),m(),s=h(),r=0;r<s;r++)m();g(),f(1);const x=h(),b=h(),w=d(1);0===w&&f(1),f(1),u()&&(a=h(),n=h(),o=h(),l=h());let E=[1,1];if(u()&&u()){switch(c()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(x+1)-2*a-2*n),height:(2-w)*(b+1)*16-(w?2:4)*(o+l),pixelRatio:E}}}class Pw extends Aw{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a,n=this.VideoSample,o=!1;s.data=null,n&&r.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:var c;if(a=!0,o)null!=(c=n)&&c.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null);n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 19:case 20:a=!0,null!=(r=n)&&r.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 39:a=!0,Ay(i.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=kp(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(a=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const s in t.params)e.params[s]=t.params[s]}this.pushParameterSet(e.sps,i.data,e.vps),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0;break;case 34:if(a=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const s in t)e.params[s]=t[s]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:a=!0,e.audFound=!0,null!=(l=n)&&l.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1}if(n&&a){n.units.push(i)}})),i&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Lw(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new Lw(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),n=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),u=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),p=t.readUByte(),y=[],v=[];for(let H=0;H<s;H++)y.push(t.readBoolean()),v.push(t.readBoolean());if(s>0)for(let H=s;H<8;H++)t.readBits(2);for(let H=0;H<s;H++)y[H]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[H]&&t.readUByte();t.readUEG();const x=t.readUEG();3==x&&t.skipBits(1);const b=t.readUEG(),w=t.readUEG(),E=t.readBoolean();let S=0,T=0,_=0,k=0;E&&(S+=t.readUEG(),T+=t.readUEG(),_+=t.readUEG(),k+=t.readUEG());const A=t.readUEG(),L=t.readUEG(),R=t.readUEG();for(let H=t.readBoolean()?0:s;H<=s;H++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let s=0;s<(3===e?2:6);s++){if(t.readBoolean()){const s=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<s;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let N=0;for(let H=0;H<P;H++){let e=!1;if(0!==H&&(e=t.readBoolean()),e){H===P&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let s=0;s<=N;s++){const s=t.readBoolean();let i=!1;s||(i=t.readBoolean()),(s||i)&&e++}N=e}else{const e=t.readUEG(),s=t.readUEG();N=e+s;for(let i=0;i<e;i++)t.readUEG(),t.readBoolean();for(let i=0;i<s;i++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let s=0;s<e;s++){for(let e=0;e<R+4;e++)t.readBits(1);t.readBits(1)}}let C=0,I=1,D=1,j=!0,O=1,M=0;t.readBoolean(),t.readBoolean();let F=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(I=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],D=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(I=t.readBits(16),D=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),F=t.readBoolean(),F&&(S+=t.readUEG(),T+=t.readUEG(),_+=t.readUEG(),k+=t.readUEG());if(t.readBoolean()){O=t.readBits(32),M=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let a=0;a<=s;a++){j=t.readBoolean();let s=!1;j||t.readBoolean()?t.readEG():s=t.readBoolean();const a=s?1:t.readUEG()+1;if(e)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let $=b,U=w;if(E||F){let e=1,t=1;1===x?e=t=2:2==x&&(e=2),$=b-e*T-e*S,U=w-t*k-t*_}const B=i?["A","B","C"][i]:"",V=n<<24|o<<16|l<<8|c;let G=0;for(let H=0;H<32;H++)G=(G|(V>>H&1)<<31-H)>>>0;let K=G.toString(16);1===a&&"2"===K&&(K="6");return{codecString:`hvc1.${B}${a}.${K}.${r?"H":"L"}${p}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[n,o,l,c],general_constraint_indicator_flags:[d,h,u,f,m,g],general_level_idc:p,bit_depth:A+8,bit_depth_luma_minus8:A,bit_depth_chroma_minus8:L,min_spatial_segmentation_idc:C,chroma_format_idc:x,frame_rate:{fixed:j,fps:M/O}},width:$,height:U,pixelRatio:[I,D]}}readPPS(e){const t=new Lw(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let r=1;return i&&s?r=0:i?r=3:s&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Nw=188;class Cw{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=Cw.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),-1!==s}static syncOffset(e){const t=e.length;let s=Math.min(940,t-Nw)+1,i=0;for(;i<s;){let r=!1,a=-1,n=0;for(let o=i;o<t;o+=Nw){if(71!==e[o]||t-o!==Nw&&71!==e[o+Nw]){if(n)return-1;break}if(n++,-1===a&&(a=o,0!==a&&(s=Math.min(a+18612,e.length-Nw)+1)),r||(r=0===Iw(e,o)),r&&n>1&&(0===a&&n>2||o+Nw>s))return a}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ny[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Cw.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Cw.createTrack("audio",i),this._id3Track=Cw.createTrack("id3"),this._txtTrack=Cw.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){let r;s||(this.sampleAes=null);const a=this._videoTrack,n=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=a.pid,d=a.pesData,h=n.pid,u=o.pid,f=n.pesData,m=o.pesData,g=null,p=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=Sy(this.remainderData,e)).length,this.remainderData=null),v<Nw&&!i)return this.remainderData=e,{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l};const x=Math.max(0,Cw.syncOffset(e));v-=(v-x)%Nw,v<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let b=0;for(let E=x;E<v;E+=Nw)if(71===e[E]){const t=!!(64&e[E+1]),i=Iw(e,E);let v;if((48&e[E+3])>>4>1){if(v=E+5+e[E+4],v===E+Nw)continue}else v=E+4;switch(i){case c:if(t){if(d&&(r=Fw(d,this.logger))){if(null===this.videoParser)switch(a.segmentCodec){case"avc":this.videoParser=new Rw;break;case"hevc":this.videoParser=new Pw}null!==this.videoParser&&this.videoParser.parsePES(a,l,r,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(v,E+Nw)),d.size+=E+Nw-v);break;case h:if(t){if(f&&(r=Fw(f,this.logger)))switch(n.segmentCodec){case"aac":this.parseAACPES(n,r);break;case"mp3":this.parseMPEGPES(n,r);break;case"ac3":this.parseAC3PES(n,r)}f={data:[],size:0}}f&&(f.data.push(e.subarray(v,E+Nw)),f.size+=E+Nw-v);break;case u:t&&(m&&(r=Fw(m,this.logger))&&this.parseID3PES(o,r),m={data:[],size:0}),m&&(m.data.push(e.subarray(v,E+Nw)),m.size+=E+Nw-v);break;case 0:t&&(v+=e[v]+1),y=this._pmtId=Dw(e,v);break;case y:{t&&(v+=e[v]+1);const i=jw(e,v,this.typeSupported,s,this.observer,this.logger);c=i.videoPid,c>0&&(a.pid=c,a.segmentCodec=i.segmentVideoCodec),h=i.audioPid,h>0&&(n.pid=h,n.segmentCodec=i.segmentAudioCodec),u=i.id3Pid,u>0&&(o.pid=u),null===g||p||(this.logger.warn(`MPEG-TS PMT found at ${E} after unknown PID '${g}'. Backtracking to sync byte @${x} to parse all TS packets.`),g=null,E=x-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i}}else b++;b>0&&Ow(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,n.pesData=f,o.pesData=m;const w={audioTrack:n,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,a=s.pesData,n=t.pesData,o=i.pesData;let l;if(a&&(l=Fw(a,this.logger))){if(null===this.videoParser)switch(s.segmentCodec){case"avc":this.videoParser=new Rw;break;case"hevc":this.videoParser=new Pw}null!==this.videoParser&&(this.videoParser.parsePES(s,r,l,!0),s.pesData=null)}else s.pesData=a;if(n&&(l=Fw(n,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=n&&n.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=n;o&&(l=Fw(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new kw(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise((s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)})):s(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)}))}))}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r,a,n,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=Sy(i.sample.unit,o);else{const a=r-t;i.sample.unit.set(o.subarray(0,t),a),e.samples.push(i.sample),s=i.missing}}for(r=s,a=o.length;r<a-1&&!qb(o,r);r++);if(r!==s){let e;const t=r<a-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",Ow(this.observer,new Error(e),t,this.logger),!t)return}if(zb(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)n=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Yb(e.samplerate);n=i.sample.pts+t}}let l,c=0;for(;r<a;){if(l=Xb(e,o,r,n,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<a-1&&!qb(o,r);r++);}}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,a=0;const n=t.pts;if(void 0!==n)for(;a<i;)if(xw(s,a)){const t=pw(e,s,a,n,r);if(!t)break;a+=t.length,r++}else a++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let a,n=0,o=0;for(;o<r&&(a=Sw(e,s,o,i,n++))>0;)o+=a}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=kp({},t,{type:this._videoTrack?ow.emsg:ow.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Iw(e,t){return((31&e[t+1])<<8)+e[t+2]}function Dw(e,t){return(31&e[t+10])<<8|e[t+11]}function jw(e,t,s,i,r,a){const n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=Iw(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){Mw("ADTS AAC",a);break}case 15:-1===n.audioPid&&(n.audioPid=o);break;case 21:-1===n.id3Pid&&(n.id3Pid=o);break;case 219:if(!i){Mw("H.264",a);break}case 27:-1===n.videoPid&&(n.videoPid=o);break;case 3:case 4:s.mpeg||s.mp3?-1===n.audioPid&&(n.audioPid=o,n.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Mw("AC-3",a);break}case 129:s.ac3?-1===n.audioPid&&(n.audioPid=o,n.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===n.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){if(106===e[i])!0!==s.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=o,n.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return Ow(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),n;case 36:-1===n.videoPid&&(n.videoPid=o,n.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=l+5}return n}function Ow(e,t,s,i){i.warn(`parsing error: ${t.message}`),e.emit(gp.ERROR,gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:t,reason:t.message})}function Mw(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function Fw(e,t){let s,i,r,a,n,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Sy(l[0],l[1]),l.splice(1,1);s=l[0];if(1===(s[0]<<16)+(s[1]<<8)+s[2]){if(i=(s[4]<<8)+s[5],i&&i>e.size-6)return null;const c=s[7];192&c&&(a=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&c?(n=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,a-n>54e5&&(t.warn(`${Math.round((a-n)/9e4)}s delta between PTS and DTS, align them`),a=n)):n=a),r=s[8];let d=r+9;if(e.size<=d)return null;e.size-=d;const h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){s=l[e];let t=s.byteLength;if(d){if(d>t){d-=t;continue}s=s.subarray(d),t-=d,d=0}h.set(s,o),o+=t}return i&&(i-=r+3),{data:h,pts:a,dts:n,len:i}}return null}class $w{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Uw=Math.pow(2,32)-1;class Bw{static init(){let e;for(e in Bw.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Bw.types)Bw.types.hasOwnProperty(e)&&(Bw.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Bw.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Bw.STTS=Bw.STSC=Bw.STCO=r,Bw.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Bw.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Bw.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Bw.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Bw.FTYP=Bw.box(Bw.types.ftyp,a,o,a,n),Bw.DINF=Bw.box(Bw.types.dinf,Bw.box(Bw.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=255&s,a.set(e,4),i=0,s=8;i<r;i++)a.set(t[i],s),s+=t[i].byteLength;return a}static hdlr(e){return Bw.box(Bw.types.hdlr,Bw.HDLR_TYPES[e])}static mdat(e){return Bw.box(Bw.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Uw+1)),i=Math.floor(t%(Uw+1));return Bw.box(Bw.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Bw.box(Bw.types.mdia,Bw.mdhd(e.timescale||0,e.duration||0),Bw.hdlr(e.type),Bw.minf(e))}static mfhd(e){return Bw.box(Bw.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Bw.box(Bw.types.minf,Bw.box(Bw.types.smhd,Bw.SMHD),Bw.DINF,Bw.stbl(e)):Bw.box(Bw.types.minf,Bw.box(Bw.types.vmhd,Bw.VMHD),Bw.DINF,Bw.stbl(e))}static moof(e,t,s){return Bw.box(Bw.types.moof,Bw.mfhd(e),Bw.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=Bw.trak(e[t]);return Bw.box.apply(null,[Bw.types.moov,Bw.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(Bw.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=Bw.trex(e[t]);return Bw.box.apply(null,[Bw.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Uw+1)),i=Math.floor(t%(Uw+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Bw.box(Bw.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Bw.box(Bw.types.sdtp,s)}static stbl(e){return Bw.box(Bw.types.stbl,Bw.stsd(e),Bw.box(Bw.types.stts,Bw.STTS),Bw.box(Bw.types.stsc,Bw.STSC),Bw.box(Bw.types.stsz,Bw.STSZ),Bw.box(Bw.types.stco,Bw.STCO))}static avc1(e){let t,s,i,r=[],a=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],i=s.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],i=s.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(s));const n=Bw.box(Bw.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return Bw.box(Bw.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n,Bw.box(Bw.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Bw.box(Bw.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Bw.box(Bw.types.mp4a,Bw.audioStsd(e),Bw.box(Bw.types.esds,Bw.esds(e)))}static mp3(e){return Bw.box(Bw.types[".mp3"],Bw.audioStsd(e))}static ac3(e){return Bw.box(Bw.types["ac-3"],Bw.audioStsd(e),Bw.box(Bw.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Bw.box(Bw.types.stsd,Bw.STSD,Bw.mp4a(e));if("ac3"===t&&e.config)return Bw.box(Bw.types.stsd,Bw.STSD,Bw.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Bw.box(Bw.types.stsd,Bw.STSD,Bw.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Bw.box(Bw.types.stsd,Bw.STSD,Bw.avc1(e));if("hevc"===t&&e.vps)return Bw.box(Bw.types.stsd,Bw.STSD,Bw.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(s/(Uw+1)),n=Math.floor(s%(Uw+1));return Bw.box(Bw.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const s=Bw.sdtp(e),i=e.id,r=Math.floor(t/(Uw+1)),a=Math.floor(t%(Uw+1));return Bw.box(Bw.types.traf,Bw.box(Bw.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Bw.box(Bw.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a])),Bw.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,Bw.box(Bw.types.trak,Bw.tkhd(e),Bw.mdia(e))}static trex(e){const t=e.id;return Bw.box(Bw.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,a=new Uint8Array(r);let n,o,l,c,d,h;for(t+=8+r,a.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),n=0;n<i;n++)o=s[n],l=o.duration,c=o.size,d=o.flags,h=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*n);return Bw.box(Bw.types.trun,a)}static initSegment(e){Bw.types||Bw.init();const t=Bw.moov(e);return Sy(Bw.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let r=i.length;for(let u=0;u<s.length;u+=1){r+=3;for(let e=0;e<s[u].length;e+=1)r+=2+s[u][e].length}const a=new Uint8Array(r);a.set(i,0),r=i.length;const n=s.length-1;for(let u=0;u<s.length;u+=1){a.set(new Uint8Array([32+u|(u===n?128:0),0,s[u].length]),r),r+=3;for(let e=0;e<s[u].length;e+=1)a.set(new Uint8Array([s[u][e].length>>8,255&s[u][e].length]),r),r+=2,a.set(s[u][e],r),r+=s[u][e].length}const o=Bw.box(Bw.types.hvcC,a),l=e.width,c=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return Bw.box(Bw.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Bw.box(Bw.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Bw.box(Bw.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))}}Bw.types=void 0,Bw.HDLR_TYPES=void 0,Bw.STTS=void 0,Bw.STSC=void 0,Bw.STCO=void 0,Bw.STSZ=void 0,Bw.VMHD=void 0,Bw.SMHD=void 0,Bw.STSD=void 0,Bw.FTYP=void 0,Bw.DINF=void 0;function Vw(e,t,s=1,i=!1){const r=e*t*s;return i?Math.round(r):r}function Gw(e,t=!1){return Vw(e,1e3,1/9e4,t)}let Kw,Hw=null,qw=null;function Ww(e,t,s,i){return{duration:t,size:s,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class zw{constructor(e,t,s,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.ISGenerated=!1,null===Hw){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Hw=e?parseInt(e[1]):0}if(null===qw){const e=navigator.userAgent.match(/Safari\/(\d+)/i);qw=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce(((e,i)=>{let r=i.pts,a=r-e;return a<-4294967296&&(t=!0,r=Yw(r,s),a=r-e),a>0?e:r}),s);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,s,i,r,a,n,o){let l,c,d,h,u,f,m=r,g=r;const p=e.pid>-1,y=t.pid>-1,v=t.samples.length,x=e.samples.length>0,b=n&&v>0||v>1;if((!p||x)&&(!y||b)||this.ISGenerated||n){if(this.ISGenerated){var w,E,S,T;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(w=t.pixelRatio)?void 0:w[0])!==(null==(E=e.pixelRatio)?void 0:E[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(T=e.pixelRatio)?void 0:T[1]))||!e&&b||null===this.nextAudioPts&&x)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,r,a));const s=this.isVideoContiguous;let i,n=-1;if(b&&(n=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,n>0){this.logger.warn(`[mp4-remuxer]: Dropped ${n} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(n),t.dropped+=n,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===n&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(x&&b){const s=this.getVideoStartPts(t.samples),i=(Yw(e.samples[0].pts,s)-s)/t.inputTimeScale;m+=Math.max(0,i),g+=Math.max(0,-i)}if(x){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,a)),c=this.remuxAudio(e,m,this.isAudioContiguous,a,y||b||o===wp?g:void 0),b){const i=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,g,s,i)}}else b&&(l=this.remuxVideo(t,g,s,0));l&&(l.firstKeyFrame=n,l.independent=-1!==n,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(u=Xw(s,r,this._initPTS,this._initDTS)),i.samples.length&&(h=Jw(i,r,this._initPTS))),{audio:c,video:l,initSegment:d,independent:f,text:h,id3:u}}generateIS(e,t,s,i){const r=e.samples,a=t.samples,n=this.typeSupported,o={},l=this._initPTS;let c,d,h,u=!l||i,f="audio/mp4";if(u&&(c=d=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":n.mpeg?(f="audio/mpeg",e.codec=""):n.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&n.mpeg?new Uint8Array(0):Bw.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=e.inputTimeScale,l&&h===l.timescale?u=!1:c=d=r[0].pts-Math.round(h*s))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Bw.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(h=t.inputTimeScale,l&&h===l.timescale)u=!1;else{const e=this.getVideoStartPts(a),t=Math.round(h*s);d=Math.min(d,Yw(a[0].dts,e)-t),c=Math.min(c,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:c,timescale:h},this._initDTS={baseTime:d,timescale:h}):c=h=void 0,{tracks:o,initPTS:c,timescale:h}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,a=e.samples,n=[],o=a.length,l=this._initPTS;let c,d,h=this.nextAvcDts,u=8,f=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=!1;if(!s||null===h){const e=t*r,i=a[0].pts-Yw(a[0].dts,a[0].pts);Hw&&null!==h&&Math.abs(e-i-h)<15e3?s=!0:h=e-i}const y=l.baseTime*r/l.timescale;for(let I=0;I<o;I++){const e=a[I];e.pts=Yw(e.pts-y,h),e.dts=Yw(e.dts-y,h),e.dts<a[I>0?I-1:I].dts&&(p=!0)}p&&a.sort((function(e,t){const s=e.dts-t.dts,i=e.pts-t.pts;return s||i})),c=a[0].dts,d=a[a.length-1].dts;const v=d-c,x=v?Math.round(v/(o-1)):f||e.inputTimeScale/30;if(s){const s=c-h,i=s>x,r=s<-1;if((i||r)&&(i?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Gw(s,!0)} ms (${s}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Gw(-s,!0)} ms (${s}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||h>=a[0].pts||Hw)){c=h;const e=a[0].pts-s;if(i)a[0].dts=c,a[0].pts=e;else{let t=!0;for(let i=0;i<a.length&&!(a[i].dts>e&&t);i++){const e=a[i].pts;if(a[i].dts-=s,a[i].pts-=s,i<a.length-1){const s=a[i+1].pts;t=s<=a[i].pts==s<=e}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Gw(e,!0)}/${Gw(c,!0)}, delta: ${Gw(s,!0)} ms`)}}c=Math.max(0,c);let b=0,w=0,E=c;for(let I=0;I<o;I++){const e=a[I],t=e.units,s=t.length;let i=0;for(let r=0;r<s;r++)i+=t[r].data.length;w+=i,b+=s,e.length=i,e.dts<E?(e.dts=E,E+=x/4|0||1):E=e.dts,m=Math.min(e.pts,m),g=Math.max(e.pts,g)}d=a[o-1].dts;const S=w+4*b+8;let T;try{T=new Uint8Array(S)}catch(C){return void this.observer.emit(gp.ERROR,gp.ERROR,{type:fp.MUX_ERROR,details:mp.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:S,reason:`fail allocating video mdat ${S}`})}const _=new DataView(T.buffer);_.setUint32(0,S),T.set(Bw.types.mdat,4);let k=!1,A=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,P=Number.NEGATIVE_INFINITY;for(let I=0;I<o;I++){const e=a[I],t=e.units;let s,l=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],s=e.data,r=e.data.byteLength;_.setUint32(u,r),u+=4,T.set(s,u),u+=r,l+=4+r}if(I<o-1)f=a[I+1].dts-e.dts,s=a[I+1].pts-e.pts;else{const t=this.config,n=I>0?e.dts-a[I-1].dts:x;if(s=I>0?e.pts-a[I-1].pts:x,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const s=Math.floor(t.maxBufferHole*r),a=(i?m+i*r:this.nextAudioPts)-e.pts;a>s?(f=a-n,f<0?f=n:k=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${a/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=n}else f=n}const c=Math.round(e.pts-e.dts);A=Math.min(A,f),R=Math.max(R,f),L=Math.min(L,s),P=Math.max(P,s),n.push(Ww(e.key,f,l,c))}if(n.length)if(Hw){if(Hw<70){const e=n[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(qw&&P-L<R-A&&x/R<.025&&0===n[0].cts){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,s=n.length;t<s;t++){const i=e+n[t].duration,r=e+n[t].cts;if(t<s-1){const e=i+n[t+1].cts;n[t].duration=e-r}else n[t].duration=t?n[t-1].duration:x;n[t].cts=0,e=i}}f=k||!f?x:f,this.nextAvcDts=h=d+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const N={data1:Bw.moof(e.sequenceNumber++,c,kp(e,{samples:n})),data2:T,startPTS:m/r,endPTS:(g+f)/r,startDTS:c/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:n.length,dropped:e.dropped};return e.samples=[],e.dropped=0,N}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,s,i,r){const a=e.inputTimeScale,n=a/(e.samplerate?e.samplerate:a),o=this.getSamplesPerFrame(e),l=o*n,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],u=void 0!==r;let f=e.samples,m=d?0:8,g=this.nextAudioPts||-1;const p=t*a,y=c.baseTime*a/c.timescale;if(this.isAudioContiguous=s=s||f.length&&g>0&&(i&&Math.abs(p-g)<9e3||Math.abs(Yw(f[0].pts-y,p)-g)<20*l),f.forEach((function(e){e.pts=Yw(e.pts-y,p)})),!s||g<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;g=0===r?0:i&&!u?Math.max(0,p):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,i=g;s<f.length;s++){const r=f[s],n=r.pts,o=n-i,c=Math.abs(1e3*o/a);if(o<=-t*l&&u)0===s&&(this.logger.warn(`Audio frame @ ${(n/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/a)} ms.`),this.nextAudioPts=g=i=n);else if(o>=t*l&&c<1e4&&u){let t=Math.round(o/l);i=n-t*l,i<0&&(t--,i+=l),0===s&&(this.nextAudioPts=g=i),this.logger.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/a).toFixed(3)}s due to ${Math.round(1e3*o/a)} ms gap.`);for(let a=0;a<t;a++){const t=Math.max(i,0);let a=$w.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);a||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),a=r.unit.subarray()),f.splice(s,0,{unit:a,pts:t}),i+=l,s++}}r.pts=i,i+=l}}let v,x=null,b=null,w=0,E=f.length;for(;E--;)w+=f[E].unit.byteLength;for(let P=0,N=f.length;P<N;P++){const t=f[P],i=t.unit;let r=t.pts;if(null!==b){h[P-1].duration=Math.round((r-b)/n)}else{if(s&&"aac"===e.segmentCodec&&(r=g),x=r,!(w>0))return;w+=m;try{v=new Uint8Array(w)}catch(R){return void this.observer.emit(gp.ERROR,gp.ERROR,{type:fp.MUX_ERROR,details:mp.REMUX_ALLOC_ERROR,fatal:!1,error:R,bytes:w,reason:`fail allocating audio mdat ${w}`})}if(!d){new DataView(v.buffer).setUint32(0,w),v.set(Bw.types.mdat,4)}}v.set(i,m);const a=i.byteLength;m+=a,h.push(Ww(!0,o,a,0)),b=r}const S=h.length;if(!S)return;const T=h[h.length-1];this.nextAudioPts=g=b+n*T.duration;const _=d?new Uint8Array(0):Bw.moof(e.sequenceNumber++,x/n,kp({},e,{samples:h}));e.samples=[];const k=x/a,A=g/a,L={data1:_,data2:v,startPTS:k,endPTS:A,startDTS:k,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,L}}function Yw(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function Xw(e,t,s,i){const r=e.samples.length;if(!r)return;const a=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Yw(r.pts-s.baseTime*a/s.timescale,t*a)/a,r.dts=Yw(r.dts-i.baseTime*a/i.timescale,t*a)/a}const n=e.samples;return e.samples=[],{samples:n}}function Jw(e,t,s){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let n=0;n<i;n++){const i=e.samples[n];i.pts=Yw(i.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const a=e.samples;return e.samples=[],{samples:a}}function Qw(e,t){const s=null==e?void 0:e.codec;if(s&&s.length>4)return s;if(t===Xp){if("ec-3"===s||"ac-3"===s||"alac"===s)return s;if("fLaC"===s||"Opus"===s){return By(s,!1)}return jp.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"}return jp.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1"}try{Kw=self.performance.now.bind(self.performance)}catch(Lk){Kw=Date.now}const Zw=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=lw("video",1),a=this.audioTrack=lw("audio",1),n=this.txtTrack=lw("text",1);if(this.id3Track=lw("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=gy(e);if(o.video){const{id:e,timescale:t,codec:s,supplemental:i}=o.video;r.id=e,r.timescale=n.timescale=t,r.codec=s,r.supplemental=i}if(o.audio){const{id:e,timescale:t,codec:s}=o.audio;a.id=e,a.timescale=t,a.codec=s}n.id=ny.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let s=0;s<t;){const i=cy(e,s);if(i>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=i>1?s+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Sy(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},s=fy(e,["moof"]);if(s.length<2)return t.remainder=e,t;const i=s[s.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(s);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=s;const a=this.extractID3Track(i,t);return r.samples=Ty(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=Ty(e,t),{videoTrack:t,audioTrack:lw(),id3Track:i,textTrack:lw()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=fy(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function(e){const t=e[0];let s="",i="",r=0,a=0,n=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==oy(e.subarray(c,c+1));)s+=oy(e.subarray(c,c+1)),c+=1;for(s+=oy(e.subarray(c,c+1)),c+=1;"\0"!==oy(e.subarray(c,c+1));)i+=oy(e.subarray(c,c+1)),c+=1;i+=oy(e.subarray(c,c+1)),c+=1,r=cy(e,12),a=cy(e,16),o=cy(e,20),l=cy(e,24),c=28}else if(1===t){c+=4,r=cy(e,c),c+=4;const t=cy(e,c);c+=4;const a=cy(e,c);for(c+=4,n=2**32*t+a,hp(n)||(n=Number.MAX_SAFE_INTEGER,jp.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=cy(e,c),c+=4,l=cy(e,c),c+=4;"\0"!==oy(e.subarray(c,c+1));)s+=oy(e.subarray(c,c+1)),c+=1;for(s+=oy(e.subarray(c,c+1)),c+=1;"\0"!==oy(e.subarray(c,c+1));)i+=oy(e.subarray(c,c+1)),c+=1;i+=oy(e.subarray(c,c+1)),c+=1}return{schemeIdUri:s,value:i,timeScale:r,presentationTime:n,presentationTimeDelta:a,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(Tw.test(i.schemeIdUri)){const e=_w(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const a=i.payload;s.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:ow.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=_w(i,t);s.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:ow.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class{constructor(e,t,s,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(function(e,t){if(!e||!t)return e;const s=t.keyId;s&&t.isCommonEncryption&&fy(e,["moov","trak"]).forEach((e=>{const t=fy(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=fy(t,["enca"]);const r=i.length>0;r||(i=fy(t,["encv"])),i.forEach((e=>{fy(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=wy(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(jp.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${$p(e)} -> ${$p(s)}`),t.set(s,8))}}))}))}));return e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=gy(e);i.audio&&(t=Qw(i.audio,Xp)),i.video&&(s=Qw(i.video,Jp));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,i,r,a){var n,o;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};dp(c)||(c=this.lastEndTime=r||0);const h=t.samples;if(null==h||!h.length)return d;const u={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(n=f)&&n.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);const m=function(e,t){let s=0,i=0,r=0;const a=fy(e,["moof","traf"]);for(let n=0;n<a.length;n++){const e=a[n],o=fy(e,["tfhd"])[0],l=t[cy(o,4)];if(!l)continue;const c=l.default,d=cy(o,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&d&&(h=cy(o,2&d?12:8));const u=l.timescale||9e4,f=fy(e,["trun"]);for(let t=0;t<f.length;t++)s=Ey(f[t]),!s&&h&&(s=h*cy(f[t],4)),l.type===Jp?i+=s/u:l.type===Xp&&(r+=s/u)}if(0===i&&0===r){let t=1/0,s=0,i=0;const r=fy(e,["sidx"]);for(let e=0;e<r.length;e++){const a=my(r[e]);if(null!=a&&a.references){t=Math.min(t,a.earliestPresentationTime/a.timescale);const e=a.references.reduce(((e,t)=>e+t.info.duration||0),0);s=Math.max(s,e+a.earliestPresentationTime/a.timescale),i=s-t}}if(i&&dp(i))return i}return i||r}(h,f),g=function(e,t){return fy(t,["moof","traf"]).reduce(((t,s)=>{const i=fy(s,["tfdt"])[0],r=i[0],a=fy(s,["tfhd"]).reduce(((t,s)=>{const a=cy(s,4),n=e[a];if(n){let e=cy(i,4);if(1===r){if(e===ry)return jp.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=ry+1,e+=cy(i,8)}const s=e/(n.timescale||9e4);if(dp(s)&&(null===t||s<t))return s}return t}),null);return null!==a&&dp(a)&&(null===t||a<t)?a:t}),null)}(f,h),p=null===g?r:g;!a&&l||!function(e,t,s,i){if(null===e)return!0;const r=Math.max(i,1),a=t-e.baseTime/e.timescale;return Math.abs(a-s)>r}(l,p,r,m)&&u.timescale===l.timescale||(u.initPTS=p-r,l&&1===l.timescale&&this.logger.warn(`Adjusting initPTS @${r} from ${l.baseTime/l.timescale} to ${u.initPTS}`),this.initPTS=l={baseTime:u.initPTS,timescale:1});const y=e?p-l.baseTime/l.timescale:c,v=y+m;!function(e,t,s){fy(t,["moof","traf"]).forEach((t=>{fy(t,["tfhd"]).forEach((i=>{const r=cy(i,4),a=e[r];if(!a)return;const n=a.timescale||9e4;fy(t,["tfdt"]).forEach((e=>{const t=e[0],i=s*n;if(i){let s=cy(e,4);if(0===t)s-=i,s=Math.max(s,0),uy(e,4,s);else{s*=Math.pow(2,32),s+=cy(e,8),s-=i,s=Math.max(s,0);const t=Math.floor(s/(ry+1)),r=Math.floor(s%(ry+1));uy(e,4,t),uy(e,8,r)}}}))}))}))}(f,h,l.baseTime/l.timescale),m>0?this.lastEndTime=v:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!f.audio,b=!!f.video;let w="";x&&(w+="audio"),b&&(w+="video");const E={data1:h,startPTS:y,startDTS:y,endPTS:v,endDTS:v,type:w,hasAudio:x,hasVideo:b,nb:1,dropped:0};return d.audio="audio"===E.type?E:void 0,d.video="audio"!==E.type?E:void 0,d.initSegment=u,d.id3=Xw(s,r,l,l),i.samples.length&&(d.text=Jw(i,r,l)),d}}},{demux:Cw,remux:zw},{demux:class extends cw{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Vb(e,0);let i=(null==s?void 0:s.length)||0;if(bw(e,i))return!1;for(let r=e.length;i<r;i++)if(Wb(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Gb(e,t)&&Hb(e,t)<=e.length-t}(e,t)}appendFrame(e,t,s){zb(e,this.observer,t,s,e.manifestCodec);const i=Xb(e,t,s,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:zw},{demux:class extends cw{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Vb(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==nw(t)&&ww(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(bw(e,s))return jp.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return vw(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,s){if(null!==this.basePTS)return pw(e,t,s,this.basePTS,this.frameIndex)}},remux:zw}];Zw.splice(2,0,{demux:Ew,remux:zw});class eE{constructor(e,t,s,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=Kw();let a=new Uint8Array(e);const{currentTransmuxState:n,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:u,initSegmentChange:f}=i||n,{audioCodec:m,videoCodec:g,defaultInitPts:p,duration:y,initSegmentData:v}=o,x=function(e,t){let s=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t);return s}(a,t);if(x&&mx(x.method)){const e=this.getDecrypter(),t=gx(x.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(a,x.key.buffer,x.iv.buffer,t).then((e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t})),this.decryptionPromise;{let i=e.softwareDecrypt(a,x.key.buffer,x.iv.buffer,t);if(s.part>-1){const t=e.flush();i=t?t.buffer:t}if(!i)return r.executeEnd=Kw(),tE(s);a=new Uint8Array(i)}}const b=this.needsProbing(c,d);if(b){const e=this.configureTransmuxer(a);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(gp.ERROR,gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Kw(),tE(s)}(c||d||f||b)&&this.resetInitSegment(v,m,g,y,t),(c||f||b)&&this.resetInitialTimestamp(p),l||this.resetContiguity();const w=this.transmux(a,x,u,h,s);this.asyncResult=sE(w);const E=this.currentTransmuxState;return E.contiguous=!0,E.discontinuity=!1,E.trackSwitch=!1,r.executeEnd=Kw(),w}flush(e){const t=e.transmuxing;t.executeStart=Kw();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then((()=>this.flush(e)));const a=[],{timeOffset:n}=i;if(s){const t=s.flush();t&&a.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=Kw();const s=[tE(e)];return this.asyncResult?Promise.resolve(s):s}const c=o.flush(n);return sE(c)?(this.asyncResult=!0,c.then((t=>(this.flushRemux(a,t,e),a)))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:n}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===bp?"level":"track"} ${s.level}`);const c=this.remuxer.remux(i,r,a,n,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:s}),s.transmuxing.executeEnd=Kw()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:a,remuxer:n}=this;a&&n&&(a.resetInitSegment(e,t,s,i),n.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,i,r):this.transmuxUnencrypted(e,s,i,r),a}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:a,id3Track:n,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,n,o,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,i,!1,this.id),chunkMeta:r})))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let d=0,h=Zw.length;d<h;d++){var a;if(null!=(a=Zw[d].demux)&&a.probe(e,this.logger)){r=Zw[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const n=this.demuxer,o=this.remuxer,l=r.remux,c=r.demux;o&&o instanceof l||(this.remuxer=new l(s,t,i,this.logger)),n&&n instanceof c||(this.demuxer=new c(s,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Wv(this.config)),e}}const tE=e=>({remuxResult:{},chunkMeta:e});function sE(e){return"then"in e&&e.then instanceof Function}class iE{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class rE{constructor(e,t,s,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let aE=0;class nE{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=aE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,s=this.hls;if(s&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,s.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const a=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===gp.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new Ob,this.observer.on(gp.FRAG_DECRYPTED,a),this.observer.on(gp.ERROR,a);const n=Ky(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const s=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(s.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function(e){const t=Fb[e];if(t)return t.clientCount++,t;const s=new self.URL(e,self.location.href).href,i={worker:new self.Worker(s),scriptURL:s,clientCount:1};return Fb[e]=i,i}(r.workerPath)):(s.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=Fb[Mb];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(t),i={worker:new self.Worker(s),objectURL:s,clientCount:1};return Fb[Mb]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:n,id:t,config:ov(r)})}catch(Lk){s.warn(`Error setting up "${t}" Web Worker, fallback to inline`,Lk),this.terminateWorker(),this.error=null,this.transmuxer=new eE(this.observer,n,r,"",t,e.logger)}return}}this.transmuxer=new eE(this.observer,n,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=aE++;const t=this.hls.config,s=Ky(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:ov(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=Fb[e||Mb];if(t&&1==t.clientCount--){const{worker:s,objectURL:i}=t;delete Fb[e||Mb],i&&self.URL.revokeObjectURL(i),s.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,a,n,o,l,c){var d,h;l.transmuxing.start=self.performance.now();const{instanceNo:u,transmuxer:f}=this,m=a?a.start:r.start,g=r.decryptdata,p=this.frag,y=!(p&&r.cc===p.cc),v=!(p&&l.level===p.level),x=p?l.sn-p.sn:-1,b=this.part?l.part-this.part.index:-1,w=0===x&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),E=!v&&(1===x||0===x&&(1===b||w&&b<=0)),S=self.performance.now();(v||x||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!a||!b&&E||(a.stats.parsing.start=S);const T=!(p&&(null==(d=r.initSegment)?void 0:d.url)===(null==(h=p.initSegment)?void 0:h.url)),_=new rE(y,E,o,v,m,T);if(!E||y||T){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===bp?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${y}\n        trackSwitch: ${v}\n        contiguous: ${E}\n        accurateTimeOffset: ${o}\n        timeOffset: ${m}\n        initSegmentChange: ${T}`);const e=new iE(s,i,t,n,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:u,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:_},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,g,l,_);sE(t)?t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const t=s.flush(e);sE(t)?t.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(t,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class oE extends Rp{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=null==t?void 0:t.renditionReports;if(i){let a=-1;for(let s=0;s<i.length;s++){const n=i[s];let o;try{o=new self.URL(n.URI,t.url).href}catch(r){this.warn(`Could not construct new URL for Rendition Report: ${r}`),o=n.URI||""}if(o===e){a=s;break}o===e.substring(0,o.length)&&(a=s)}if(-1!==a){const e=i[a],r=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let n=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);n>=0&&e>t.partTarget&&(n+=1)}const o=s&&sv(s);return new iv(r,n>=0?n:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,a=self.performance.now(),n=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-n;const o=this.hls.config.timelineOffset;if(o!==i.appliedTimelineOffset){const e=Math.max(o||0,0);i.appliedTimelineOffset=e,i.fragments.forEach((t=>{t.start=t.playlistOffset+e}))}if(i.live||null!=s&&s.live){const o="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){ib(s,i);const e=i.playlistParsingError;if(e){this.warn(e);const s=this.hls;if(!s.config.ignorePlaylistParsingErrors){var l;const{networkDetails:a}=t;return void s.trigger(gp.ERROR,{type:fp.NETWORK_ERROR,details:mp.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=i.fragments[0])?void 0:l.type,networkDetails:a,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const c=this.hls.mainForwardBufferInfo,d=c?c.end-c.len:0,h=ob(i,1e3*(i.edge-d));if(i.requestScheduled+h<a?i.requestScheduled=a:i.requestScheduled+=h,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let u,f,m;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,n=i.endSN,l=i.lastPartIndex,c=r===n;-1!==l?c?(f=n+1,m=e?0:l):(f=r,m=e?l+1:i.maxPartIndex):f=n+1;const d=i.age,h=d+i.ageHeader;let g=Math.min(h-i.partTarget,1.5*i.targetduration);if(g>0){if(h>3*i.targetduration)this.log(`Playlist last advanced ${d.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,m=void 0;else if(null!=s&&s.tuneInGoal&&h-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${g} with playlist age: ${i.age}`),g=0;else{const e=Math.floor(g/i.targetduration);if(f+=e,void 0!==m){m+=Math.round(g%i.targetduration/i.partTarget)}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${d.toFixed(2)}s goal: ${g} skip sn ${e} to part ${m}`)}i.tuneInGoal=g}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m),e||!c)return i.requestScheduled=a,void this.loadingPlaylist(o,u)}else(i.canBlockReload||i.canSkipUntil)&&(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m));u&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(h-2*n,h/2)),this.scheduleLoading(o,u,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),a=i.requestScheduled;if(r>=a)return void this.loadingPlaylist(e,t);const n=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(n)} ms`),this.clearTimer(),this.timer=self.setTimeout((()=>this.loadingPlaylist(e,t)),n)}getDeliveryDirectives(e,t,s,i){let r=sv(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=Zy),new iv(s,i,r)}checkRetry(e){const t=e.details,s=wv(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:n}=i||{},o=!!i&&!!n&&(r===Rv||!i.resolved&&r===Av);if(o){var l;if(a>=n.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${n.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Sv(n,a);this.clearTimer(),this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${a+1}/${n.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}function lE(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!cE(e[s].attrs,t[s].attrs))return!1;return!0}function cE(e,t,s){const i=e["STABLE-RENDITION-ID"];return i&&!s?i===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((s=>e[s]!==t[s]))}function dE(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class hE{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1!==i.length||s||this.executeNext(t)}appendBlocker(e){return new Promise((t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)}))}prependBlocker(e){return new Promise((t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}}))}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((e=>{var t;const s=null==(t=e[0])?void 0:t.label;"async-blocker"!==s&&"async-blocker-prepend"!==s||(e[0].execute(),e.splice(0,1))}))}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){var s;if(r.onError(i),null===this.queues||null===this.tracks)return;const t=null==(s=this.tracks[e])?void 0:s.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,s;return null!=(t=this.queues)&&t[e]||null!=(s=this.tracks)&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=null==(t=this.tracks)?void 0:t[e],i=null==s?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map((e=>e.label)).join(", "))||""}}const uE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,fE="HlsJsTrackRemovedError";class mE extends Error{constructor(e){super(e),this.name=fE}}function gE(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}function pE(e){return"audio"===e?1:0}class yE{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(gp.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(gp.BUFFER_CODECS,this.onBufferCodecs,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(gp.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(gp.BUFFER_CODECS,this.onBufferCodecs,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&dp(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter(((t,s)=>this.isLevelAllowed(t)&&s<=e));return this.clientRect=null,yE.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,s){if(null==e||!e.length)return-1;let i=e.length-1;const r=Math.max(t,s);for(let o=0;o<e.length;o+=1){const t=e[o];if((t.width>=r||t.height>=r)&&(a=t,!(n=e[o+1])||a.width!==n.width||a.height!==n.height)){i=o;break}}var a,n;return i}}const vE={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},xE={HLS:"h"},bE="CMCD-Object",wE="CMCD-Request",EE="CMCD-Session",SE="CMCD-Status",TE={[bE]:["br","d","ot","tb"],[wE]:["bl","dl","mtp","nor","nrr","su"],[EE]:["cid","pr","sf","sid","st","v"],[SE]:["bs","rtp"]};class _E{constructor(e,t){Array.isArray(e)&&(e=e.map((e=>e instanceof _E?e:new _E(e)))),this.value=e,this.params=t}}function kE(e,t,s,i){return new Error(`failed to ${e} "${r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"==typeof r?JSON.stringify(r):String(r)}" as ${s}`,{cause:i});var r}function AE(e,t,s){return kE("serialize",e,t,s)}class LE{constructor(e){this.description=e}}const RE="Bare Item";function PE(e){if(!1===ArrayBuffer.isView(e))throw AE(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function NE(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw AE(e,"Integer");return e.toString()}function CE(e){const t=Qb(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw AE(e,"Decimal");const s=t.toString();return s.includes(".")?s:`${s}.0`}const IE=/[\x00-\x1f\x7f]+/;function DE(e){const t=(s=e).description||s.toString().slice(7,-1);var s;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw AE(t,"Token");return t}function jE(e){switch(typeof e){case"number":if(!dp(e))throw AE(e,RE);return Number.isInteger(e)?NE(e):CE(e);case"string":return function(e){if(IE.test(e))throw AE(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return DE(e);case"boolean":return function(e){if("boolean"!=typeof e)throw AE(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${NE(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return PE(e);if(e instanceof LE)return DE(e);default:throw AE(e,RE)}}function OE(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw AE(e,"Key");return e}function ME(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${OE(e)}`:`;${OE(e)}=${jE(t)}`)).join("")}function FE(e){return e instanceof _E?`${jE(e.value)}${ME(e.params)}`:jE(e)}function $E(e,t={whitespace:!0}){if("object"!=typeof e)throw AE(e,"Dict");const s=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(s).map((([e,t])=>{t instanceof _E==!1&&(t=new _E(t));let s=OE(e);var i;return!0===t.value?s+=ME(t.params):(s+="=",Array.isArray(t.value)?s+=`(${(i=t).value.map(FE).join(" ")})${ME(i.params)}`:s+=FE(t)),s})).join(`,${i}`)}const UE=e=>Math.round(e),BE=e=>100*UE(e/100),VE={br:UE,d:UE,bl:BE,dl:BE,mtp:BE,nor:(e,t)=>((null==t?void 0:t.baseUrl)&&(e=function(e,t){const s=new URL(e),i=new URL(t);if(s.origin!==i.origin)return e;const r=s.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:BE,tb:UE};function GE(e,t){const s={};if(null==e||"object"!=typeof e)return s;const i=Object.keys(e).sort(),r=kp({},VE,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return i.forEach((i=>{if(null==a?void 0:a(i))return;let n=e[i];const o=r[i];o&&(n=o(n,t)),"v"===i&&1===n||"pr"==i&&1===n||function(e){return"number"==typeof e?dp(e):null!=e&&""!==e&&!1!==e}(n)&&(function(e){return"ot"===e||"sf"===e||"st"===e}(i)&&"string"==typeof n&&(n=new LE(n)),s[i]=n)})),s}function KE(e,t={}){return e?function(e,t){return $E(e,t)}(GE(e,t),kp({whitespace:!1},t)):""}function HE(e,t,s){return kp(e,function(e,t={}){const s={};if(!e)return s;const i=Object.entries(e),r=Object.entries(TE).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),a=i.reduce(((e,t)=>{var s,i;const[a,n]=t,o=(null===(s=r.find((e=>e[1].includes(a))))||void 0===s?void 0:s[0])||wE;return null!==(i=e[o])&&void 0!==i||(e[o]={}),e[o][a]=n,e}),{});return Object.entries(a).reduce(((e,[s,i])=>(e[s]=KE(i,t),e)),s)}(t,s))}const qE=/CMCD=[^&#]+/;function WE(e,t,s){const i=function(e,t={}){if(!e)return"";const s=KE(e,t);return`CMCD=${encodeURIComponent(s)}`}(t,s);if(!i)return e;if(qE.test(e))return e.replace(qE,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}function zE(e,t,s,i){e&&Object.keys(t).forEach((r=>{const a=e.filter((e=>e.groupId===r)).map((e=>{const a=kp({},e);return a.details=void 0,a.attrs=new dx(a.attrs),a.url=a.attrs.URI=YE(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a}));e.push(...a)}))}function YE(e,t,s,i){const{HOST:r,PARAMS:a,[s]:n}=i;let o;t&&(o=null==n?void 0:n[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),a&&Object.keys(a).sort().forEach((e=>{e&&l.searchParams.set(e,a[e])})),l.href}class XE extends Rp{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=XE.CDMCleanupPromise?[XE.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:t,initData:s}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=Cx(this.config));const t=e.map(Nx).filter((e=>!!e));this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then((r=>{const a=_x(r);let n,o;if("sinf"===t){if(a!==bx.FAIRPLAY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${a}`);const r=oy(new Uint8Array(s));try{const e=wy(px(JSON.parse(r).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");n=new Uint8Array(e.subarray(8,24)),o=bx.FAIRPLAY}catch(u){return void this.warn(`${i} Failed to parse sinf: ${u}`)}}else{if(a!==bx.WIDEVINE&&a!==bx.PLAYREADY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${a}`);const r=function(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let i=0;for(;i+32<s;){const s=Py(new DataView(e,i));t.push(s),i+=s.size}}return t}(s),l=r.filter((e=>!!e.systemId&&Px(e.systemId)===a));l.length>1&&this.warn(`${i} Using first of ${l.length} pssh found for selected key-system ${a}`);const c=l[0];if(!c)return void(0===r.length||r.some((e=>!e.systemId))?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${r.map((e=>Px(e.systemId))).join(",")} pssh data in favor of playlist keys`));if(o=Px(c.systemId),0===c.version&&c.data)if(o===bx.WIDEVINE){const e=c.data.length-22;n=new Uint8Array(c.data.subarray(e,e+16))}else o===bx.PLAYREADY&&(n=jx(c.data))}if(!o||!n)return;const l=$p(n),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[l];for(let e=0;e<d.length;e++){const i=d[e],r=i.decryptdata;if(!r.keyId)continue;const a=$p(r.keyId);if(l===a||-1!==r.uri.replace(/-/g,"").indexOf(l)){if(h=c[a],r.pssh)break;delete c[a],r.pssh=new Uint8Array(s),r.keyId=n,h=c[l]=h.then((()=>this.generateRequestWithPreferredKeySession(i,t,s,"encrypted-event-key-match"))),h.catch((e=>this.handleError(e)));break}}if(!h){if(o!==a)return void this.log(`Ignoring "${e.type}" event with ${o} init data for selected key-system ${a}`);h=c[l]=this.getKeySystemSelectionPromise([o]).then((({keySystem:e,mediaKeys:i})=>{var r;this.throwIfDestroyed();const a=new Mx("ISO-23001-7",l,null!=(r=Nx(e))?r:"");return a.pssh=new Uint8Array(s),a.keyId=n,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:a,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(r,t,s,"encrypted-event-no-match")}))})),h.catch((e=>this.handleError(e)))}}))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(gp.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(gp.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(gp.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(gp.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t[e];return i?i.licenseUrl:e===bx.WIDEVINE&&s?s:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(e,t,s)=>!!e&&s.indexOf(e)===t,i=t.map((e=>e.audioCodec)).filter(s),r=t.map((e=>e.videoCodec)).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise(((t,s)=>{const a=e=>{const n=e.shift();this.getMediaKeysPromise(n,i,r).then((e=>t({keySystem:n,mediaKeys:e}))).catch((t=>{e.length?a(e):s(t instanceof JE?t:new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};a(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!=typeof s){let e=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===Ix&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return s(e,t)}getMediaKeysPromise(e,t,s){const i=function(e,t,s,i){let r;switch(e){case bx.FAIRPLAY:r=["cenc","sinf"];break;case bx.WIDEVINE:case bx.PLAYREADY:r=["cenc"];break;case bx.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,s,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs=${e}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}))),videoCapabilities:s.map((e=>({contentType:`video/mp4; codecs=${e}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null})))}]}(r,t,s,i)}(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let a=null==r?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ov(i)}`),a=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),a.then((s=>{this.log(`Access for key-system "${s.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=s.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((s=>s?this.setMediaKeysServerCertificate(t,e,s):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return a.then((()=>r.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${$p(e.keyId||[])}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return $p(e.keyId)}updateKeySession(e,t){var s;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${$p((null==(s=e.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,s)=>{const i=Cx(this.config),r=e.map(_x).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({keySystem:e})=>{const i=Nx(e);i?t(i):s(new Error(`Unable to find format for key-system "${e}"`))})).catch(s)}))}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[s];if(!r){r=this.getKeySystemForKeyPromise(t).then((({keySystem:s,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(s,r).then((()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:s,mediaKeys:r,decryptdata:t})))))));(this.keyIdToKeySessionPromise[s]=r.then((e=>{const s=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",s,"playlist-key")}))).catch((e=>this.handleError(e)))}return r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof JE?this.hls.trigger(gp.ERROR,e.data):this.hls.trigger(gp.ERROR,{type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=_x(e.keyFormat),s=t?[t]:Cx(this.config);return this.attemptKeySystemAccess(s)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Cx(this.config)),0===e.length)throw new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ov({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===s.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,s,i){var r,a;const n=null==(r=this.config.drmSystems)||null==(a=r[e.keySystem])?void 0:a.generateRequest;if(n)try{const i=n.call(this.hls,t,s,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,s=i.initData?i.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(f){var o;if(this.warn(f.message),null!=(o=this.hls)&&o.config.debug)throw f}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${s?s.byteLength:null})`);const c=new Ob,d=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void c.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${s.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch((e=>{c.eventNames().length?c.emit("error",e):this.handleError(e)})):"license-release"===i?e.keySystem===bx.FAIRPLAY&&(this.updateKeySession(e,yx("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},h=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void c.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const s=e.keyStatus;c.emit("keyStatus",s),"expired"===s&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",h);const u=new Promise(((e,t)=>{c.on("error",t),c.on("keyStatus",(s=>{s.startsWith("usable")?e():"output-restricted"===s?t(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===s?t(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${s}"`)):"expired"===s?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${s}"`)}))}));return e.mediaKeysSession.generateRequest(t,s).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>u)).catch((t=>{throw c.removeAllListeners(),this.removeSession(e),t})).then((()=>(c.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,s)=>{if("string"==typeof s&&"object"==typeof t){const e=s;s=t,t=e}this.log(`key status change "${t}" for keyStatuses keyId: ${$p("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${$p(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,s=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((r,a)=>{const n={responseType:"arraybuffer",url:i},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,i)=>{r(e.data)},onError:(t,s,r,o)=>{a(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:Lp({url:n.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,s,r)=>{a(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:n.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,s)=>{a(new Error("aborted"))}};s.load(n,l,c)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise(((i,r)=>{e.setServerCertificate(s).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${t}"`),i(e)})).catch((e=>{r(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,i=r.length;s<i;s++){var a,n;t=r[s];const i=null==(a=t.querySelector("name"))?void 0:a.textContent,o=null==(n=t.querySelector("value"))?void 0:n.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return yx(atob(l))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)})).catch((a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)})).then((s=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:s||i}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise(((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===n.readyState)if(200===n.status){this._requestLicenseFailureCount=0;let t=n.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,n,a,e)}catch(o){this.error(o)}i(t)}else{const o=s.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||n.status>=400&&n.status<500)r(new JE({type:fp.KEY_SYSTEM_ERROR,details:mp.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:a,data:void 0,code:n.status,text:n.statusText}},`License Request XHR failed (${a}). Status: ${n.status} (${n.statusText})`));else{const s=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${s} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=n,this.setupLicenseXHR(n,a,e,t).then((({xhr:t,licenseChallenge:s})=>{e.keySystem==bx.PLAYREADY&&(s=this.unpackPlayReadyKeyMessage(t,s)),t.send(s)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const s=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Mx.clearKeyUriToKeyIdMap();const i=s.length;XE.CDMCleanupPromise=Promise.all(s.map((e=>this.removeSession(e))).concat(null==e||null==(t=e.setMediaKeys(null))?void 0:t.catch((e=>{var t;this.log(`Could not clear media keys: ${e}`),null==(t=this.hls)||t.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),s.length=0)})).catch((e=>{var t;this.log(`Could not close sessions and clear media keys: ${e}`),null==(t=this.hls)||t.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:r}=this.config,a=function(e){var t;return"persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some((e=>"persistent-license"===e)))}(r)?new Promise(((e,s)=>{self.setTimeout((()=>s(new Error("MediaKeySession.remove() timeout"))),8e3),t.remove().then(e)})):Promise.resolve();return a.catch((e=>{var t;this.log(`Could not remove session: ${e}`),null==(t=this.hls)||t.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})})).then((()=>t.close())).catch((e=>{var t;this.log(`Could not close session: ${e}`),null==(t=this.hls)||t.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})}))}}}XE.CDMCleanupPromise=void 0;class JE extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function QE(e,t){let s;try{s=new Event("addtrack")}catch(Lk){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function ZE(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(Lk){jp.debug(`[texttrack-utils]: ${Lk}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(i){jp.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===s&&(e.mode=s)}function eS(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===s&&(e.mode=s)}function tS(e,t,s,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,s){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let i,r=0,a=s;for(;r<=a;)if(i=Math.floor((a+r)/2),t<e[i].startTime)a=i-1;else{if(!(t>e[i].startTime&&r<s))return i;r=i+1}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(r>-1)for(let a=r,n=e.length;a<n;a++){const r=e[a];if(r.startTime>=t&&r.endTime<=s)i.push(r);else if(r.startTime>s)return i}return i}(e.cues,t,s);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function sS(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[s])}return t}function iS(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()}const rS=.025;let aS=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function nS(e,t,s){return`${e.identifier}-${s+1}-${iS(t)}`}class oS{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;if(e<=0||isNaN(t))return!1;return this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return lS(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-lS(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=dp(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return lS(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<rS))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?aS.Range:aS.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function lS(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<rS)?t.start:t.start+t.duration}function cS(e,t,s){const i=new self.URL(e,s);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function dS(e){const t=e.timelineStart,s=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+s).toFixed(2)}]`}class hS{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const e=this.interstitial.playoutLimit,t=this.currentTime;this.startOffset+t>=e&&this.hls.trigger(gp.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;let a=i.uri;try{a=cS(a,r.sessionId).href}catch(o){}r.loadSource(a);const n=()=>{this.hasDetails=!0};r.once(gp.LEVEL_LOADED,n),r.once(gp.AUDIO_TRACK_LOADED,n),r.once(gp.SUBTITLE_TRACK_LOADED,n),r.on(gp.MEDIA_ATTACHING,((e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&t.addEventListener("timeupdate",this.checkPlayout)}))}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const s=this.timelineOffset,i=sx.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=sx.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,s){this.hls.on(e,t)}once(e,t,s){this.hls.once(e,t)}off(e,t,s){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${dS(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${null!=(t=this.interstitial)&&t.appendInPlace?"append-in-place":""}`}}class uS extends Rp{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((e=>e.reset())),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce(((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s),0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(void 0===t&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&null!=(r=i[s])&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const e=s[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if((null==(s=t[i].event)?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const e=s[r];if(!e.error){const s=e.timelineStart;if(t===s||t>s&&t<s+(e.duration||0))return r}}return 0}get assetIdAtEnd(){var e,t;const s=null==(e=this.items)||null==(t=e[this.length-1])?void 0:t.event;if(s){const e=s.assetList,t=e[e.length-1];if(t)return t.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,a=this.parseDateRanges(i,{url:s.url},t),n=Object.keys(i),o=r?r.filter((e=>!n.includes(e.identifier))):[];a.length&&a.sort(((e,t)=>{const s=e.cue.pre,i=e.cue.post,r=t.cue.pre,a=t.cue.post;if(s&&!r)return-1;if(r&&!s)return 1;if(i&&!a)return 1;if(a&&!i)return-1;if(!(s||r||i||a)){const s=e.startTime,i=t.startTime;if(s!==i)return s-i}return e.dateRange.tagOrder-t.dateRange.tagOrder})),this.events=a,o.forEach((e=>{this.removeEvent(e)})),this.updateSchedule(e,o)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,r=this.parseSchedule(s,e);(t.length||(null==i?void 0:i.length)!==r.length||r.some(((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005)))&&(this.items=r,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const n=r[a],o=e[n];if(o.isInterstitial){let e=this.eventMap[n];e?e.setDateRange(o):(e=new oS(o,t),this.eventMap[n]=e,!1===s&&(e.appendInPlace=s)),i.push(e)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if(e=e.filter((e=>!(e.error||e.cue.once&&e.hasPlayed))),e.length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach(((t,n)=>{const l=t.cue.pre,c=t.cue.post,d=e[n-1]||null,h=t.appendInPlace,u=c?r:t.startOffset,f=t.duration,m=t.timelineOccupancy===aS.Range?f:0,g=t.resumptionOffset,p=(null==d?void 0:d.startTime)===u,y=u+t.cumulativeDuration;let v=h?y+f:u+g;if(l||!c&&u<=0){const e=o;o+=m,t.timelineStart=y;const i=a;a+=f,s.push({event:t,start:y,end:v,playout:{start:i,end:a},integrated:{start:e,end:o}})}else{if(!(u<=r))return;{if(!p){const r=u-i;if(r>.033){const l=i,c=o;o+=r;const d=a;a+=r;const h={previousEvent:e[n-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:d,end:a},integrated:{start:c,end:o}};s.push(h)}else r>0&&d&&(d.cumulativeDuration+=r,s[s.length-1].end=u)}c&&(v=y),t.timelineStart=y;const r=o;o+=m;const l=a;a+=f,s.push({event:t,start:y,end:v,playout:{start:l,end:a},integrated:{start:r,end:o}})}}const x=t.resumeTime;i=c||x>r?r:x})),i<r){var n;const e=i,t=o,l=r-i;o+=l;const c=a;a+=l,s.push({previousEvent:(null==(n=s[s.length-1])?void 0:n.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:c,end:a},integrated:{start:t,end:o}})}this.setDurations(r,a,o)}else{const e=0;s.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,a=-1;e.forEach(((n,o)=>{const l=n.cue.pre,c=n.cue.post,d=l?0:c?i:n.startTime;this.updateAssetDurations(n);if(a===d?n.cumulativeDuration=r:(r=0,a=d),!c&&n.snapOptions.in&&(n.resumeAnchor=yv(null,s.fragments,n.startOffset+n.resumptionOffset,0,0)||void 0),n.appendInPlace&&!n.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(n,t)||(n.appendInPlace=!1)}if(!n.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${n}`))}const h=dp(n.resumeOffset)?n.resumeOffset:n.duration;r+=h}))}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;if(Math.abs(s-i)>rS)return this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1;if(!t)return this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1;return!Object.keys(t).some((i=>{const r=t[i].details,a=r.edge;if(s>=a)return this.log(`"${e.identifier}" resumption ${s} past ${i} playlist end ${a}`),!1;const n=yv(null,r.fragments,s);if(!n)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${i} playlist (${r.fragStart}-${r.fragmentEnd})`),!0;const o="audio"===i?.175:0;return!(Math.abs(n.start-s)<rS+o||Math.abs(n.end-s)<rS+o)&&(this.log(`"${e.identifier}" resumption ${s} not aligned with ${i} fragment bounds (${n.start}-${n.end} sn: ${n.sn} cc: ${n.cc})`),!0)}))}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;e.assetList.forEach(((e,a)=>{const n=t+s;e.startOffset=s,e.timelineStart=n,i||(i=null===e.duration),r||(r=!!e.error);const o=e.error?0:e.duration||0;s+=o})),e.duration=i&&!r?Math.max(s,e.duration):s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function fS(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class mS{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=cS(s,this.hls.sessionId,e.baseUrl)}catch(d){const t=this.assignAssetListError(e,mp.ASSET_LIST_LOAD_ERROR,d,s);return void this.hls.trigger(gp.ERROR,t)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=new(0,r.loader)(r),n={responseType:"json",url:i.href},o=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,s,i,r)=>{const a=t.data,n=null==a?void 0:a.ASSETS;if(Array.isArray(n))e.assetListResponse=a,this.hls.trigger(gp.ASSET_LIST_LOADED,{event:e,assetListResponse:a,networkDetails:r});else{const t=this.assignAssetListError(e,mp.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,s,r);this.hls.trigger(gp.ERROR,t)}},onError:(t,s,i,r)=>{const a=this.assignAssetListError(e,mp.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${s.url})`),s.url,r,i);this.hls.trigger(gp.ERROR,a)},onTimeout:(t,s,i)=>{const r=this.assignAssetListError(e,mp.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${s.url})`),s.url,t,i);this.hls.trigger(gp.ERROR,r)}};return a.load(n,l,c),this.hls.trigger(gp.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,i,r,a){return e.error=s,{type:fp.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:a,stats:r}}}function gS(e,t,s){pS(e,t,s),e.addEventListener(t,s)}function pS(e,t,s){e.removeEventListener(t,s)}function yS(e){null==e||e.play().catch((()=>{}))}class vS{constructor(e){this.buffered=void 0;const t=(t,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][t]};this.buffered={get length(){return e.length},end:s=>t("end",s,e.length),start:s=>t("start",s,e.length)}}}const xS={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},bS=e=>String.fromCharCode(xS[e]||e),wS=15,ES=100,SS={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},TS={17:2,18:4,21:6,22:8,23:10,19:13,20:15},_S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},kS={25:2,26:4,29:6,30:8,31:10,27:13,28:15},AS=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class LS{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s="function"==typeof t?t():t;jp.log(`${this.time} [${e}] ${s}`)}}}const RS=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class PS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class NS{constructor(){this.uchar=" ",this.penState=new PS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class CS{constructor(e){this.chars=[],this.pos=0,this.currPenState=new PS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ES;t++)this.chars.push(new NS);this.logger=e}equals(e){for(let t=0;t<ES;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ES;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ES;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ES&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ES)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=bS(e);this.pos>=ES?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<ES;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<ES;s++){const i=this.chars[s].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class IS{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<wS;t++)this.rows.push(new CS(e));this.logger=e}reset(){for(let e=0;e<wS;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let s=0;s<wS;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<wS;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<wS;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+ov(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<wS;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const i=s.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(s.rows[e+a])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+ov(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<wS;r++){const s=this.rows[r].getTextString();s&&(i=r+1,e?t.push("Row "+i+": '"+s+"'"):t.push(s.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}getTextAndFormat(){return this.rows}}class DS{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new IS(s),this.nonDisplayedMemory=new IS(s),this.lastOutputScreen=new IS(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+ov(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class jS{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new LS;this.channels=[null,new DS(e,t,i),new DS(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const e=127&t[s],i=127&t[s+1];let r=!1,a=null;if(0===e&&0===i)continue;this.logger.log(3,(()=>"["+RS([t[s],t[s+1]])+"] -> ("+RS([e,i])+")"));const n=this.cmdHistory;if(e>=16&&e<=31){if(MS(e,i,n)){OS(null,null,n),this.logger.log(3,(()=>"Repeated command ("+RS([e,i])+") is dropped"));continue}OS(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else OS(null,null,n);if(!r&&(a=this.parseChars(e,i),a)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,(()=>"Couldn't parse cleaned data "+RS([e,i])+" orig: "+RS([t[s],t[s+1]])))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,i=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+RS([e,t])+")")),!0)}return!1}parsePAC(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;s=t>=64&&t<=95?1===i?SS[e]:_S[e]:1===i?TS[e]:kS[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return s=t>95?t-96:t-64,i.underline=!(1&~s),s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((s-16)/2),i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,(()=>"Special char '"+bS(e)+"' in channel "+s)),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,(()=>"Char codes =  "+RS(i).join(","))),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let s;const i={};16===e||24===e?(s=Math.floor((t-32)/2),i.background=AS[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}OS(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function OS(e,t,s){s.a=e,s.b=t}function MS(e,t,s){return s.a===e&&s.b===t}var FS=function(){if(null!=xx&&xx.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function s(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function i(e){return s(t,e)}function r(e,...t){let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const s in t)e[s]=t[s]}return e}function a(t,a,n){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",d=!1,h=t,u=a,f=n,m=null,g="",p=!0,y="auto",v="start",x=50,b="middle",w=50,E="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(t){const i=function(t){return s(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return v},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return x},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");x=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return b},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return E},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class $S{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function US(e){function t(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(i||0)}const s=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?t(s[2],s[3],0,s[4]):t(s[1],s[2],s[3],s[4]):null}class BS{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function VS(e,t,s,i){const r=i?e.split(i):[e];for(const a in r){if("string"!=typeof r[a])continue;const e=r[a].split(s);if(2!==e.length)continue;t(e[0],e[1])}}const GS=new FS(0,0,""),KS="middle"===GS.align?"middle":"center";function HS(e,t,s){const i=e;function r(){const t=US(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),a(),t.endTime=r(),a(),function(e,t){const i=new BS;VS(e,(function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",KS,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",KS,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",KS,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===GS.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",KS);let a=i.get("position","auto");"auto"===a&&50===GS.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function qS(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class WS{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new $S,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function s(){let e=t.buffer,s=0;for(e=qS(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const i=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=s();const i=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=s(),t.state){case"HEADER":/:/.test(e)?VS(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new FS(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{HS(e,t.cue,t.regionList)}catch(i){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const s=-1!==e.indexOf("--\x3e");if(!e||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(i){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const zS=/\r\n|\n\r|\n|\r/g,YS=function(e,t,s=0){return e.slice(s,s+t.length)===t};function XS(e,t,s){return iS(e.toString())+iS(t.toString())+iS(s)}function JS(e,t,s,i,r,a,n){const o=new WS,l=Fp(new Uint8Array(e)).trim().replace(zS,"\n").split("\n"),c=[],d=t?function(e,t=1){return Vw(e,9e4,1/t)}(t.baseTime,t.timescale):0;let h,u="00:00.000",f=0,m=0,g=!0;o.oncue=function(e){const a=s[i];let n=s.ccOffset;const o=(f-d)/9e4;if(null!=a&&a.new&&(void 0!==m?n=s.ccOffset=a.start:function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(a=r)&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s}(s,i,o)),o){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));n=o-s.presentationOffset}const l=e.endTime-e.startTime,u=Yw(9e4*(e.startTime+n-m),9e4*r)/9e4;e.startTime=Math.max(u,0),e.endTime=Math.max(u+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=XS(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?n(h):a(c)},l.forEach((e=>{if(g){if(YS(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((e=>{YS(e,"LOCAL:")?u=e.slice(6):YS(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{m=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(dp(t)&&dp(s)&&dp(i)&&dp(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=6e4*i,t+=36e5*r,t}(u)/1e3}catch(t){h=t}return}""===e&&(g=!1)}o.parse(e+"\n")})),o.flush()}const QS="stpp.ttml.im1t",ZS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,eT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,tT={left:"start",center:"center",right:"end",start:"start",end:"end"};function sT(e,t,s,i){const r=fy(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const a=r.map((e=>Fp(e))),n=function(e,t,s=1,i=!1){return Vw(e,t,1/s,i)}(t.baseTime,1,t.timescale);try{a.forEach((e=>s(function(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),i=s.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e)),{}),n="preserve"!==i.getAttribute("xml:space"),o=rT(iT(i,"styling","style")),l=rT(iT(i,"layout","region")),c=iT(i,"body","[begin]");return[].map.call(c,(e=>{const s=aT(e,n);if(!s||!e.hasAttribute("begin"))return null;const i=lT(e.getAttribute("begin"),a),r=lT(e.getAttribute("dur"),a);let c=lT(e.getAttribute("end"),a);if(null===i)throw oT(e);if(null===c){if(null===r)throw oT(e);c=i+r}const d=new FS(i-t,c-t,s);d.id=XS(d.startTime,d.endTime,d.text);const h=function(e,t,s){const i="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;n&&s.hasOwnProperty(n)&&(r=s[n]);return a.reduce(((s,a)=>{const n=nT(t,i,a)||nT(e,i,a)||nT(r,i,a);return n&&(s[a]=n),s}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:u}=h;if(u){const e=tT[u];e&&(d.lineAlign=e),d.align=u}return kp(d,h),d})).filter((e=>null!==e))}(e,n))))}catch(o){i(o)}}function iT(e,t,s){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(s)):[]}function rT(e){return e.reduce(((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e}),{})}function aT(e,t){return[].slice.call(e.childNodes).reduce(((e,s,i)=>{var r;return"br"===s.nodeName&&i?e+"\n":null!=(r=s.childNodes)&&r.length?aT(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent}),"")}function nT(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function oT(e){return new Error(`Could not parse ttml timestamp ${e}`)}function lT(e,t){if(!e)return null;let s=US(e);return null===s&&(ZS.test(e)?s=function(e,t){const s=ZS.exec(e),i=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+i/t.frameRate}(e,t):eT.test(e)&&(s=function(e,t){const s=eT.exec(e),i=Number(s[1]);switch(s[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}class cT{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function dT(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function hT(e,t){return!!e&&e.kind===dT(t)&&dE(t,e)}const uT=/\s/,fT={newCue(e,t,s,i){const r=[];let a,n,o,l,c;const d=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(a=i.rows[u],o=!0,l=0,c="",!a.isEmpty()){var h;for(let e=0;e<a.chars.length;e++)uT.test(a.chars[e].uchar)&&o?l++:(c+=a.chars[e].uchar,o=!1);a.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const i=qS(c.trim()),f=XS(t,s,i);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(n=new d(t,s,i),n.id=f,n.line=u+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(n))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>ZE(e,t)))),r}};const mT=/(\d+)-(\d+)\/(\d+)/;class gT{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||pT,this.controller=new self.AbortController,this.stats=new Yp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function(e,t){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(kp({},e.headers))};e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return s}(e,this.controller.signal),a="arraybuffer"===e.responseType,n=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=o&&dp(o)?o:l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),t.timeout);(sE(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((s=>{var r;this.response=this.loader=s;const n=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),l-(n-i.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new yT(t||"fetch, bad network response",e,s)}i.loading.first=n,i.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=mT.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(dp(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(s.headers)||i.total;const o=null==(r=this.callbacks)?void 0:r.onProgress;return o&&dp(t.highWaterMark)?this.loadProgressively(s,i,e,t.highWaterMark,o):a?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((s=>{var r,a;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=s[n];l&&(i.loaded=i.total=l);const c={url:o.url,data:s,code:o.status},d=null==(r=this.callbacks)?void 0:r.onProgress;d&&!dp(t.highWaterMark)&&d(i,e,s,o),null==(a=this.callbacks)||a.onSuccess(c,i,e,o)})).catch((t=>{var s;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,a=t?t.message:null;null==(s=this.callbacks)||s.onError({code:r,text:a},e,t?t.details:null,i)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const a=new Cb,n=e.body.getReader(),o=()=>n.read().then((n=>{if(n.done)return a.dataLength&&r(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=n.value,c=l.length;return t.loaded+=c,c<i||a.dataLength?(a.push(l),a.dataLength>=i&&r(t,s,a.flush().buffer,e)):r(t,s,l.buffer,e),o()})).catch((()=>Promise.reject()));return o()}}function pT(e,t){return new self.Request(e.url,t)}class yT extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const vT=/^age:\s*[\d.]+\s*$/im;class xT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Yp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)})).catch((e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)})).then((()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)})).catch((e=>{var r;null==(r=this.callbacks)||r.onError({code:s.status,text:e.message},t,s,i)})):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=s.loadPolicy;if(i)for(const n in i)e.setRequestHeader(n,i[n]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&dp(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var a,n;s.loading.end=Math.max(self.performance.now(),s.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;s.loaded=s.total=o,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first);const l=null==(a=this.callbacks)?void 0:a.onProgress;l&&l(s,e,r,t);const c={url:t.responseURL,data:r,code:i};return void(null==(n=this.callbacks)||n.onSuccess(c,s,e,t))}}const c=r.loadPolicy.errorRetry;var o;if(_v(c,s.retry,!1,{url:e.url,data:void 0,code:i}))this.retry(c);else jp.error(`${i} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,s)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(_v(e,this.stats.retry,!0))this.retry(e);else{var t;jp.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Sv(e,s.retry),s.retry++,jp.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&vT.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const bT=Lp(Lp({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:xT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends Rp{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:s,partCurrent:i,hls:r}=this,{autoLevelEnabled:a,media:n}=r;if(!s||!n)return;const o=performance.now(),l=i?i.stats:s.stats,c=i?i.duration:s.duration,d=o-l.loading.start,h=r.minAutoLevel,u=s.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||u<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const m=f>-1&&f!==u,g=!!e||m;if(!g&&(n.paused||!n.playbackRate||!n.readyState))return;const p=r.mainForwardBufferInfo;if(!g&&null===p)return;const y=this.bwEstimator.getEstimateTTFB(),v=Math.abs(n.playbackRate);if(d<=Math.max(y,c/(2*v)*1e3))return;const x=p?p.len/v:0,b=l.loading.first?l.loading.first-l.loading.start:-1,w=l.loaded&&b>-1,E=this.getBwEstimate(),S=r.levels,T=S[u],_=Math.max(l.loaded,Math.round(c*(s.bitrate||T.averageBitrate)/8));let k=w?d-b:d;k<1&&w&&(k=Math.min(d,8*l.loaded/E));const A=w?1e3*l.loaded/k:0,L=y/1e3,R=A?(_-l.loaded)/A:8*_/E+L;if(R<=x)return;const P=A?8*A:E,N=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),C=this.hls.config.abrBandWidthUpFactor;let I,D=Number.POSITIVE_INFINITY;for(I=u-1;I>h;I--){const e=S[I].maxBitrate,t=!S[I].details||N;if(D=this.getTimeToLoadFrag(L,P,c*e,t),D<Math.min(x,c+L))break}if(D>=R)return;if(D>10*c)return;w?this.bwEstimator.sample(d-Math.min(y,b),l.loaded):this.bwEstimator.sampleTTFB(d);const j=S[I].maxBitrate;this.getBwEstimate()*C>j&&this.resetEstimator(j);const O=this.findBestLevel(j,h,I,0,x,1,1);O>-1&&(I=O),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${u} is loading too slowly;\n      Fragment duration: ${s.duration.toFixed(3)}\n      Time to underbuffer: ${x.toFixed(3)} s\n      Estimated load time for current fragment: ${R.toFixed(3)} s\n      Estimated load time for down switch fragment: ${D.toFixed(3)} s\n      TTFB estimate: ${0|b} ms\n      Current BW estimate: ${dp(E)?0|E:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${I} @ ${0|j} bps`),r.nextLoadLevel=r.nextAutoLevel=I,this.clearTimer();const M=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===I&&I>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${I>0?"and switching down":""}\n      Fragment duration: ${s.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,I>h){let t=this.findBestLevel(this.hls.levels[h].bitrate,h,I,0,e,1,1);-1===t&&(t=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};m||R>2*D?M():this.timer=self.setInterval(M,1e3*D),r.trigger(gp.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Tp(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.FRAG_LOADING,this.onFragLoading,this),e.on(gp.FRAG_LOADED,this.onFragLoaded,this),e.on(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.on(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.on(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(gp.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.FRAG_LOADING,this.onFragLoading,this),e.off(gp.FRAG_LOADED,this.onFragLoaded,this),e.off(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.off(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.off(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(gp.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(gp.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){var i;if(!s.bitrateTest)this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case mp.BUFFER_ADD_CODEC_ERROR:case mp.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case mp.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:s,partCurrent:i}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=i?i.stats:e.stats,r=t-s.loading.start,a=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&a>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,a),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,s,i){return e+s/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;dp(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===bp&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=s?s.duration:t.duration,r=this.hls.levels[t.level],a=(r.loaded?r.loaded.bytes:0)+i.loaded,n=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:a,duration:n},r.realBitrate=Math.round(8*a/n)}if(t.bitrateTest){const e={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(gp.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==bp||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,n=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${n}`),n}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&s&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=s,n=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,a,i,l,0,c,d);if(e>=0)return this.rebufferNotice=-1,e}let h=n?Math.min(n,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){h=(n?Math.min(n,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1}}const u=this.findBestLevel(o,a,i,l,h,c,d);if(this.rebufferNotice!==u&&(this.rebufferNotice=u,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${u}`)),u>-1)return u;const f=s.levels[a],m=s.loadLevelObj;return m&&(null==f?void 0:f.bitrate)<m.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,a,n){var o;const l=i+r,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:u}=this,{levels:f,allAudioTracks:m,loadLevel:g,config:p}=this.hls;if(1===f.length)return 0;const y=f[d],v=!(null==(o=this.hls.latestLevelDetails)||!o.live),x=-1===g||-1===c;let b,w="SDR",E=(null==y?void 0:y.frameRate)||0;const{audioPreference:S,videoPreference:T}=p,_=this.audioTracksByGroup||(this.audioTracksByGroup=cv(m));let k=-1;if(x){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(e,t,s,i){return e.slice(s,i+1).reduce(((e,s,i)=>{if(!s.codecSet)return e;const r=s.audioGroups;let a=e[s.codecSet];a||(e[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const n=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,n),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.minIndex=Math.min(a.minIndex,i),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,r&&r.forEach((e=>{if(!e)return;const s=t.groups[e];s&&(a.hasDefaultAudio=a.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach((e=>{a.channels[e]=(a.channels[e]||0)+s.channels[e]})))})),e}),{})}(f,_,t,s)),r=function(e,t,s,i,r){const a=Object.keys(e),n=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,c=n&&2===parseInt(n);let d=!1,h=!1,u=1/0,f=1/0,m=1/0,g=1/0,p=0,y=[];const{preferHDR:v,allowedVideoRanges:x}=nv(t,r);for(let S=a.length;S--;){const t=e[a[S]];d||(d=t.channels[2]>0),u=Math.min(u,t.minHeight),f=Math.min(f,t.minFramerate),m=Math.min(m,t.minBitrate),x.filter((e=>t.videoRanges[e]>0)).length>0&&(h=!0)}u=dp(u)?u:0,f=dp(f)?f:0;const b=Math.max(1080,u),w=Math.max(30,f);m=dp(m)?m:s,s=Math.max(m,s),h||(t=void 0);const E=a.length>1;return{codecSet:a.reduce(((t,i)=>{const r=e[i];if(i===t)return t;if(y=h?x.filter((e=>r.videoRanges[e]>0)):[],E){if(r.minBitrate>s)return lv(i,`min bitrate of ${r.minBitrate} > current estimate of ${s}`),t;if(!r.hasDefaultAudio)return lv(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return lv(i,`audio codec preference "${o}" not found`),t;if(n&&!c){if(!r.channels[n])return lv(i,`no renditions with ${n} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||c)&&d&&0===r.channels[2])return lv(i,"no renditions with stereo sound found"),t;if(r.minHeight>b)return lv(i,`min resolution of ${r.minHeight} > maximum of ${b}`),t;if(r.minFramerate>w)return lv(i,`min framerate of ${r.minFramerate} > maximum of ${w}`),t;if(!y.some((e=>r.videoRanges[e]>0)))return lv(i,`no variants with VIDEO-RANGE of ${ov(y)} found`),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return lv(i,`video codec preference "${l}" not found`),t;if(r.maxScore<p)return lv(i,`max score of ${r.maxScore} < selected max of ${p}`),t}return t&&(Fy(i)>=Fy(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,p=r.maxScore,i)}),void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:m,minIndex:g}}(i,w,e,S,T),{codecSet:a,videoRanges:n,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:d}=r;k=c,b=a,w=d?n[n.length-1]:n[0],E=o,e=Math.max(e,l),this.log(`picked start tier ${ov(r)}`)}else b=null==y?void 0:y.codecSet,w=null==y?void 0:y.videoRange;const A=u?u.duration:h?h.duration:0,L=this.bwEstimator.getEstimateTTFB()/1e3,R=[];for(let N=s;N>=t;N--){var P;const t=f[N],o=N>d;if(!t)continue;if(p.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"==typeof(null==s?void 0:s.decodingInfo)&&(Yy(t,_,w,E,e,S)||_y(t.videoCodec))?(t.supportedPromise=Xy(t,_,s),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,i=s.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${ov(e)}`):e.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${i} ${ov(e)}`),i>-1&&s.length>1&&(this.log(`Removing unsupported level ${i}`),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}))):t.supportedResult=qy}if((b&&t.codecSet!==b||w&&t.videoRange!==w||o&&E>t.frameRate||!o&&E>0&&E<t.frameRate||t.supportedResult&&(null==(P=t.supportedResult.decodingInfoResults)||!P[0].smooth))&&(!x||N!==k)){R.push(N);continue}const h=t.details,m=(u?null==h?void 0:h.partTarget:null==h?void 0:h.averagetargetduration)||A;let y;y=o?n*e:a*e;const T=A&&i>=2*A&&0===r?t.averageBitrate:t.maxBitrate,C=this.getTimeToLoadFrag(L,y,T*m,void 0===h);if(y>=T&&(N===c||0===t.loadError&&0===t.fragmentError)&&(C<=L||!dp(C)||v&&!this.bitrateTestDelay||C<l)){const e=this.forcedAutoLevel;return N===g||-1!==e&&e===g||(R.length&&this.trace(`Skipped level(s) ${R.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${f[R[0]].codecs}" ${f[R[0]].videoRange}; not compatible with "${b}" ${w}`),this.info(`switch candidate:${d}->${N} adjustedbw(${Math.round(y)})-bitrate=${Math.round(y-T)} ttfb:${L.toFixed(1)} avgDuration:${m.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${C.toFixed(1)} firstSelection:${x} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${g}`)),x&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}},bufferController:class extends Rp{constructor(e,t){var s;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:s}=this;e&&this.log("Media source opened"),t&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(gp.MEDIA_ATTACHED,{media:t,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(s=Op(e.config.preferManagedMediaSource),"undefined"!=typeof self&&s===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.BUFFER_RESET,this.onBufferReset,this),e.on(gp.BUFFER_APPENDING,this.onBufferAppending,this),e.on(gp.BUFFER_CODECS,this.onBufferCodecs,this),e.on(gp.BUFFER_EOS,this.onBufferEos,this),e.on(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(gp.FRAG_PARSED,this.onFragParsed,this),e.on(gp.FRAG_CHANGED,this.onFragChanged,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.BUFFER_RESET,this.onBufferReset,this),e.off(gp.BUFFER_APPENDING,this.onBufferAppending,this),e.off(gp.BUFFER_CODECS,this.onBufferCodecs,this),e.off(gp.BUFFER_EOS,this.onBufferEos,this),e.off(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(gp.FRAG_PARSED,this.onFragParsed,this),e.off(gp.FRAG_CHANGED,this.onFragChanged,this),e.off(gp.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?kp(s,i.tracks):this.sourceBuffers.forEach((e=>{const[t]=e;t&&(s[t]=kp({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null})),{media:e,mediaSource:t,tracks:s}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(s=this.transferData)&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media,i=Op(this.appendSource);if(this.transferData=this.overrides=void 0,s&&i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),e)this._objectUrl=s.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const t=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||t&&a instanceof t,gE(s),function(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,e),s.load()}catch(r){s.src=e}else s.src=e}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(s=e.constructor)?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,n=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&r&&a){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${ov(s,((e,t)=>"initSegment"===e?void 0:t))};\ntransfer tracks: ${ov(i,((e,t)=>"initSegment"===e?void 0:t))}}`),!Mp(i,s)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,a=this.details,n=Math.max(r,(null==a?void 0:a.fragments[0].start)||0);return n-r>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${r} -> ${n}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${n} currentTime: ${r}`),this.onMediaDetaching(gp.MEDIA_DETACHING,{}),this.onMediaAttaching(gp.MEDIA_ATTACHING,t),void(e.currentTime=n))}this.transferData=void 0,r.forEach((e=>{const t=e,s=i[t];if(s){const e=s.buffer;if(e){const i=this.fragmentTracker,r=s.id;if(i.hasFragments(r)||i.hasParts(r)){const s=sx.getBuffered(e);i.detectEvictedFragments(t,s,r,null,!0)}const a=pE(t),n=[t,e];this.sourceBuffers[a]=n,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,s)}}})),n(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),n()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach((([e])=>{e&&this.removeBuffer(e)})),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let s=t.length;s--;)e&&t[s].abort(),r.removeSourceBuffer(t[s]);e&&r.endOfStream()}catch(Lk){this.warn(`onMediaDetaching: ${Lk.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&gE(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(gp.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach((([e])=>{e&&this.resetBuffer(e)})),this.initTracks()}resetBuffer(e){var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(Lk){this.warn(`onBufferReset ${e}`,Lk)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[pE(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new hE(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!r&&this.sourceBufferCount&&this.media&&i.some((e=>!s[e]));r||a?this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`):(i.forEach((e=>{var i,r,a;const n=t[e],{id:o,codec:l,levelCodec:c,container:d,metadata:h,supplemental:u}=n;let f=s[e];const m=null==(i=this.transferData)||null==(r=i.tracks)?void 0:r[e],g=null!=m&&m.buffer?m:f,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),y=null==g?void 0:g.levelCodec;f||(f=s[e]={buffer:void 0,listeners:[],codec:l,supplemental:u,container:d,levelCodec:c,metadata:h,id:o});const v=Vy(p,y),x=null==v?void 0:v.replace(uE,"$1");let b=Vy(l,c);const w=null==(a=b)?void 0:a.replace(uE,"$1");b&&v&&x!==w&&("audio"===e.slice(0,5)&&(b=By(b,this.appendSource)),this.log(`switching codec ${p} to ${b}`),b!==(f.pendingCodec||f.codec)&&(f.pendingCodec=b),f.container=d,this.appendChangeType(e,d,b))})),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce(((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e}),{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const r=this.tracks[e];if(r){const a=r.buffer;null!=a&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),a.changeType(i),r.codec=s,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(s,bp))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&sx.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,bp))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:a,frag:n,part:o,chunkMeta:l}=t,c=l.buffering[r],d=n.sn,h=self.performance.now();c.start=h;const u=n.stats.buffering,f=o?o.stats.buffering:null;0===u.start&&(u.start=h),f&&0===f.start&&(f.start=h);const m=s.audio;let g=!1;"audio"===r&&"audio/mpeg"===(null==m?void 0:m.container)&&(g=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const p=this.tracks.video,y=null==p?void 0:p.buffer;if(y&&"initSegment"!==d){const e=o||n,t=this.blockedAudioAppend;if("audio"!==r||"main"===a||this.blockedAudioAppend){if("video"===r){const s=e.end;if(t){const e=t.frag.start;(s>e||s<this.lastVideoAppendEnd||sx.isBuffered(y,e))&&this.unblockAudio()}this.lastVideoAppendEnd=s}}else{const t=e.start+.05*e.duration,s=y.buffered,i=this.currentOp("video");s.length||i?!i&&!sx.isBuffered(y,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const v=(o||n).start,x={label:`append-${r}`,execute:()=>{if(c.executeStart=self.performance.now(),g){const e=this.tracks[r];if(e){const t=e.buffer;if(t){const e=v-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${v} (delta: ${e}) sn: ${d})`),t.timestampOffset=v)}}}this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===u.first&&(u.first=e),f&&0===f.first&&(f.first=e);const t={};this.sourceBuffers.forEach((([e,s])=>{e&&(t[e]=sx.getBuffered(s))})),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(gp.BUFFER_APPENDED,{type:r,frag:n,part:o,chunkMeta:l,parent:n.type,timeRanges:t})},onError:e=>{var t;const s={type:fp.MEDIA_ERROR,parent:n.type,details:mp.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:n,part:o,chunkMeta:l,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR)s.details=mp.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)s.errorAction=Iv(!0);else if(e.name===fE&&0===this.sourceBufferCount)s.errorAction=Iv(!0);else{const e=++this.appendErrors[r];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${i||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||i)&&(s.fatal=!0)}this.hls.trigger(gp.ERROR,s)}};this.append(x,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(gp.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach((([e])=>{e&&this.append(this.getFlushOp(e,i,r),e)}))}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],a=i?i.elementaryStreams:s.elementaryStreams;a[Qp]?r.push("audiovideo"):(a[Xp]&&r.push("audio"),a[Jp]&&r.push("video"));0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers((()=>{const e=self.performance.now();s.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:s.stats;this.hls.trigger(gp.FRAG_BUFFERED,{frag:s,part:i,stats:t,id:s.type})}),r).catch((e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}))}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t,s;return e&&(!(null!=(t=this.tracks[e])&&t.ended)||(null==(s=this.tracks[e])?void 0:s.ending))}))}onBufferEos(e,t){var s;this.sourceBuffers.forEach((([e])=>{if(e){const s=this.tracks[e];t.type&&t.type!==e||(s.ending=!0,s.ended||(s.ended=!0,this.log(`${e} buffer reached EOS`)))}}));const i=!1!==(null==(s=this.overrides)?void 0:s.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)}))&&(i?(this.log("Queueing EOS"),this.blockUntilOpen((()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(gp.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))):(this.tracksEnded(),this.hls.trigger(gp.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach((([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen((()=>this.updateMediaSource(e)))}onError(e,t){if(t.details===mp.BUFFER_APPEND_ERROR&&t.frag){var s;const e=null==(s=t.errorAction)?void 0:s.nextAutoLevel;dp(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||null===t)return;if(!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,a=t.levelTargetDuration,n=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(dp(n)&&n>=0){const e=Math.max(n,a),t=Math.floor(r/a)*a-e;this.flushBackBuffer(r,a,t)}if(dp(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const e=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),t=Math.max(e,a),s=Math.floor(r/a)*a+t;this.flushFrontBuffer(r,a,s)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach((([e,t])=>{if(t){const r=sx.getBuffered(t);if(r.length>0&&s>r.start(0)){var i;this.hls.trigger(gp.BACK_BUFFER_REACHED,{bufferEnd:s});const t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(gp.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(gp.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:e})}}}))}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach((([t,i])=>{if(i){const r=sx.getBuffered(i),a=r.length;if(a<2)return;const n=r.start(a-1),o=r.end(a-1);if(s>n||e>=n&&e<=o)return;this.hls.trigger(gp.BUFFER_FLUSHING,{startOffset:n,endOffset:1/0,type:t})}}))}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||"open"!==(null==s?void 0:s.readyState))return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&s.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,i)}}return{duration:1/0}}const r=null==(e=this.overrides)?void 0:e.duration;if(r)return dp(r)?{duration:r}:null;const a=this.media.duration;return i>(dp(s.duration)?s.duration:0)&&i>a||!dp(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==e&&(dp(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),void 0!==t&&void 0!==s&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ov(s)}`),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach((([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}})),this.hls.trigger(gp.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach((([e])=>{this.executeNext(e)}))}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const n=a,o=e[n];if(this.isPending(o)){const e=this.getTrackCodec(o,n),a=`${o.container};codecs=${e}`;o.codec=e,this.log(`creating sourceBuffer(${a})${this.currentOp(n)?" Queued":""} ${ov(o)}`);try{const e=s.addSourceBuffer(a),i=pE(n),r=[n,e];t[i]=r,o.buffer=e}catch(r){var i;return this.error(`error while trying to add sourceBuffer: ${r.message}`),this.shiftAndExecuteNext(n),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[n],void this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,sourceBufferName:n,mimeType:a,parent:o.id})}this.trackSourceBuffer(n,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&("video"===t||"audiovideo"===t)&&Dy(s,"video")&&(i=function(e,t){const s=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)Iy(t[e],"video")||s.push(t[e])}return t&&s.push(t),s.join(",")}(i,s));const r=Vy(i,e.levelCodec);return r?"audio"===t.slice(0,5)?By(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",((e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(gp.BUFFER_FLUSHED,{type:e})}))}get mediaSrc(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(s=this.mediaSource)?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,a=this.tracks[e],n=null==a?void 0:a.buffer;if(!i||!r||!n)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=dp(i.duration)?i.duration:1/0,l=dp(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(s,o,l);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),n.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=null==s?void 0:s.buffer;if(!i)throw new mE(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch((e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}));else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some((([e,t])=>e&&t.updating))}isQueued(){return this.sourceBuffers.some((([e])=>e&&!!this.currentOp(e)))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map((e=>this.appendBlocker(e)));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then((t=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))}))}stepOperationQueue(e){e.forEach((e=>{var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;s&&!s.updating&&this.shiftAndExecuteNext(e)}))}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce(((e,t)=>e+(this.isPending(this.tracks[t])?1:0)),0)}get sourceBufferCount(){return this.sourceBuffers.reduce(((e,[t])=>e+(t?1:0)),0)}get sourceBufferTypes(){return this.sourceBuffers.map((([e])=>e)).filter((e=>!!e))}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=s.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach((e=>{s.removeEventListener(e.event,e.listener)})),t.listeners.length=0)}},capLevelController:yE,errorController:class extends Rp{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(gp.ERROR,this.onError,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(gp.ERROR,this.onError,this),e.off(gp.ERROR,this.onErrorOut,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===bp?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case mp.FRAG_LOAD_ERROR:case mp.FRAG_LOAD_TIMEOUT:case mp.KEY_LOAD_ERROR:case mp.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case mp.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction=Iv());case mp.FRAG_GAP:case mp.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Av);case mp.LEVEL_EMPTY_ERROR:case mp.LEVEL_PARSING_ERROR:{var a,n;const e=t.parent===bp?t.level:i.loadLevel;t.details===mp.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(n=a.levelDetails)&&n.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case mp.LEVEL_LOAD_ERROR:case mp.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case mp.AUDIO_TRACK_LOAD_ERROR:case mp.AUDIO_TRACK_LOAD_TIMEOUT:case mp.SUBTITLE_LOAD_ERROR:case mp.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===vp&&e.hasAudioGroup(r.groupId)||r.type===xp&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Av,void(t.errorAction.flags=Nv)}return;case mp.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.loadLevelObj,s=null==e?void 0:e.attrs["HDCP-LEVEL"];s?t.errorAction={action:Av,flags:Cv,hdcpLevel:s}:this.keySystemError(t)}return;case mp.BUFFER_ADD_CODEC_ERROR:case mp.REMUX_ALLOC_ERROR:case mp.BUFFER_APPEND_ERROR:var o;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(o=t.level)?o:i.loadLevel);return;case mp.INTERNAL_EXCEPTION:case mp.BUFFER_APPENDING_ERROR:case mp.BUFFER_FULL_ERROR:case mp.LEVEL_SWITCH_ERROR:case mp.BUFFER_STALLED_ERROR:case mp.BUFFER_SEEK_OVER_HOLE:case mp.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=Iv())}t.type===fp.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=Ev(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(_v(s,i,wv(e),e.response))return{action:Rv,flags:Pv,retryConfig:s,retryCount:i};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,n=Ev(e.details.startsWith("key")?a:r,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i){e.details!==mp.FRAG_GAP&&i.fragmentError++;if(_v(n,o,wv(e),e.response))return{action:Rv,flags:Pv,retryConfig:n,retryCount:o}}const l=this.getLevelSwitchAction(e,s);return n&&(l.retryConfig=n,l.retryCount=o),l}getLevelSwitchAction(e,t){const s=this.hls;null==t&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const t=e.details;i.loadError++,t===mp.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:c,loadLevel:d,minAutoLevel:h,maxAutoLevel:u}=s;s.autoLevelEnabled||(s.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,m=(f===wp&&t===mp.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===mp.BUFFER_ADD_CODEC_ERROR||t===mp.BUFFER_APPEND_ERROR))&&c.some((({audioCodec:e})=>i.audioCodec!==e)),g="video"===e.sourceBufferName&&(t===mp.BUFFER_ADD_CODEC_ERROR||t===mp.BUFFER_APPEND_ERROR)&&c.some((({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t)),{type:p,groupId:y}=null!=(a=e.context)?a:{};for(let s=c.length;s--;){const r=(s+d)%c.length;if(r!==d&&r>=h&&r<=u&&0===c[r].loadError){var n,o;const s=c[r];if(t===mp.FRAG_GAP&&f===bp&&e.frag){const t=c[r].details;if(t){const s=yv(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(p===vp&&s.hasAudioGroup(y)||p===xp&&s.hasSubtitleGroup(y))continue;if(f===wp&&null!=(n=i.audioGroups)&&n.some((e=>s.hasAudioGroup(e)))||f===Ep&&null!=(o=i.subtitleGroups)&&o.some((e=>s.hasSubtitleGroup(e)))||m&&i.audioCodec===s.audioCodec||!m&&i.audioCodec!==s.audioCodec||g&&i.codecSet===s.codecSet)continue}l=r;break}}if(l>-1&&s.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:Av,flags:Pv,nextAutoLevel:l}}return{action:Av,flags:Nv}}onErrorOut(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case kv:break;case Av:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===mp.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i,hdcpLevel:r,nextAutoLevel:a}=s;switch(i){case Pv:this.switchLevel(e,a);break;case Cv:r&&(t.maxHdcpLevel=Jy[Jy.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}s.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===mp.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=Hy(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===t&&this.hls.removeLevel(i)}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,n=1e3*r/e,o=this.hls;if(o.trigger(gp.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:s}),n>0&&r>o.config.fpsDroppedMonitoringThreshold*a){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(gp.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ix,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:fT,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Pb{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Ep),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.on(gp.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(gp.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(gp.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(gp.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(gp.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.off(gp.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(gp.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(gp.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(gp.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(gp.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=xb,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(ey(s)&&(this.fragPrevious=s),this.state=xb,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const n=s.start;for(let l=0;l<r.length;l++)if(n>=r[l].start&&n<=r[l].end){a=r[l];break}const o=s.start+s.duration;a?a.end=o:(a={start:n,end:o},r.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(0===s&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}})),this.fragmentTracker.removeFragmentsInRange(s,e,Ep)}}onError(e,t){const s=t.frag;(null==s?void 0:s.type)===Ep&&(t.details===mp.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==vb&&(this.state=xb))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&lE(this.levels,t)?this.levels=t.map((e=>new rv(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new rv(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ep),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==vb&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:a,id:n}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${n}`);const o=r[n];if(n>=r.length||!o)return;this.log(`Subtitle track ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(s=o.details)&&s.live){const e=this.mainDetails;if(a.deltaUpdateFailed||!e)return;const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(a,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,nb(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(pb(a,e),l=a.fragmentStart):t&&(l=t.start,nb(a,l))}if(o.details=a,this.levelLastLoaded=o,n===i&&(this.hls.trigger(gp.SUBTITLE_TRACK_UPDATED,{details:a,id:n,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===xb)){yv(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=i&&i.key&&i.iv&&mx(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,gx(i.method)).catch((e=>{throw r.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((s=>{const i=performance.now();r.trigger(gp.FRAG_DECRYPTED,{frag:t,payload:s,stats:{tstart:e,tdecrypt:i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=xb}))}}doTick(){if(this.media){if(this.state===xb){const{currentTrackId:e,levels:t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;if(this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),a=sx.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:n,len:o}=a,l=s.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,d=c.length,h=l.edge;let u=null;const f=this.fragPrevious;if(n<h){const e=i.maxFragLookUpTolerance,t=n>h-e?0:e;u=yv(f,c,Math.max(c[0].start,n),t),!u&&f&&f.start<c[0].start&&(u=c[0])}else u=c[d-1];if(u=this.filterReplacedPrimary(u,s.details),!u)return;const m=c[u.sn-l.startSN-1];if(m&&m.cc===u.cc&&this.fragmentTracker.getState(m)===Dv&&(u=m),this.fragmentTracker.getState(u)===Dv){const e=this.mapToInitFragWhenRequired(u);e&&this.loadFragment(e,s,n)}}}else this.state=xb}loadFragment(e,t,s){ey(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new vS(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends oE{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=sS(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.LEVEL_LOADING,this.onLevelLoading,this),e.on(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(gp.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.LEVEL_LOADING,this.onLevelLoading,this),e.off(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(gp.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(gp.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;sS(s.textTracks).forEach((e=>{eS(e)}))}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i)return void this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const n=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=hv(t,e);if(s>-1)r=e[s];else{const e=hv(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==s?void 0:s.join(",")}" group-id`),this.hls.trigger(gp.SUBTITLE_TRACKS_UPDATED,a),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!s||r.default)&&(s||e)&&(!e||uv(r,e)))return i}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(cE(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(cE(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){if(dE(t[s],e))return s}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==xp||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&uv(e,s))return s;const i=hv(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(s)return null;{const s=hv(e,t);if(s>-1)return t[s]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,n=null==a?void 0:a.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(gp.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=sS(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter((e=>dE(s,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!dp(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(gp.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:n="",name:o,type:l,url:c}=i;this.hls.trigger(gp.SUBTITLE_TRACK_SWITCH,{id:a,groupId:n,name:o,type:l,url:c});const d=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(d)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(gp.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(gp.FRAG_LOADING,this.onFragLoading,this),e.on(gp.FRAG_LOADED,this.onFragLoaded,this),e.on(gp.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(gp.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(gp.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(gp.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(gp.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(gp.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(gp.FRAG_LOADING,this.onFragLoading,this),e.off(gp.FRAG_LOADED,this.onFragLoaded,this),e.off(gp.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(gp.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(gp.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(gp.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new cT(this,"textTrack1"),t=new cT(this,"textTrack2"),s=new cT(this,"textTrack3"),i=new cT(this,"textTrack4");this.cea608Parser1=new jS(1,e,t),this.cea608Parser2=new jS(3,s,i)}addCues(e,t,s,i,r){let a=!1;for(let d=r.length;d--;){const e=r[d],i=(n=e[0],o=e[1],l=t,c=s,Math.min(o,c)-Math.max(n,l));if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],s),a=!0,i/(s-t)>.5))return}var n,o,l,c;if(a||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,i)}else{const r=this.Cues.newCue(null,t,s,i);this.hls.trigger(gp.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){const{unparsedVttFrags:a}=this;s===bp&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),a.length&&(this.unparsedVttFrags=[],a.forEach((e=>{this.onFragLoaded(gp.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(hT(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:a}=t[e],n=this.getExistingTrack(r,a);if(n)s[e]=n,eS(s[e]),QE(s[e],i);else{const t=this.createTextTrack("captions",r,a);t&&(t[e]=!0,s[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(gp.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach((e=>{eS(i[e]),delete i[e]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)eS(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some((e=>e.textCodec===QS));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(lE(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?sS(e.textTracks):null;if(this.tracks.forEach(((e,s)=>{let i;if(t){let s=null;for(let i=0;i<t.length;i++)if(t[i]&&hT(t[i],e)){s=t[i],t[i]=null;break}s&&(i=s)}if(i)eS(i);else{const t=dT(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(gp.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s=`textTrack${t[1]}`,i=this.captionsProperties[s];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===bp){var s,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:a}=this,{cc:n,sn:o}=t.frag,l=null!=(s=null==(i=t.part)?void 0:i.index)?s:-1;e&&r&&(o!==a+1||o===a&&l!==this.lastPartIndex+1||n!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=n,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===Ep)if(i.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),e&&e.textCodec===QS?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(gp.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;sT(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),s.trigger(gp.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{s.logger.log(`Failed to parse IMSC1: ${t}`),s.trigger(gp.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,n=r.length-1;if(!r[s.cc]&&-1===n)return void a.push(e);const o=this.hls;JS(null!=(t=s.initSegment)&&t.data?Sy(s.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,(e=>{this._appendCues(e,s.level),o.trigger(gp.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?a.push(e):this._fallbackToIMSC1(s,i),o.logger.log(`Failed to parse VTT cue: ${t}`),r&&n>s.cc||o.trigger(gp.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:t})}))}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||sT(t,this.initPTS[e.cc],(()=>{s.textCodec=QS,this._parseIMSC1(e,t)}),(()=>{s.textCodec="wvtt"}))}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach((e=>ZE(s,e)))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(gp.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Ep&&this.onFragLoaded(gp.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(s.type!==bp||"NONE"!==this.closedCaptionsForLevel(s))for(let r=0;r<i.length;r++){const e=i[r].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(i[r].pts,t[0]),this.cea608Parser2.addData(i[r].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(a&&!(a.currentTime<s)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach((i=>tS(e[i],t,s)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach((s=>tS(e[s],t,i)))}}}extractCea608Data(e){const t=[[],[]],s=31&e[0];let i=2;for(let r=0;r<s;r++){const s=e[i++],r=127&e[i++],a=127&e[i++];if(0===r&&0===a)continue;if(!!(4&s)){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(a))}}return t}},audioStreamController:class extends Pb{constructor(e,t,s){super(e,t,s,"audio-stream-controller",wp),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.on(gp.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(gp.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(gp.BUFFER_RESET,this.onBufferReset,this),e.on(gp.BUFFER_CREATED,this.onBufferCreated,this),e.on(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(gp.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(gp.FRAG_LOADING,this.onFragLoading,this),e.on(gp.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.off(gp.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(gp.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(gp.BUFFER_RESET,this.onBufferReset,this),e.off(gp.BUFFER_CREATED,this.onBufferCreated,this),e.off(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(gp.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(gp.FRAG_LOADING,this.onFragLoading,this),e.off(gp.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){if(s===bp){const e=t.cc,s=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}/${r}`),this.mainAnchor=t,this.state===Lb){const s=this.waitingData;(!s&&!this.loadingParts||s&&s.frag.cc!==e)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&s&&s.cc!==e?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,s.abortRequests(),this.resetLoadingState()):this.state===xb&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),s=e.cc;return function(e,t,s){if(e&&e.startCC<=t&&e.endCC>=t){const i=s.start,r=s.end;let a=e.fragments;if(!s.relurl){const{fragmentHint:t}=e;t&&(a=a.concat(t))}return pv(a,(e=>e.cc<t||e.end<=i?1:e.cc>t||e.start>=r?-1:0))}return null}(t,s,e)||t&&bv(t.fragments,s)||e}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=vb);const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),s>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=xb):this.state=Sb,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case xb:this.doTickIdle();break;case Sb:{const{levels:e,trackId:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=Lb}break}case Eb:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=xb}break}case Lb:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,a=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=wb;const e={frag:t,part:s,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else a&&a.cc!==e.frag.cc&&(this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${a.cc}`),this.nextLoadPosition=this.findSyncFrag(a).start,this.clearWaitingFragment())}else this.state=xb}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==vb&&(this.state=xb))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||null==s||!s[r])return;const n=s[r],o=n.details;if(!o||this.waitForLive(n)||this.waitForCdnTuneIn(o))return this.state=Sb,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Xp,wp));const c=this.getFwdBufferInfo(l,wp);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(gp.BUFFER_EOS,{type:"audio"}),void(this.state=kb);const d=c.len,h=t.maxBufferLength,u=o.fragments,f=u[0].start,m=this.getLoadPosition(),g=this.flushing?m:c.end;if(this.switchingTrack&&i){const e=m;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05)}if(d>=h&&!this.switchingTrack&&g<u[u.length-1].start)return;let p=this.getNextFragment(g,o);if(p&&this.isLoopLoading(p,g)&&(p=this.getNextFragmentLoopLoading(p,o,c,bp,h)),!p)return void(this.bufferFlushed=!0);let y=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&ey(p)&&!p.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===Mv&&(this.mainFragLoading=y=null),y&&ey(y))){if(p.start>y.end){const e=this.fragmentTracker.getFragAtPos(g,bp);e&&e.end>y.end&&(y=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(p.start>y.end)return}this.loadFragment(p,n,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new rv(e)))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==vb&&(this.setInterval(100),this.state=xb,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(gp.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:a,groupId:n,track:o}=t;if(!i)return void this.warn(`Audio tracks reset while loading track ${a} "${o.name}" of "${n}"`);const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==vb&&(this.state=Sb));this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${o.name}" of "${n}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const c=i[a];let d=0;if(r.live||null!=(s=c.details)&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var h;if(c.details)d=this.alignPlaylists(r,c.details,null==(h=this.levelLastLoaded)?void 0:h.details);r.alignedSliding||(gb(r,l),r.alignedSliding||pb(r,l),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(gp.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state!==Sb||this.waitForCdnTuneIn(r)||(this.state=xb),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:a,trackId:n,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const l=o[n];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const d=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new nE(this.hls,wp,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[s.cc],f=null==(t=s.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=i?i.index:-1,a=-1!==t,n=new ex(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,a);h.push(r,f,d,"",s,i,c.totalduration,e,n,u)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${c.startSN} ,${c.endSN}],track ${n}`);const{cache:e}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new Cb,complete:!1};e.push(new Uint8Array(r)),this.state!==vb&&(this.state=Lb)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===bp&&ey(t.frag)&&(this.mainFragLoading=t,this.state===xb&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type===wp)if(this.fragContextChanged(s))this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(ey(s)){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(gp.AUDIO_TRACK_SWITCHED,Lp({},e)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}else this.audioOnly||s.type!==bp||s.elementaryStreams.video||s.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var s;if(t.fatal)this.state=Ab;else switch(t.details){case mp.FRAG_GAP:case mp.FRAG_PARSING_ERROR:case mp.FRAG_DECRYPT_ERROR:case mp.FRAG_LOAD_ERROR:case mp.FRAG_LOAD_TIMEOUT:case mp.KEY_LOAD_ERROR:case mp.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(wp,t);break;case mp.AUDIO_TRACK_LOAD_ERROR:case mp.AUDIO_TRACK_LOAD_TIMEOUT:case mp.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Sb||(null==(s=t.context)?void 0:s.type)!==vp||(this.state=xb);break;case mp.BUFFER_ADD_CODEC_ERROR:case mp.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.resetLoadingState();break;case mp.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case mp.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==Jp&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Jp){this.flushing=!1,this.bufferFlushed=!0,this.state===kb&&(this.state=xb);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,wp),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,n=this.getCurrentContext(a);if(!n)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:c}=n,{details:d}=c,{audio:h,text:u,id3:f,initSegment:m}=r;if(!this.fragContextChanged(o)&&d){if(this.state=Tb,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,m.tracks,e,a),i.trigger(gp.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=h;l&&(l.elementaryStreams[Xp]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(Xp,e,t,s,i),this.bufferFragmentData(h,o,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=kp({id:s,frag:o,details:d},f);i.trigger(gp.FRAG_PARSING_METADATA,e)}if(u){const e=kp({id:s,frag:o,details:d},u);i.trigger(gp.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,s,i){if(this.state!==Tb)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=wp;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&1===a.split(",").length&&(r.levelCodec=a),this.hls.trigger(gp.BUFFER_CODECS,t);const n=r.initSegment;if(null!=n&&n.byteLength){const e={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:n};this.hls.trigger(gp.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===Dv||i===Ov)if(ey(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Lb;const s=this.mainDetails;s&&s.fragmentStart!==t.details.fragmentStart&&pb(t.details,s)}else super.loadFragment(e,t,s);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:n}=this.bufferedTrack;uv({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:n},e,fv)||(gv(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(gp.AUDIO_TRACK_SWITCHED,Lp({},e))}},audioTrackController:class extends oE{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.LEVEL_LOADING,this.onLevelLoading,this),e.on(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(gp.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.LEVEL_LOADING,this.onLevelLoading,this),e.off(gp.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(gp.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(gp.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i)return void this.warn(`Audio track with id:${s} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const n=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=hv(t,e,fv);if(s>-1)r=e[s];else{const e=hv(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const n={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==s?void 0:s.join(",")}`),this.hls.trigger(gp.AUDIO_TRACKS_UPDATED,n);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var a;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==vp||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&uv(e,i,fv))return i;const r=hv(e,this.tracksInGroup,fv);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,s,i,r){const a=t[i],n=t.reduce(((e,t,s)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(s),e}),{})[a.uri];n.length>1&&(i=Math.max.apply(Math,n));const o=a.videoRange,l=a.frameRate,c=a.codecSet.substring(0,4),d=mv(t,i,(t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,a=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return hv(e,a,r)>-1}));return d>-1?d:mv(t,i,(t=>{const i=t.audioGroups,a=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return hv(e,a,r)>-1}))}(e,t.levels,s,i,fv);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=hv(e,s);if(t>-1)return s[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(gp.AUDIO_TRACK_SWITCHING,Lp({},i)),r)return;const a=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if((!this.selectDefaultTrack||i.default)&&(!e||uv(e,i,fv)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:o}=e;for(let e=0;e<t.length;e++){if(uv({name:s,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:o},t[e],fv))return e}for(let l=0;l<t.length;l++){const s=t[l];if(cE(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const s=t[l];if(cE(e.attrs,s.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&gv(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,n=null==a?void 0:a.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(gp.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}},emeController:XE,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:vE.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:s}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),a={d:1e3*(s||t).duration,ot:r};r!==vE.VIDEO&&r!==vE.AUDIO&&r!=vE.MUXED||(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(r)/1e3,a.bl=this.getBufferLength(r));const n=s?this.getNextPart(s):this.getNextFrag(t);null!=n&&n.url&&n.url!==t.url&&(a.nor=n.url),this.apply(e,a)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHED,this.onMediaDetached,this),e.on(gp.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHED,this.onMediaDetached,this),e.off(gp.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:xE.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){kp(t,this.createData());const s=t.ot===vE.INIT||t.ot===vE.VIDEO||t.ot===vE.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce(((e,s)=>(i.includes(s)&&(e[s]=t[s]),e)),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),HE(e.headers,t,r)):e.url=WE(e.url,t,r)}getNextFrag(e){var t;const s=null==(t=this.hls.levels[e.level])?void 0:t.details;if(s){const t=e.sn-s.startSN;return s.fragments[t+1]}}getNextPart(e){var t,s;const{index:i,fragment:r}=e,a=null==(t=this.hls.levels[r.level])||null==(s=t.details)?void 0:s.partList;if(a){const{sn:e}=r;for(let t=a.length-1;t>=0;t--){const s=a[t];if(s.index===i&&s.fragment.sn===e)return a[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?vE.TIMED_TEXT:"initSegment"===e.sn?vE.INIT:"audio"===t?vE.AUDIO:"main"===t?this.hls.audioTracks.length?vE.VIDEO:vE.MUXED:void 0}getTopBandwidth(e){let t,s=0;const i=this.hls;if(e===vE.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,s=e>-1?e+1:i.levels.length;t=i.levels.slice(0,s)}for(const r of t)r.bitrate>s&&(s=r.bitrate);return s>0?s:NaN}getBufferLength(e){const t=this.media,s=e===vE.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!t)return NaN;return 1e3*sx.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}},contentSteeringController:class extends Rp{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((null==s?void 0:s.action)===Av&&s.flags===Nv){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:s,pathwayId:i,type:a}=t.context;s&&e?r=this.getPathwayForGroupId(s,a,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==r),s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${ov(i)} penalized: ${ov(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this._pathwayPriority=e;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach((e=>{i-s[e]>3e5&&delete s[e]}));for(let r=0;r<e.length;r++){const i=e[r];if(i in s)continue;if(i===this.pathwayId)return;const a=this.hls.nextLoadLevel,n=this.hls.levels[a];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,hb(t),this.hls.trigger(gp.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];n&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==n.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==n.bitrate&&this.log(`Unstable Pathways change from bitrate ${n.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===vp&&i[r].hasAudioGroup(e)||t===xp&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach((e=>{const{ID:r,"BASE-ID":a,"URI-REPLACEMENT":n}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(a).map((e=>{const t=new dx(e.attrs);t["PATHWAY-ID"]=r;const a=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;a&&(s[t.AUDIO]=a,t.AUDIO=a),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=YE(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",n),c=new rv({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let s=1;s<e.audioGroups.length;s++)c.addGroupId("audio",`${e.audioGroups[s]}_clone_${r}`);if(e.subtitleGroups)for(let s=1;s<e.subtitleGroups.length;s++)c.addGroupId("text",`${e.subtitleGroups[s]}_clone_${r}`);return c}));t.push(...o),zE(this.audioTracks,s,n,r),zE(this.subtitleTracks,i,n,r)}))}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new s(t);try{i=new self.URL(e)}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,n=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},l={onSuccess:(e,t,s,r)=>{this.log(`Loaded steering manifest: "${i}"`);const a=e.data;if(1!==(null==a?void 0:a.VERSION))return void this.log(`Steering VERSION ${a.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":n,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=a;if(n)try{this.uri=new self.URL(n,i).href}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${n}`)}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const d={steeringManifest:a,url:i.toString()};this.hls.trigger(gp.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},onError:(e,t,s,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,s)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}},interstitialsController:class extends Rp{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const s=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(s){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule()}if(this.checkBuffer(),s&&e<i.start||e>=i.end){var r;const e=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!s){const t=this.findItemIndex(i);if(e>t){const s=this.schedule.findJumpRestrictedIndex(t+1,e);if(s>t)return void this.setSchedulePosition(s)}}return void this.setSchedulePosition(e)}const a=this.playingAsset;if(!a){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const n=a.timelineStart,o=a.duration||0;(s&&e<n||e>=n+o)&&this.setScheduleToAssetAtTime(e,a)},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const s=this.playingAsset;if(!s)return;e>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(e,s)},this.onScheduleUpdate=(e,t)=>{const s=this.schedule,i=this.playingItem,r=s.events||[],a=s.items||[],n=s.durations,o=e.map((e=>e.identifier)),l=!(!r.length&&!o.length);if(l&&this.log(`INTERSTITIALS_UPDATED (${r.length}): ${r}\nSchedule: ${a.map((e=>fS(e)))}`),o.length&&this.log(`Removed events ${o}`),this.playerQueue.forEach((e=>{if(e.interstitial.appendInPlace){const s=e.assetItem.timelineStart,i=e.timelineOffset-s;if(i)try{e.timelineOffset=s}catch(t){Math.abs(i)>rS&&this.warn(`${t} ("${e.assetId}" ${e.timelineOffset}->${s})`)}}})),i){const e=this.updateItem(i,this.timelinePos);this.itemsMatch(i,e)&&(this.playingItem=e,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const c=this.bufferingItem;if(c){const e=this.updateItem(c,this.bufferedPos);this.itemsMatch(c,e)?this.bufferingItem=e:c.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(c.event,null))}if(e.forEach((e=>{e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,null)}))})),l||t){if(this.hls.trigger(gp.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:a.slice(0),durations:n,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn(`Interstitial "${i.event.identifier}" removed while playing`),void this.primaryFallback(i.event);this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new mS(e),this.schedule=new uS(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(gp.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(gp.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(gp.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(gp.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(gp.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(gp.BUFFER_APPENDED,this.onBufferAppended,this),e.on(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(gp.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(gp.MEDIA_ENDED,this.onMediaEnded,this),e.on(gp.ERROR,this.onError,this),e.on(gp.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(gp.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(gp.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(gp.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(gp.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(gp.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(gp.BUFFER_CODECS,this.onBufferCodecs,this),e.off(gp.BUFFER_APPENDED,this.onBufferAppended,this),e.off(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(gp.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(gp.MEDIA_ENDED,this.onMediaEnded,this),e.off(gp.ERROR,this.onError,this),e.off(gp.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){pS(e,"play",this.onPlay),pS(e,"pause",this.onPause),pS(e,"seeking",this.onSeeking),pS(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;gS(s,"seeking",this.onSeeking),gS(s,"timeupdate",this.onTimeupdate),gS(s,"play",this.onPlay),gS(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===s)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(s);this.setSchedulePosition(e)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,r,n,o)=>{if(t){let l=t[i].start;const c=t.event;if(c){if("playout"===i||c.timelineOccupancy!==aS.Point){const e=s(r);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===n?a():e[n])-t.start}return l}return 0},r=(t,s)=>{if(0!==t&&"primary"!==s&&e.schedule.length){var i;const r=e.schedule.findItemIndexAtTime(t),a=null==(i=e.schedule.items)?void 0:i[r];if(a){return t+(a[s].start-a.start)}}return t},a=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?n("primary"):Math.max(t,0)},n=t=>{var s;return null!=(s=e.primaryDetails)&&s.live?e.primaryDetails.edge:e.schedule.durations[t]},o=(t,r)=>{var a,n;const o=e.effectivePlayingItem;if(null!=o&&null!=(a=o.event)&&a.restrictions.skip)return;e.log(`seek to ${t} "${r}"`);const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,r),d=null==(n=e.schedule.items)?void 0:n[c],h=e.getBufferingPlayer(),u=null==h?void 0:h.interstitial,f=null==u?void 0:u.appendInPlace,m=l&&e.itemsMatch(l,d);if(l&&(f||m)){const a=s(e.playingAsset),n=(null==a?void 0:a.media)||e.primaryMedia;if(n){const s="primary"===r?n.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-s,c=(f?s:n.currentTime)+o;if(c>=0&&(!a||f||c<=a.duration))return void(n.currentTime=c)}}if(d){let s=t;if("primary"!==r){const e=t-d[r].start;s=d.start+e}const i=!e.isInterstitial(d);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!d.event.appendInPlace){if(l){const a=e.findItemIndex(l);if(c>a){const t=e.schedule.findJumpRestrictedIndex(a+1,c);if(t>a)return void e.setSchedulePosition(t)}let n=0;if(i)e.timelinePos=s,e.checkBuffer();else{var g;const e=null==d||null==(g=d.event)?void 0:g.assetList;if(e){const s=t-(d[r]||d).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&s>=i.startOffset&&s<i.startOffset+i.duration){n=t;break}}}}e.setSchedulePosition(c,n)}}else{const t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=s)}}},l=()=>{const s=e.effectivePlayingItem;if(e.isInterstitial(s))return s;const i=t();return e.isInterstitial(i)?i:null},c={get currentTime(){const t=l(),s=e.effectivePlayingItem;return s&&s===t?i(s,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-s.playout.start:0},set currentTime(t){const s=l(),i=e.effectivePlayingItem;i&&i===s&&o(t+i.playout.start,"playout")},get duration(){const e=l();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const s=null==(t=l())?void 0:t.event.assetList;return s?s.map((t=>e.getAssetPlayer(t.identifier))):[]},get playingIndex(){var t;const s=null==(t=l())?void 0:t.event;return s&&e.effectivePlayingAsset?s.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var t,s;return(null==(t=e.schedule)||null==(s=t.events)?void 0:s.slice(0))||[]},get schedule(){var t,s;return(null==(t=e.schedule)||null==(s=t.items)?void 0:s.slice(0))||[]},get interstitialPlayer(){return l()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const s=t();return e.findItemIndex(s)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return a()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){o(e,"primary")},get duration(){return n("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){o(e,"integrated")},get duration(){return n("integrated")},get seekableStart(){var t;return r((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,s=null==t?void 0:t.event;if(s&&!s.restrictions.skip){const i=e.findItemIndex(t);if(s.appendInPlace){const e=t.playout.start+t.event.duration;o(e+.001,"playout")}else e.advanceAfterAssetEnded(s,i,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&s)&&this.findItemIndex(t)===s.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t,s;if(null===this.mediaSelection)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(t=e.event)&&t.appendInPlace&&(r=this.primaryMedia);const a=null==(s=r)?void 0:s.currentTime;return void 0!==a&&dp(a)?a:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ov(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const a=this.hls,n=e!==a,o=n&&e.interstitial.appendInPlace,l=null==(s=this.detachedData)?void 0:s.mediaSource;let c;if(a.media)o&&(r=a.transferMedia(),this.detachedData=r),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),c=`${e}`):c="detached MediaSource"}else c="detached media";if(!r)if(l)r=this.detachedData,this.log(`using detachedData: MediaSource ${ov(r)}`);else if(!this.detachedData||a.media===t){const e=this.playerQueue;e.length>1&&e.forEach((e=>{if(n&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}})),this.hls.detachMedia(),this.detachedData={media:t}}const d=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),h=d&&r?r:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${n?e:"Primary"} from ${c}`),h===r){const t=n&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!n||t,cueRemoval:!n}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(-1===s){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const s=e.findEventIndex(t[0].identifier);this.setSchedulePosition(s)}else if(s>=0||!this.primaryLive){const t=this.timelinePos=s>0?s:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAfterAssetEnded(e,t,s){const i=s+1;if(e.isAssetPastPlayoutLimit(i)||e.assetList[i].error){const s=this.schedule.items;if(s){const i=t+1;if(i>=s.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.timelinePos=r,this.checkBuffer()),this.setSchedulePosition(i)}}else this.setSchedulePosition(t,i)}setScheduleToAssetAtTime(e,t){const s=this.schedule,i=t.parentIdentifier,r=s.getEvent(i);if(r){const t=s.findEventIndex(i),a=s.findAssetIndex(r,e);this.setSchedulePosition(t,a)}}setSchedulePosition(e,t){const s=this.schedule.items;if(!s||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?s[e]:null,r=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(r)){var n;const l=r.event,c=this.playingAsset,d=null==c?void 0:c.identifier,h=d?this.getAssetPlayer(d):null;if(h&&d&&(!this.eventItemsMatch(r,i)||void 0!==t&&d!==(null==(n=l.assetList)?void 0:n[t].identifier))){var o;const t=l.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${l.assetList.length} ${dS(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(gp.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(d,i),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(r,i)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${l} ${fS(r)}`),l.hasPlayed=!0,this.hls.trigger(gp.INTERSTITIAL_ENDED,{event:l,schedule:s.slice(0),scheduleIndex:e}),l.cue.once)){this.updateSchedule();const e=this.schedule.items;if(i&&e){const s=this.schedule.findItemIndex(i);this.advanceSchedule(s,e,t,r,a)}return}}this.advanceSchedule(e,s,t,r,a)}advanceSchedule(e,t,s,i,r){const a=e>=0?t[e]:null,n=this.primaryMedia,o=this.playerQueue;if(o.length&&o.forEach((t=>{const s=t.interstitial,i=this.schedule.findEventIndex(s.identifier);(i<e||i>e+1)&&this.clearInterstitial(s,a)})),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const r=a.event;void 0===s&&(s=this.schedule.findAssetIndex(r,this.timelinePos));const o=this.waitingItem;this.assetsBuffered(a,n)||this.setBufferingItem(a);let l=this.preloadAssets(r,s);if(this.eventItemsMatch(a,o||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${fS(a)} ${r.appendInPlace?"append in place":""}`),this.hls.trigger(gp.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${r}`);if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!n)return void this.log(`Waiting for attachMedia to start Interstitial ${r}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const c=r.assetList[s];if(!c){const i=t[e+1],a=this.media;return i&&a&&!this.isInterstitial(i)&&a.currentTime<i.start&&(a.currentTime=this.timelinePos=i.start),void this.advanceAfterAssetEnded(r,e,s||0)}if(l||(l=this.getAssetPlayer(c.identifier)),null===l||l.destroyed){const e=r.assetList.length;this.warn(`asset ${s+1}/${e} player destroyed ${r}`),l=this.createAssetPlayer(r,c,s)}if(!this.eventItemsMatch(a,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(l,s,t,e,n),this.shouldPlay&&yS(l.media)}else null!==a?(this.resumePrimary(a,e,i),this.shouldPlay&&yS(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e,t;return null==(e=this.mediaSelection)||null==(t=e.main)?void 0:t.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,s){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${fS(e)}`),null==(i=this.detachedData)||!i.mediaSource){let s=this.timelinePos;(s<e.start||s>=e.end)&&(s=this.getPrimaryResumption(e,t),this.timelinePos=s),this.attachPrimary(s,e)}if(!s)return;const r=this.schedule.items;r&&(this.log(`resumed ${fS(e)}`),this.hls.trigger(gp.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(s<e.fragmentStart||s>e.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return sx.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(s=i.mainForwardBufferInfo)?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(gp.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(gp.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level)return;const s=this.hls.levels[t.level],i=Lp(Lp({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Lp(Lp({},this.altSelection),{},{audio:s}));const r=Lp(Lp({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Lp(Lp({},this.altSelection),{},{subtitles:s}));const r=Lp(Lp({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=dv(t);this.playerQueue.forEach((e=>e.hls.setAudioOption(t)||e.hls.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=dv(t);this.playerQueue.forEach((e=>e.hls.setSubtitleOption(t)||-1!==t.id&&e.hls.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var s;const e=this.schedule.findEventIndex(i.identifier),t=null==(s=this.schedule.items)?void 0:s[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){const s=this.schedule.items;if(e&&s){return s[this.findItemIndex(e,t)]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===(null==(s=t.event)?void 0:s.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const s=sx.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,t,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const a=this.playingItem,n=this.findItemIndex(a);let o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,c;const s=this.findItemIndex(r),i=Math.min(s+1,t.length-1),a=t[i];if((-1===o&&r&&e>=r.end||null!=(l=a.event)&&l.appendInPlace&&e+.01>=a.start)&&(o=i),i-n>1&&!1===(null==r||null==(c=r.event)?void 0:c.appendInPlace))return;if(this.bufferedPos=e,o>s&&o>n)this.bufferedToItem(a);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&a.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(a)&&this.preloadAssets(a.event,0)}}else s&&a&&!this.itemsMatch(a,r)&&(o===n?this.bufferedToItem(a):o===n+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some((e=>{const s=this.getAssetPlayer(e.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(t))}))}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:r}=s;if(!i||!r)return t;const a=this.isInterstitial(e),n=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const s=n?n.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${fS(e)}`+(t?` (${s.toFixed(2)} remaining)`:"")),a?e.event.assetList.forEach((e=>{const t=this.getAssetPlayer(e.identifier);t&&t.resumeBuffering()})):(this.hls.resumeBuffering(),this.playerQueue.forEach((e=>e.pauseBuffering())))}this.hls.trigger(gp.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==s){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=0===s.assetList.length&&!s.assetListLoader,r=s.cue.once;if(i||!r){const e=this.preloadAssets(s,t);if(null!=e&&e.interstitial.appendInPlace){const i=s.assetList[t],r=this.primaryMedia;i&&r&&this.bufferAssetPlayer(e,r)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,a=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var n;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(n=t.nextEvent)?void 0:n.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let a,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(a=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${a?` live-start: ${o} start-offset: ${a}`:""}`),s)return this.createAsset(e,0,0,r,e.duration,s);const l=this.assetListLoader.loadAssetList(e,a);l&&(e.assetListLoader=l)}else if(!a&&i){for(let s=t;s<i;s++){const t=e.assetList[s],i=this.getAssetPlayerQueueIndex(t.identifier);-1!==i&&!this.playerQueue[i].destroyed||t.error||this.createAssetPlayer(e,t,s)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach((t=>{this.hls.trigger(gp.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s];return null}createAsset(e,t,s,i,r,a){const n={parentIdentifier:e.identifier,identifier:nS(e,a,t),duration:r,startOffset:s,timelineStart:i,uri:a};return this.createAssetPlayer(e,n,t)}createAssetPlayer(e,t,s){this.log(`create HLSAssetPlayer for ${dS(t)}`);const i=this.hls,r=i.userConfig;let a=r.videoPreference;const n=i.loadLevelObj||i.levels[i.currentLevel];(a||n)&&(a=kp({},a),n.videoCodec&&(a.videoCodec=n.videoCodec),n.videoRange&&(a.allowedVideoRanges=[n.videoRange]));const o=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const s=t.duration;s&&e<s&&(c=e)}}const d=t.identifier,h=Lp(Lp({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:o||r.audioPreference,subtitlePreference:l||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const u=h.cmcd;null!=u&&u.sessionId&&u.contentId&&(h.cmcd=kp({},u,{contentId:iS(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const f=new hS(this.HlsPlayerClass,h,e,t);this.playerQueue.push(f),e.assetList[s]=t;const m=i=>{if(i.live){const t=new Error(`Interstitials MUST be VOD assets ${e}`),i={fatal:!0,type:fp.OTHER_ERROR,details:mp.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};return void this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)}const r=i.edge-i.fragmentStart,a=t.duration;(null===a||r>a)&&(this.log(`Interstitial asset "${d}" duration change ${a} > ${r}`),t.duration=r,this.updateSchedule())};f.on(gp.LEVEL_UPDATED,((e,{details:t})=>m(t))),f.on(gp.LEVEL_PTS_UPDATED,((e,{details:t})=>m(t)));const g=(e,t)=>{const s=this.getAssetPlayer(d);if(s&&t.tracks){s.off(gp.BUFFER_CODECS,g),s.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===s.assetItem&&e&&!s.media&&this.bufferAssetPlayer(s,e)}};f.on(gp.BUFFER_CODECS,g);const p=()=>{var s;const i=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${i}`),!i)return;const r=this.schedule.findEventIndex(e.identifier),a=e.findAssetIndex(t),n=a+1,o=null==(s=this.schedule.items)?void 0:s[r];if(this.isInterstitial(o))if(-1===a||e.isAssetPastPlayoutLimit(n)||e.assetList[n].error){var l;const e=null==(l=this.schedule.items)?void 0:l[r+1];e&&this.bufferedToItem(e)}else this.bufferedToItem(o,n)};f.on(gp.BUFFERED_TO_END,p);const y=t=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const s=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,t)};return f.once(gp.MEDIA_ENDED,y(s)),f.once(gp.PLAYOUT_LIMIT_REACHED,y(1/0)),f.on(gp.ERROR,((t,i)=>{const r=this.getAssetPlayer(d);if(i.details!==mp.BUFFER_STALLED_ERROR)this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${i.error} ${e}`);else if(null!=r&&r.media){const t=r.currentTime,s=r.duration-t;t&&e.appendInPlace&&s/r.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${r.media.currentTime}`),p()):(this.warn(`Stalled at ${t} of ${t+s} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}})),f.on(gp.DESTROYING,(()=>{if(!this.getAssetPlayer(d))return;const t=new Error(`Asset player destroyed unexpectedly ${d}`),i={fatal:!0,type:fp.OTHER_ERROR,details:mp.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)})),this.hls.trigger(gp.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:f}),f}clearInterstitial(e,t){e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,t)})),e.reset()}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(-1!==s){this.log(`clearAssetPlayer "${e}" toSegment: ${t?fS(t):t}`);const i=this.playerQueue[s];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:a,assetItem:n,assetId:o}=e,l=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=n,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,s[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${e}`),this.hls.trigger(gp.INTERSTITIAL_ASSET_STARTED,{asset:n,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;const{interstitial:r,assetItem:a,assetId:n}=e,o=this.schedule.findEventIndex(r.identifier),l=null==(s=this.schedule.items)?void 0:s[o];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const d=r.appendInPlace;if(d&&!1===(null==c?void 0:c.interstitial.appendInPlace))return;const h=(null==c?void 0:c.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(d&&a!==this.playingAsset){if(!e.tracks)return;if(h&&!Mp(h,e.tracks)){const t=new Error(`Asset "${n}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),s={fatal:!0,type:fp.OTHER_ERROR,details:mp.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(a);return void this.handleAssetItemError(s,r,o,i,t.message)}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,s,i,r){if(e.details===mp.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;let n=null;if(a){const e=this.getAssetPlayerQueueIndex(a.identifier);n=this.playerQueue[e]||null}const o=this.schedule.items,l=kp({},e,{fatal:!1,errorAction:Iv(!0),asset:a,assetListIndex:i,event:t,schedule:o,scheduleIndex:s,player:n});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(gp.INTERSTITIAL_ASSET_ERROR,l),!e.fatal)return;const c=new Error(r);a&&(this.playingAsset!==a&&this.clearAssetPlayer(a.identifier,null),a.error=c),t.assetList.some((e=>!e.error))?t.appendInPlace&&(t.error=c):t.error=c,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${s?fS(s):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(s,i);if(this.itemsMatch(s,r))this.clearInterstitial(e,null);else{const e=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(e)}}else this.checkStart()}onAssetListLoaded(e,t){var s;const i=t.event,r=i.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const n=i.timelineStart,o=i.duration;let l=0;a.forEach(((e,t)=>{const s=parseFloat(e.DURATION);this.createAsset(i,t,l,n+l,s,e.URI),l+=s})),i.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${o}) ${i}`);const c=this.waitingItem,d=(null==c?void 0:c.event.identifier)===r;this.updateSchedule();const h=null==(s=this.bufferingItem)?void 0:s.event;if(d){var u;const e=this.schedule.findEventIndex(r),t=null==(u=this.schedule.items)?void 0:u[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===r&&h.appendInPlace){const e=i.assetList[0],t=this.getAssetPlayer(e.identifier),s=this.primaryMedia;e&&t&&s&&this.bufferAssetPlayer(t,s)}}onError(e,t){switch(t.details){case mp.ASSET_LIST_PARSING_ERROR:case mp.ASSET_LIST_LOAD_ERROR:case mp.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&this.primaryFallback(e);break}case mp.BUFFER_STALLED_ERROR:this.onTimeupdate(),this.checkBuffer(!0)}}}});function wT(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(wT):Object.keys(e).reduce(((t,s)=>(t[s]=wT(e[s]),t)),{}):e}function ET(e,t){const s=e.loader;if(s!==gT&&s!==xT)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=gT,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class ST extends Zv{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(gp.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const s=this.media=t.media;gS(s,"playing",this.onMediaPlaying),gS(s,"waiting",this.onMediaWaiting),gS(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(pS(s,"playing",this.onMediaPlaying),pS(s,"waiting",this.onMediaWaiting),pS(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=null==(s=this.hls)?void 0:s.config;if(!r)return;const{media:a,stalled:n}=this;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,d=a.paused&&!o||a.ended||0===a.playbackRate;if(this.seeking=o,e!==t)return t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(c||l)return void(l&&this.stallResolved(e));if(d)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(gp.MEDIA_ENDED,{stalled:!1})));if(!sx.getBuffered(a).length)return void(this.nudgeRetry=0);const h=sx.bufferInfo(a,e,0),u=h.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const t=TT(this.hls.inFlightFragments,e),s=h.len>2,i=!u||t||u-e>2&&!f.getPartialFragment(e);if(s||i)return;this.moved=!1}const m=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(h.len>0)&&!u)return;const t=Math.max(u,h.start||0)-e,s=!(null==m||!m.live)?2*m.targetduration:2,i=f.getPartialFragment(e);if(t>0&&(t<=s||i))return void(a.paused||this._trySkipBufferHole(i))}const g=r.detectStallWithCurrentTimeMs,p=self.performance.now(),y=this.waiting;if(null===n)return void(this.stalled=y>0&&p-y<g?y:p);const v=p-n;if(!o&&(v>=g||y)&&this.hls){var x;if("ended"===(null==(x=this.mediaSource)?void 0:x.readyState)&&(null==m||!m.live)&&Math.abs(e-((null==m?void 0:m.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(gp.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(h),!this.media||!this.hls)return}const b=sx.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(b,v)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(gp.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(s=this.buffered.audio)&&s.length&&i&&i.length>1&&e>i.end(0)){const s=sx.bufferedInfo(sx.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const s=sx.timeRangesToArray(i),r=sx.bufferedInfo(s,t,0).bufferedIndex;if(r>-1&&r<s.length-1){const t=sx.bufferedInfo(s,e,0).bufferedIndex,i=s[r].end,a=s[r+1].start;if((-1===t||t>r)&&a-i<1&&e-i<2){const s=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${i} -> ${a} buffered index: ${t}`);this.warn(s.message),this.media.currentTime+=1e-6;const r=this.fragmentTracker.getPartialFragment(e)||void 0,n=sx.bufferInfo(this.media,e,0);this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:r,buffer:n.len,bufferInfo:n})}}}}}_tryFixBufferStall(e,t){var s,i;const{fragmentTracker:r,media:a}=this,n=null==(s=this.hls)?void 0:s.config;if(!a||!r||!n)return;const o=a.currentTime,l=null==(i=this.hls)?void 0:i.latestLevelDetails,c=r.getPartialFragment(o);if(c||null!=l&&l.live&&o<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const d=e.buffered;(d&&d.length>1&&e.len>n.maxBufferHole||e.nextStart&&e.nextStart-o<n.maxBufferHole)&&(t>1e3*n.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&null!==r&&s&&t){this.stallReported=!0;const i=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${ov(e)})`);this.warn(i.message),t.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!s||!r)return 0;const a=i.currentTime,n=sx.bufferInfo(i,a,0),o=a<n.start?n.start:n.nextStart;if(o&&this.hls){const t=n.len<=r.maxBufferHole,c=n.len>0&&n.len<1&&i.readyState<3,d=o-a;if(d>0&&(t||c)){if(d>r.maxBufferHole){let t=!1;if(0===a){const e=s.getAppendedFrag(0,bp);e&&o<e.end&&(t=!0)}if(!t){const t=e||s.getAppendedFrag(a,bp);if(t){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(TT(this.hls.inFlightFragments,o))return 0;let e=!1,i=t.end;for(;i<o;){const t=s.getPartialFragment(i);if(!t){e=!0;break}i+=t.duration}if(e)return 0}}}const t=Math.max(o+.05,a+.1);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${t}`),this.moved=!0,i.currentTime=t,null==e||!e.gap){const s=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${t}`);this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:e||void 0,buffer:n.len,bufferInfo:n})}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!s||!r)return 0;const a=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const n=a+(i+1)*r.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${a} to ${n}`);this.warn(o.message),s.currentTime=n,t.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const s=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(s.message),t.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.BUFFER_STALLED_ERROR,error:s,fatal:!0,buffer:e.len,bufferInfo:e})}}}function TT(e,t){const s=_T(e.main);if(s&&s.start<=t)return s;const i=_T(e.audio);return i&&i.start<=t?i:null}function _T(e){if(!e)return null;switch(e.state){case xb:case vb:case kb:case Ab:return null}return e.frag}function kT(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function AT(e,t,s,i,r){let a=new e(t,s,"");try{a.value=i,r&&(a.type=r)}catch(n){a=new e(t,s,ov(r?Lp({type:r},i):i))}return a}const LT=(()=>{const e=kT();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class RT{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(gp.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(gp.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(gp.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(gp.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(gp.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var s;this.media=t.media,!1===(null==(s=t.overrides)?void 0:s.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&eS(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return QE(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:i}}}=this;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=kT();if(a)for(let n=0;n<r.length;n++){const e=r[n].type;if(e===ow.emsg&&!s||!i)continue;const t=iw(r[n].data);if(t){const s=r[n].pts;let i=s+r[n].duration;i>LT&&(i=LT);i-s<=0&&(i=s+.25);for(let r=0;r<t.length;r++){const n=t[r];if(!rw(n)){this.updateId3CueEnds(s,e);const t=AT(a,s,i,n,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var s;const i=null==(s=this.id3Track)?void 0:s.cues;if(i)for(let r=i.length;r--;){const s=i[r];s.type===t&&s.startTime<e&&s.endTime===LT&&(s.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}=a;if(r&&(n||o)){let e;e="audio"===i?e=>e.type===ow.audioId3&&o:"video"===i?e=>e.type===ow.emsg&&n:e=>e.type===ow.audioId3&&o||e.type===ow.emsg&&n,tS(r,t,s,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:s}=this,{dateRanges:i}=e,r=Object.keys(i);let a=this.dateRangeCuesAppended;var n;if(s&&t)if(null!=(n=s.cues)&&n.length){const e=Object.keys(a).filter((e=>!r.includes(e)));for(let t=e.length;t--;){const i=e[t],r=a[i].cues;delete a[i],Object.keys(r).forEach((e=>{try{const t=r[e];t.removeEventListener("enter",this.onEventCueEnter),s.removeCue(t)}catch(t){}}))}}else a=this.dateRangeCuesAppended={};const o=e.fragments[e.fragments.length-1];if(0===r.length||!dp(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=kT();for(let h=0;h<r.length;h++){const e=r[h],t=i[e],s=t.startTime,n=a[e],o=(null==n?void 0:n.cues)||{};let u=(null==n?void 0:n.durationKnown)||!1,f=LT;const{duration:m,endDate:g}=t;if(g&&null!==m)f=s+m,u=!0;else if(t.endOnNext&&!u){const e=r.reduce(((e,s)=>{if(s!==t.id){const r=i[s];if(r.class===t.class&&r.startDate>t.startDate&&(!e||t.startDate<e.startDate))return r}return e}),null);e&&(f=e.startTime,u=!0)}const p=Object.keys(t.attr);for(let i=0;i<p.length;i++){const r=p[i];if("ID"===(d=r)||"CLASS"===d||"CUE"===d||"START-DATE"===d||"DURATION"===d||"END-DATE"===d||"END-ON-NEXT"===d)continue;const a=o[r];if(a)u&&!n.durationKnown?a.endTime=f:Math.abs(a.startTime-s)>.01&&(a.startTime=s,a.endTime=f);else if(l){let i=t.attr[r];hx(r)&&(c=i,i=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const a=AT(l,s,f,{key:r,data:i},ow.dateRange);a&&(a.id=e,this.id3Track.addCue(a),o[r]=a,this.hls.config.interstitialsController&&("X-ASSET-LIST"!==r&&"X-ASSET-URL"!==r||a.addEventListener("enter",this.onEventCueEnter)))}}a[e]={cues:o,dateRange:t,durationKnown:u}}var c,d}}class PT{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const a=this.targetLatency;if(null===a)return;const n=s-a;if(n<Math.min(this.maxLatency,a+t.targetduration)&&n>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,s));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:n}=this.config,o=this.hls.userConfig;let l=n&&s||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:a*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const s=this.levelDetails;if(null===s)return null;const i=s.edge,r=e-t-this.edgeStalled,a=i-s.totalduration,n=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,r),n)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(gp.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(gp.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(gp.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(gp.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===mp.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(s=this.levelDetails)&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&(null==(s=this.hls)||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class NT extends oE{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.on(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.on(gp.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.off(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(gp.FRAG_BUFFERED,this.onFragBuffered,this),e.off(gp.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let n=!1,o=!1,l=!1;t.levels.forEach((e=>{var t;const c=e.attrs;let{audioCodec:d,videoCodec:h}=e;d&&(e.audioCodec=d=By(d,s)||void 0),0===(null==(t=h)?void 0:t.indexOf("avc1"))&&(h=e.videoCodec=function(e){const t=e.split(",");for(let s=0;s<t.length;s++){const e=t[s].split(".");if(e.length>2){let i=e.shift()+".";i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t[s]=i}}return t.join(",")}(h));const{width:u,height:f,unknownCodecs:m}=e;let g=m?m.length:0;if(m)for(let s=g;s--;){const t=m[s];this.isAudioSupported(t)?(e.audioCodec=d=d?`${d},${t}`:t,g--,Cy.audio[d.substring(0,4)]=2):this.isVideoSupported(t)&&(e.videoCodec=h=h?`${h},${t}`:t,g--,Cy.video[h.substring(0,4)]=2)}if(n||(n=!(!u||!f)),o||(o=!!h),l||(l=!!d),g||d&&!this.isAudioSupported(d)||h&&!this.isVideoSupported(h))return void this.log(`Some or all CODECS not supported "${c.CODECS}"`);const{CODECS:p,"FRAME-RATE":y,"HDCP-LEVEL":v,"PATHWAY-ID":x,RESOLUTION:b,"VIDEO-RANGE":w}=c,E=`${`${x||"."}-`}${e.bitrate}-${b}-${y}-${p}-${w}-${v}`;if(r[E])if(r[E].uri===e.url||e.attrs["PATHWAY-ID"])r[E].addGroupId("audio",c.AUDIO),r[E].addGroupId("text",c.SUBTITLES);else{const t=a[E]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=this.createLevel(e);r[E]=s,i.push(s)}else{const t=this.createLevel(e);r[E]=t,a[E]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,n,o,l)}createLevel(e){const t=new rv(e),s=e.supplemental;if(null!=s&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(e.message),t.supportedResult=Wy(e,[])}return t}isAudioSupported(e){return Dy(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Dy(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){let a=[],n=[],o=e;if((s||i)&&r&&(o=o.filter((({videoCodec:e,videoRange:t,width:s,height:i})=>{return(!!e||!(!s||!i))&&(!!(r=t)&&Qy.indexOf(r)>-1);var r}))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){let e="no level with compatible codecs found in manifest",s=e;t.levels.length&&(s=`one or more CODECS in variant not supported: ${ov(t.levels.map((e=>e.attrs.CODECS)).filter(((e,t,s)=>s.indexOf(e)===t)))}`,this.warn(s),e+=` (${s})`);const i=new Error(e);this.hls.trigger(gp.ERROR,{type:fp.MEDIA_ERROR,details:mp.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:s})}}));t.audioTracks&&(a=t.audioTracks.filter((e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),CT(a)),t.subtitles&&(n=t.subtitles,CT(n));const l=o.slice(0);o.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Qy.indexOf(e.videoRange)-Qy.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=My(e.videoCodec),i=My(t.videoCodec);if(s!==i)return i-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=Fy(e.codecSet),i=Fy(t.codecSet);if(s!==i)return i-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let c=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let g=0;g<l.length;g++)if(l[g].pathwayId===o[0].pathwayId){c=l[g];break}this._levels=o;for(let g=0;g<o.length;g++)if(o[g]===c){var d;this._firstLevel=g;const e=c.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(d=this.hls.userConfig)?void 0:d.abrEwmaDefaultEstimate)){const s=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);s>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=s)}break}const h=r&&!i,u=this.hls.config,f=!(!u.audioStreamController||!u.audioTrackController),m={levels:o,audioTracks:a,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:f&&!h&&a.some((e=>!!e.url))};this.hls.trigger(gp.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:s,reason:s.message}),i)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],n=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&i&&r===n)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${n?" with Pathway "+n:""} from level ${s}${r?" with Pathway "+r:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(gp.LEVEL_SWITCHING,o);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter((e=>-1!==t.indexOf(e)));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=s}}onError(e,t){!t.fatal&&t.context&&t.context.type===yp&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===bp){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const s=this._levels[t.level];null!=s&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,a=t.levelInfo;var n;if(!a)return this.warn(`Invalid level index ${i}`),void(null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0));if(a===this.currentLevel||t.withoutMultiVariant){0===a.fragmentError&&(a.loadError=0);let e=a.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,n=null==a?void 0:a.age;this.log(`Loading level index ${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(gp.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const s=this._levels.filter(((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));hb(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(gp.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(gp.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function CT(e){const t={};e.forEach((e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++}))}function IT(){return self.SourceBuffer||self.WebKitSourceBuffer}function DT(){if(!Op())return!1;const e=IT();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class jT extends Pb{constructor(e,t,s){super(e,t,s,"stream-controller",bp),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!dp(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const s=this.getFwdBufferInfoAtPos(e,t,bp,0);null!==s&&0!==s.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${s?s.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.on(gp.LEVEL_LOADING,this.onLevelLoading,this),e.on(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.on(gp.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(gp.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(gp.BUFFER_CREATED,this.onBufferCreated,this),e.on(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(gp.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(gp.MANIFEST_PARSED,this.onManifestParsed,this),e.off(gp.LEVEL_LOADED,this.onLevelLoaded,this),e.off(gp.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(gp.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(gp.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(gp.BUFFER_CREATED,this.onBufferCreated,this),e.off(gp.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(gp.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(gp.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=xb,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=vb}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Rb:{const{levels:e,level:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=xb;break}if(this.hls.nextLoadLevel!==this.level){this.state=xb;break}break}case Eb:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,s=null==e?void 0:e[t];this.resetStartWhenNotLoaded(s||null),this.state=xb}}}this.state===xb&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const a=s[r],n=this.getMainFwdBufferInfo();if(null===n)return;const o=this.getLevelDetails();if(o&&this._streamEnded(n,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(gp.BUFFER_EOS,e),void(this.state=kb)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=a.details;if(!l||this.state===Rb||this.waitForLive(a))return this.level=r,this.state=Rb,void(this.startFragRequested=!1);const c=n.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>n.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:n.end;let u=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&u&&ey(u)&&this.fragmentTracker.getState(u)!==Mv){var f;const e=(null!=(f=this.backtrackFragment)?f:u).sn-l.startSN,t=l.fragments[e-1];t&&u.cc===t.cc&&(u=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&n.len&&(this.backtrackFragment=null);if(u&&this.isLoopLoading(u,h)){if(!u.gap){const e=this.audioOnly&&!this.altAudio?Xp:Jp,t=(e===Jp?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,bp)}u=this.getNextFragmentLoopLoading(u,l,n,bp,d)}u&&(!u.initSegment||u.initSegment.data||this.bitrateTest||(u=u.initSegment),this.loadFragment(u,a,h))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===Dv||i===Ov?ey(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,bp)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;s=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,i=Math.max(a.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case bb:case wb:case Eb:case Tb:case _b:this.state=xb}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;gS(s,"playing",this.onMediaPlaying),gS(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(pS(s,"playing",this.onMediaPlaying),pS(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(gp.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(s=s||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=s&&i&&!function(){var e;const t=IT();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==xb)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=Rb)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,a=t.level,n=t.details,o=n.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${a}`);this.log(`Level ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${o}`);const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==wb&&this.state!==Eb||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(n.live||null!=(s=l.details)&&s.live){var h;if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;d=this.alignPlaylists(n,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=n,this.levelLastLoaded=l,r||this.setStartPosition(n,d),this.hls.trigger(gp.LEVEL_UPDATED,{details:n,level:a}),this.state===Rb){if(this.waitForCdnTuneIn(n))return;this.state=xb}r&&n.live&&this.synchronizeToLiveEdge(n),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,n=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=n;if(null!==i&&s.duration>i&&(r<i||!o)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&s.readyState<4||r<n-a)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${n}, reset currentTime to : ${i.toFixed(3)}`),s.currentTime=i))}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const n=a[s.level];if(!n)return void this.warn(`Level ${s.level} not found on progress`);const o=n.details;if(!o)return this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),void this.fragmentTracker.removeFragment(s);const l=n.videoCodec,c=o.PTSKnown||!o.live,d=null==(t=s.initSegment)?void 0:t.data,h=this._getAudioCodec(n),u=this.transmuxer=this.transmuxer||new nE(this.hls,bp,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,m=-1!==f,g=new ex(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,m),p=this.initPTS[s.cc];u.push(r,d,h,l,s,i,o.totalduration,c,g,p)}onAudioTrackSwitching(e,t){const s=this.hls,i=2===this.altAudio;if(gv(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),s.once(gp.BUFFER_FLUSHED,(()=>{var e;null==(e=this.hls)||e.trigger(gp.AUDIO_TRACK_SWITCHED,t)})),void s.trigger(gp.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});s.trigger(gp.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=gv(t.url,this.hls);if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,a=!1;for(const n in s){const e=s[n];if("main"===e.id){if(r=n,i=e,"video"===n){const e=s[n];e&&(this.videoBuffer=e.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===bp;if(r){if(this.fragContextChanged(s))return this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===_b&&(this.state=xb));const e=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),ey(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const a=this.media;a&&(!this._hasEnoughToStart&&sx.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal)this.state=Ab;else switch(t.details){case mp.FRAG_GAP:case mp.FRAG_PARSING_ERROR:case mp.FRAG_DECRYPT_ERROR:case mp.FRAG_LOAD_ERROR:case mp.FRAG_LOAD_TIMEOUT:case mp.KEY_LOAD_ERROR:case mp.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(bp,t);break;case mp.LEVEL_LOAD_ERROR:case mp.LEVEL_LOAD_TIMEOUT:case mp.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Rb||(null==(s=t.context)?void 0:s.type)!==yp||(this.state=xb);break;case mp.BUFFER_ADD_CODEC_ERROR:case mp.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.resetLoadingState();break;case mp.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case mp.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=xb,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Xp||!this.altAudio){const e=(t===Jp?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,bp),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log(`could not seek to ${s}, already seeking at ${t}`);const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),a=sx.getBuffered(e),n=a.length?a.start(0):0,o=n-s,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0))&&(this.log(`adjusting start position by ${o} to match buffer start`),s+=o,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${n}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((e=>{const{hls:s}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=xb,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(gp.FRAG_LOADED,e),i.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,n=this.getCurrentContext(a);if(!n)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:c}=n,{video:d,text:h,id3:u,initSegment:f}=r,{details:m}=c,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Tb,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,f.tracks,e,a),i.trigger(gp.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;dp(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(gp.INIT_PTS_FOUND,{frag:o,id:s,initPTS:e,timescale:t}))}if(d&&m){g&&"audiovideo"===d.type&&this.logMuxedErr(o);const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,s=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:n}=d;if(l)l.elementaryStreams[d.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:n};else if(d.firstKeyFrame&&d.independent&&1===a.id&&!s&&(this.couldBacktrack=!0),d.dropped&&d.independent){const r=this.getMainFwdBufferInfo(),a=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=d.firstKeyFramePTS?d.firstKeyFramePTS:e;if(!t&&a<l-this.config.maxBufferHole&&!s)return void this.backtrack(o);s&&(o.gap=!0),o.setElementaryStreamInfo(d.type,o.start,i,o.start,n,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(d.type,e,i,r,n),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(d,o,l,a,t||s)}else{if(!t&&!s)return void this.backtrack(o);o.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=g;l&&(l.elementaryStreams[Xp]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(Xp,e,t,s,i),this.bufferFragmentData(g,o,l,a)}if(m&&null!=u&&null!=(t=u.samples)&&t.length){const e={id:s,frag:o,details:m,samples:u.samples};i.trigger(gp.FRAG_PARSING_METADATA,e)}if(m&&h){const e={id:s,frag:o,details:m,samples:h.samples};i.trigger(gp.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${ey(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==Tb)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:a,audiovideo:n}=t;if(r){let s=Vy(r.codec,e.audioCodec);"mp4a"===s&&(s="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){s&&(s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(s="mp4a.40.5")}s&&-1!==s.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",this.log(`Android: force audio codec to ${s}`)),e.audioCodec&&e.audioCodec!==s&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${s}"`),r.levelCodec=s,r.id=bp,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${s||""}/${e.audioCodec||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=bp;const s=a.codec;if(4===(null==s?void 0:s.length))switch(s){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e"}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s}]${a.codec!==s?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}n&&(this.log(`Init audiovideo buffer, container:${n.container}, codecs[level/parsed]=[${e.codecs}/${n.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(gp.BUFFER_CODECS,t),!this.hls)return;o.forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(gp.BUFFER_APPENDING,{type:e,data:r,frag:s,part:null,chunkMeta:i,parent:s.type})}))}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,bp)}get maxBufferLength(){const{levels:e,level:t}=this,s=null==e?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=xb}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(sx.isBuffered(e,s)?t=this.getAppendedFrag(s):sx.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(gp.FRAG_CHANGED,{frag:t}),e&&e.level===s||this.hls.trigger(gp.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return dp(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(dp(t)){const e=this.getLevelDetails(),s=this.currentFrag||(e?yv(null,e.fragments,t):null);if(s){const e=s.programDateTime;if(null!==e){const i=e+1e3*(t-s.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class OT{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[s].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=mp.KEY_LOAD_ERROR,s,i,r){return new Qv({type:fp.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:s,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===s||"initSegment"===r.sn||s<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,mp.KEY_LOAD_ERROR,s))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,mp.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let n=this.keyUriToKeyInfo[a];if(null!=(s=n)&&s.decryptdata.key)return r.key=n.decryptdata.key,Promise.resolve({frag:e,keyInfo:n});var o;if(null!=(i=n)&&i.keyLoadPromise)switch(null==(o=n.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return n.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:n})))}switch(n=this.keyUriToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(n,e):this.loadKeyEME(n,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(n,e);default:return Promise.reject(this.createKeyLoadError(e,mp.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(s);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,s)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=new(0,s.loader)(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((r,a)=>{const n={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=s.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,i)=>{const{frag:n,keyInfo:o,url:l}=s;if(!n.decryptdata||o!==this.keyUriToKeyInfo[l])return a(this.createKeyLoadError(n,mp.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=n.decryptdata.key=new Uint8Array(e.data),n.keyLoader=null,o.loader=null,r({frag:n,keyInfo:o})},onError:(e,s,i,r)=>{this.resetLoader(s),a(this.createKeyLoadError(t,mp.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,Lp({url:n.url,data:void 0},e)))},onTimeout:(e,s,i)=>{this.resetLoader(s),a(this.createKeyLoadError(t,mp.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,s,i)=>{this.resetLoader(s),a(this.createKeyLoadError(t,mp.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(n,l,c)}))}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function MT(e){const{type:t}=e;switch(t){case vp:return wp;case xp:return Ep;default:return bp}}function FT(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class $T{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.on(gp.LEVEL_LOADING,this.onLevelLoading,this),e.on(gp.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(gp.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(gp.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(gp.MANIFEST_LOADING,this.onManifestLoading,this),e.off(gp.LEVEL_LOADING,this.onLevelLoading,this),e.off(gp.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(gp.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(gp.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=new(s||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:pp,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:a,deliveryDirectives:n,levelInfo:o}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:yp,url:a,deliveryDirectives:n,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:n}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:vp,url:r,deliveryDirectives:a,levelOrTrack:n})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:n}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:xp,url:r,deliveryDirectives:a,levelOrTrack:n})}onLevelsUpdated(e,t){const s=this.loaders[yp];if(s){const e=s.context;e&&!t.levels.some((t=>t===e.levelOrTrack))&&(s.abort(),delete this.loaders[yp])}}load(e){var t;const s=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=this.hls.logger,s=r.context;if(s&&s.levelOrTrack===e.levelOrTrack&&(s.url===e.url||s.deliveryDirectives&&!e.deliveryDirectives))return void(s.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${s.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===pp?s.manifestLoadPolicy.default:kp({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),dp(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===yp&&null!==e.level?t=this.hls.levels[e.level].details:e.type===vp&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===xp&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);i=kp({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},n={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(e,t,s,i)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const a=e.data;0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),Gx.isMediaPlaylist(a)||s.type!==pp?this.handleTrackOrLevelPlaylist(e,t,s,i||null,r):this.handleMasterPlaylist(e,t,s,i)):this.handleManifestParsingError(e,s,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,s,i)=>{this.handleNetworkError(t,s,!1,e,i)},onTimeout:(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};r.load(e,n,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,a=e.data,n=FT(e,s),o=Gx.parseMasterPlaylist(a,n);if(o.playlistParsingError)return void this.handleManifestParsingError(e,s,o.playlistParsingError,i,t);const{contentSteering:l,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f}=o;this.variableList=f;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":p}=Gx.parseMasterPlaylistMedia(a,n,o);if(m.length){m.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new dx({}),bitrate:0,url:""}))}r.trigger(gp.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:g,captions:p,contentSteering:l,url:n,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,i,r){const a=this.hls,{id:n,level:o,type:l}=s,c=FT(e,s),d=dp(o)?o:dp(n)?n:0,h=MT(s),u=Gx.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(l===pp){const e={attrs:new dx({}),bitrate:0,details:u,name:"",url:c};u.requestScheduled=t.loading.start+ob(u,0),a.trigger(gp.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=u,this.handlePlaylistLoaded(u,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(gp.ERROR,{type:fp.NETWORK_ERROR,details:mp.MANIFEST_PARSING_ERROR,fatal:t.type===pp,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let a=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===yp?a+=`: ${e.level} id: ${e.id}`:e.type!==vp&&e.type!==xp||(a+=` id: ${e.id} group-id: "${e.groupId}"`);const n=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let o=mp.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case pp:o=s?mp.MANIFEST_LOAD_TIMEOUT:mp.MANIFEST_LOAD_ERROR,l=!0;break;case yp:o=s?mp.LEVEL_LOAD_TIMEOUT:mp.LEVEL_LOAD_ERROR,l=!1;break;case vp:o=s?mp.AUDIO_TRACK_LOAD_TIMEOUT:mp.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case xp:o=s?mp.SUBTITLE_TRACK_LOAD_TIMEOUT:mp.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const d={type:fp.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:n,networkDetails:t,stats:r};if(i){const s=(null==t?void 0:t.url)||e.url;d.response=Lp({url:s,data:void 0},i)}this.hls.trigger(gp.ERROR,d)}handlePlaylistLoaded(e,t,s,i,r,a){const n=this.hls,{type:o,level:l,id:c,groupId:d,deliveryDirectives:h}=i,u=FT(t,i),f=MT(i),m="number"==typeof i.level&&f===bp?l:void 0;if(!e.fragments.length){const a=e.playlistParsingError=new Error("No Segments found in Playlist");return void n.trigger(gp.ERROR,{type:fp.NETWORK_ERROR,details:mp.LEVEL_EMPTY_ERROR,fatal:!1,url:u,error:a,reason:a.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){if(this.hls.logger.warn(g),!n.config.ignorePlaylistParsingErrors)return void n.trigger(gp.ERROR,{type:fp.NETWORK_ERROR,details:mp.LEVEL_PARSING_ERROR,fatal:!1,url:u,error:g,reason:g.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s});e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case pp:case yp:n.trigger(gp.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||n.levels[0],level:m||0,id:c||0,stats:s,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:o===pp});break;case vp:n.trigger(gp.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:h});break;case xp:n.trigger(gp.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:h})}}}class UT{static get version(){return Mb}static isMSESupported(){return DT()}static isSupported(){return function(){if(!DT())return!1;const e=Op();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(Oy(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(Oy(t,"audio")))))}()}static getMediaSource(){return Op()}static get Events(){return gp}static get MetadataSchema(){return ow}static get ErrorTypes(){return fp}static get ErrorDetails(){return mp}static get DefaultConfig(){return UT.defaultConfig?UT.defaultConfig:bT}static set DefaultConfig(e){UT.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ob,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,s){const i=Cp();if("object"==typeof console&&!0===e||"object"==typeof e){const a=["debug","log","info","warn","error"];a.forEach((t=>{i[t]=Ip(t,e,s)}));try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.2`)}catch(r){return Cp()}a.forEach((t=>{Dp[t]=Ip(t,e)}))}else kp(Dp,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=function(e,t,s){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=wT(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const a=`${"level"===e?"playlist":e}LoadPolicy`,n=void 0===t[a],o=[];r.forEach((s=>{const r=`${e}Loading${s}`,l=t[r];if(void 0!==l&&n){o.push(r);const e=i[a].default;switch(t[a]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&s.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${a}": ${ov(t[a])}`)})),Lp(Lp({},i),t)}(UT.DefaultConfig,e,t);this.userConfig=e,s.progressive&&ET(s,t);const{abrController:i,bufferController:r,capLevelController:a,errorController:n,fpsController:o}=s,l=new n(this),c=this.abrController=new i(this),d=new Fv(this),h=s.interstitialsController,u=h?this.interstitialsController=new h(this,UT):null,f=this.bufferController=new r(this,d),m=this.capLevelController=new a(this),g=new o(this),p=new $T(this),y=s.contentSteeringController,v=y?new y(this):null,x=this.levelController=new NT(this,v),b=new RT(this),w=new OT(this.config),E=this.streamController=new jT(this,d,w),S=this.gapController=new ST(this,d);m.setStreamController(E),g.setStreamController(E);const T=[p,x,E];u&&T.splice(1,0,u),v&&T.splice(1,0,v),this.networkControllers=T;const _=[c,f,S,m,g,b,d];this.audioTrackController=this.createController(s.audioTrackController,T);const k=s.audioStreamController;k&&T.push(this.audioStreamController=new k(this,d,w)),this.subtitleTrackController=this.createController(s.subtitleTrackController,T);const A=s.subtitleStreamController;A&&T.push(this.subtititleStreamController=new A(this,d,w)),this.createController(s.timelineController,_),w.emeController=this.emeController=this.createController(s.emeController,_),this.cmcdController=this.createController(s.cmcdController,_),this.latencyController=this.createController(PT,_),this.coreComponents=_,T.push(l);const L=l.onErrorOut;"function"==typeof L&&this.on(gp.ERROR,L,l),this.on(gp.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const t=e===gp.ERROR;this.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.INTERNAL_EXCEPTION,fatal:t,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(gp.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(gp.ERROR,{type:fp.OTHER_ERROR,details:mp.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(gp.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(gp.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(gp.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=zp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(gp.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),this.started&&this.networkControllers);s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((e=>{e.resumeBuffering&&e.resumeBuffering()})))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((e=>{e.pauseBuffering&&e.pauseBuffering()})))}get inFlightFragments(){const e={[bp]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[wp]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ep]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}));return s}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Jy.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return Xy(e,cv(t),navigator.mediaCapabilities)}}UT.defaultConfig=void 0;const BT=Y.createContext(),VT=()=>{const e=Y.useContext(BT);if(!e)throw new Error("useClips debe ser usado dentro de un ClipsProvider");return e},GT=({children:t})=>{const[s,i]=Y.useState([]),{user:r}=um(),a=async()=>{if(!r)return void i([]);const{data:e,error:t}=await nm.from("clips").select("*").eq("user_id",r.auth.id).order("created_at",{ascending:!1});t||i(e)};Y.useEffect((()=>{a()}),[r]);return e.jsx(BT.Provider,{value:{savedClips:s,addClip:async e=>{if(!r)return;const{data:t,error:s}=await nm.from("clips").insert([{...e,user_id:r.auth.id}]).select();return!s&&t&&i((e=>[t[0],...e])),{data:t,error:s}},deleteClip:async e=>{if(!r)return;const{error:t}=await nm.from("clips").delete().eq("id",e).eq("user_id",r.auth.id);t||i((t=>t.filter((t=>t.id!==e))))},fetchClips:a},children:t})},KT=()=>{const[t,s]=Y.useState(!1),[i,r]=Y.useState(null),a=Y.useRef(null),n=Y.useRef(null),o=Y.useRef([]),l=Y.useRef(null),[c,d]=Y.useState([]),[h,u]=Y.useState(""),f=Y.useRef(null),{addClip:m}=VT(),{user:g}=um(),{t:p}=Ec();Y.useEffect((()=>{const e="https://agvyby.fubohd.com/foxsports2/mono.m3u8?token=d1fc2b72eb241226d14e6f37dca36007fb8dff81-b6-1750547321-1750529321";return a.current&&(()=>{if(UT.isSupported()){const t=new UT({debug:!0,enableWorker:!0,lowLatencyMode:!0,backBufferLength:90});l.current=t,t.on(UT.Events.MEDIA_ATTACHED,(()=>{t.loadSource(e)})),t.on(UT.Events.MANIFEST_PARSED,((e,t)=>{a.current.play().catch((e=>{}))})),t.on(UT.Events.ERROR,((e,s)=>{if(s.fatal)switch(s.type){case UT.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case UT.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:t.destroy()}})),t.attachMedia(a.current)}else a.current.canPlayType("application/vnd.apple.mpegurl")?(a.current.src=e,a.current.addEventListener("loadedmetadata",(()=>{a.current.play().catch((e=>{}))}))):r(p("live.error_no_hls"))})(),()=>{l.current&&l.current.destroy()}}),[]),Y.useEffect((()=>{(async()=>{const{data:e,error:t}=await nm.from("live_chat").select("*").order("created_at",{ascending:!0});t||d(e)})();const e=nm.channel("public:live_chat").on("postgres_changes",{event:"INSERT",schema:"public",table:"live_chat"},(e=>{d((t=>[...t,e.new]))})).subscribe();return()=>{nm.removeChannel(e)}}),[]),Y.useEffect((()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})}),[c]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(ag,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(ng,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(og,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:p("live.title")})}),e.jsxs(cg,{className:"pt-6",children:[i&&e.jsx("div",{className:"bg-red-900/50 border border-red-800 text-red-200 p-4 rounded-lg mb-6",children:i}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:a,className:"w-full h-full object-cover",controls:!0,autoPlay:!0,playsInline:!0}),e.jsxs("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center",children:[e.jsx(Fc,{className:"w-4 h-4 mr-2 animate-pulse"}),p("live.on_air")]})]}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:e.jsxs(nc,{onClick:t?async()=>{n.current&&t&&(n.current.stop(),s(!1),n.current.onstop=async()=>{if(!g)return void r(p("live.error_login"));const e=new Blob(o.current,{type:"video/webm"}),t=`clip_${g.auth.id}_${Date.now()}.webm`,{error:s}=await nm.storage.from("clips").upload(t,e);if(s)return void r(p("live.error_upload",{message:s.message}));const{data:i}=nm.storage.from("clips").getPublicUrl(t);await m({video_url:i.publicUrl,title:`Clip de ${g.nombre_usuario}`,start_time_seconds:a.current?.currentTime||0})})}:()=>{if(a.current)try{const e=a.current.captureStream(),t=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5});n.current=t,o.current=[],t.ondataavailable=e=>{e.data.size>0&&o.current.push(e.data)},t.onstop=()=>{const e=new Blob(o.current,{type:"video/webm"}),t=URL.createObjectURL(e),s=(new Date).toLocaleTimeString();m({url:t,title:`Clip ${s}`,duration:"0:45",timestamp:(new Date).toISOString()})},t.start(),s(!0)}catch(e){r(p("live.error_record"))}},className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(sd,{className:"w-5 h-5 mr-2"}),p(t?"live.stop_record":"live.record_clip")]})})]}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col h-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-200",children:p("live.chat_title")}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-900/50 rounded-lg p-3 border border-gray-800 mb-2 max-h-96",children:[0===c.length&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:p("live.no_messages")}),c.map((t=>e.jsxs("div",{className:"mb-2",children:[e.jsx(Eg,{username:t.username,className:"font-bold text-red-400 mr-2"}),e.jsx("span",{className:"text-gray-300",children:t.message}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:new Date(t.created_at).toLocaleTimeString()})]},t.id))),e.jsx("div",{ref:f})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h.trim()&&g&&(await nm.from("live_chat").insert([{user_id:g.auth.id,username:g.nombre_usuario,message:h}]),u(""))},className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:e=>u(e.target.value),placeholder:p("live.write_message"),className:"flex-1 rounded-md bg-gray-800 text-white px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:!g}),e.jsx(nc,{type:"submit",className:"bg-red-600 hover:bg-red-700 text-white font-bold px-4 py-2 rounded-md",disabled:!g,children:p("live.send")})]})]})]})]})]})})})},HT=async e=>{try{const{data:t,error:s}=await nm.from("peleas").select("*").eq("evento_id",e).eq("tipo_pelea","principal").eq("activo",!0).single();if(s){if("PGRST116"===s.code)return null;throw new Error(`Error al obtener pelea principal: ${s.message}`)}return t}catch(t){throw t}},qT=async e=>{try{const{data:t,error:s}=await nm.from("peleas").select("*").eq("evento_id",e).eq("tipo_pelea","co-estelar").eq("activo",!0).single();if(s){if("PGRST116"===s.code)return null;throw new Error(`Error al obtener pelea co-estelar: ${s.message}`)}return t}catch(t){throw t}},WT=async e=>{try{const{data:t,error:s}=await nm.from("peleas").select("*").eq("evento_id",e).eq("tipo_pelea","estelar").eq("activo",!0).order("orden_pelea",{ascending:!0});if(s)throw new Error(`Error al obtener peleas estelares: ${s.message}`);return t||[]}catch(t){throw t}},zT=async e=>{try{const{data:t,error:s}=await nm.from("peleas").select("*").eq("evento_id",e).eq("tipo_pelea","preliminar").eq("activo",!0).order("orden_pelea",{ascending:!0});if(s)throw new Error(`Error al obtener peleas preliminares: ${s.message}`);return t||[]}catch(t){throw t}},YT={"Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://static.ufcstats.com/images/athlete/Jamahal-Hill.png","Khalil Rountree Jr.":"https://static.ufcstats.com/images/athlete/Khalil-Rountree.png","Rose Namajunas":"https://static.ufcstats.com/images/athlete/Rose-Namajunas.png","Maycee Barber":"https://static.ufcstats.com/images/athlete/Maycee-Barber.png","Leon Edwards":"https://static.ufcstats.com/images/athlete/Leon-Edwards.png","Belal Muhammad":"https://static.ufcstats.com/images/athlete/Belal-Muhammad.png","Tom Aspinall":"https://static.ufcstats.com/images/athlete/Tom-Aspinall.png","Curtis Blaydes":"https://static.ufcstats.com/images/athlete/Curtis-Blaydes.png","Cory Sandhagen":"https://static.ufcstats.com/images/athlete/Cory-Sandhagen.png","Umar Nurmagomedov":"https://static.ufcstats.com/images/athlete/Umar-Nurmagomedov.png","Joe Pyfer":"https://static.ufcstats.com/images/athlete/Joe-Pyfer.png","Michel Pereira":"https://static.ufcstats.com/images/athlete/Michel-Pereira.png","Mayra Bueno Silva":"https://static.ufcstats.com/images/athlete/Mayra-Bueno-Silva.png","Irene Aldana":"https://static.ufcstats.com/images/athlete/Irene-Aldana.png","Ian Machado Garry":"https://static.ufcstats.com/images/athlete/Ian-Garry.png","Michael Page":"https://static.ufcstats.com/images/athlete/Michael-Page.png","Cub Swanson":"https://static.ufcstats.com/images/athlete/Cub-Swanson.png","Andre Fili":"https://static.ufcstats.com/images/athlete/Andre-Fili.png","Jessica Andrade":"https://static.ufcstats.com/images/athlete/Jessica-Andrade.png","Macy Chiasson":"https://static.ufcstats.com/images/athlete/Macy-Chiasson.png","Brandon Royval":"https://static.ufcstats.com/images/athlete/Brandon-Royval.png","Manel Kape":"https://static.ufcstats.com/images/athlete/Manel-Kape.png","Raul Rosas Jr.":"https://static.ufcstats.com/images/athlete/Raul-Rosas-Jr.png","Ricky Turcios":"https://static.ufcstats.com/images/athlete/Ricky-Turcios.png"},XT=({eventTitle:t,eventId:s=null})=>{const{t:i}=Ec(),{id:r}=se(),[a,n]=Y.useState(null),[o,l]=Y.useState(null),[c,d]=Y.useState(null),[h,u]=Y.useState([]),[f,m]=Y.useState([]),[g,p]=Y.useState(!0),[y,v]=Y.useState(null);Y.useEffect((()=>{(async()=>{try{p(!0),v(null);const e=await Zm();let i;const a=r||s;if(a?i=e.find((e=>e.id===parseInt(a))):t&&(i=e.find((e=>e.titulo===t))),i){n(i);const[e,t,s,r]=await Promise.all([HT(i.id),qT(i.id),WT(i.id),zT(i.id)]);l(e),d(t),u(s),m(r)}else n(null)}catch(Lk){v(Lk.message)}finally{p(!1)}})()}),[r,t,s]);return g?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs("div",{className:"flex justify-center items-center py-20",children:[e.jsx(Wc,{className:"w-8 h-8 animate-spin text-red-500 mr-4"}),e.jsx("span",{className:"text-gray-400",children:"Cargando evento..."})]})})}):y?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(kc,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Error al cargar evento"}),e.jsx("p",{className:"text-gray-400",children:y})]})})})}):a?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(ag,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:a.imagen||"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:a.texto_alternativo||a.titulo,className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(ng,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(og,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:a.titulo}),e.jsxs("div",{className:"text-gray-300 mt-2 text-lg",children:[(x=a.fecha,new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))," - ",a.ubicacion," (",a.sede,")"]}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs(cg,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),o&&e.jsxs("div",{className:"bg-red-900/20 rounded-lg px-4 py-3 border border-red-700 mb-4",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-red-400 font-bold text-sm uppercase tracking-wider",children:"Pelea Principal"})}),e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:o.peleador_1_nombre}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:o.peleador_1_bandera})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:o.peleador_2_bandera}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:o.peleador_2_nombre})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-red-300 font-semibold",children:o.categoria_peso})})]}),c&&e.jsxs("div",{className:"bg-blue-900/20 rounded-lg px-4 py-3 border border-blue-700 mb-4",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsx("span",{className:"text-blue-400 font-bold text-sm uppercase tracking-wider",children:"Co-Estelar"})}),e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:c.peleador_1_nombre}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:c.peleador_1_bandera})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:c.peleador_2_bandera}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:c.peleador_2_nombre})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:c.categoria_peso})})]}),e.jsx("div",{className:"space-y-4 mb-8",children:h.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:YT[t.peleador_1_nombre]||"https://via.placeholder.com/44x44/333/fff?text=?",alt:t.peleador_1_nombre,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.peleador_1_bandera}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.peleador_1_nombre})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.peleador_2_nombre}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.peleador_2_bandera}),e.jsx("img",{src:YT[t.peleador_2_nombre]||"https://via.placeholder.com/44x44/333/fff?text=?",alt:t.peleador_2_nombre,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.categoria_peso})})]},t.id)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Prelims"}),e.jsx("div",{className:"space-y-3",children:f.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:YT[t.peleador_1_nombre]||"https://via.placeholder.com/36x36/333/fff?text=?",alt:t.peleador_1_nombre,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.peleador_1_bandera}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.peleador_1_nombre})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.peleador_2_nombre}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.peleador_2_bandera}),e.jsx("img",{src:YT[t.peleador_2_nombre]||"https://via.placeholder.com/36x36/333/fff?text=?",alt:t.peleador_2_nombre,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.categoria_peso})})]},t.id)))})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-400 mb-2",children:"Evento no encontrado"}),e.jsx("p",{className:"text-gray-500",children:"El evento solicitado no está disponible."})]})})});var x},JT=()=>e.jsx(XT,{eventId:1}),QT=()=>{const{savedClips:t,deleteClip:s}=VT(),{t:i}=Ec();return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(ag,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(ng,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(og,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:i("clips.saved_clips")})}),e.jsx(cg,{className:"pt-6",children:0===t.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:i("clips.no_clips")}),e.jsx("p",{className:"text-gray-500 mt-2",children:i("clips.hint_record")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((t=>e.jsx(al.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},children:e.jsxs(ag,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("video",{src:t.video_url,className:"w-full h-full object-cover",controls:!0}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(Fc,{className:"w-3 h-3 mr-1 text-red-500"}),t.duration_seconds,"s"]})]}),e.jsxs(cg,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-white",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Grabado el ",new Date(t.created_at).toLocaleString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(nc,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>((e,t)=>{const s=document.createElement("a");s.href=e,s.download=`${t}.webm`,document.body.appendChild(s),s.click(),document.body.removeChild(s)})(t.video_url,t.title),children:[e.jsx(Vc,{className:"w-4 h-4 mr-2"}),i("clips.download")]}),e.jsxs(nc,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>{return e=t.video_url,void(navigator.share?navigator.share({title:i("clips.clip_title"),url:e}):(navigator.clipboard.writeText(e),alert(i("clips.url_copied"))));var e},children:[e.jsx(rd,{className:"w-4 h-4 mr-2"}),i("clips.share")]}),e.jsx(nc,{variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>s(t.id),children:e.jsx(ud,{className:"w-4 h-4"})})]})]})]})},t.id)))})})]})})})},ZT=Y.forwardRef((({className:t,...s},i)=>e.jsx(H,{ref:i,className:tc("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s})));ZT.displayName=H.displayName;const e_=Y.forwardRef((({className:t,...s},i)=>e.jsx(q,{ref:i,className:tc("aspect-square h-full w-full",t),...s})));e_.displayName=q.displayName;const t_=Y.forwardRef((({className:t,...s},i)=>e.jsx(W,{ref:i,className:tc("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s})));t_.displayName=W.displayName;const s_=()=>{const{id:t}=se(),{t:s}=Ec(),[i,r]=Y.useState(null),[a,n]=Y.useState([]),[o,l]=Y.useState(""),{user:c}=um(),d=c?.auth?.id,h=c?.nombre_usuario,u=c?.avatar;if(Y.useEffect((()=>{(async function(e){const{data:t,error:s}=await nm.from("forum_threads").select("*").eq("id",e).single();if(s)throw s;return t})(t).then(r),async function(e){const{data:t,error:s}=await nm.from("forum_replies").select("*").eq("thread_id",e).order("created_at",{ascending:!0});if(s)throw s;return t||[]}(t).then(n)}),[t]),!i)return e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:s("thread.not_found")})});return e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(ag,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(ng,{children:[e.jsx(og,{className:"text-3xl font-bold text-red-500 mb-2",children:i.title}),e.jsxs("p",{className:"text-sm text-gray-400",children:[s("thread.by")," ",e.jsx(Eg,{username:i.username,className:"font-medium text-red-400"})," - ",new Date(i.created_at).toLocaleString()]})]})}),e.jsx(ag,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(cg,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(ZT,{className:"h-10 w-10 mr-4",children:[e.jsx(e_,{src:i.avatar||"https://github.com/shadcn.png",alt:i.username}),e.jsx(t_,{children:i.username?.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(Eg,{username:i.username,className:"font-semibold text-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(i.created_at).toLocaleString()})]})]}),e.jsx("div",{className:"whitespace-pre-line text-lg text-white",children:i.content})]})}),e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:s("thread.replies",{count:a.length})}),e.jsx(ag,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm mb-6",children:e.jsx(cg,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:a.length>0?a.map((t=>e.jsx("li",{className:"p-4",children:e.jsx(ag,{className:"bg-gray-900 border-gray-800 mb-2",children:e.jsxs(cg,{className:"flex items-start gap-4 p-4",children:[e.jsxs(ZT,{className:"h-8 w-8",children:[e.jsx(e_,{src:t.avatar||"https://github.com/shadcn.png",alt:t.username}),e.jsx(t_,{children:t.username?.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(Eg,{username:t.username,className:"font-semibold text-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleString()}),e.jsx("div",{className:"whitespace-pre-line text-white mt-1",children:t.content})]})]})})},t.id))):e.jsx("li",{className:"p-4 text-center text-gray-500",children:s("thread.no_replies")})})})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!o.trim())return;const s=await async function({thread_id:e,content:t,user_id:s,username:i,avatar:r}){const{data:a,error:n}=await nm.from("forum_replies").insert([{thread_id:e,content:t,user_id:s,username:i,avatar:r}]).select().single();if(n)throw n;return a}({thread_id:t,content:o,user_id:d,username:h,avatar:u});n([...a,s]),l("")},className:"mb-8",children:[e.jsx(Qg,{value:o,onChange:e=>l(e.target.value),placeholder:s("thread.reply_placeholder"),className:"mb-2 bg-gray-900 border-gray-700 text-white",rows:3,required:!0,disabled:!c}),e.jsx(nc,{type:"submit",className:"bg-red-600 hover:bg-red-700",disabled:!c,children:s("thread.reply_button")})]})]})})},i_=()=>{const{id:t}=se(),{t:s}=Ec(),[i,r]=Y.useState(null),[a,n]=Y.useState([]);return Y.useEffect((()=>{Zg().then((e=>{const s=e.find((e=>String(e.id)===String(t)));r(s)})),async function(e){const{data:t,error:s}=await nm.from("forum_threads").select("*").eq("category_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]}(t).then(n)}),[t]),i?e.jsx(al.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(ag,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(ng,{className:"text-center",children:[e.jsx(og,{className:"text-4xl md:text-5xl font-black mb-2 uppercase text-red-500 tracking-wider",children:i.name}),e.jsx(lg,{className:"text-lg text-gray-400 mb-4",children:i.description}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center mt-4",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx(sg,{type:"text",placeholder:s("category.search_placeholder",{category:i.name}),className:"pl-10 bg-gray-800 border-gray-700 focus:border-red-500 focus:ring-red-500 text-white"}),e.jsx(id,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsx(ep,{categoryId:i.id,onThreadCreated:e=>n([e,...a])})]})]})}),e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:s("category.threads_in",{category:i.name,count:a.length})}),e.jsx(ag,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx(cg,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:a.length>0?a.map((t=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ZT,{className:"h-8 w-8",children:[e.jsx(e_,{src:t.avatar||"https://github.com/shadcn.png",alt:t.username}),e.jsx(t_,{children:t.username?.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(Z,{to:`/thread/${t.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s("forum.by")," ",e.jsx("span",{className:"font-medium text-gray-400",children:t.username})," ","-"," ",new Date(t.created_at).toLocaleString()]})]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(Z,{to:`/thread/${t.id}`,children:e.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded flex items-center",children:[e.jsx(Qc,{className:"w-4 h-4 mr-1"}),"Ver hilo"]})})})]},t.id))):e.jsx("li",{className:"p-4 text-center text-gray-500",children:s("category.no_threads")})})})})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:s("category.not_found")})})},r_=()=>e.jsx(XT,{eventId:2}),a_=()=>e.jsx(XT,{eventId:3}),n_=()=>e.jsx(XT,{eventId:4}),o_=({paquete:t,onSelect:s,isSelected:i,isLoading:r})=>{const{t:a}=Ec();return e.jsxs(ag,{className:"transition-all duration-300 cursor-pointer "+(t.popular?"border-yellow-500 bg-gradient-to-br from-yellow-900/20 to-black ring-2 ring-yellow-500/50":i?"border-red-500 bg-gradient-to-br from-red-900/20 to-black ring-2 ring-red-500/50":"border-gray-700 bg-gradient-to-br from-gray-900/50 to-black hover:border-gray-600"),children:[e.jsxs(ng,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:t.popular&&e.jsxs(xg,{className:"bg-yellow-500 text-black font-bold mb-2",children:[e.jsx(cd,{className:"h-3 w-3 mr-1"}),a("coins.most_popular")]})}),e.jsx(og,{className:"text-xl font-bold text-white mb-2",children:t.nombre}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-3",children:[e.jsx($c,{className:"h-6 w-6 text-yellow-400"}),e.jsx("span",{className:"text-3xl font-bold text-yellow-400",children:t.monedas.toLocaleString()})]}),e.jsx("div",{className:"text-gray-200 text-sm mb-4",children:t.descripcion}),t.descuento>0&&e.jsx("div",{className:"flex items-center justify-center space-x-2 mb-3",children:e.jsxs(xg,{variant:"destructive",className:"text-xs",children:[e.jsx(bd,{className:"h-3 w-3 mr-1"}),t.descuento,"% ",a("coins.discount")]})})]}),e.jsxs(cg,{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",t.precio.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-200",children:[a("coins.per_coin"),": $",(t.precio/t.monedas).toFixed(3)]})]}),e.jsx(nc,{className:"w-full "+(t.popular?"bg-yellow-600 hover:bg-yellow-700 text-black font-bold":"bg-red-600 hover:bg-red-700 text-white"),onClick:()=>s(t),disabled:r,children:r?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:a("coins.processing")})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($c,{className:"h-4 w-4"}),e.jsx("span",{children:a("coins.buy_now")})]})})]})]})},l_=({transactions:t,isLoading:s})=>{const{t:i}=Ec(),r=t=>{switch(t){case"ingreso":return e.jsx(md,{className:"h-4 w-4 text-green-500"});case"egreso":return e.jsx(md,{className:"h-4 w-4 text-red-500 rotate-180"});default:return e.jsx($c,{className:"h-4 w-4 text-gray-400"})}},a=e=>{switch(e){case"ingreso":return"text-green-400";case"egreso":return"text-red-400";default:return"text-gray-400"}};return s?e.jsxs(ag,{className:"bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:[e.jsx(ng,{children:e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(Fc,{className:"h-5 w-5"}),e.jsx("span",{children:i("transactions.history")})]})}),e.jsx(cg,{children:e.jsx("div",{className:"space-y-3",children:[...Array(3)].map(((t,s)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800/50 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-600 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-600 rounded w-3/4 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-600 rounded w-1/2"})]}),e.jsx("div",{className:"h-3 bg-gray-600 rounded w-16"})]},s)))})})]}):e.jsxs(ag,{className:"bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:[e.jsx(ng,{children:e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(Fc,{className:"h-5 w-5"}),e.jsx("span",{children:i("transactions.history")}),e.jsx(xg,{variant:"secondary",className:"ml-auto",children:t.length})]})}),e.jsx(cg,{children:0===t.length?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx($c,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:i("transactions.no_transactions")})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:t.map((t=>{return e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-800/50 rounded-lg hover:bg-gray-800/70 transition-colors",children:[r(t.tipo),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate",children:(n=t.motivo,{registro:i("transactions.registration"),apuesta:i("transactions.bet"),voto:i("transactions.vote"),compra_paquete_basico:i("transactions.purchase_basic"),compra_paquete_estandar:i("transactions.purchase_standard"),compra_paquete_premium:i("transactions.purchase_premium"),compra_paquete_pro:i("transactions.purchase_pro"),ingreso:i("transactions.income"),egreso:i("transactions.expense")}[n]||n)}),e.jsx("div",{className:"text-xs text-gray-400",children:(s=t.fecha,new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),e.jsxs("div",{className:`text-sm font-bold ${a(t.tipo)}`,children:["ingreso"===t.tipo?"+":"-",Number(t.cantidad).toLocaleString()]})]},t.id);var s,n}))})})]})};async function c_(e,t={}){const s=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=`http://localhost:3001/api/compras${e}`,r={headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},...t};try{const e=await fetch(i,r);if(!e.ok){const t=await e.json().catch((()=>({})));throw new Error(t.error||`Error ${e.status}: ${e.statusText}`)}return await e.json()}catch(a){throw a}}const d_=()=>{const[t,s]=Y.useState([]),[i,r]=Y.useState(!1),[a,n]=Y.useState(""),o=async()=>{r(!0);try{const e=await async function(){return c_("/paquetes")}();e.success?(s(e.paquetes),n("✅ Paquetes obtenidos correctamente")):n("❌ Error: "+e.error)}catch(e){n("❌ Error de conexión: "+e.message)}finally{r(!1)}};return Y.useEffect((()=>{o()}),[]),e.jsxs(ag,{className:"max-w-2xl mx-auto mt-8",children:[e.jsx(ng,{children:e.jsx(og,{className:"text-2xl",children:"🧪 Prueba del Backend de Compras"})}),e.jsxs(cg,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(nc,{onClick:o,disabled:i,variant:"outline",children:"🔍 Obtener Paquetes"}),e.jsx(nc,{onClick:async()=>{r(!0);try{const e=await async function(e){return c_("/crear-pago",{method:"POST",body:JSON.stringify({paqueteId:e})})}("estandar");e.success?n("✅ Pago creado: "+e.preference_id):n("❌ Error: "+e.error)}catch(e){n("❌ Error de conexión: "+e.message)}finally{r(!1)}},disabled:i,variant:"outline",children:"💳 Crear Pago de Prueba"})]}),a&&e.jsx("div",{className:"p-3 rounded-md bg-gray-100",children:e.jsx("p",{className:"font-mono",children:a})}),t.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Paquetes Disponibles:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((t=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.monedas," Monedas"]}),e.jsxs("p",{className:"text-green-600 font-semibold",children:["$",t.precio]}),t.popular&&e.jsx("span",{className:"inline-block bg-yellow-400 text-yellow-900 px-2 py-1 text-xs rounded",children:"⭐ Más Popular"})]},t.id)))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"🚀 Estado del Sistema:"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{children:"✅ Servidor Backend: Puerto 3001"}),e.jsx("p",{children:"✅ API Endpoints: Funcionando"}),e.jsx("p",{children:"✅ Integración MercadoPago: Configurada"}),e.jsx("p",{children:"✅ Webhooks: Listos"}),e.jsx("p",{children:"✅ Base de Datos: Conectada"})]})]})]})]})},h_=()=>{const{user:t,refreshUser:s}=um(),{t:i}=Ec(),{toast:r}=Wm(),[a,n]=Y.useState(null),[o,l]=Y.useState(!1),[c,d]=Y.useState([]),[h,u]=Y.useState(!0);Y.useEffect((()=>{t?.id&&f()}),[t?.id]);const f=async()=>{try{u(!0);const e=await async function(e,t=50){const{data:s,error:i}=await nm.from("transacciones_moneda").select("*").eq("usuario_id",e).order("fecha",{ascending:!1}).limit(t);if(i)throw i;return s||[]}(t.id,20);d(e)}catch(e){r({title:i("error.title"),description:i("error.loading_history"),variant:"destructive"})}finally{u(!1)}},m=async e=>{if(t){l(!0),n(e);try{await async function(e,t){return{id:`pref_${Date.now()}`,init_point:`https://www.mercadopago.com.ar/checkout/v1/redirect?pref_id=pref_${Date.now()}`,sandbox_init_point:`https://sandbox.mercadopago.com.ar/checkout/v1/redirect?pref_id=pref_${Date.now()}`,paquete:e,userId:t}}(e,t.id);r({title:i("coins.purchase_initiated"),description:i("coins.redirecting_payment")}),setTimeout((()=>{r({title:i("coins.purchase_success"),description:i("coins.coins_added",{coins:e.monedas})}),s(),f(),n(null)}),2e3)}catch(a){r({title:i("error.title"),description:i("error.purchase_failed"),variant:"destructive"})}finally{l(!1)}}else r({title:i("error.title"),description:i("auth.login_required"),variant:"destructive"})};return t?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[e.jsx($c,{className:"h-8 w-8 text-yellow-400"}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:i("coins.title")})]}),e.jsx("p",{className:"text-gray-400 text-lg max-w-2xl mx-auto",children:i("coins.subtitle")})]}),e.jsx(ag,{className:"mb-8 bg-gradient-to-r from-gray-800 to-gray-900 border-yellow-500/70 shadow-lg",children:e.jsx(cg,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($c,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:i("coins.current_balance")}),e.jsx("p",{className:"text-gray-300",children:i("coins.balance_description")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:t.saldo?.toLocaleString()||0}),e.jsx("div",{className:"text-sm text-gray-300",children:i("coins.coins")})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(ag,{className:"bg-gradient-to-br from-green-900/20 to-black border-green-500/50",children:e.jsxs(cg,{className:"p-6 text-center",children:[e.jsx(nd,{className:"h-8 w-8 text-green-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:i("coins.secure_payment")}),e.jsx("p",{className:"text-gray-400 text-sm",children:i("coins.secure_description")})]})}),e.jsx(ag,{className:"bg-gradient-to-br from-blue-900/20 to-black border-blue-500/50",children:e.jsxs(cg,{className:"p-6 text-center",children:[e.jsx(bd,{className:"h-8 w-8 text-blue-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:i("coins.instant_delivery")}),e.jsx("p",{className:"text-gray-400 text-sm",children:i("coins.instant_description")})]})}),e.jsx(ag,{className:"bg-gradient-to-br from-purple-900/20 to-black border-purple-500/50",children:e.jsxs(cg,{className:"p-6 text-center",children:[e.jsx(cd,{className:"h-8 w-8 text-purple-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:i("coins.best_value")}),e.jsx("p",{className:"text-gray-400 text-sm",children:i("coins.best_value_description")})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:i("coins.choose_package")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:cm.map((t=>e.jsx(o_,{paquete:t,onSelect:m,isSelected:a?.id===t.id,isLoading:o&&a?.id===t.id},t.id)))})]}),e.jsx("div",{children:e.jsx(l_,{transactions:c,isLoading:h})})]}),e.jsxs(ag,{className:"mt-8 bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:[e.jsx(ng,{children:e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(Uc,{className:"h-5 w-5"}),e.jsx("span",{children:i("coins.payment_methods")})]})}),e.jsx(cg,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:i("coins.accepted_methods")}),e.jsxs("ul",{className:"space-y-2 text-gray-400",children:[e.jsxs("li",{children:["• ",i("coins.credit_cards")]}),e.jsxs("li",{children:["• ",i("coins.debit_cards")]}),e.jsxs("li",{children:["• ",i("coins.bank_transfer")]}),e.jsxs("li",{children:["• ",i("coins.digital_wallets")]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:i("coins.security_info")}),e.jsxs("ul",{className:"space-y-2 text-gray-400",children:[e.jsxs("li",{children:["• ",i("coins.ssl_encryption")]}),e.jsxs("li",{children:["• ",i("coins.pci_compliant")]}),e.jsxs("li",{children:["• ",i("coins.refund_policy")]}),e.jsxs("li",{children:["• ",i("coins.customer_support")]})]})]})]})})]})]}),e.jsx(d_,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center",children:e.jsx(ag,{className:"w-full max-w-md bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:e.jsxs(cg,{className:"p-8 text-center",children:[e.jsx($c,{className:"h-16 w-16 mx-auto mb-4 text-yellow-400"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:i("coins.login_required")}),e.jsx("p",{className:"text-gray-400 mb-6",children:i("coins.login_message")}),e.jsx(nc,{asChild:!0,className:"w-full bg-red-600 hover:bg-red-700",children:e.jsx("a",{href:"/login",children:i("auth.login")})})]})})})},u_=({userId:t,tieneAcceso:s,loading:i,onComprarAcceso:r,saldoUsuario:a})=>{const{toast:n}=Wm(),o=500;return e.jsxs(ag,{className:"bg-gradient-to-br from-gray-900/50 to-black border-2 transition-all duration-300 "+(s?"border-green-500 shadow-green-500/20":"border-purple-500 shadow-purple-500/20"),children:[e.jsx(ng,{children:e.jsxs(og,{className:"text-white flex items-center space-x-2",children:[e.jsx(ed,{className:"h-6 w-6 text-purple-400"}),e.jsx("span",{children:"Acceso a Clips Destacados"}),s&&e.jsxs(xg,{className:"bg-green-500 text-white text-xs animate-pulse",children:[e.jsx(Nc,{className:"h-3 w-3 mr-1"}),"Desbloqueado"]})]})}),e.jsx(cg,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"text-4xl flex-shrink-0",children:s?"🎬":"🔒"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-white text-lg mb-2",children:s?"Acceso Premium Desbloqueado":"Contenido Exclusivo"}),e.jsx("p",{className:"text-gray-300 mb-3",children:s?"Disfruta de clips destacados exclusivos y contenido premium":"Desbloquea acceso a clips destacados exclusivos y contenido premium"}),!s&&e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx($c,{className:"h-4 w-4 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400 font-semibold",children:["Precio: ",o.toLocaleString()," monedas"]})]})]})]}),!s&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Saldo disponible: ",a?.toLocaleString()||0," monedas"]}),e.jsx(nc,{onClick:async()=>{try{await r(o),n({title:"🎉 ¡Acceso desbloqueado!",description:"Ahora puedes acceder a clips destacados exclusivos"})}catch(e){n({title:"Error",description:e.message||"No se pudo comprar el acceso",variant:"destructive"})}},disabled:i||(a||0)<o,className:((a||0)>=o?"bg-purple-600 hover:bg-purple-700":"bg-gray-600 cursor-not-allowed")+" text-white",children:i?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Comprando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(zc,{className:"h-4 w-4 mr-2"}),"Desbloquear Acceso"]})})]}),s&&e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-400",children:[e.jsx(Nc,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"¡Acceso activo!"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Puedes acceder a clips destacados desde el menú principal"})]})]})})]})},f_=()=>{const{user:t}=um(),{t:s}=Ec(),{toast:i}=Wm(),{loading:r,purchaseBadge:a}=bg(),{tieneAccesoClipsDestacados:n,loading:o,comprarAccesoClips:l}=zg(t?.id),[c,d]=Y.useState([]),[h,u]=Y.useState([]),[f,m]=Y.useState(!0);Y.useEffect((()=>{t?.id&&g()}),[t?.id]);const g=async()=>{try{m(!0);const[e,s]=await Promise.all([km(),Lm(t.id)]);d(e),u(s)}catch(e){i({title:"Error",description:"No se pudieron cargar los datos de la tienda",variant:"destructive"})}finally{m(!1)}},p=t=>{switch(t){case"comun":default:return e.jsx(cd,{className:"h-3 w-3"});case"rara":return e.jsx(Zap,{className:"h-3 w-3"});case"legendaria":return e.jsx(Bc,{className:"h-3 w-3"})}};if(!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center",children:e.jsx(ag,{className:"w-full max-w-md bg-gradient-to-br from-gray-900/50 to-black border-gray-700",children:e.jsxs(cg,{className:"p-8 text-center",children:[e.jsx(Bc,{className:"h-16 w-16 mx-auto mb-4 text-yellow-400"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Inscríbete para acceder"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Necesitas estar registrado para acceder a la tienda de insignias"}),e.jsx(nc,{asChild:!0,className:"w-full bg-red-600 hover:bg-red-700",children:e.jsx("a",{href:"/login",children:"Iniciar Sesión"})})]})})});const y=h.map((e=>e.insignia_id));return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[e.jsx(Bc,{className:"h-8 w-8 text-yellow-400"}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Canjear Recompensas"})]}),e.jsx("p",{className:"text-gray-400 text-lg max-w-2xl mx-auto",children:"Colecciona insignias exclusivas y desbloquea contenido premium"})]}),e.jsx(ag,{className:"mb-8 bg-gradient-to-r from-gray-800 to-gray-900 border-yellow-500/70 shadow-lg",children:e.jsx(cg,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($c,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Tu Saldo Actual"}),e.jsx("p",{className:"text-gray-300",children:"Monedas disponibles para comprar insignias"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:t.saldo?.toLocaleString()||0}),e.jsx("div",{className:"text-sm text-gray-300",children:"monedas"})]})]})})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center space-x-2",children:[e.jsx(cd,{className:"h-6 w-6 text-purple-400"}),e.jsx("span",{children:"Recompensas Premium"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsx(u_,{userId:t?.id,tieneAcceso:n,loading:o,onComprarAcceso:l,saldoUsuario:t?.saldo})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6",children:["Insignias Disponibles (",c.length,")"]}),f?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[...Array(6)].map(((t,s)=>e.jsxs(ag,{className:"animate-pulse",children:[e.jsxs(ng,{children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-2/3"})]}),e.jsxs(cg,{children:[e.jsx("div",{className:"h-16 bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]})]},s)))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:c.map((s=>{const i=y.includes(s.id),n=(e=>{switch(e){case"comun":default:return{border:"border-gray-600",background:"bg-gradient-to-br from-gray-800/50 to-black",badge:"bg-gray-600 text-white",icon:"text-gray-400"};case"rara":return{border:"border-blue-500",background:"bg-gradient-to-br from-blue-900/20 to-black",badge:"bg-blue-600 text-white",icon:"text-blue-400"};case"legendaria":return{border:"border-yellow-500",background:"bg-gradient-to-br from-yellow-900/20 to-black",badge:"bg-yellow-600 text-black",icon:"text-yellow-400"}}})(s.rareza),o=t.saldo>=s.precio;return e.jsxs(ag,{className:`transition-all duration-300 ${n.border} ${n.background} hover:scale-105`,children:[e.jsxs(ng,{className:"text-center pb-4",children:[e.jsxs("div",{className:"flex justify-center mb-2",children:[e.jsxs(xg,{className:`${n.badge} text-xs font-bold`,children:[p(s.rareza),e.jsx("span",{className:"ml-1 capitalize",children:s.rareza})]}),s.limitada&&e.jsxs(xg,{variant:"destructive",className:"ml-2 text-xs",children:[e.jsx(Bc,{className:"h-3 w-3 mr-1"}),"Limitada"]})]}),e.jsx("div",{className:"text-6xl mb-4",children:s.icono}),e.jsx(og,{className:"text-xl font-bold text-white mb-2",children:s.nombre}),e.jsx("div",{className:"text-gray-200 text-sm mb-4",children:s.descripcion}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-3",children:[e.jsx($c,{className:"h-5 w-5 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-400",children:s.precio.toLocaleString()})]})]}),e.jsx(cg,{className:"text-center",children:e.jsx(nc,{className:"w-full "+(i?"bg-green-600 hover:bg-green-700 text-white":o?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"),onClick:()=>(async e=>{try{await a(t.id,e,[g])}catch(s){}})(s.id),disabled:i||!o||r,children:r?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):i?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ac,{className:"h-4 w-4"}),e.jsx("span",{children:"Ya poseída"})]}):o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(od,{className:"h-4 w-4"}),e.jsx("span",{children:"Comprar"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($c,{className:"h-4 w-4"}),e.jsx("span",{children:"Saldo insuficiente"})]})})})]},s.id)}))})]})]})})},m_=()=>e.jsxs(ie,{children:[e.jsx(re,{path:"/",element:e.jsx(tg,{})}),e.jsx(re,{path:"/login",element:e.jsx(ug,{})}),e.jsx(re,{path:"/register",element:e.jsx(mg,{})}),e.jsx(re,{path:"/profile",element:e.jsx(Sg,{})}),e.jsx(re,{path:"/compare",element:e.jsx(Lg,{})}),e.jsx(re,{path:"/fighters",element:e.jsx(Fg,{})}),e.jsx(re,{path:"/events",element:e.jsx($g,{})}),e.jsx(re,{path:"/highlights",element:e.jsx(Jg,{})}),e.jsx(re,{path:"/forum",element:e.jsx(tp,{})}),e.jsx(re,{path:"/predict",element:e.jsx(cp,{})}),e.jsx(re,{path:"/live",element:e.jsx(KT,{})}),e.jsx(re,{path:"/ufc303",element:e.jsx(JT,{})}),e.jsx(re,{path:"/ufcnamajunasbarber",element:e.jsx(r_,{})}),e.jsx(re,{path:"/ufc304",element:e.jsx(a_,{})}),e.jsx(re,{path:"/ufcsandhagennurmagomedov",element:e.jsx(n_,{})}),e.jsx(re,{path:"/clips",element:e.jsx(QT,{})}),e.jsx(re,{path:"/coins",element:e.jsx(h_,{})}),e.jsx(re,{path:"/badges",element:e.jsx(f_,{})}),e.jsx(re,{path:"/thread/:id",element:e.jsx(s_,{})}),e.jsx(re,{path:"/category/:id",element:e.jsx(i_,{})}),e.jsx(re,{path:"/event/:id",element:e.jsx(XT,{})})]}),g_=()=>{const t=ee();return Y.useEffect((()=>{const e=new URLSearchParams(window.location.search);"signup"===e.get("type")&&e.get("access_token")&&t("/login");(async()=>{const{data:{user:e}}=await nm.auth.getUser();if(e){const{data:t}=await nm.from("usuario").select("*").eq("correo",e.email).single();t||(await nm.from("usuario").insert([{nombre_usuario:e.user_metadata?.full_name||e.email.split("@")[0],correo:e.email,fecha_registro:(new Date).toISOString(),puntos:0,rango:"Novato",avatar:e.user_metadata?.avatar_url||null,notificaciones:!0,tema:"dark","contraseña":"",saldo:0}]),window.dispatchEvent(new Event("storage")))}})()}),[t]),e.jsx(Ym,{children:e.jsx(m_,{})})},p_=e=>"string"==typeof e,y_=()=>{let e,t;const s=new Promise(((s,i)=>{e=s,t=i}));return s.resolve=e,s.reject=t,s},v_=e=>null==e?"":""+e,x_=/###/g,b_=e=>e&&e.indexOf("###")>-1?e.replace(x_,"."):e,w_=e=>!e||p_(e),E_=(e,t,s)=>{const i=p_(t)?t.split("."):t;let r=0;for(;r<i.length-1;){if(w_(e))return{};const t=b_(i[r]);!e[t]&&s&&(e[t]=new s),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++r}return w_(e)?{}:{obj:e,k:b_(i[r])}},S_=(e,t,s)=>{const{obj:i,k:r}=E_(e,t,Object);if(void 0!==i||1===t.length)return void(i[r]=s);let a=t[t.length-1],n=t.slice(0,t.length-1),o=E_(e,n,Object);for(;void 0===o.obj&&n.length;)a=`${n[n.length-1]}.${a}`,n=n.slice(0,n.length-1),o=E_(e,n,Object),o?.obj&&void 0!==o.obj[`${o.k}.${a}`]&&(o.obj=void 0);o.obj[`${o.k}.${a}`]=s},T_=(e,t)=>{const{obj:s,k:i}=E_(e,t);if(s&&Object.prototype.hasOwnProperty.call(s,i))return s[i]},__=(e,t,s)=>{for(const i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?p_(e[i])||e[i]instanceof String||p_(t[i])||t[i]instanceof String?s&&(e[i]=t[i]):__(e[i],t[i],s):e[i]=t[i]);return e},k_=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var A_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const L_=e=>p_(e)?e.replace(/[&<>"'\/]/g,(e=>A_[e])):e;const R_=[" ",",","?","!",";"],P_=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}(20),N_=(e,t,s=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const i=t.split(s);let r=e;for(let a=0;a<i.length;){if(!r||"object"!=typeof r)return;let e,t="";for(let n=a;n<i.length;++n)if(n!==a&&(t+=s),t+=i[n],e=r[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&n<i.length-1)continue;a+=n-a+1;break}r=e}return r},C_=e=>e?.replace("_","-"),I_={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){}};class D_{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||I_,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,i){return i&&!this.debug?null:(p_(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new D_(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new D_(this.logger,e)}}var j_=new D_;class O_{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const s=this.observers[e].get(t)||0;this.observers[e].set(t,s+1)})),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){if(this.observers[e]){Array.from(this.observers[e].entries()).forEach((([e,s])=>{for(let i=0;i<s;i++)e(...t)}))}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach((([s,i])=>{for(let r=0;r<i;r++)s.apply(s,[e,...t])}))}}}class M_ extends O_{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s,i={}){const r=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,a=void 0!==i.ignoreJSONStructure?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let n;e.indexOf(".")>-1?n=e.split("."):(n=[e,t],s&&(Array.isArray(s)?n.push(...s):p_(s)&&r?n.push(...s.split(r)):n.push(s)));const o=T_(this.data,n);return!o&&!t&&!s&&e.indexOf(".")>-1&&(e=n[0],t=n[1],s=n.slice(2).join(".")),!o&&a&&p_(s)?N_(this.data?.[e]?.[t],s,r):o}addResource(e,t,s,i,r={silent:!1}){const a=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator;let n=[e,t];s&&(n=n.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(n=e.split("."),i=t,t=n[1]),this.addNamespaces(t),S_(this.data,n,i),r.silent||this.emit("added",e,t,s,i)}addResources(e,t,s,i={silent:!1}){for(const r in s)(p_(s[r])||Array.isArray(s[r]))&&this.addResource(e,t,r,s[r],{silent:!0});i.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,i,r,a={silent:!1,skipCopy:!1}){let n=[e,t];e.indexOf(".")>-1&&(n=e.split("."),i=s,s=t,t=n[1]),this.addNamespaces(t);let o=T_(this.data,n)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),i?__(o,s,r):o={...o,...s},S_(this.data,n,o),a.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var F_={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,s,i,r){return e.forEach((e=>{t=this.processors[e]?.process(t,s,i,r)??t})),t}};const $_={},U_=e=>!p_(e)&&"boolean"!=typeof e&&"number"!=typeof e;class B_ extends O_{constructor(e,t={}){var s,i;super(),s=e,i=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach((e=>{s[e]&&(i[e]=s[e])})),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=j_.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const s={...t};if(null==e)return!1;const i=this.resolve(e,s);return void 0!==i?.res}extractFromKey(e,t){let s=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===s&&(s=":");const i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let r=t.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,n=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,s)=>{t=t||"",s=s||"";const i=R_.filter((e=>t.indexOf(e)<0&&s.indexOf(e)<0));if(0===i.length)return!0;const r=P_.getRegExp(`(${i.map((e=>"?"===e?"\\?":e)).join("|")})`);let a=!r.test(e);if(!a){const t=e.indexOf(s);t>0&&!r.test(e.substring(0,t))&&(a=!0)}return a})(e,s,i));if(a&&!n){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:p_(r)?[r]:r};const a=e.split(s);(s!==i||s===i&&this.options.ns.indexOf(a[0])>-1)&&(r=a.shift()),e=a.join(i)}return{key:e,namespaces:p_(r)?[r]:r}}translate(e,t,s){let i="object"==typeof t?{...t}:t;if("object"!=typeof i&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(i={...i}),i||(i={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const r=void 0!==i.returnDetails?i.returnDetails:this.options.returnDetails,a=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,{key:n,namespaces:o}=this.extractFromKey(e[e.length-1],i),l=o[o.length-1];let c=void 0!==i.nsSeparator?i.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const d=i.lng||this.language,h=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return h?r?{res:`${l}${c}${n}`,usedKey:n,exactUsedKey:n,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:`${l}${c}${n}`:r?{res:n,usedKey:n,exactUsedKey:n,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:n;const u=this.resolve(e,i);let f=u?.res;const m=u?.usedKey||n,g=u?.exactUsedKey||n,p=void 0!==i.joinArrays?i.joinArrays:this.options.joinArrays,y=!this.i18nFormat||this.i18nFormat.handleAsObject,v=void 0!==i.count&&!p_(i.count),x=B_.hasDefaultValue(i),b=v?this.pluralResolver.getSuffix(d,i.count,i):"",w=i.ordinal&&v?this.pluralResolver.getSuffix(d,i.count,{ordinal:!1}):"",E=v&&!i.ordinal&&0===i.count,S=E&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${b}`]||i[`defaultValue${w}`]||i.defaultValue;let T=f;y&&!f&&x&&(T=S);const _=U_(T),k=Object.prototype.toString.apply(T);if(!(y&&T&&_&&["[object Number]","[object Function]","[object RegExp]"].indexOf(k)<0)||p_(p)&&Array.isArray(T))if(y&&p_(p)&&Array.isArray(f))f=f.join(p),f&&(f=this.extendTranslation(f,e,i,s));else{let t=!1,r=!1;!this.isValidLookup(f)&&x&&(t=!0,f=S),this.isValidLookup(f)||(r=!0,f=n);const o=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&r?void 0:f,h=x&&S!==f&&this.options.updateMissing;if(r||t||h){if(this.logger.log(h?"updateKey":"missingKey",d,l,n,h?S:f),a){const e=this.resolve(n,{...i,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let i=0;i<t.length;i++)e.push(t[i]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(i.lng||this.language):e.push(i.lng||this.language);const s=(e,t,s)=>{const r=x&&s!==f?s:o;this.options.missingKeyHandler?this.options.missingKeyHandler(e,l,t,r,h,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,l,t,r,h,i),this.emit("missingKey",e,l,t,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?e.forEach((e=>{const t=this.pluralResolver.getSuffixes(e,i);E&&i[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach((t=>{s([e],n+t,i[`defaultValue${t}`]||S)}))})):s(e,n,S))}f=this.extendTranslation(f,e,i,u,s),r&&f===n&&this.options.appendNamespaceToMissingKey&&(f=`${l}${c}${n}`),(r||t)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${n}`:n,t?f:void 0,i))}else{if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,T,{...i,ns:o}):`key '${n} (${this.language})' returned an object instead of string.`;return r?(u.res=e,u.usedParams=this.getUsedParamsDetails(i),u):e}if(a){const e=Array.isArray(T),t=e?[]:{},s=e?g:m;for(const r in T)if(Object.prototype.hasOwnProperty.call(T,r)){const e=`${s}${a}${r}`;t[r]=x&&!f?this.translate(e,{...i,defaultValue:U_(S)?S[r]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...i,joinArrays:!1,ns:o}),t[r]===e&&(t[r]=T[r])}f=t}}return r?(u.res=f,u.usedParams=this.getUsedParamsDetails(i),u):f}extendTranslation(e,t,s,i,r){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const a=p_(e)&&(void 0!==s?.interpolation?.skipOnVariables?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let n;if(a){const t=e.match(this.interpolator.nestingRegexp);n=t&&t.length}let o=s.replace&&!p_(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),e=this.interpolator.interpolate(e,o,s.lng||this.language||i.usedLng,s),a){const t=e.match(this.interpolator.nestingRegexp);n<(t&&t.length)&&(s.nest=!1)}!s.lng&&i&&i.res&&(s.lng=this.language||i.usedLng),!1!==s.nest&&(e=this.interpolator.nest(e,((...e)=>r?.[0]!==e[0]||s.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null)),s)),s.interpolation&&this.interpolator.reset()}const a=s.postProcess||this.options.postProcess,n=p_(a)?[a]:a;return null!=e&&n?.length&&!1!==s.applyPostProcessor&&(e=F_.handle(n,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e,t={}){let s,i,r,a,n;return p_(e)&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(s))return;const o=this.extractFromKey(e,t),l=o.key;i=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==t.count&&!p_(t.count),h=d&&!t.ordinal&&0===t.count,u=void 0!==t.context&&(p_(t.context)||"number"==typeof t.context)&&""!==t.context,f=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach((e=>{this.isValidLookup(s)||(n=e,$_[`${f[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(n)||($_[`${f[0]}-${e}`]=!0,this.logger.warn(`key "${i}" for languages "${f.join(", ")}" won't get resolved as namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((i=>{if(this.isValidLookup(s))return;a=i;const n=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(n,l,i,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(i,t.count,t));const s=`${this.options.pluralSeparator}zero`,r=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(n.push(l+e),t.ordinal&&0===e.indexOf(r)&&n.push(l+e.replace(r,this.options.pluralSeparator)),h&&n.push(l+s)),u){const i=`${l}${this.options.contextSeparator}${t.context}`;n.push(i),d&&(n.push(i+e),t.ordinal&&0===e.indexOf(r)&&n.push(i+e.replace(r,this.options.pluralSeparator)),h&&n.push(i+s))}}let o;for(;o=n.pop();)this.isValidLookup(s)||(r=o,s=this.getResource(i,e,o,t))})))}))})),{res:s,usedKey:i,exactUsedKey:r,usedLng:a,usedNS:n}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,s,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,s,i):this.resourceStore.getResource(e,t,s,i)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!p_(e.replace);let i=s?e.replace:e;if(s&&void 0!==e.count&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!s){i={...i};for(const e of t)delete i[e]}return i}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,12)&&void 0!==e[s])return!0;return!1}}class V_{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=j_.create("languageUtils")}getScriptPartFromCode(e){if(!(e=C_(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=C_(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(p_(e)&&e.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(e)[0]}catch(t){}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const s=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(s)||(t=s)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const s=this.getScriptPartFromCode(e);if(this.isSupportedCode(s))return t=s;const i=this.getLanguagePartFromCode(e);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find((e=>e===i?e:e.indexOf("-")<0&&i.indexOf("-")<0?void 0:e.indexOf("-")>0&&i.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===i||0===e.indexOf(i)&&i.length>1?e:void 0))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),p_(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),i=[],r=e=>{e&&(this.isSupportedCode(e)?i.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return p_(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):p_(e)&&r(this.formatLanguageCode(e)),s.forEach((e=>{i.indexOf(e)<0&&r(this.formatLanguageCode(e))})),i}}const G_={zero:0,one:1,two:2,few:3,many:4,other:5},K_={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class H_{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=j_.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const s=C_("dev"===e?"en":e),i=t.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:s,type:i});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let a;try{a=new Intl.PluralRules(s,{type:i})}catch(Lk){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),K_;if(!e.match(/-|_/))return K_;const i=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(i,t)}return this.pluralRulesCache[r]=a,a}needsPlural(e,t={}){let s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,s={}){return this.getSuffixes(e,s).map((e=>`${t}${e}`))}getSuffixes(e,t={}){let s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort(((e,t)=>G_[e]-G_[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):[]}getSuffix(e,t,s={}){const i=this.getRule(e,s);return i?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,s))}}const q_=(e,t,s,i=".",r=!0)=>{let a=((e,t,s)=>{const i=T_(e,s);return void 0!==i?i:T_(t,s)})(e,t,s);return!a&&r&&p_(s)&&(a=N_(e,s,i),void 0===a&&(a=N_(t,s,i))),a},W_=e=>e.replace(/\$/g,"$$$$");class z_{constructor(e={}){this.logger=j_.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:i,prefix:r,prefixEscaped:a,suffix:n,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:h,nestingPrefixEscaped:u,nestingSuffix:f,nestingSuffixEscaped:m,nestingOptionsSeparator:g,maxReplaces:p,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:L_,this.escapeValue=void 0===s||s,this.useRawValueToEscape=void 0!==i&&i,this.prefix=r?k_(r):a||"{{",this.suffix=n?k_(n):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=h?k_(h):u||k_("$t("),this.nestingSuffix=f?k_(f):m||k_(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=p||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,s,i){let r,a,n;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const r=q_(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,s,{...i,...t,interpolationkey:e}):r}const r=e.split(this.formatSeparator),a=r.shift().trim(),n=r.join(this.formatSeparator).trim();return this.format(q_(t,o,a,this.options.keySeparator,this.options.ignoreJSONStructure),n,s,{...i,...t,interpolationkey:a})};this.resetRegExp();const c=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==i?.interpolation?.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>W_(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?W_(this.escape(e)):W_(e)}].forEach((t=>{for(n=0;r=t.regex.exec(e);){const s=r[1].trim();if(a=l(s),void 0===a)if("function"==typeof c){const t=c(e,r,i);a=p_(t)?t:""}else if(i&&Object.prototype.hasOwnProperty.call(i,s))a="";else{if(d){a=r[0];continue}this.logger.warn(`missed to pass in variable ${s} for interpolating ${e}`),a=""}else p_(a)||this.useRawValueToEscape||(a=v_(a));const o=t.safeValue(a);if(e=e.replace(r[0],o),d?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,n++,n>=this.maxReplaces)break}})),e}nest(e,t,s={}){let i,r,a;const n=(e,t)=>{const s=this.nestingOptionsSeparator;if(e.indexOf(s)<0)return e;const i=e.split(new RegExp(`${s}[ ]*{`));let r=`{${i[1]}`;e=i[0],r=this.interpolate(r,a);const n=r.match(/'/g),o=r.match(/"/g);((n?.length??0)%2==0&&!o||o.length%2!=0)&&(r=r.replace(/'/g,'"'));try{a=JSON.parse(r),t&&(a={...t,...a})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${s}${r}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,e};for(;i=this.nestingRegexp.exec(e);){let o=[];a={...s},a=a.replace&&!p_(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let l=!1;if(-1!==i[0].indexOf(this.formatSeparator)&&!/{.*}/.test(i[1])){const e=i[1].split(this.formatSeparator).map((e=>e.trim()));i[1]=e.shift(),o=e,l=!0}if(r=t(n.call(this,i[1].trim(),a),a),r&&i[0]===e&&!p_(r))return r;p_(r)||(r=v_(r)),r||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),r=""),l&&(r=o.reduce(((e,t)=>this.format(e,t,s.lng,{...s,interpolationkey:i[1].trim()})),r.trim())),e=e.replace(i[0],r),this.regexp.lastIndex=0}return e}}const Y_=e=>{const t={};return(s,i,r)=>{let a=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(a={...a,[r.interpolationkey]:void 0});const n=i+JSON.stringify(a);let o=t[n];return o||(o=e(C_(i),r),t[n]=o),o(s)}},X_=e=>(t,s,i)=>e(C_(s),i)(t);class J_{constructor(e={}){this.logger=j_.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const s=t.cacheInBuiltFormats?Y_:X_;this.formats={number:s(((e,t)=>{const s=new Intl.NumberFormat(e,{...t});return e=>s.format(e)})),currency:s(((e,t)=>{const s=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>s.format(e)})),datetime:s(((e,t)=>{const s=new Intl.DateTimeFormat(e,{...t});return e=>s.format(e)})),relativetime:s(((e,t)=>{const s=new Intl.RelativeTimeFormat(e,{...t});return e=>s.format(e,t.range||"day")})),list:s(((e,t)=>{const s=new Intl.ListFormat(e,{...t});return e=>s.format(e)}))}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Y_(t)}format(e,t,s,i={}){const r=t.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find((e=>e.indexOf(")")>-1))){const e=r.findIndex((e=>e.indexOf(")")>-1));r[0]=[r[0],...r.splice(1,e)].join(this.formatSeparator)}const a=r.reduce(((e,t)=>{const{formatName:r,formatOptions:a}=(e=>{let t=e.toLowerCase().trim();const s={};if(e.indexOf("(")>-1){const i=e.split("(");t=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);"currency"===t&&r.indexOf(":")<0?s.currency||(s.currency=r.trim()):"relativetime"===t&&r.indexOf(":")<0?s.range||(s.range=r.trim()):r.split(";").forEach((e=>{if(e){const[t,...i]=e.split(":"),r=i.join(":").trim().replace(/^'+|'+$/g,""),a=t.trim();s[a]||(s[a]=r),"false"===r&&(s[a]=!1),"true"===r&&(s[a]=!0),isNaN(r)||(s[a]=parseInt(r,10))}}))}return{formatName:t,formatOptions:s}})(t);if(this.formats[r]){let t=e;try{const n=i?.formatParams?.[i.interpolationkey]||{},o=n.locale||n.lng||i.locale||i.lng||s;t=this.formats[r](e,o,{...a,...i,...n})}catch(n){this.logger.warn(n)}return t}return this.logger.warn(`there was no format function for ${r}`),e}),e);return a}}class Q_ extends O_{constructor(e,t,s,i={}){super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=i,this.logger=j_.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,i.backend,i)}queueLoad(e,t,s,i){const r={},a={},n={},o={};return e.forEach((e=>{let i=!0;t.forEach((t=>{const n=`${e}|${t}`;!s.reload&&this.store.hasResourceBundle(e,t)?this.state[n]=2:this.state[n]<0||(1===this.state[n]?void 0===a[n]&&(a[n]=!0):(this.state[n]=1,i=!1,void 0===a[n]&&(a[n]=!0),void 0===r[n]&&(r[n]=!0),void 0===o[t]&&(o[t]=!0)))})),i||(n[e]=!0)})),(Object.keys(r).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(a),toLoadLanguages:Object.keys(n),toLoadNamespaces:Object.keys(o)}}loaded(e,t,s){const i=e.split("|"),r=i[0],a=i[1];t&&this.emit("failedLoading",r,a,t),!t&&s&&this.store.addResourceBundle(r,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&s&&(this.state[e]=0);const n={};this.queue.forEach((s=>{((e,t,s)=>{const{obj:i,k:r}=E_(e,t,Object);i[r]=i[r]||[],i[r].push(s)})(s.loaded,[r],a),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(s,e),t&&s.errors.push(t),0!==s.pendingCount||s.done||(Object.keys(s.loaded).forEach((e=>{n[e]||(n[e]={});const t=s.loaded[e];t.length&&t.forEach((t=>{void 0===n[e][t]&&(n[e][t]=!0)}))})),s.done=!0,s.errors.length?s.callback(s.errors):s.callback())})),this.emit("loaded",n),this.queue=this.queue.filter((e=>!e.done))}read(e,t,s,i=0,r=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:s,tried:i,wait:r,callback:a});this.readingCalls++;const n=(n,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}n&&o&&i<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,s,i+1,2*r,a)}),r):a(n,o)},o=this.backend[s].bind(this.backend);if(2!==o.length)return o(e,t,n);try{const s=o(e,t);s&&"function"==typeof s.then?s.then((e=>n(null,e))).catch(n):n(null,s)}catch(Lk){n(Lk)}}prepareLoading(e,t,s={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();p_(e)&&(e=this.languageUtils.toResolveHierarchy(e)),p_(t)&&(t=[t]);const r=this.queueLoad(e,t,s,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e,t=""){const s=e.split("|"),i=s[0],r=s[1];this.read(i,r,"read",void 0,void 0,((s,a)=>{s&&this.logger.warn(`${t}loading namespace ${r} for language ${i} failed`,s),!s&&a&&this.logger.log(`${t}loaded namespace ${r} for language ${i}`,a),this.loaded(e,s,a)}))}saveMissing(e,t,s,i,r,a={},n=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=s&&""!==s){if(this.backend?.create){const o={...a,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let r;r=5===l.length?l(e,t,s,i,o):l(e,t,s,i),r&&"function"==typeof r.then?r.then((e=>n(null,e))).catch(n):n(null,r)}catch(Lk){n(Lk)}else l(e,t,s,i,n,o)}e&&e[0]&&this.store.addResource(e[0],t,s,i)}}else this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const Z_=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),p_(e[1])&&(t.defaultValue=e[1]),p_(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const s=e[3]||e[2];Object.keys(s).forEach((e=>{t[e]=s[e]}))}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),ek=e=>(p_(e.ns)&&(e.ns=[e.ns]),p_(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),p_(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),tk=()=>{};class sk extends O_{constructor(e={},t){var s;if(super(),this.options=ek(e),this.services={},this.logger=j_,this.modules={external:[]},s=this,Object.getOwnPropertyNames(Object.getPrototypeOf(s)).forEach((e=>{"function"==typeof s[e]&&(s[e]=s[e].bind(s))})),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout((()=>{this.init(e,t)}),0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(p_(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const s=Z_();this.options={...s,...this.options,...ek(e)},this.options.interpolation={...s.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);const i=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?j_.init(i(this.modules.logger),this.options):j_.init(null,this.options),e=this.modules.formatter?this.modules.formatter:J_;const t=new V_(this.options);this.store=new M_(this.options.resources,this.options);const r=this.services;r.logger=j_,r.resourceStore=this.store,r.languageUtils=t,r.pluralResolver=new H_(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!e||this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format||(r.formatter=i(e),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new z_(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new Q_(i(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",((e,...t)=>{this.emit(e,...t)})),this.modules.languageDetector&&(r.languageDetector=i(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=i(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new B_(this.services,this.options),this.translator.on("*",((e,...t)=>{this.emit(e,...t)})),this.modules.external.forEach((e=>{e.init&&e.init(this)}))}if(this.format=this.options.interpolation.format,t||(t=tk),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((e=>{this[e]=(...t)=>this.store[e](...t)}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((e=>{this[e]=(...t)=>(this.store[e](...t),this)}));const r=y_(),a=()=>{const e=(e,s)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),r.resolve(s),t(e,s)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?a():setTimeout(a,0),r}loadResources(e,t=tk){let s=t;const i=p_(e)?e:this.language;if("function"==typeof e&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===i?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return s();const e=[],t=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach((t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)}))};if(i)t(i);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((e=>t(e)))}this.options.preload?.forEach?.((e=>t(e))),this.services.backendConnector.load(e,this.options.ns,(e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),s(e)}))}else s(null)}reloadResources(e,t,s){const i=y_();return"function"==typeof e&&(s=e,e=void 0),"function"==typeof t&&(s=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),s||(s=tk),this.services.backendConnector.reload(e,t,(e=>{i.resolve(),s(e)})),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&F_.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const s=y_();this.emit("languageChanging",e);const i=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},r=(r,a)=>{a?this.isLanguageChangingTo===e&&(i(a),this.translator.changeLanguage(a),this.isLanguageChangingTo=void 0,this.emit("languageChanged",a),this.logger.log("languageChanged",a)):this.isLanguageChangingTo=void 0,s.resolve(((...e)=>this.t(...e))),t&&t(r,((...e)=>this.t(...e)))},a=t=>{e||t||!this.services.languageDetector||(t=[]);const s=p_(t)?t:t&&t[0],a=this.store.hasLanguageSomeTranslations(s)?s:this.services.languageUtils.getBestMatchFromCodes(p_(t)?[t]:t);a&&(this.language||i(a),this.translator.language||this.translator.changeLanguage(a),this.services.languageDetector?.cacheUserLanguage?.(a)),this.loadResources(a,(e=>{r(e,a)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e):a(this.services.languageDetector.detect()),s}getFixedT(e,t,s){const i=(e,t,...r)=>{let a;a="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(r)):{...t},a.lng=a.lng||i.lng,a.lngs=a.lngs||i.lngs,a.ns=a.ns||i.ns,""!==a.keyPrefix&&(a.keyPrefix=a.keyPrefix||s||i.keyPrefix);const n=this.options.keySeparator||".";let o;return o=a.keyPrefix&&Array.isArray(e)?e.map((e=>`${a.keyPrefix}${n}${e}`)):a.keyPrefix?`${a.keyPrefix}${n}${e}`:e,this.t(o,a)};return p_(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=s,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===s.toLowerCase())return!0;const a=(e,t)=>{const s=this.services.backendConnector.state[`${e}|${t}`];return-1===s||0===s||2===s};if(t.precheck){const e=t.precheck(this,a);if(void 0!==e)return e}return!!this.hasResourceBundle(s,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!a(s,e)||i&&!a(r,e)))}loadNamespaces(e,t){const s=y_();return this.options.ns?(p_(e)&&(e=[e]),e.forEach((e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)})),this.loadResources((e=>{s.resolve(),t&&t(e)})),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=y_();p_(e)&&(e=[e]);const i=this.options.preload||[],r=e.filter((e=>i.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e)));return r.length?(this.options.preload=i.concat(r),this.loadResources((e=>{s.resolve(),t&&t(e)})),s):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services?.languageUtils||new V_(Z_());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new sk(e,t)}cloneInstance(e={},t=tk){const s=e.forkResourceStore;s&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},r=new sk(i);void 0===e.debug&&void 0===e.prefix||(r.logger=r.logger.clone(e));if(["store","services","language"].forEach((e=>{r[e]=this[e]})),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},s){const e=Object.keys(this.store.data).reduce(((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce(((s,i)=>(s[i]={...e[t][i]},s)),e[t]),e)),{});r.store=new M_(e,i),r.services.resourceStore=r.store}return r.translator=new B_(r.services,i),r.translator.on("*",((e,...t)=>{r.emit(e,...t)})),r.init(i,t),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ik=sk.createInstance();ik.createInstance=sk.createInstance,ik.createInstance,ik.dir,ik.init,ik.loadResources,ik.reloadResources,ik.use,ik.changeLanguage,ik.getFixedT,ik.t,ik.exists,ik.setDefaultNamespace,ik.hasLoadedNamespace,ik.loadNamespaces,ik.loadLanguages;const{slice:rk,forEach:ak}=[];const nk=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ok={create(e,t,s,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};s&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+60*s*1e3)),i&&(r.domain=i),document.cookie=function(e,t){const s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let i=`${e}=${encodeURIComponent(t)}`;if(s.maxAge>0){const e=s.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(e)}`}if(s.domain){if(!nk.test(s.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${s.domain}`}if(s.path){if(!nk.test(s.path))throw new TypeError("option path is invalid");i+=`; Path=${s.path}`}if(s.expires){if("function"!=typeof s.expires.toUTCString)throw new TypeError("option expires is invalid");i+=`; Expires=${s.expires.toUTCString()}`}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.sameSite)switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s.partitioned&&(i+="; Partitioned"),i}(e,t,r)},read(e){const t=`${e}=`,s=document.cookie.split(";");for(let i=0;i<s.length;i++){let e=s[i];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var lk={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return ok.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:s,cookieMinutes:i,cookieDomain:r,cookieOptions:a}=t;s&&"undefined"!=typeof document&&ok.create(s,e,i,r,a)}},ck={name:"querystring",lookup(e){let t,{lookupQuerystring:s}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const i=e.substring(1).split("&");for(let r=0;r<i.length;r++){const e=i[r].indexOf("=");if(e>0){i[r].substring(0,e)===s&&(t=i[r].substring(e+1))}}}return t}},dk={name:"hash",lookup(e){let t,{lookupHash:s,lookupFromHashIndex:i}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const r=e.substring(1);if(s){const e=r.split("&");for(let i=0;i<e.length;i++){const r=e[i].indexOf("=");if(r>0){e[i].substring(0,r)===s&&(t=e[i].substring(r+1))}}}if(t)return t;if(!t&&i>-1){const t=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(t))return;const s="number"==typeof i?i:0;return t[s]?.replace("/","")}}}return t}};let hk=null;const uk=()=>{if(null!==hk)return hk;try{if(hk="undefined"!=typeof window&&null!==window.localStorage,!hk)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){hk=!1}return hk};var fk={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&uk())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:s}=t;s&&uk()&&window.localStorage.setItem(s,e)}};let mk=null;const gk=()=>{if(null!==mk)return mk;try{if(mk="undefined"!=typeof window&&null!==window.sessionStorage,!mk)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){mk=!1}return mk};var pk={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&gk())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:s}=t;s&&gk()&&window.sessionStorage.setItem(s,e)}},yk={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:s,language:i}=navigator;if(e)for(let r=0;r<e.length;r++)t.push(e[r]);s&&t.push(s),i&&t.push(i)}return t.length>0?t:void 0}},vk={name:"htmlTag",lookup(e){let t,{htmlTag:s}=e;const i=s||("undefined"!=typeof document?document.documentElement:null);return i&&"function"==typeof i.getAttribute&&(t=i.getAttribute("lang")),t}},xk={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(s))return;const i="number"==typeof t?t:0;return s[i]?.replace("/","")}},bk={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const s="number"==typeof t?t+1:1,i="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(i)return i[s]}};let wk=!1;try{document.cookie,wk=!0}catch(Rk){}const Ek=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];wk||Ek.splice(1,1);class Sk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return ak.call(rk.call(arguments,1),(t=>{if(t)for(const s in t)void 0===e[s]&&(e[s]=t[s])})),e}(t,this.options||{},{order:Ek,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=s,this.addDetector(lk),this.addDetector(ck),this.addDetector(fk),this.addDetector(pk),this.addDetector(yk),this.addDetector(vk),this.addDetector(xk),this.addDetector(bk),this.addDetector(dk)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach((e=>{if(this.detectors[e]){let s=this.detectors[e].lookup(this.options);s&&"string"==typeof s&&(s=[s]),s&&(t=t.concat(s))}})),t=t.filter((e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some((e=>e.test(t))));var t})).map((e=>this.options.convertDetectedLanguage(e))),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach((t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)})))}}Sk.type="languageDetector";const Tk={profile:{edit_profile:"Editar Perfil",member_since:"Miembro desde",username:"Nombre de Usuario",email:"Correo Electrónico",total_points:"Puntos Totales",ranking:"Ranking",language:"Idioma"},main_card:"Cartelera Estelar",prelims:"Preliminares",vs:"VS",weight:{"peso medio":"Peso medio","peso semipesado":"Peso semipesado","peso pesado":"Peso pesado","peso gallo":"Peso gallo","peso paja femenina":"Peso paja femenina","peso pluma":"Peso pluma","Peso ligero":"Peso ligero","peso mosca femenina":"Peso mosca femenina","peso mosca":"Peso mosca","peso welter":"Peso welter"},event:{title:{sandhagen_nurmagomedov:"UFC Fight Night: Sandhagen vs. Nurmagomedov",namajunas_barber:"UFC Fight Night: Namajunas vs. Barber",edwards_muhammad:"UFC 304: Edwards vs. Muhammad 2"},date_location:{sandhagen_nurmagomedov:"2 de agosto de 2025 - Abu Dhabi, UAE (Etihad Arena)",namajunas_barber:"12 de julio de 2025 - Denver, CO (Ball Arena)",edwards_muhammad:"26 de julio de 2025 - Manchester, England (Co-op Live)"},time:"{{time}}",arena:"Arena de UFC"},thread:{not_found:"Hilo no encontrado.",by:"por",replies:"Respuestas ({{count}})",reply_placeholder:"Escribe tu respuesta aquí...",reply_button:"Responder",no_replies:"Aún no hay respuestas."},clips:{saved_clips:"Clips Guardados",no_clips:"No tienes clips guardados aún.",hint_record:"Graba clips durante las transmisiones en vivo para verlos aquí.",download:"Descargar",share:"Compartir",clip_title:"Clip de UFC",url_copied:"URL copiada al portapapeles"},prediction:{title:"Predicción y Apuesta",who_wins:"¿Quién ganará la pelea?",ko_tko:"KO/TKO",submission:"Sumisión",decision:"Decisión",round_label:"¿En qué round terminará?",round_hint:"(Solo aplica si no es decisión)",yes:"Sí",no:"No",bet_amount:"Monto de la Apuesta",coins:"Monedas",balance:"Saldo",potential_win:"Ganancia Potencial",alert_invalid_bet:"Por favor, ingresa un monto válido para apostar.",alert_no_coins:"No tienes suficientes monedas para esta apuesta.",alert_sent:"Predicciones enviadas con apuesta de {{amount}} monedas (ver consola)",send:"Enviar Predicción y Apuesta",first_strike:"¿Primer golpe significativo?",first_takedown:"¿Primer derribo?",most_significant_strikes:"¿Más golpes significativos?",additional_predictions:"Predicciones Adicionales",will_be_ko:"¿Habrá KO/TKO?",will_be_sub:"¿Habrá Sumisión?",go_to_decision:"¿Llegará a Decisión?"},live:{title:"Transmisión en Vivo",error_no_hls:"Tu navegador no soporta la reproducción de video en vivo",error_record:"No se pudo iniciar la grabación",error_login:"Debes iniciar sesión para guardar clips.",error_upload:"Error al subir el clip: {{message}}",on_air:"EN VIVO",record_clip:"Grabar Clip",stop_record:"Detener Grabación",chat_title:"Chat en Vivo",no_messages:"No hay mensajes aún. ¡Sé el primero en comentar!",write_message:"Escribe tu mensaje...",send:"Enviar"},nav:{home:"Inicio",forum:"Foro",fighters:"Peleadores",compare:"Comparar",highlights:"Clips Destacados",events:"Eventos",saved_clips:"Clips Guardados",live:"Ver en Vivo",profile:"Mi Perfil",my_rankings:"Mis Rankings",buy_coins:"Comprar Monedas",rewards:"Recompensas"},auth:{login:"Iniciar Sesión",register:"Registrarse",logout:"Cerrar Sesión",email:"Correo Electrónico",password:"Contraseña",remember:"Recordarme",logging_in:"Iniciando sesión...",registering:"Registrando...",username:"Nombre de Usuario",username_placeholder:"TuUsuario",email_placeholder:"tu@email.com",passwords_no_match:"Las contraseñas no coinciden",create_account:"CREAR CUENTA",complete_data_join_community:"Completa tus datos para unirte a la comunidad",confirm_password:"Confirmar Contraseña",login_here:"Inicia sesión aquí",accept_terms:"Al registrarte, aceptas nuestros ",terms_conditions:"Términos y Condiciones",login_subtitle:"Ingresa tus credenciales para acceder a tu cuenta",forgot_password:"¿Olvidaste tu contraseña?",or_continue_with:"O continúa con",continue_with_google:"Continuar con Google",no_account:"¿No tienes cuenta?",register_here:"Regístrate aquí",already_have_account:"¿Ya tienes cuenta?"},sidebar:{my_points:"Mis Puntos:"},stats:{accurate_predictions:"Predicciones Acertadas",coins_won:"Monedas Ganadas",global_ranking:"Ranking Global",next_level:"Siguiente Nivel"},user:{default:"Usuario",points:"pts",win_rate:"Win Rate",predictions:"Predicciones",profile:"Mi Perfil",ranking:"Ranking Global"},forum:{title:"Foro de la Comunidad",search_placeholder:"Buscar en el foro...",create_thread:"Crear Nuevo Hilo",categories:"Categorías",recent_threads:"Hilos Recientes",by:"por",in:"en",category_general:"Discusión General",category_general_desc:"Habla de todo sobre UFC",category_predictions:"Predicciones y Apuestas",category_predictions_desc:"Comparte tus pronósticos",category_news:"Noticias y Rumores",category_news_desc:"Últimas novedades del octágono",category_fighters:"Peleadores y Divisiones",category_fighters_desc:"Análisis por categoría"},highlights:{title:"Clips Destacados",ko_epic:"KO Épico: McGregor vs. Aldo",submission_incredible:"Sumisión Increíble: Nurmagomedov",total_war:"Guerra Total: Jones vs. Gustafsson I",surprise_kick:"Patada Voladora Sorpresa",comeback:"Remontada Histórica",night_ko:"Noche de Nocauts",alt_ko:"Golpe de nocaut en el octágono",alt_submission:"Sumisión en la lona",alt_war:"Intercambio intenso de golpes",alt_kick:"Patada voladora espectacular",alt_comeback:"Celebración de remontada histórica",alt_night:"Montaje de momentos destacados",fighters:"Peleadores",watch_clip:"Ver Clip",loading:"Cargando clips destacados...",retry:"Reintentar",refresh:"Actualizar",no_clips:"No hay clips destacados disponibles en este momento.",upload_clip:"Subir Clip",upload_title:"Subir Nuevo Clip",title_label:"Título",description_label:"Descripción",fighters_label:"Peleadores (separados por comas)",fighters_placeholder:"McGregor, Aldo",video_label:"Archivo de Video",cancel:"Cancelar",uploading:"Subiendo...",close:"Cerrar"},fighters:{title:"Ranking Oficial de Peleadores (P4P)",champion:"Campeón",top_contender:"Top Contender",status:{"Campeón":"Campeón","Top Contender":"Top Contender"},no_table:"Componentes de Tabla o Badge no encontrados. Por favor, créalos si no existen.",note:"Ranking Libra por Libra (P4P) basado en el rendimiento y dominio divisional.",rank:"Rank",name:"Nombre",division:"División",record:"Récord",status_col:"Status",points_col:"Puntos"},compare:{title:"Comparador de Peleadores",select_fighter_1:"Seleccionar Peleador 1",select_fighter_2:"Seleccionar Peleador 2",strikes_per_min:"Golpes / min",accuracy:"Precisión (%)",takedowns_per_15:"Derribos / 15min",defense:"Defensa (%)",avg_fight_time:"Tiempo Medio Pelea",no_select:"Componente Select no encontrado"},events:{title:"Próximos Eventos",alt_arena:"Arena iluminada llena de espectadores para un evento de UFC",alt_octagon:"Vista lateral del octágono de UFC durante una pelea",alt_staredown:"Dos peleadores frente a frente antes de un combate",alt_celebration:"Peleador victorioso celebrando en el octágono",main_event:"Pelea Principal:",co_main_event:"Co-Estelar:",details:"Ver Detalles"},category:{not_found:"Categoría no encontrada.",search_placeholder:"Buscar en {{category}}...",threads_in:"Hilos en {{category}} ({{count}})",no_threads:"No hay hilos en esta categoría todavía."},home:{featured_fight_bg:"Fondo de pelea destacada UFC con luces de octágono",event_principal:"Evento Principal",open_predictions:"Predicciones Abiertas",star_fight:"PELEA ESTELAR",star_fight_description:"Pelea estelar por el título mundial",select_fav_a:"Seleccionar a Luchador A como favorito",select_fav_b:"Seleccionar a Luchador B como favorito",fighter_a:"Retrato del Luchador A",fighter_b:"Retrato del Luchador B",see_more:"Ver en Vivo",make_prediction:"Hacer Predicción",join_community:"Ir al Foro",learn_more:"Hacer Predicción",join_title:"Únete a la Comunidad",join_desc:"Participa en los foros, compite en los rankings de predicciones y demuestra quién sabe más de MMA.",see_rankings:"Ver Rankings",upcoming_events:"Próximos Eventos",see_details:"Ver Detalles",champion:"Campeón",challenger:"Retador",vote_percent:"% de los votos",ufc_300_title:"UFC 300: PELEA ESTELAR",see_all:"Ver todos"},login:{welcome:"Bienvenido a",subtitle:"Tu plataforma definitiva para el mundo del MMA"},register:{title:"Únete a la Comunidad",subtitle:"Crea tu cuenta y empieza a predecir resultados de MMA"},rankings:{title:"Ranking Global de Predicciones",rank:"Rank",user:"Usuario",points:"Puntos",streak:"Racha",updated:"El ranking se actualiza después de cada evento principal. ¡Sigue prediciendo!"},fighter:{division:"División:",country:"País:",record:"Récord:",status:"Status:"},logo:{alt:"Logo de UFC"},coins:{title:"Comprar Monedas Virtuales",subtitle:"Adquiere monedas virtuales para participar en predicciones, apuestas y más actividades en la plataforma",current_balance:"Saldo Actual",balance_description:"Monedas disponibles para usar",coins:"Monedas",choose_package:"Elige tu Paquete",most_popular:"Más Popular",discount:"Descuento",per_coin:"Por moneda",buy_now:"Comprar Ahora",processing:"Procesando...",purchase_initiated:"Compra Iniciada",redirecting_payment:"Redirigiendo a MercadoPago...",purchase_success:"¡Compra Exitosa!",coins_added:"Se agregaron {{coins}} monedas a tu cuenta",login_required:"Inicio de Sesión Requerido",login_message:"Necesitas iniciar sesión para comprar monedas virtuales",secure_payment:"Pago Seguro",secure_description:"Protegido por MercadoPago",instant_delivery:"Entrega Instantánea",instant_description:"Monedas disponibles inmediatamente",best_value:"Mejor Valor",best_value_description:"Más monedas por tu dinero",payment_methods:"Métodos de Pago",accepted_methods:"Métodos Aceptados",credit_cards:"Tarjetas de Crédito",debit_cards:"Tarjetas de Débito",bank_transfer:"Transferencia Bancaria",digital_wallets:"Billeteras Digitales",security_info:"Información de Seguridad",ssl_encryption:"Cifrado SSL",pci_compliant:"Cumple con PCI DSS",refund_policy:"Política de Reembolso",customer_support:"Soporte al Cliente"},transactions:{history:"Historial de Transacciones",no_transactions:"No tienes transacciones aún",registration:"Registro",bet:"Apuesta",vote:"Voto",purchase_basic:"Compra - Paquete Básico",purchase_standard:"Compra - Paquete Estándar",purchase_premium:"Compra - Paquete Premium",purchase_pro:"Compra - Paquete Pro",income:"Ingreso",expense:"Egreso"},error:{title:"Error",loading_history:"Error al cargar el historial de transacciones",purchase_failed:"Error al procesar la compra. Inténtalo de nuevo.",loading_rewards:"Error al cargar las recompensas",redeem_failed:"Error al canjear la recompensa. Inténtalo de nuevo."},rewards:{title:"Catálogo de Recompensas",subtitle:"Canjea tus monedas virtuales por recompensas exclusivas y contenido premium",current_balance:"Saldo Actual",balance_description:"Monedas disponibles para canjear",all_categories:"Todas las Categorías",badges:"Insignias",content:"Contenido",all_rewards:"Todas las Recompensas",categories:"Categorías",my_rewards:"Mis Recompensas",total_rewards:"Total de Recompensas",total_spent:"Total Gastado",average_per_reward:"Promedio por Recompensa",common:"Común",rare:"Rara",legendary:"Legendaria",limited:"Limitada",includes:"Incluye",benefits:"Beneficios",processing:"Procesando...",owned:"Ya Poseída",insufficient_coins:"Monedas Insuficientes",redeem:"Canjear",redeem_success:"¡Recompensa Canjeada!",reward_added:"Se agregó {{name}} a tu colección",login_required:"Inicio de Sesión Requerido",login_message:"Necesitas iniciar sesión para ver las recompensas",no_rewards:"No tienes recompensas aún",start_collecting:"¡Comienza a coleccionar recompensas!"},eventosUFC303:{title:"UFC 303: McGregor vs. Chandler",date_location:"28 de junio de 2025 - Las Vegas, NV (T-Mobile Arena)",time:"7:00 PM (hora local)",main_card:"Cartelera Estelar",prelims:"Preliminares",vs:"VS",image_alt:"Arena de UFC 303",weights:{"Peso ligero":"Peso ligero","Peso semipesado":"Peso semipesado","Peso medio":"Peso medio","Peso gallo femenino":"Peso gallo femenino","Peso welter":"Peso welter","Peso pluma":"Peso pluma","Peso gallo":"Peso gallo","Peso mosca":"Peso mosca"}}},_k={profile:{edit_profile:"Edit Profile",member_since:"Member since",username:"Username",email:"Email",total_points:"Total Points",ranking:"Ranking",language:"Language"},main_card:"Main Card",prelims:"Prelims",vs:"VS",weight:{"peso medio":"Middleweight","peso semipesado":"Light Heavyweight","peso pesado":"Heavyweight","peso gallo":"Bantamweight","peso paja femenina":"Women's Strawweight","peso pluma":"Featherweight","Peso ligero":"Lightweight","peso mosca femenina":"Women's Flyweight","peso mosca":"Flyweight","peso welter":"Welterweight"},event:{title:{sandhagen_nurmagomedov:"UFC Fight Night: Sandhagen vs. Nurmagomedov",namajunas_barber:"UFC Fight Night: Namajunas vs. Barber",edwards_muhammad:"UFC 304: Edwards vs. Muhammad 2"},date_location:{sandhagen_nurmagomedov:"August 2, 2025 - Abu Dhabi, UAE (Etihad Arena)",namajunas_barber:"July 12, 2025 - Denver, CO (Ball Arena)",edwards_muhammad:"July 26, 2025 - Manchester, England (Co-op Live)"},time:"{{time}}",arena:"UFC Arena"},thread:{not_found:"Thread not found.",by:"by",replies:"Replies ({{count}})"},clips:{saved_clips:"Saved Clips",no_clips:"You have no saved clips yet.",hint_record:"Record clips during live streams to see them here.",download:"Download",share:"Share",clip_title:"UFC Clip",url_copied:"URL copied to clipboard"},prediction:{title:"Prediction & Bet",who_wins:"Who will win the fight?",additional_predictions:"Additional Predictions",first_strike:"First significant strike?",first_takedown:"First takedown?",will_be_ko:"Will there be a KO/TKO?",will_be_sub:"Will there be a Submission?",go_to_decision:"Will it go to Decision?",most_significant_strikes:"Most significant strikes?",send:"Send Prediction & Bet",yes:"Yes",no:"No",bet_amount:"Bet Amount",coins:"Coins",balance:"Balance",potential_win:"Potential Winnings",alert_invalid_bet:"Please enter a valid amount to bet.",alert_no_coins:"You don't have enough coins for this bet.",alert_sent:"Predictions sent with a bet of {{amount}} coins (see console)"},live:{title:"Live Stream",error_no_hls:"Your browser does not support live video playback",error_record:"Could not start recording",error_login:"You must be logged in to save clips.",error_upload:"Error uploading clip: {{message}}",on_air:"ON AIR",record_clip:"Record Clip",stop_record:"Stop Recording",chat_title:"Live Chat",no_messages:"No messages yet. Be the first to comment!",write_message:"Type your message...",send:"Send"},nav:{home:"Home",forum:"Forum",fighters:"Fighters",compare:"Compare",highlights:"Highlights",events:"Events",saved_clips:"Saved Clips",live:"Watch Live",profile:"My Profile",my_rankings:"My Rankings",buy_coins:"Buy Coins",rewards:"Rewards"},auth:{login:"Login",register:"Register",logout:"Logout",login_subtitle:"Enter your credentials to access your account",forgot_password:"Forgot your password?",or_continue_with:"Or continue with",continue_with_google:"Continue with Google",no_account:"Don't have an account?",register_here:"Register here",accept_terms:"By logging in, you accept our ",terms_conditions:"Terms and Conditions",email:"Email",password:"Password",remember:"Remember me",already_have_account:"Already have an account?",create_account:"Create Account",complete_data_join_community:"Complete your details to join the community",username:"Username",username_placeholder:"YourUsername",confirm_password:"Confirm Password",registering:"Registering...",login_here:"Login here",passwords_no_match:"Passwords do not match",email_placeholder:"your@email.com"},sidebar:{my_points:"My Points:"},stats:{accurate_predictions:"Accurate Predictions",coins_won:"Coins Won",global_ranking:"Global Ranking",next_level:"Next Level"},user:{default:"User",points:"pts",win_rate:"Win Rate",predictions:"Predictions",profile:"My Profile",ranking:"Global Ranking"},forum:{title:"Community Forum",search_placeholder:"Search the forum...",create_thread:"Create New Thread",categories:"Categories",recent_threads:"Recent Threads",by:"by",in:"in",category_general:"General Discussion",category_general_desc:"Talk about everything UFC",category_predictions:"Predictions & Bets",category_predictions_desc:"Share your predictions",category_news:"News & Rumors",category_news_desc:"Latest octagon news",category_fighters:"Fighters & Divisions",category_fighters_desc:"Category analysis"},highlights:{title:"Highlights",ko_epic:"Epic KO: McGregor vs. Aldo",submission_incredible:"Incredible Submission: Nurmagomedov",total_war:"Total War: Jones vs. Gustafsson I",surprise_kick:"Surprise Flying Kick",comeback:"Historic Comeback",night_ko:"Night of Knockouts",alt_ko:"Knockout punch in the octagon",alt_submission:"Submission hold on the mat",alt_war:"Intense exchange of blows",alt_kick:"Spectacular flying kick",alt_comeback:"Celebrating a comeback victory",alt_night:"Montage of highlight moments",fighters:"Fighters",watch_clip:"Watch Clip",loading:"Loading highlights...",retry:"Retry",refresh:"Refresh",no_clips:"No featured clips available at the moment.",upload_clip:"Upload Clip",upload_title:"Upload New Clip",title_label:"Title",description_label:"Description",fighters_label:"Fighters (comma separated)",fighters_placeholder:"McGregor, Aldo",video_label:"Video File",cancel:"Cancel",uploading:"Uploading...",close:"Close"},fighters:{title:"Official Fighter Rankings (P4P)",champion:"Champion",top_contender:"Top Contender",status:{"Campeón":"Champion","Top Contender":"Top Contender",Campeao:"Champion"},no_table:"Table or Badge components not found. Please create them if missing.",note:"Pound for Pound (P4P) ranking based on performance and divisional dominance.",rank:"Rank",name:"Name",division:"Division",record:"Record",status_col:"Status",points_col:"Points"},compare:{title:"Fighter Comparison",select_fighter_1:"Select Fighter 1",select_fighter_2:"Select Fighter 2",strikes_per_min:"Strikes / min",accuracy:"Accuracy (%)",takedowns_per_15:"Takedowns / 15min",defense:"Defense (%)",avg_fight_time:"Avg Fight Time",no_select:"Select component not found"},events:{title:"Upcoming Events",alt_arena:"Brightly lit arena packed with spectators for a UFC event",alt_octagon:"Side view of the UFC octagon during a fight",alt_staredown:"Two fighters facing off intensely before a match",alt_celebration:"A victorious fighter celebrating in the octagon",main_event:"Main Event:",co_main_event:"Co-Main Event:",details:"View Details"},category:{not_found:"Category not found.",search_placeholder:"Search in {{category}}...",threads_in:"Threads in {{category}} ({{count}})",no_threads:"No threads in this category yet."},login:{welcome:"Welcome to",subtitle:"Your ultimate platform for the MMA world"},register:{title:"Join the Community",subtitle:"Create your account and start predicting MMA results"},rankings:{title:"Global Prediction Rankings",rank:"Rank",user:"User",points:"Points",streak:"Streak",updated:"The ranking is updated after each main event. Keep predicting!"},fighter:{division:"Division:",country:"Country:",record:"Record:",status:"Status:"},home:{join_title:"Join the Community",join_desc:"Participate in the forums, compete in the prediction rankings, and show who knows the most about MMA.",see_rankings:"See Rankings",upcoming_events:"Upcoming Events",see_details:"See Details",champion:"Champion",challenger:"Challenger",vote_percent:"% of votes",ufc_300_title:"UFC 300: MAIN EVENT",open_predictions:"Open Predictions",event_principal:"Main Event",star_fight_description:"Main event for the world title",see_more:"Watch Live",make_prediction:"Make Prediction",see_all:"See all"},logo:{alt:"UFC Logo"},coins:{title:"Buy Virtual Coins",subtitle:"Purchase virtual coins to participate in predictions, bets and more platform activities",current_balance:"Current Balance",balance_description:"Coins available to use",coins:"Coins",choose_package:"Choose Your Package",most_popular:"Most Popular",discount:"Discount",per_coin:"Per coin",buy_now:"Buy Now",processing:"Processing...",purchase_initiated:"Purchase Initiated",redirecting_payment:"Redirecting to MercadoPago...",purchase_success:"Purchase Successful!",coins_added:"{{coins}} coins added to your account",login_required:"Login Required",login_message:"You need to log in to buy virtual coins",secure_payment:"Secure Payment",secure_description:"Protected by MercadoPago",instant_delivery:"Instant Delivery",instant_description:"Coins available immediately",best_value:"Best Value",best_value_description:"More coins for your money",payment_methods:"Payment Methods",accepted_methods:"Accepted Methods",credit_cards:"Credit Cards",debit_cards:"Debit Cards",bank_transfer:"Bank Transfer",digital_wallets:"Digital Wallets",security_info:"Security Information",ssl_encryption:"SSL Encryption",pci_compliant:"PCI DSS Compliant",refund_policy:"Refund Policy",customer_support:"Customer Support"},transactions:{history:"Transaction History",no_transactions:"You have no transactions yet",registration:"Registration",bet:"Bet",vote:"Vote",purchase_basic:"Purchase - Basic Package",purchase_standard:"Purchase - Standard Package",purchase_premium:"Purchase - Premium Package",purchase_pro:"Purchase - Pro Package",income:"Income",expense:"Expense"},error:{title:"Error",loading_history:"Error loading transaction history",purchase_failed:"Error processing purchase. Please try again.",loading_rewards:"Error loading rewards",redeem_failed:"Error redeeming reward. Please try again."},rewards:{title:"Rewards Catalog",subtitle:"Redeem your virtual coins for exclusive rewards and premium content",current_balance:"Current Balance",balance_description:"Coins available to redeem",all_categories:"All Categories",badges:"Badges",content:"Content",all_rewards:"All Rewards",categories:"Categories",my_rewards:"My Rewards",total_rewards:"Total Rewards",total_spent:"Total Spent",average_per_reward:"Average per Reward",common:"Common",rare:"Rare",legendary:"Legendary",limited:"Limited",includes:"Includes",benefits:"Benefits",processing:"Processing...",owned:"Already Owned",insufficient_coins:"Insufficient Coins",redeem:"Redeem",redeem_success:"Reward Redeemed!",reward_added:"{{name}} added to your collection",login_required:"Login Required",login_message:"You need to log in to view rewards",no_rewards:"You have no rewards yet",start_collecting:"Start collecting rewards!"},eventosUFC303:{title:"UFC 303: McGregor vs. Chandler",date_location:"June 28, 2025 - Las Vegas, NV (T-Mobile Arena)",time:"7:00 PM (local time)",main_card:"Main Card",prelims:"Prelims",vs:"VS",image_alt:"UFC 303 Arena",weights:{"Peso ligero":"Lightweight","Peso semipesado":"Light Heavyweight","Peso medio":"Middleweight","Peso gallo femenino":"Women's Bantamweight","Peso welter":"Welterweight","Peso pluma":"Featherweight","Peso gallo":"Bantamweight","Peso mosca":"Flyweight"}}},kk={profile:{edit_profile:"Editar Perfil",member_since:"Membro desde",username:"Nome de Usuário",email:"E-mail",total_points:"Pontos Totais",ranking:"Ranking",language:"Idioma"},main_card:"Card Principal",prelims:"Preliminares",vs:"VS",weight:{"peso medio":"Peso médio","peso semipesado":"Peso meio-pesado","peso pesado":"Peso pesado","peso gallo":"Peso galo","peso paja femenina":"Peso palha feminino","peso pluma":"Peso pena","Peso ligero":"Peso leve","peso mosca femenina":"Peso mosca feminino","peso mosca":"Peso mosca","peso welter":"Peso meio-médio"},event:{title:{sandhagen_nurmagomedov:"UFC Fight Night: Sandhagen vs. Nurmagomedov",namajunas_barber:"UFC Fight Night: Namajunas vs. Barber",edwards_muhammad:"UFC 304: Edwards vs. Muhammad 2"},date_location:{sandhagen_nurmagomedov:"2 de agosto de 2025 - Abu Dhabi, EAU (Etihad Arena)",namajunas_barber:"12 de julho de 2025 - Denver, CO (Ball Arena)",edwards_muhammad:"26 de julho de 2025 - Manchester, Inglaterra (Co-op Live)"},time:"{{time}}",arena:"Arena do UFC"},thread:{replies:"Respostas ({{count}})"},clips:{saved_clips:"Clipes Salvos",no_clips:"Você ainda não tem clipes salvos.",hint_record:"Grave clipes durante as transmissões ao vivo para vê-los aqui.",download:"Baixar",share:"Compartilhar",clip_title:"Clipe do UFC",url_copied:"URL copiada para a área de transferência"},prediction:{title:"Previsão e Aposta",who_wins:"Quem vai ganhar a luta?",additional_predictions:"Previsões Adicionais",first_strike:"Primeiro golpe significativo?",first_takedown:"Primeira queda?",will_be_ko:"Vai haver KO/TKO?",will_be_sub:"Vai haver Finalização?",go_to_decision:"Vai para Decisão?",most_significant_strikes:"Mais golpes significativos?",send:"Enviar Previsão e Aposta",yes:"Sim",no:"Não",bet_amount:"Valor da Aposta",coins:"Moedas",balance:"Saldo",potential_win:"Ganho Potencial",alert_invalid_bet:"Por favor, insira um valor válido para apostar.",alert_no_coins:"Você não tem moedas suficientes para esta aposta.",alert_sent:"Previsões enviadas com aposta de {{amount}} moedas (ver console)"},live:{title:"Transmissão ao Vivo",error_no_hls:"Seu navegador não suporta reprodução de vídeo ao vivo",error_record:"Não foi possível iniciar a gravação",error_login:"Você precisa estar logado para salvar clipes.",error_upload:"Erro ao enviar o clipe: {{message}}",on_air:"AO VIVO",record_clip:"Gravar Clipe",stop_record:"Parar Gravação",chat_title:"Chat ao Vivo",no_messages:"Ainda não há mensagens. Seja o primeiro a comentar!",write_message:"Digite sua mensagem...",send:"Enviar"},nav:{home:"Início",forum:"Fórum",fighters:"Lutadores",compare:"Comparar",highlights:"Destaques",events:"Eventos",saved_clips:"Clipes Salvos",live:"Assistir ao Vivo",profile:"Meu Perfil",my_rankings:"Meus Rankings",buy_coins:"Comprar Moedas",rewards:"Recompensas"},auth:{login:"Entrar",register:"Registrar-se",logout:"Sair",login_subtitle:"Insira suas credenciais para acessar sua conta",forgot_password:"Esqueceu sua senha?",or_continue_with:"Ou continue com",continue_with_google:"Continuar com Google",no_account:"Não tem uma conta?",register_here:"Cadastre-se aqui",accept_terms:"Ao se registrar, você aceita nossos ",terms_conditions:"Termos e Condições",email:"E-mail",password:"Senha",remember:"Lembrar-me",already_have_account:"Já tem uma conta?",create_account:"Criar Conta",complete_data_join_community:"Complete seus dados para entrar na comunidade",username:"Nome de Usuário",username_placeholder:"SeuUsuario",confirm_password:"Confirmar Senha",registering:"Registrando...",login_here:"Entrar aqui",passwords_no_match:"As senhas não coincidem",email_placeholder:"seu@email.com"},sidebar:{my_points:"Meus Pontos:"},stats:{accurate_predictions:"Previsões Acertadas",coins_won:"Moedas Ganhas",global_ranking:"Ranking Global",next_level:"Próximo Nível"},user:{default:"Usuário",points:"pts",win_rate:"Taxa de Vitórias",predictions:"Previsões",profile:"Meu Perfil",ranking:"Ranking Global"},highlights:{title:"Destaques",ko_epic:"KO Épico: McGregor vs. Aldo",submission_incredible:"Finalização Incrível: Nurmagomedov",total_war:"Guerra Total: Jones vs. Gustafsson I",surprise_kick:"Chute Voador Surpresa",comeback:"Virada Histórica",night_ko:"Noite de Nocautes",alt_ko:"Soco de nocaute no octógono",alt_submission:"Finalização no chão",alt_war:"Troca intensa de golpes",alt_kick:"Chute voador espetacular",alt_comeback:"Celebrando uma vitória de virada",alt_night:"Montagem de momentos de destaque",fighters:"Lutadores",watch_clip:"Assistir Clipe",loading:"Carregando destaques...",retry:"Tentar Novamente",refresh:"Atualizar",no_clips:"Não há clipes em destaque disponíveis no momento.",upload_clip:"Enviar Clipe",upload_title:"Enviar Novo Clipe",title_label:"Título",description_label:"Descrição",fighters_label:"Lutadores (separados por vírgulas)",fighters_placeholder:"McGregor, Aldo",video_label:"Arquivo de Vídeo",cancel:"Cancelar",uploading:"Enviando...",close:"Fechar"},events:{title:"Próximos Eventos",alt_arena:"Arena iluminada cheia de espectadores para um evento do UFC",alt_octagon:"Vista lateral do octógono do UFC durante uma luta",alt_staredown:"Dois lutadores frente a frente antes de uma luta",alt_celebration:"Lutador vitorioso comemorando no octógono",main_event:"Luta Principal:",co_main_event:"Co-Principal:",details:"Ver Detalhes"},category:{not_found:"Categoria não encontrada.",search_placeholder:"Buscar em {{category}}...",threads_in:"Tópicos em {{category}} ({{count}})",no_threads:"Ainda não há tópicos nesta categoria."},login:{welcome:"Bem-vindo ao",subtitle:"Sua plataforma definitiva para o mundo do MMA"},register:{title:"Junte-se à Comunidade",subtitle:"Crie sua conta e comece a prever resultados de MMA"},rankings:{title:"Ranking Global de Previsões",rank:"Posição",user:"Usuário",points:"Pontos",streak:"Sequência",updated:"O ranking é atualizado após cada evento principal. Continue prevendo!"},fighters:{title:"Ranking Oficial de Lutadores (P4P)",rank:"Posição",name:"Nome",division:"Divisão",record:"Cartel",status_col:"Status",points_col:"Pontos",no_table:"Componentes de Tabela ou Badge não encontrados. Por favor, crie-os se não existirem.",note:"Ranking Peso por Peso (P4P) baseado no desempenho e domínio divisional.",status:{"Campeón":"Campeão","Top Contender":"Top Contender"}},home:{join_title:"Junte-se à Comunidade",join_desc:"Participe dos fóruns, compita nos rankings de previsões e mostre quem mais entende de MMA.",see_rankings:"Ver Rankings",upcoming_events:"Próximos Eventos",see_details:"Ver Detalhes",champion:"Campeão",challenger:"Desafiante",vote_percent:"% dos votos",ufc_300_title:"UFC 300: LUTA PRINCIPAL",see_all:"Ver todos"},logo:{alt:"Logo do UFC"},coins:{title:"Comprar Moedas Virtuais",subtitle:"Adquira moedas virtuais para participar em previsões, apostas e mais atividades da plataforma",current_balance:"Saldo Atual",balance_description:"Moedas disponíveis para usar",coins:"Moedas",choose_package:"Escolha seu Pacote",most_popular:"Mais Popular",discount:"Desconto",per_coin:"Por moeda",buy_now:"Comprar Agora",processing:"Processando...",purchase_initiated:"Compra Iniciada",redirecting_payment:"Redirecionando para MercadoPago...",purchase_success:"Compra Bem-sucedida!",coins_added:"{{coins}} moedas adicionadas à sua conta",login_required:"Login Necessário",login_message:"Você precisa fazer login para comprar moedas virtuais",secure_payment:"Pagamento Seguro",secure_description:"Protegido pelo MercadoPago",instant_delivery:"Entrega Instantânea",instant_description:"Moedas disponíveis imediatamente",best_value:"Melhor Valor",best_value_description:"Mais moedas pelo seu dinheiro",payment_methods:"Métodos de Pagamento",accepted_methods:"Métodos Aceitos",credit_cards:"Cartões de Crédito",debit_cards:"Cartões de Débito",bank_transfer:"Transferência Bancária",digital_wallets:"Carteiras Digitais",security_info:"Informações de Segurança",ssl_encryption:"Criptografia SSL",pci_compliant:"Compatível com PCI DSS",refund_policy:"Política de Reembolso",customer_support:"Suporte ao Cliente"},transactions:{history:"Histórico de Transações",no_transactions:"Você ainda não tem transações",registration:"Registro",bet:"Aposta",vote:"Voto",purchase_basic:"Compra - Pacote Básico",purchase_standard:"Compra - Pacote Padrão",purchase_premium:"Compra - Pacote Premium",purchase_pro:"Compra - Pacote Pro",income:"Receita",expense:"Despesa"},error:{title:"Erro",loading_history:"Erro ao carregar histórico de transações",purchase_failed:"Erro ao processar compra. Tente novamente.",loading_rewards:"Erro ao carregar recompensas",redeem_failed:"Erro ao resgatar recompensa. Tente novamente."},rewards:{title:"Catálogo de Recompensas",subtitle:"Resgate suas moedas virtuais por recompensas exclusivas e conteúdo premium",current_balance:"Saldo Atual",balance_description:"Moedas disponíveis para resgatar",all_categories:"Todas as Categorias",badges:"Insígnias",content:"Conteúdo",all_rewards:"Todas as Recompensas",categories:"Categorias",my_rewards:"Minhas Recompensas",total_rewards:"Total de Recompensas",total_spent:"Total Gasto",average_per_reward:"Média por Recompensa",common:"Comum",rare:"Rara",legendary:"Lendária",limited:"Limitada",includes:"Inclui",benefits:"Benefícios",processing:"Processando...",owned:"Já Possuída",insufficient_coins:"Moedas Insuficientes",redeem:"Resgatar",redeem_success:"Recompensa Resgatada!",reward_added:"{{name}} adicionada à sua coleção",login_required:"Login Necessário",login_message:"Você precisa fazer login para ver as recompensas",no_rewards:"Você ainda não tem recompensas",start_collecting:"Comece a colecionar recompensas!"},eventosUFC303:{title:"UFC 303: McGregor vs. Chandler",date_location:"28 de junho de 2025 - Las Vegas, NV (T-Mobile Arena)",time:"19:00 (horário local)",main_card:"Card Principal",prelims:"Preliminares",vs:"VS",image_alt:"Arena do UFC 303",weights:{"Peso ligero":"Peso leve","Peso semipesado":"Peso meio-pesado","Peso medio":"Peso médio","Peso gallo feminino":"Peso galo feminino","Peso welter":"Peso meio-médio","Peso pluma":"Peso pena","Peso gallo":"Peso galo","Peso mosca":"Peso mosca"}}};ik.use(Sk).use(vc).init({resources:{es:{translation:Tk},en:{translation:_k},pt:{translation:kk}},fallbackLng:"es",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});ne(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(ae,{children:e.jsx(hm,{children:e.jsx(Nm,{children:e.jsx(GT,{children:e.jsx(g_,{})})})})})}));

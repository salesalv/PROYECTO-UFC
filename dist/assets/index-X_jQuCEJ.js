import{j as e,S as t,O as s,P as i,C as r,a as n,T as a,D as o,R as l,b as c,c as d,L as h,I as u,d as f,e as m,f as g,V as p,g as v,A as y,h as b,i as x,k as E,l as T,m as S,$ as w,n as k,o as A,p as L,q as R,r as _,s as I,t as P,u as C,v as D,w as N,x as M,y as O,z as j,B as F,E as U,F as B,G as $,H as G,J as V,K,M as H,N as q,Q as W}from"./radix-DFvs02kk.js";import{a as Y,r as z,b as X,L as J,g as Q,c as Z,u as ee,N as te,d as se,e as ie,f as re,B as ne}from"./vendor-DS9cy9Oy.js";var ae;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var oe=Y;ae=oe.createRoot,oe.hydrateRoot;const le=z.createContext({});function ce(e){const t=z.useRef(null);return null===t.current&&(t.current=e()),t.current}const de=z.createContext(null),he=z.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class ue extends z.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function fe({children:t,isPresent:s}){const i=z.useId(),r=z.useRef(null),n=z.useRef({width:0,height:0,top:0,left:0}),{nonce:a}=z.useContext(he);return z.useInsertionEffect((()=>{const{width:e,height:t,top:o,left:l}=n.current;if(s||!r.current||!e||!t)return;r.current.dataset.motionPopId=i;const c=document.createElement("style");return a&&(c.nonce=a),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`\n          [data-motion-pop-id="${i}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${o}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(c)}}),[s]),e.jsx(ue,{isPresent:s,childRef:r,sizeRef:n,children:z.cloneElement(t,{ref:r})})}const me=({children:t,initial:s,isPresent:i,onExitComplete:r,custom:n,presenceAffectsLayout:a,mode:o})=>{const l=ce(ge),c=z.useId(),d=z.useCallback((e=>{l.set(e,!0);for(const t of l.values())if(!t)return;r&&r()}),[l,r]),h=z.useMemo((()=>({id:c,initial:s,isPresent:i,custom:n,onExitComplete:d,register:e=>(l.set(e,!1),()=>l.delete(e))})),a?[Math.random(),d]:[i,d]);return z.useMemo((()=>{l.forEach(((e,t)=>l.set(t,!1)))}),[i]),z.useEffect((()=>{!i&&!l.size&&r&&r()}),[i]),"popLayout"===o&&(t=e.jsx(fe,{isPresent:i,children:t})),e.jsx(de.Provider,{value:h,children:t})};function ge(){return new Map}function pe(e=!0){const t=z.useContext(de);if(null===t)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,n=z.useId();z.useEffect((()=>{e&&r(n)}),[e]);const a=z.useCallback((()=>e&&i&&i(n)),[n,i,e]);return!s&&i?[!1,a]:[!0]}const ve=e=>e.key||"";function ye(e){const t=[];return z.Children.forEach(e,(e=>{z.isValidElement(e)&&t.push(e)})),t}const be="undefined"!=typeof window,xe=be?z.useLayoutEffect:z.useEffect,Ee=({children:t,custom:s,initial:i=!0,onExitComplete:r,presenceAffectsLayout:n=!0,mode:a="sync",propagate:o=!1})=>{const[l,c]=pe(o),d=z.useMemo((()=>ye(t)),[t]),h=o&&!l?[]:d.map(ve),u=z.useRef(!0),f=z.useRef(d),m=ce((()=>new Map)),[g,p]=z.useState(d),[v,y]=z.useState(d);xe((()=>{u.current=!1,f.current=d;for(let e=0;e<v.length;e++){const t=ve(v[e]);h.includes(t)?m.delete(t):!0!==m.get(t)&&m.set(t,!1)}}),[v,h.length,h.join("-")]);const b=[];if(d!==g){let e=[...d];for(let t=0;t<v.length;t++){const s=v[t],i=ve(s);h.includes(i)||(e.splice(t,0,s),b.push(s))}return"wait"===a&&b.length&&(e=b),y(ye(e)),void p(d)}const{forceRender:x}=z.useContext(le);return e.jsx(e.Fragment,{children:v.map((t=>{const g=ve(t),p=!(o&&!l)&&(d===v||h.includes(g));return e.jsx(me,{isPresent:p,initial:!(u.current&&!i)&&void 0,custom:p?void 0:s,presenceAffectsLayout:n,mode:a,onExitComplete:p?void 0:()=>{if(!m.has(g))return;m.set(g,!0);let e=!0;m.forEach((t=>{t||(e=!1)})),e&&(null==x||x(),y(f.current),o&&(null==c||c()),r&&r())},children:t},g)}))})},Te=e=>e;let Se=Te;function we(e){let t;return()=>(void 0===t&&(t=e()),t)}const ke=(e,t,s)=>{const i=t-e;return 0===i?1:(s-e)/i},Ae=e=>1e3*e,Le=e=>e/1e3,Re=!1;const _e=["read","resolveKeyframes","update","preRender","render","postRender"];function Ie(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},n=()=>s=!0,a=_e.reduce(((e,t)=>(e[t]=function(e){let t=new Set,s=new Set,i=!1,r=!1;const n=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function o(t){n.has(t)&&(l.schedule(t),e()),t(a)}const l={schedule:(e,r=!1,a=!1)=>{const o=a&&i?t:s;return r&&n.add(e),o.has(e)||o.add(e),e},cancel:e=>{s.delete(e),n.delete(e)},process:e=>{a=e,i?r=!0:(i=!0,[t,s]=[s,t],t.forEach(o),t.clear(),i=!1,r&&(r=!1,l.process(e)))}};return l}(n),e)),{}),{read:o,resolveKeyframes:l,update:c,preRender:d,render:h,postRender:u}=a,f=()=>{const n=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(n-r.timestamp,40),1),r.timestamp=n,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),d.process(r),h.process(r),u.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(f))};return{schedule:_e.reduce(((t,n)=>{const o=a[n];return t[n]=(t,n=!1,a=!1)=>(s||(s=!0,i=!0,r.isProcessing||e(f)),o.schedule(t,n,a)),t}),{}),cancel:e=>{for(let t=0;t<_e.length;t++)a[_e[t]].cancel(e)},state:r,steps:a}}const{schedule:Pe,cancel:Ce,state:De,steps:Ne}=Ie("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Te,!0),Me=z.createContext({strict:!1}),Oe={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},je={};for(const kw in Oe)je[kw]={isEnabled:e=>Oe[kw].some((t=>!!e[t]))};const Fe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ue(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Fe.has(e)}let Be=e=>!Ue(e);try{($e=require("@emotion/is-prop-valid").default)&&(Be=e=>e.startsWith("on")?!Ue(e):$e(e))}catch(Sw){}var $e;function Ge(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(s,i)=>"create"===i?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}const Ve=z.createContext({});function Ke(e){return"string"==typeof e||Array.isArray(e)}function He(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const qe=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],We=["initial",...qe];function Ye(e){return He(e.animate)||We.some((t=>Ke(e[t])))}function ze(e){return Boolean(Ye(e)||e.variants)}function Xe(e){const{initial:t,animate:s}=function(e,t){if(Ye(e)){const{initial:t,animate:s}=e;return{initial:!1===t||Ke(t)?t:void 0,animate:Ke(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,z.useContext(Ve));return z.useMemo((()=>({initial:t,animate:s})),[Je(t),Je(s)])}function Je(e){return Array.isArray(e)?e.join(" "):e}const Qe=Symbol.for("motionComponentSymbol");function Ze(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function et(e,t,s){return z.useCallback((i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&("function"==typeof s?s(i):Ze(s)&&(s.current=i))}),[t])}const tt=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),st="data-"+tt("framerAppearId"),{schedule:it}=Ie(queueMicrotask,!1),rt=z.createContext({});function nt(e,t,s,i,r){var n,a;const{visualElement:o}=z.useContext(Ve),l=z.useContext(Me),c=z.useContext(de),d=z.useContext(he).reducedMotion,h=z.useRef(null);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:o,props:s,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:d}));const u=h.current,f=z.useContext(rt);!u||u.projection||!r||"html"!==u.type&&"svg"!==u.type||function(e,t,s,i){const{layoutId:r,layout:n,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:at(e.parent)),e.projection.setOptions({layoutId:r,layout:n,alwaysMeasureLayout:Boolean(a)||o&&Ze(o),visualElement:e,animationType:"string"==typeof n?n:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}(h.current,s,r,f);const m=z.useRef(!1);z.useInsertionEffect((()=>{u&&m.current&&u.update(s,c)}));const g=s[st],p=z.useRef(Boolean(g)&&!(null===(n=window.MotionHandoffIsComplete)||void 0===n?void 0:n.call(window,g))&&(null===(a=window.MotionHasOptimisedAnimation)||void 0===a?void 0:a.call(window,g)));return xe((()=>{u&&(m.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),it.render(u.render),p.current&&u.animationState&&u.animationState.animateChanges())})),z.useEffect((()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask((()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,g)})),p.current=!1))})),u}function at(e){if(e)return!1!==e.options.allowProjection?e.projection:at(e.parent)}function ot({preloadedFeatures:t,createVisualElement:s,useRender:i,useVisualState:r,Component:n}){var a,o;function l(t,a){let o;const l={...z.useContext(he),...t,layoutId:lt(t)},{isStatic:c}=l,d=Xe(t),h=r(t,c);if(!c&&be){z.useContext(Me).strict;const e=function(e){const{drag:t,layout:s}=je;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==s?void 0:s.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(l);o=e.MeasureLayout,d.visualElement=nt(n,h,l,s,e.ProjectionNode)}return e.jsxs(Ve.Provider,{value:d,children:[o&&d.visualElement?e.jsx(o,{visualElement:d.visualElement,...l}):null,i(n,t,et(h,d.visualElement,a),h,c,d.visualElement)]})}t&&function(e){for(const t in e)je[t]={...je[t],...e[t]}}(t),l.displayName=`motion.${"string"==typeof n?n:`create(${null!==(o=null!==(a=n.displayName)&&void 0!==a?a:n.name)&&void 0!==o?o:""})`}`;const c=z.forwardRef(l);return c[Qe]=n,c}function lt({layoutId:e}){const t=z.useContext(le).id;return t&&void 0!==e?t+"-"+e:e}const ct=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function dt(e){return"string"==typeof e&&!e.includes("-")&&!!(ct.indexOf(e)>-1||/[A-Z]/u.test(e))}function ht(e){const t=[{},{}];return null==e||e.values.forEach(((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()})),t}function ut(e,t,s,i){if("function"==typeof t){const[r,n]=ht(i);t=t(void 0!==s?s:e.custom,r,n)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,n]=ht(i);t=t(void 0!==s?s:e.custom,r,n)}return t}const ft=e=>Array.isArray(e),mt=e=>Boolean(e&&e.getVelocity);function gt(e){const t=mt(e)?e.get():e;return s=t,Boolean(s&&"object"==typeof s&&s.mix&&s.toValue)?t.toValue():t;var s}const pt=e=>(t,s)=>{const i=z.useContext(Ve),r=z.useContext(de),n=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,n){const a={latestValues:vt(i,r,n,e),renderState:t()};return s&&(a.onMount=e=>s({props:i,current:e,...a}),a.onUpdate=e=>s(e)),a}(e,t,i,r);return s?n():ce(n)};function vt(e,t,s,i){const r={},n=i(e,{});for(const u in n)r[u]=gt(n[u]);let{initial:a,animate:o}=e;const l=Ye(e),c=ze(e);t&&c&&!l&&!1!==e.inherit&&(void 0===a&&(a=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===a;const h=d?o:a;if(h&&"boolean"!=typeof h&&!He(h)){const t=Array.isArray(h)?h:[h];for(let s=0;s<t.length;s++){const i=ut(e,t[s]);if(i){const{transitionEnd:e,transition:t,...s}=i;for(const i in s){let e=s[i];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}const yt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],bt=new Set(yt),xt=e=>t=>"string"==typeof t&&t.startsWith(e),Et=xt("--"),Tt=xt("var(--"),St=e=>!!Tt(e)&&wt.test(e.split("/*")[0].trim()),wt=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,kt=(e,t)=>t&&"number"==typeof e?t.transform(e):e,At=(e,t,s)=>s>t?t:s<e?e:s,Lt={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Rt={...Lt,transform:e=>At(0,1,e)},_t={...Lt,default:1},It=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),Pt=It("deg"),Ct=It("%"),Dt=It("px"),Nt=It("vh"),Mt=It("vw"),Ot={...Ct,parse:e=>Ct.parse(e)/100,transform:e=>Ct.transform(100*e)},jt={borderWidth:Dt,borderTopWidth:Dt,borderRightWidth:Dt,borderBottomWidth:Dt,borderLeftWidth:Dt,borderRadius:Dt,radius:Dt,borderTopLeftRadius:Dt,borderTopRightRadius:Dt,borderBottomRightRadius:Dt,borderBottomLeftRadius:Dt,width:Dt,maxWidth:Dt,height:Dt,maxHeight:Dt,top:Dt,right:Dt,bottom:Dt,left:Dt,padding:Dt,paddingTop:Dt,paddingRight:Dt,paddingBottom:Dt,paddingLeft:Dt,margin:Dt,marginTop:Dt,marginRight:Dt,marginBottom:Dt,marginLeft:Dt,backgroundPositionX:Dt,backgroundPositionY:Dt},Ft={rotate:Pt,rotateX:Pt,rotateY:Pt,rotateZ:Pt,scale:_t,scaleX:_t,scaleY:_t,scaleZ:_t,skew:Pt,skewX:Pt,skewY:Pt,distance:Dt,translateX:Dt,translateY:Dt,translateZ:Dt,x:Dt,y:Dt,z:Dt,perspective:Dt,transformPerspective:Dt,opacity:Rt,originX:Ot,originY:Ot,originZ:Dt},Ut={...Lt,transform:Math.round},Bt={...jt,...Ft,zIndex:Ut,size:Dt,fillOpacity:Rt,strokeOpacity:Rt,numOctaves:Ut},$t={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Gt=yt.length;function Vt(e,t,s){const{style:i,vars:r,transformOrigin:n}=e;let a=!1,o=!1;for(const l in t){const e=t[l];if(bt.has(l))a=!0;else if(Et(l))r[l]=e;else{const t=kt(e,Bt[l]);l.startsWith("origin")?(o=!0,n[l]=t):i[l]=t}}if(t.transform||(a||s?i.transform=function(e,t,s){let i="",r=!0;for(let n=0;n<Gt;n++){const a=yt[n],o=e[a];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(a.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=kt(o,Bt[a]);l||(r=!1,i+=`${$t[a]||a}(${e}) `),s&&(t[a]=e)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}(t,e.transform,s):i.transform&&(i.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=n;i.transformOrigin=`${e} ${t} ${s}`}}const Kt={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ht={offset:"strokeDashoffset",array:"strokeDasharray"};function qt(e,t,s){return"string"==typeof e?e:Dt.transform(t+s*e)}function Wt(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:n,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...c},d,h){if(Vt(e,c,h),d)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:f,dimensions:m}=e;u.transform&&(m&&(f.transform=u.transform),delete u.transform),m&&(void 0!==r||void 0!==n||f.transform)&&(f.transformOrigin=function(e,t,s){return`${qt(t,e.x,e.width)} ${qt(s,e.y,e.height)}`}(m,void 0!==r?r:.5,void 0!==n?n:.5)),void 0!==t&&(u.x=t),void 0!==s&&(u.y=s),void 0!==i&&(u.scale=i),void 0!==a&&function(e,t,s=1,i=0,r=!0){e.pathLength=1;const n=r?Kt:Ht;e[n.offset]=Dt.transform(-i);const a=Dt.transform(t),o=Dt.transform(s);e[n.array]=`${a} ${o}`}(u,a,o,l,!1)}const Yt=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),zt=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Xt=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Jt(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const n in s)e.style.setProperty(n,s[n])}const Qt=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Zt(e,t,s,i){Jt(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Qt.has(r)?r:tt(r),t.attrs[r])}const es={};function ts(e,{layout:t,layoutId:s}){return bt.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!es[e]||"opacity"===e)}function ss(e,t,s){var i;const{style:r}=e,n={};for(const a in r)(mt(r[a])||t.style&&mt(t.style[a])||ts(a,e)||void 0!==(null===(i=null==s?void 0:s.getValue(a))||void 0===i?void 0:i.liveStyle))&&(n[a]=r[a]);return n}function is(e,t,s){const i=ss(e,t,s);for(const r in e)if(mt(e[r])||mt(t[r])){i[-1!==yt.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}const rs=["x","y","width","height","cx","cy","r"],ns={useVisualState:pt({scrapeMotionValuesFromProps:is,createRenderState:zt,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let n=!!e.drag;if(!n)for(const o in r)if(bt.has(o)){n=!0;break}if(!n)return;let a=!t;if(t)for(let o=0;o<rs.length;o++){const s=rs[o];e[s]!==t[s]&&(a=!0)}a&&Pe.read((()=>{!function(e,t){try{t.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(s){t.dimensions={x:0,y:0,width:0,height:0}}}(s,i),Pe.render((()=>{Wt(i,r,Xt(s.tagName),e.transformTemplate),Zt(s,i)}))}))}})},as={useVisualState:pt({scrapeMotionValuesFromProps:ss,createRenderState:Yt})};function os(e,t,s){for(const i in t)mt(t[i])||ts(i,s)||(e[i]=t[i])}function ls(e,t){const s={};return os(s,e.style||{},e),Object.assign(s,function({transformTemplate:e},t){return z.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{}};return Vt(s,t,e),Object.assign({},s.vars,s.style)}),[t])}(e,t)),s}function cs(e,t){const s={},i=ls(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function ds(e,t,s,i){const r=z.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Wt(s,t,Xt(i),e.transformTemplate),{...s.attrs,style:{...s.style}}}),[t]);if(e.style){const t={};os(t,e.style,e),r.style={...t,...r.style}}return r}function hs(e=!1){return(t,s,i,{latestValues:r},n)=>{const a=(dt(t)?ds:cs)(s,r,n,t),o=function(e,t,s){const i={};for(const r in e)"values"===r&&"object"==typeof e.values||(Be(r)||!0===s&&Ue(r)||!t&&!Ue(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(s,"string"==typeof t,e),l=t!==z.Fragment?{...o,...a,ref:i}:{},{children:c}=s,d=z.useMemo((()=>mt(c)?c.get():c),[c]);return z.createElement(t,{...l,children:d})}}function us(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){return ot({...dt(s)?ns:as,preloadedFeatures:e,useRender:hs(i),createVisualElement:t,Component:s})}}function fs(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function ms(e,t,s){const i=e.getProps();return ut(i,t,void 0!==s?s:i.custom,e)}const gs=we((()=>void 0!==window.ScrollTimeline));class ps{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map((e=>"finished"in e?e.finished:e)))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e,t){const s=this.animations.map((s=>gs()&&s.attachTimeline?s.attachTimeline(e):"function"==typeof t?t(s):void 0));return()=>{s.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class vs extends ps{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function ys(e,t){return e?e[t]||e.default||e:void 0}const bs=2e4;function xs(e){let t=0;let s=e.next(t);for(;!s.done&&t<bs;)t+=50,s=e.next(t);return t>=bs?1/0:t}function Es(e){return"function"==typeof e}function Ts(e,t){e.timeline=t,e.onfinish=null}const Ss=e=>Array.isArray(e)&&"number"==typeof e[0],ws={linearEasing:void 0};function ks(e,t){const s=we(e);return()=>{var e;return null!==(e=ws[t])&&void 0!==e?e:s()}}const As=ks((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),Ls=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let n=0;n<r;n++)i+=e(ke(0,r-1,n))+", ";return`linear(${i.substring(0,i.length-2)})`};function Rs(e){return Boolean("function"==typeof e&&As()||!e||"string"==typeof e&&(e in Is||As())||Ss(e)||Array.isArray(e)&&e.every(Rs))}const _s=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,Is={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_s([0,.65,.55,1]),circOut:_s([.55,0,1,.45]),backIn:_s([.31,.01,.66,-.59]),backOut:_s([.33,1.53,.69,.99])};function Ps(e,t){return e?"function"==typeof e&&As()?Ls(e,t):Ss(e)?_s(e):Array.isArray(e)?e.map((e=>Ps(e,t)||Is.easeOut)):Is[e]:void 0}const Cs={x:!1,y:!1};function Ds(){return Cs.x||Cs.y}function Ns(e,t){const s=function(e){if(e instanceof Element)return[e];if("string"==typeof e){const t=document.querySelectorAll(e);return t?Array.from(t):[]}return Array.from(e)}(e),i=new AbortController;return[s,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function Ms(e){return t=>{"touch"===t.pointerType||Ds()||e(t)}}const Os=(e,t)=>!!t&&(e===t||Os(e,t.parentElement)),js=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Fs=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Us=new WeakSet;function Bs(e){return t=>{"Enter"===t.key&&e(t)}}function $s(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Gs(e){return js(e)&&!Ds()}function Vs(e,t,s={}){const[i,r,n]=Ns(e,s),a=e=>{const i=e.currentTarget;if(!Gs(e)||Us.has(i))return;Us.add(i);const n=t(e),a=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Gs(e)&&Us.has(i)&&(Us.delete(i),"function"==typeof n&&n(e,{success:t}))},o=e=>{a(e,s.useGlobalTarget||Os(i,e.target))},l=e=>{a(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return i.forEach((e=>{(function(e){return Fs.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(s.useGlobalTarget?window:e).addEventListener("pointerdown",a,r),e.addEventListener("focus",(e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const i=Bs((()=>{if(Us.has(s))return;$s(s,"down");const e=Bs((()=>{$s(s,"up")}));s.addEventListener("keyup",e,t),s.addEventListener("blur",(()=>$s(s,"cancel")),t)}));s.addEventListener("keydown",i,t),s.addEventListener("blur",(()=>s.removeEventListener("keydown",i)),t)})(e,r)),r)})),n}const Ks=new Set(["width","height","top","left","right","bottom",...yt]);let Hs;function qs(){Hs=void 0}const Ws={now:()=>(void 0===Hs&&Ws.set(De.isProcessing||Re?De.timestamp:performance.now()),Hs),set:e=>{Hs=e,queueMicrotask(qs)}};function Ys(e,t){-1===e.indexOf(t)&&e.push(t)}function zs(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class Xs{constructor(){this.subscriptions=[]}add(e){return Ys(this.subscriptions,e),()=>zs(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,s);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Js(e,t){return t?e*(1e3/t):0}class Qs{constructor(e,t={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const s=Ws.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Ws.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Xs);const s=this.events[e].add(t);return"change"===e?()=>{s(),Pe.read((()=>{this.events.change.getSize()||this.stop()}))}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ws.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Js(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Zs(e,t){return new Qs(e,t)}function ei(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Zs(s))}function ti(e,t){const s=e.getValue("willChange");if(i=s,Boolean(mt(i)&&i.add))return s.add(t);var i}function si(e){return e.props[st]}const ii=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function ri(e,t,s,i){if(e===t&&s===i)return Te;const r=t=>function(e,t,s,i,r){let n,a,o=0;do{a=t+(s-t)/2,n=ii(a,i,r)-e,n>0?s=a:t=a}while(Math.abs(n)>1e-7&&++o<12);return a}(t,0,1,e,s);return e=>0===e||1===e?e:ii(r(e),t,i)}const ni=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ai=e=>t=>1-e(1-t),oi=ri(.33,1.53,.69,.99),li=ai(oi),ci=ni(li),di=e=>(e*=2)<1?.5*li(e):.5*(2-Math.pow(2,-10*(e-1))),hi=e=>1-Math.sin(Math.acos(e)),ui=ai(hi),fi=ni(hi),mi=e=>/^0[^.\s]+$/u.test(e);const gi=e=>Math.round(1e5*e)/1e5,pi=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const vi=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,yi=(e,t)=>s=>Boolean("string"==typeof s&&vi.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),bi=(e,t,s)=>i=>{if("string"!=typeof i)return i;const[r,n,a,o]=i.match(pi);return{[e]:parseFloat(r),[t]:parseFloat(n),[s]:parseFloat(a),alpha:void 0!==o?parseFloat(o):1}},xi={...Lt,transform:e=>Math.round((e=>At(0,255,e))(e))},Ei={test:yi("rgb","red"),parse:bi("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+xi.transform(e)+", "+xi.transform(t)+", "+xi.transform(s)+", "+gi(Rt.transform(i))+")"};const Ti={test:yi("#"),parse:function(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Ei.transform},Si={test:yi("hsl","hue"),parse:bi("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+Ct.transform(gi(t))+", "+Ct.transform(gi(s))+", "+gi(Rt.transform(i))+")"},wi={test:e=>Ei.test(e)||Ti.test(e)||Si.test(e),parse:e=>Ei.test(e)?Ei.parse(e):Si.test(e)?Si.parse(e):Ti.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Ei.transform(e):Si.transform(e)},ki=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const Ai="number",Li="color",Ri=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function _i(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let n=0;const a=t.replace(Ri,(e=>(wi.test(e)?(i.color.push(n),r.push(Li),s.push(wi.parse(e))):e.startsWith("var(")?(i.var.push(n),r.push("var"),s.push(e)):(i.number.push(n),r.push(Ai),s.push(parseFloat(e))),++n,"${}"))).split("${}");return{values:s,split:a,indexes:i,types:r}}function Ii(e){return _i(e).values}function Pi(e){const{split:t,types:s}=_i(e),i=t.length;return e=>{let r="";for(let n=0;n<i;n++)if(r+=t[n],void 0!==e[n]){const t=s[n];r+=t===Ai?gi(e[n]):t===Li?wi.transform(e[n]):e[n]}return r}}const Ci=e=>"number"==typeof e?0:e;const Di={test:function(e){var t,s;return isNaN(e)&&"string"==typeof e&&((null===(t=e.match(pi))||void 0===t?void 0:t.length)||0)+((null===(s=e.match(ki))||void 0===s?void 0:s.length)||0)>0},parse:Ii,createTransformer:Pi,getAnimatableNone:function(e){const t=Ii(e);return Pi(e)(t.map(Ci))}},Ni=new Set(["brightness","contrast","saturate","opacity"]);function Mi(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=s.match(pi)||[];if(!i)return e;const r=s.replace(i,"");let n=Ni.has(t)?1:0;return i!==s&&(n*=100),t+"("+n+r+")"}const Oi=/\b([a-z-]*)\(.*?\)/gu,ji={...Di,getAnimatableNone:e=>{const t=e.match(Oi);return t?t.map(Mi).join(" "):e}},Fi={...Bt,color:wi,backgroundColor:wi,outlineColor:wi,fill:wi,stroke:wi,borderColor:wi,borderTopColor:wi,borderRightColor:wi,borderBottomColor:wi,borderLeftColor:wi,filter:ji,WebkitFilter:ji},Ui=e=>Fi[e];function Bi(e,t){let s=Ui(e);return s!==ji&&(s=Di),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const $i=new Set(["auto","none","0"]);const Gi=e=>e===Lt||e===Dt,Vi=(e,t)=>parseFloat(e.split(", ")[t]),Ki=(e,t)=>(s,{transform:i})=>{if("none"===i||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return Vi(r[1],t);{const t=i.match(/^matrix\((.+)\)$/u);return t?Vi(t[1],e):0}},Hi=new Set(["x","y","z"]),qi=yt.filter((e=>!Hi.has(e)));const Wi={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Ki(4,13),y:Ki(5,14)};Wi.translateX=Wi.x,Wi.translateY=Wi.y;const Yi=new Set;let zi=!1,Xi=!1;function Ji(){if(Xi){const e=Array.from(Yi).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),s=new Map;t.forEach((e=>{const t=function(e){const t=[];return qi.forEach((s=>{const i=e.getValue(s);void 0!==i&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))})),t}(e);t.length&&(s.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=s.get(e);t&&t.forEach((([t,s])=>{var i;null===(i=e.getValue(t))||void 0===i||i.set(s)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Xi=!1,zi=!1,Yi.forEach((e=>e.complete())),Yi.clear()}function Qi(){Yi.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Xi=!0)}))}class Zi{constructor(e,t,s,i,r,n=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=r,this.isAsync=n}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Yi.add(this),zi||(zi=!0,Pe.read(Qi),Pe.resolveKeyframes(Ji))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;for(let r=0;r<e.length;r++)if(null===e[r])if(0===r){const r=null==i?void 0:i.get(),n=e[e.length-1];if(void 0!==r)e[0]=r;else if(s&&t){const i=s.readValue(t,n);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=n),i&&void 0===r&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Yi.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Yi.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const er=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),tr=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function sr(e,t,s=1){const[i,r]=function(e){const t=tr.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${null!=s?s:i}`,r]}(e);if(!i)return;const n=window.getComputedStyle(t).getPropertyValue(i);if(n){const e=n.trim();return er(e)?parseFloat(e):e}return St(r)?sr(r,t,s+1):r}const ir=e=>t=>t.test(e),rr=[Lt,Dt,Ct,Pt,Mt,Nt,{test:e=>"auto"===e,parse:e=>e}],nr=e=>rr.find(ir(e));class ar extends Zi{constructor(e,t,s,i,r){super(e,t,s,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),St(s))){const i=sr(s,t.current);void 0!==i&&(e[o]=i),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!Ks.has(s)||2!==e.length)return;const[i,r]=e,n=nr(i),a=nr(r);if(n!==a)if(Gi(n)&&Gi(a))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)("number"==typeof(i=e[r])?0===i:null===i||"none"===i||"0"===i||mi(i))&&s.push(r);var i;s.length&&function(e,t,s){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"==typeof t&&!$i.has(t)&&_i(t).values.length&&(i=e[r]),r++}if(i&&s)for(const n of t)e[n]=Bi(s,i)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Wi[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(s,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(s);r&&r.jump(this.measuredOrigin,!1);const n=i.length-1,a=i[n];i[n]=Wi[s](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((([e,s])=>{t.getValue(e).set(s)})),this.resolveNoneKeyframes()}}const or=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!Di.test(e)&&"0"!==e||e.startsWith("url(")));function lr(e,t,s,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const n=e[e.length-1],a=or(r,t),o=or(n,t);return!(!a||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Es(s))&&i)}const cr=e=>null!==e;function dr(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(cr),n=t&&"loop"!==s&&t%2==1?0:r.length-1;return n&&void 0!==i?i:r[n]}class hr{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:n="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Ws.now(),this.options={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:r,repeatType:n,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Qi(),Ji()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Ws.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:r,delay:n,onComplete:a,onUpdate:o,isGenerator:l}=this.options;if(!l&&!lr(e,s,i,r)){if(!n)return o&&o(dr(e,this.options,t)),a&&a(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}const ur=(e,t,s)=>e+(t-e)*s;function fr(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function mr(e,t){return s=>s>0?t:e}const gr=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},pr=[Ti,Ei,Si];function vr(e){const t=(s=e,pr.find((e=>e.test(s))));var s;if(!Boolean(t))return!1;let i=t.parse(e);return t===Si&&(i=function({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,s/=100;let r=0,n=0,a=0;if(t/=100){const i=s<.5?s*(1+t):s+t-s*t,o=2*s-i;r=fr(o,i,e+1/3),n=fr(o,i,e),a=fr(o,i,e-1/3)}else r=n=a=s;return{red:Math.round(255*r),green:Math.round(255*n),blue:Math.round(255*a),alpha:i}}(i)),i}const yr=(e,t)=>{const s=vr(e),i=vr(t);if(!s||!i)return mr(e,t);const r={...s};return e=>(r.red=gr(s.red,i.red,e),r.green=gr(s.green,i.green,e),r.blue=gr(s.blue,i.blue,e),r.alpha=ur(s.alpha,i.alpha,e),Ei.transform(r))},br=(e,t)=>s=>t(e(s)),xr=(...e)=>e.reduce(br),Er=new Set(["none","hidden"]);function Tr(e,t){return s=>ur(e,t,s)}function Sr(e){return"number"==typeof e?Tr:"string"==typeof e?St(e)?mr:wi.test(e)?yr:Ar:Array.isArray(e)?wr:"object"==typeof e?wi.test(e)?yr:kr:mr}function wr(e,t){const s=[...e],i=s.length,r=e.map(((e,s)=>Sr(e)(e,t[s])));return e=>{for(let t=0;t<i;t++)s[t]=r[t](e);return s}}function kr(e,t){const s={...e,...t},i={};for(const r in s)void 0!==e[r]&&void 0!==t[r]&&(i[r]=Sr(e[r])(e[r],t[r]));return e=>{for(const t in i)s[t]=i[t](e);return s}}const Ar=(e,t)=>{const s=Di.createTransformer(t),i=_i(e),r=_i(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Er.has(e)&&!r.values.length||Er.has(t)&&!i.values.length?function(e,t){return Er.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):xr(wr(function(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let n=0;n<t.values.length;n++){const a=t.types[n],o=e.indexes[a][r[a]],l=null!==(s=e.values[o])&&void 0!==s?s:0;i[n]=l,r[a]++}return i}(i,r),r.values),s):mr(e,t)};function Lr(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return ur(e,t,s);return Sr(e)(e,t)}function Rr(e,t,s){const i=Math.max(t-5,0);return Js(s-e(i),t-i)}const _r=100,Ir=10,Pr=1,Cr=0,Dr=800,Nr=.3,Mr=.3,Or={granular:.01,default:2},jr={granular:.005,default:.5},Fr=.01,Ur=10,Br=.05,$r=1;function Gr({duration:e=Dr,bounce:t=Nr,velocity:s=Cr,mass:i=Pr}){let r,n,a=1-t;a=At(Br,$r,a),e=At(Fr,Ur,Le(e)),a<1?(r=t=>{const i=t*a,r=i*e;return.001-(i-s)/Kr(t,a)*Math.exp(-r)},n=t=>{const i=t*a*e,n=i*s+s,o=Math.pow(a,2)*Math.pow(t,2)*e,l=Math.exp(-i),c=Kr(Math.pow(t,2),a);return(.001-r(t)>0?-1:1)*((n-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,n=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let i=s;for(let r=1;r<Vr;r++)i-=e(i)/t(i);return i}(r,n,5/e);if(e=Ae(e),isNaN(o))return{stiffness:_r,damping:Ir,duration:e};{const t=Math.pow(o,2)*i;return{stiffness:t,damping:2*a*Math.sqrt(i*t),duration:e}}}const Vr=12;function Kr(e,t){return e*Math.sqrt(1-t*t)}const Hr=["duration","bounce"],qr=["stiffness","damping","mass"];function Wr(e,t){return t.some((t=>void 0!==e[t]))}function Yr(e=Mr,t=Nr){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const n=s.keyframes[0],a=s.keyframes[s.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:h,velocity:u,isResolvedFromDuration:f}=function(e){let t={velocity:Cr,stiffness:_r,damping:Ir,mass:Pr,isResolvedFromDuration:!1,...e};if(!Wr(e,qr)&&Wr(e,Hr))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(1.2*s),r=i*i,n=2*At(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Pr,stiffness:r,damping:n}}else{const s=Gr(e);t={...t,...s,mass:Pr},t.isResolvedFromDuration=!0}return t}({...s,velocity:-Le(s.velocity||0)}),m=u||0,g=c/(2*Math.sqrt(l*d)),p=a-n,v=Le(Math.sqrt(l/d)),y=Math.abs(p)<5;let b;if(i||(i=y?Or.granular:Or.default),r||(r=y?jr.granular:jr.default),g<1){const e=Kr(v,g);b=t=>{const s=Math.exp(-g*v*t);return a-s*((m+g*v*p)/e*Math.sin(e*t)+p*Math.cos(e*t))}}else if(1===g)b=e=>a-Math.exp(-v*e)*(p+(m+v*p)*e);else{const e=v*Math.sqrt(g*g-1);b=t=>{const s=Math.exp(-g*v*t),i=Math.min(e*t,300);return a-s*((m+g*v*p)*Math.sinh(i)+e*p*Math.cosh(i))/e}}const x={calculatedDuration:f&&h||null,next:e=>{const t=b(e);if(f)o.done=e>=h;else{let s=0;g<1&&(s=0===e?Ae(m):Rr(b,e,t));const n=Math.abs(s)<=i,l=Math.abs(a-t)<=r;o.done=n&&l}return o.value=o.done?a:t,o},toString:()=>{const e=Math.min(xs(x),bs),t=Ls((t=>x.next(e*t).value),e,30);return e+"ms "+t}};return x}function zr({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:n=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:d}){const h=e[0],u={done:!1,value:h},f=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let m=s*t;const g=h+m,p=void 0===a?g:a(g);p!==g&&(m=p-h);const v=e=>-m*Math.exp(-e/i),y=e=>p+v(e),b=e=>{const t=v(e),s=y(e);u.done=Math.abs(t)<=c,u.value=u.done?p:s};let x,E;const T=e=>{var t;(t=u.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(x=e,E=Yr({keyframes:[u.value,f(u.value)],velocity:Rr(y,e,u.value),damping:r,stiffness:n,restDelta:c,restSpeed:d}))};return T(0),{calculatedDuration:null,next:e=>{let t=!1;return E||void 0!==x||(t=!0,b(e),T(e)),void 0!==x&&e>=x?E.next(e-x):(!t&&b(e),u)}}}const Xr=ri(.42,0,1,1),Jr=ri(0,0,.58,1),Qr=ri(.42,0,.58,1),Zr={linear:Te,easeIn:Xr,easeInOut:Qr,easeOut:Jr,circIn:hi,circInOut:fi,circOut:ui,backIn:li,backInOut:ci,backOut:oi,anticipate:di},en=e=>{if(Ss(e)){Se(4===e.length);const[t,s,i,r]=e;return ri(t,s,i,r)}return"string"==typeof e?Zr[e]:e};function tn(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const n=e.length;if(Se(n===t.length),1===n)return()=>t[0];if(2===n&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[n-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const i=[],r=s||Lr,n=e.length-1;for(let a=0;a<n;a++){let s=r(e[a],e[a+1]);if(t){const e=Array.isArray(t)?t[a]||Te:t;s=xr(e,s)}i.push(s)}return i}(t,i,r),l=o.length,c=s=>{if(a&&s<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(s<e[i+1]);i++);const r=ke(e[i],e[i+1],s);return o[i](r)};return s?t=>c(At(e[0],e[n-1],t)):c}function sn(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=ke(0,t,i);e.push(ur(s,1,r))}}(t,e.length-1),t}function rn({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(en):en(i),n={done:!1,value:t[0]},a=function(e,t){return e.map((e=>e*t))}(s&&s.length===t.length?s:sn(t),e),o=tn(a,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map((()=>c||Qr)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(n.value=o(t),n.done=t>=e,n)}}const nn=e=>{const t=({timestamp:t})=>e(t);return{start:()=>Pe.update(t,!0),stop:()=>Ce(t),now:()=>De.isProcessing?De.timestamp:Ws.now()}},an={decay:zr,inertia:zr,tween:rn,keyframes:rn,spring:Yr},on=e=>e/100;class ln extends hr{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:s,element:i,keyframes:r}=this.options,n=(null==i?void 0:i.KeyframeResolver)||Zi;this.resolver=new n(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:r,velocity:n=0}=this.options,a=Es(t)?t:an[t]||rn;let o,l;a!==rn&&"number"!=typeof e[0]&&(o=xr(on,Lr(e[0],e[1])),e=[0,100]);const c=a({...this.options,keyframes:e});"mirror"===r&&(l=a({...this.options,keyframes:[...e].reverse(),velocity:-n})),null===c.calculatedDuration&&(c.calculatedDuration=xs(c));const{calculatedDuration:d}=c,h=d+i;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:o,calculatedDuration:d,resolvedDuration:h,totalDuration:h*(s+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:n,mapPercentToKeyframes:a,keyframes:o,calculatedDuration:l,totalDuration:c,resolvedDuration:d}=s;if(null===this.startTime)return r.next(0);const{delay:h,repeat:u,repeatType:f,repeatDelay:m,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),v=this.speed>=0?p<0:p>c;this.currentTime=Math.max(p,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let y=this.currentTime,b=r;if(u){const e=Math.min(this.currentTime,c)/d;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===f?(s=1-s,m&&(s-=m/d)):"mirror"===f&&(b=n)),y=At(0,1,s)*d}const x=v?{done:!1,value:o[0]}:b.next(y);a&&(x.value=a(x.value));let{done:E}=x;v||null===l||(E=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const T=null===this.holdTime&&("finished"===this.state||"running"===this.state&&E);return T&&void 0!==i&&(x.value=dr(o,this.options,i)),g&&g(x.value),T&&this.finish(),x}get duration(){const{resolved:e}=this;return e?Le(e.calculatedDuration):0}get time(){return Le(this.currentTime)}set time(e){e=Ae(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Le(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=nn,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!=s?s:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const cn=new Set(["opacity","clipPath","filter","transform"]);function dn(e,t,s,{delay:i=0,duration:r=300,repeat:n=0,repeatType:a="loop",ease:o="easeInOut",times:l}={}){const c={[t]:s};l&&(c.offset=l);const d=Ps(o,r);return Array.isArray(d)&&(c.easing=d),e.animate(c,{delay:i,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:n+1,direction:"reverse"===a?"alternate":"normal"})}const hn=we((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const un={anticipate:di,backInOut:ci,circInOut:fi};class fn extends hr{constructor(e){super(e);const{name:t,motionValue:s,element:i,keyframes:r}=this.options;this.resolver=new ar(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:s=300,times:i,ease:r,type:n,motionValue:a,name:o,startTime:l}=this.options;if(!a.owner||!a.owner.current)return!1;var c;if("string"==typeof r&&As()&&r in un&&(r=un[r]),Es((c=this.options).type)||"spring"===c.type||!Rs(c.ease)){const{onComplete:t,onUpdate:a,motionValue:o,element:l,...c}=this.options,d=function(e,t){const s=new ln({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let n=0;for(;!i.done&&n<2e4;)i=s.sample(n),r.push(i.value),n+=10;return{times:void 0,keyframes:r,duration:n-10,ease:"linear"}}(e,c);1===(e=d.keyframes).length&&(e[1]=e[0]),s=d.duration,i=d.times,r=d.ease,n="keyframes"}const d=dn(a.owner.current,o,e,{...this.options,duration:s,times:i,ease:r});return d.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(Ts(d,this.pendingTimeline),this.pendingTimeline=void 0):d.onfinish=()=>{const{onComplete:s}=this.options;a.set(dr(e,this.options,t)),s&&s(),this.cancel(),this.resolveFinishedPromise()},{animation:d,duration:s,times:i,type:n,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Le(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Le(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.currentTime=Ae(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return Te;const{animation:s}=t;Ts(s,e)}else this.pendingTimeline=e;return Te}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:s,duration:i,type:r,ease:n,times:a}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:o,element:l,...c}=this.options,d=new ln({...c,keyframes:s,duration:i,type:r,ease:n,times:a,isGenerator:!0}),h=Ae(this.time);e.setWithVelocity(d.sample(h-10).value,d.sample(h).value,10)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:s,repeatDelay:i,repeatType:r,damping:n,type:a}=e;if(!(t&&t.owner&&t.owner.current instanceof HTMLElement))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return hn()&&s&&cn.has(s)&&!o&&!l&&!i&&"mirror"!==r&&0!==n&&"inertia"!==a}}const mn={type:"spring",stiffness:500,damping:25,restSpeed:10},gn={type:"keyframes",duration:.8},pn={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vn=(e,{keyframes:t})=>t.length>2?gn:bt.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:mn:pn;const yn=(e,t,s,i={},r,n)=>a=>{const o=ys(i,e)||{},l=o.delay||i.delay||0;let{elapsed:c=0}=i;c-=Ae(l);let d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:n?void 0:r};(function({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:n,repeatType:a,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||(d={...d,...vn(e,d)}),d.duration&&(d.duration=Ae(d.duration)),d.repeatDelay&&(d.repeatDelay=Ae(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let h=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(h=!0)),h&&!n&&void 0!==t.get()){const e=dr(d.keyframes,o);if(void 0!==e)return Pe.update((()=>{d.onUpdate(e),d.onComplete()})),new vs([])}return!n&&fn.supports(d)?new fn(d):new ln(d)};function bn({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,i}function xn(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var n;let{transition:a=e.getDefaultTransition(),transitionEnd:o,...l}=t;i&&(a=i);const c=[],d=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const t=e.getValue(h,null!==(n=e.latestValues[h])&&void 0!==n?n:null),i=l[h];if(void 0===i||d&&bn(d,h))continue;const r={delay:s,...ys(a||{},h)};let o=!1;if(window.MotionHandoffAnimation){const t=si(e);if(t){const e=window.MotionHandoffAnimation(t,h,Pe);null!==e&&(r.startTime=e,o=!0)}}ti(e,h),t.start(yn(h,t,i,e.shouldReduceMotion&&Ks.has(h)?{type:!1}:r,e,o));const u=t.animation;u&&c.push(u)}return o&&Promise.all(c).then((()=>{Pe.update((()=>{o&&function(e,t){const s=ms(e,t);let{transitionEnd:i={},transition:r={},...n}=s||{};n={...n,...i};for(const o in n)ei(e,o,(a=n[o],ft(a)?a[a.length-1]||0:a));var a}(e,o)}))})),c}function En(e,t,s={}){var i;const r=ms(e,t,"exit"===s.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:n=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(n=s.transitionOverride);const a=r?()=>Promise.all(xn(e,r,s)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:r=0,staggerChildren:a,staggerDirection:o}=n;return function(e,t,s=0,i=0,r=1,n){const a=[],o=(e.variantChildren.size-1)*i,l=1===r?(e=0)=>e*i:(e=0)=>o-e*i;return Array.from(e.variantChildren).sort(Tn).forEach(((e,i)=>{e.notify("AnimationStart",t),a.push(En(e,t,{...n,delay:s+l(i)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(a)}(e,t,r+i,a,o,s)}:()=>Promise.resolve(),{when:l}=n;if(l){const[e,t]="beforeChildren"===l?[a,o]:[o,a];return e().then((()=>t()))}return Promise.all([a(),o(s.delay)])}function Tn(e,t){return e.sortNodePosition(t)}const Sn=We.length;function wn(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&wn(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<Sn;s++){const i=We[s],r=e.props[i];(Ke(r)||!1===r)&&(t[i]=r)}return t}const kn=[...qe].reverse(),An=qe.length;function Ln(e){return t=>Promise.all(t.map((({animation:t,options:s})=>function(e,t,s={}){let i;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>En(e,t,s)));i=Promise.all(r)}else if("string"==typeof t)i=En(e,t,s);else{const r="function"==typeof t?ms(e,t,s.custom):t;i=Promise.all(xn(e,r,s))}return i.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,s))))}function Rn(e){let t=Ln(e),s=Pn(),i=!0;const r=t=>(s,i)=>{var r;const n=ms(e,i,"exit"===t?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(n){const{transition:e,transitionEnd:t,...i}=n;s={...s,...i,...t}}return s};function n(n){const{props:a}=e,o=wn(e.parent)||{},l=[],c=new Set;let d={},h=1/0;for(let t=0;t<An;t++){const u=kn[t],f=s[u],m=void 0!==a[u]?a[u]:o[u],g=Ke(m),p=u===n?f.isActive:null;!1===p&&(h=t);let v=m===o[u]&&m!==a[u]&&g;if(v&&i&&e.manuallyAnimateOnMount&&(v=!1),f.protectedKeys={...d},!f.isActive&&null===p||!m&&!f.prevProp||He(m)||"boolean"==typeof m)continue;const y=_n(f.prevProp,m);let b=y||u===n&&f.isActive&&!v&&g||t>h&&g,x=!1;const E=Array.isArray(m)?m:[m];let T=E.reduce(r(u),{});!1===p&&(T={});const{prevResolvedValues:S={}}=f,w={...S,...T},k=t=>{b=!0,c.has(t)&&(x=!0,c.delete(t)),f.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in w){const t=T[e],s=S[e];if(d.hasOwnProperty(e))continue;let i=!1;i=ft(t)&&ft(s)?!fs(t,s):t!==s,i?null!=t?k(e):c.add(e):void 0!==t&&c.has(e)?k(e):f.protectedKeys[e]=!0}f.prevProp=m,f.prevResolvedValues=T,f.isActive&&(d={...d,...T}),i&&e.blockInitialAnimation&&(b=!1);b&&(!(v&&y)||x)&&l.push(...E.map((e=>({animation:e,options:{type:u}}))))}if(c.size){const t={};c.forEach((s=>{const i=e.getBaseTarget(s),r=e.getValue(s);r&&(r.liveStyle=!0),t[s]=null!=i?i:null})),l.push({animation:t})}let u=Boolean(l.length);return!i||!1!==a.initial&&a.initial!==a.animate||e.manuallyAnimateOnMount||(u=!1),i=!1,u?t(l):Promise.resolve()}return{animateChanges:n,setActive:function(t,i){var r;if(s[t].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach((e=>{var s;return null===(s=e.animationState)||void 0===s?void 0:s.setActive(t,i)})),s[t].isActive=i;const a=n(t);for(const e in s)s[e].protectedKeys={};return a},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=Pn(),i=!0}}}function _n(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!fs(t,e)}function In(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Pn(){return{animate:In(!0),whileInView:In(),whileHover:In(),whileTap:In(),whileDrag:In(),whileFocus:In(),exit:In()}}class Cn{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Dn=0;const Nn={animation:{Feature:class extends Cn{constructor(e){super(e),e.animationState||(e.animationState=Rn(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();He(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Cn{constructor(){super(...arguments),this.id=Dn++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}};function Mn(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function On(e){return{point:{x:e.pageX,y:e.pageY}}}function jn(e,t,s,i){return Mn(e,t,(e=>t=>js(t)&&e(t,On(t)))(s),i)}const Fn=(e,t)=>Math.abs(e-t);class Un{constructor(e,t,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Gn(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=Fn(e.x,t.x),i=Fn(e.y,t.y);return Math.sqrt(s**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!s)return;const{point:i}=e,{timestamp:r}=De;this.history.push({...i,timestamp:r});const{onStart:n,onMove:a}=this.handlers;t||(n&&n(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Bn(t,this.transformPagePoint),Pe.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const n=Gn("pointercancel"===e.type?this.lastMoveEventInfo:Bn(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,n),i&&i(e,n)},!js(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=i||window;const n=Bn(On(e),this.transformPagePoint),{point:a}=n,{timestamp:o}=De;this.history=[{...a,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,Gn(n,this.history)),this.removeListeners=xr(jn(this.contextWindow,"pointermove",this.handlePointerMove),jn(this.contextWindow,"pointerup",this.handlePointerUp),jn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ce(this.updatePoint)}}function Bn(e,t){return t?{point:t(e.point)}:e}function $n(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Gn({point:e},t){return{point:e,delta:$n(e,Kn(t)),offset:$n(e,Vn(t)),velocity:Hn(t,.1)}}function Vn(e){return e[0]}function Kn(e){return e[e.length-1]}function Hn(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=Kn(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>Ae(t)));)s--;if(!i)return{x:0,y:0};const n=Le(r.timestamp-i.timestamp);if(0===n)return{x:0,y:0};const a={x:(r.x-i.x)/n,y:(r.y-i.y)/n};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function qn(e){return e.max-e.min}function Wn(e,t,s,i=.5){e.origin=i,e.originPoint=ur(t.min,t.max,e.origin),e.scale=qn(s)/qn(t),e.translate=ur(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Yn(e,t,s,i){Wn(e.x,t.x,s.x,i?i.originX:void 0),Wn(e.y,t.y,s.y,i?i.originY:void 0)}function zn(e,t,s){e.min=s.min+t.min,e.max=e.min+qn(t)}function Xn(e,t,s){e.min=t.min-s.min,e.max=e.min+qn(t)}function Jn(e,t,s){Xn(e.x,t.x,s.x),Xn(e.y,t.y,s.y)}function Qn(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function Zn(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}const ea=.35;function ta(e,t,s){return{min:sa(e,t),max:sa(e,s)}}function sa(e,t){return"number"==typeof e?e:e[t]||0}const ia=()=>({x:{min:0,max:0},y:{min:0,max:0}});function ra(e){return[e("x"),e("y")]}function na({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function aa(e){return void 0===e||1===e}function oa({scale:e,scaleX:t,scaleY:s}){return!aa(e)||!aa(t)||!aa(s)}function la(e){return oa(e)||ca(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function ca(e){return da(e.x)||da(e.y)}function da(e){return e&&"0%"!==e}function ha(e,t,s){return s+t*(e-s)}function ua(e,t,s,i,r){return void 0!==r&&(e=ha(e,r,i)),ha(e,s,i)+t}function fa(e,t=0,s=1,i,r){e.min=ua(e.min,t,s,i,r),e.max=ua(e.max,t,s,i,r)}function ma(e,{x:t,y:s}){fa(e.x,t.translate,t.scale,t.originPoint),fa(e.y,s.translate,s.scale,s.originPoint)}const ga=.999999999999,pa=1.0000000000001;function va(e,t){e.min=e.min+t,e.max=e.max+t}function ya(e,t,s,i,r=.5){fa(e,t,s,ur(e.min,e.max,r),i)}function ba(e,t){ya(e.x,t.x,t.scaleX,t.scale,t.originX),ya(e.y,t.y,t.scaleY,t.scale,t.originY)}function xa(e,t){return na(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const Ea=({current:e})=>e?e.ownerDocument.defaultView:null,Ta=new WeakMap;class Sa{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Un(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(On(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:i,onDragStart:r}=this.getProps();if(s&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(n=s)||"y"===n?Cs[n]?null:(Cs[n]=!0,()=>{Cs[n]=!1}):Cs.x||Cs.y?null:(Cs.x=Cs.y=!0,()=>{Cs.x=Cs.y=!1}),!this.openDragLock))return;var n;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ra((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Ct.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const i=s.layout.layoutBox[e];if(i){t=qn(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Pe.postRender((()=>r(e,t))),ti(this.visualElement,"transform");const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:s,dragDirectionLock:i,onDirectionLock:r,onDrag:n}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:a}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(a),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,a),this.updateAxis("y",t.point,a),this.visualElement.render(),n&&n(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>ra((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:Ea(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Pe.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!wa(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let n=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(n=function(e,{min:t,max:s},i){return void 0!==t&&e<t?e=i?ur(t,e,i.min):Math.max(e,t):void 0!==s&&e>s&&(e=i?ur(s,e,i.max):Math.min(e,s)),e}(n,this.constraints[e],this.elastic[e])),r.set(n)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&Ze(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,{top:t,left:s,bottom:i,right:r}){return{x:Qn(e.x,s,r),y:Qn(e.y,t,i)}}(i.layoutBox,t),this.elastic=function(e=ea){return!1===e?e=0:!0===e&&(e=ea),{x:ta(e,"left","right"),y:ta(e,"top","bottom")}}(s),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&ra((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(i.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Ze(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,s){const i=xa(e,s),{scroll:r}=t;return r&&(va(i.x,r.offset.x),va(i.y,r.offset.y)),i}(s,i.root,this.visualElement.getTransformPagePoint());let n=function(e,t){return{x:Zn(e.x,t.x),y:Zn(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(n));this.hasMutatedConstraints=!!e,e&&(n=na(e))}return n}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:r,dragSnapToOrigin:n,onDragTransitionEnd:a}=this.getProps(),o=this.constraints||{},l=ra((a=>{if(!wa(a,t,this.currentDirection))return;let l=o&&o[a]||{};n&&(l={min:0,max:0});const c=i?200:1e6,d=i?40:1e7,h={type:"inertia",velocity:s?e[a]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(a,h)}));return Promise.all(l).then(a)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return ti(this.visualElement,e),s.start(yn(e,s,0,t,this.visualElement,!1))}stopAnimation(){ra((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){ra((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){ra((t=>{const{drag:s}=this.getProps();if(!wa(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:s,max:n}=i.layout.layoutBox[t];r.set(e[t]-ur(s,n,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Ze(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};ra((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();i[e]=function(e,t){let s=.5;const i=qn(e),r=qn(t);return r>i?s=ke(t.min,t.max-i,e.min):i>r&&(s=ke(e.min,e.max-r,t.min)),At(0,1,s)}({min:s,max:s},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),ra((t=>{if(!wa(t,e,null))return;const s=this.getAxisMotionValue(t),{min:r,max:n}=this.constraints[t];s.set(ur(r,n,i[t]))}))}addListeners(){if(!this.visualElement.current)return;Ta.set(this.visualElement,this);const e=jn(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();Ze(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Pe.read(t);const r=Mn(window,"resize",(()=>this.scalePositionWithinConstraints())),n=s.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(ra((t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),i(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:n=ea,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:r,dragElastic:n,dragMomentum:a}}}function wa(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const ka=e=>(t,s)=>{e&&Pe.postRender((()=>e(t,s)))};const Aa={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function La(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ra={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Dt.test(e))return e;e=parseFloat(e)}return`${La(e,t.target.x)}% ${La(e,t.target.y)}%`}},_a={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=Di.parse(e);if(r.length>5)return i;const n=Di.createTransformer(e),a="number"!=typeof r[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;r[0+a]/=o,r[1+a]/=l;const c=ur(o,l,.5);return"number"==typeof r[2+a]&&(r[2+a]/=c),"number"==typeof r[3+a]&&(r[3+a]/=c),n(r)}};class Ia extends z.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:r}=e;var n;n=Ca,Object.assign(es,n),r&&(t.group&&t.group.add(r),s&&s.register&&i&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),Aa.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:r}=this.props,n=s.projection;return n?(n.isPresent=r,i||e.layoutDependency!==t||void 0===t?n.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?n.promote():n.relegate()||Pe.postRender((()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),it.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Pa(t){const[s,i]=pe(),r=z.useContext(le);return e.jsx(Ia,{...t,layoutGroup:r,switchLayoutGroup:z.useContext(rt),isPresent:s,safeToRemove:i})}const Ca={borderRadius:{...Ra,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ra,borderTopRightRadius:Ra,borderBottomLeftRadius:Ra,borderBottomRightRadius:Ra,boxShadow:_a};const Da=(e,t)=>e.depth-t.depth;class Na{constructor(){this.children=[],this.isDirty=!1}add(e){Ys(this.children,e),this.isDirty=!0}remove(e){zs(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Da),this.isDirty=!1,this.children.forEach(e)}}const Ma=["TopLeft","TopRight","BottomLeft","BottomRight"],Oa=Ma.length,ja=e=>"string"==typeof e?parseFloat(e):e,Fa=e=>"number"==typeof e||Dt.test(e);function Ua(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Ba=Ga(0,.5,ui),$a=Ga(.5,.95,Te);function Ga(e,t,s){return i=>i<e?0:i>t?1:s(ke(e,t,i))}function Va(e,t){e.min=t.min,e.max=t.max}function Ka(e,t){Va(e.x,t.x),Va(e.y,t.y)}function Ha(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function qa(e,t,s,i,r){return e=ha(e-=t,1/s,i),void 0!==r&&(e=ha(e,1/r,i)),e}function Wa(e,t,[s,i,r],n,a){!function(e,t=0,s=1,i=.5,r,n=e,a=e){Ct.test(t)&&(t=parseFloat(t),t=ur(a.min,a.max,t/100)-a.min);if("number"!=typeof t)return;let o=ur(n.min,n.max,i);e===n&&(o-=t),e.min=qa(e.min,t,s,o,r),e.max=qa(e.max,t,s,o,r)}(e,t[s],t[i],t[r],t.scale,n,a)}const Ya=["x","scaleX","originX"],za=["y","scaleY","originY"];function Xa(e,t,s,i){Wa(e.x,t,Ya,s?s.x:void 0,i?i.x:void 0),Wa(e.y,t,za,s?s.y:void 0,i?i.y:void 0)}function Ja(e){return 0===e.translate&&1===e.scale}function Qa(e){return Ja(e.x)&&Ja(e.y)}function Za(e,t){return e.min===t.min&&e.max===t.max}function eo(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function to(e,t){return eo(e.x,t.x)&&eo(e.y,t.y)}function so(e){return qn(e.x)/qn(e.y)}function io(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class ro{constructor(){this.members=[]}add(e){Ys(this.members,e),e.scheduleRender()}remove(e){if(zs(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let s;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&s.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const no={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ao="undefined"!=typeof window&&void 0!==window.MotionDebug,oo=["","X","Y","Z"],lo={visibility:"hidden"};let co=0;function ho(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function uo(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=si(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Pe,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&uo(i)}function fo({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},s=(null==t?void 0:t())){this.id=co++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ao&&(no.totalNodes=no.resolvedTargetDeltas=no.recalculatedProjection=0),this.nodes.forEach(po),this.nodes.forEach(So),this.nodes.forEach(wo),this.nodes.forEach(vo),ao&&window.MotionDebug.record(no)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Na)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Xs),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,s=this.root.hasTreeAnimated){if(this.instance)return;var i;this.isSVG=(i=t)instanceof SVGElement&&"svg"!==i.tagName,this.instance=t;const{layoutId:r,layout:n,visualElement:a}=this.options;if(a&&!a.current&&a.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),s&&(n||r)&&(this.isLayoutDirty=!0),e){let s;const i=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Ws.now(),i=({timestamp:r})=>{const n=r-s;n>=t&&(Ce(i),e(n-t))};return Pe.read(i,!0),()=>Ce(i)}(i,250),Aa.hasAnimatedSinceResize&&(Aa.hasAnimatedSinceResize=!1,this.nodes.forEach(To))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||n)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:s,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||a.getDefaultTransition()||Io,{onLayoutAnimationStart:n,onLayoutAnimationComplete:o}=a.getProps(),l=!this.targetLayout||!to(this.targetLayout,i)||s,c=!t&&s;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,c);const t={...ys(r,"layout"),onPlay:n,onComplete:o};(a.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||To(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ce(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ko),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&uo(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(bo);this.isUpdating||this.nodes.forEach(xo),this.isUpdating=!1,this.nodes.forEach(Eo),this.nodes.forEach(mo),this.nodes.forEach(go),this.clearAllSnapshots();const e=Ws.now();De.delta=At(0,1e3/60,e-De.timestamp),De.timestamp=e,De.isProcessing=!0,Ne.update.process(De),Ne.preRender.process(De),Ne.render.process(De),De.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,it.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(yo),this.sharedNodes.forEach(Ao)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Pe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Pe.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Qa(this.projectionDelta),s=this.getTransformTemplate(),i=s?s(this.latestValues,""):void 0,n=i!==this.prevTransformTemplateValue;e&&(t||la(this.latestValues)||n)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var i;return e&&(s=this.removeTransform(s)),Do((i=s).x),Do(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const s=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(Mo))){const{scroll:e}=this.root;e&&(va(s.x,e.offset.x),va(s.y,e.offset.y))}return s}removeElementScroll(e){var t;const s={x:{min:0,max:0},y:{min:0,max:0}};if(Ka(s,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return s;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:n}=t;t!==this.root&&r&&n.layoutScroll&&(r.wasRoot&&Ka(s,e),va(s.x,r.offset.x),va(s.y,r.offset.y))}return s}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};Ka(s,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&ba(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),la(e.latestValues)&&ba(s,e.latestValues)}return la(this.latestValues)&&ba(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Ka(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!la(e.latestValues))continue;oa(e.latestValues)&&e.updateSnapshot();const i={x:{min:0,max:0},y:{min:0,max:0}};Ka(i,e.measurePageBox()),Xa(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return la(this.latestValues)&&Xa(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==De.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==s;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:n}=this.options;if(this.layout&&(r||n)){if(this.resolvedRelativeTargetAt=De.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Jn(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Ka(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var a,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),a=this.target,o=this.relativeTarget,l=this.relativeParent.target,zn(a.x,o.x,l.x),zn(a.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Ka(this.target,this.layout.layoutBox),ma(this.target,this.targetDelta)):Ka(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Jn(this.relativeTargetOrigin,this.target,e.target),Ka(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ao&&no.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!oa(this.parent.latestValues)&&!ca(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),s=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===De.timestamp&&(i=!1),i)return;const{layout:r,layoutId:n}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!n)return;Ka(this.layoutCorrected,this.layout.layoutBox);const a=this.treeScale.x,o=this.treeScale.y;!function(e,t,s,i=!1){const r=s.length;if(!r)return;let n,a;t.x=t.y=1;for(let o=0;o<r;o++){n=s[o],a=n.projectionDelta;const{visualElement:r}=n.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&n.options.layoutScroll&&n.scroll&&n!==n.root&&ba(e,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,ma(e,a)),i&&la(n.latestValues)&&ba(e,n.latestValues))}t.x<pa&&t.x>ga&&(t.x=1),t.y<pa&&t.y>ga&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,s),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(Ha(this.prevProjectionDelta.x,this.projectionDelta.x),Ha(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Yn(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===a&&this.treeScale.y===o&&io(this.projectionDelta.x,this.prevProjectionDelta.x)&&io(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),ao&&no.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,i=s?s.latestValues:{},r={...this.latestValues},n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const a={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(_o));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var l,u,f,m,g,p;Lo(n.x,e.x,s),Lo(n.y,e.y,s),this.setTargetDelta(n),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Jn(a,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,m=this.relativeTargetOrigin,g=a,p=s,Ro(f.x,m.x,g.x,p),Ro(f.y,m.y,g.y,p),h&&(l=this.relativeTarget,u=h,Za(l.x,u.x)&&Za(l.y,u.y))&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Ka(h,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,s,i,r,n){r?(e.opacity=ur(0,void 0!==s.opacity?s.opacity:1,Ba(i)),e.opacityExit=ur(void 0!==t.opacity?t.opacity:1,0,$a(i))):n&&(e.opacity=ur(void 0!==t.opacity?t.opacity:1,void 0!==s.opacity?s.opacity:1,i));for(let a=0;a<Oa;a++){const r=`border${Ma[a]}Radius`;let n=Ua(t,r),o=Ua(s,r);void 0===n&&void 0===o||(n||(n=0),o||(o=0),0===n||0===o||Fa(n)===Fa(o)?(e[r]=Math.max(ur(ja(n),ja(o),i),0),(Ct.test(o)||Ct.test(n))&&(e[r]+="%")):e[r]=o)}(t.rotate||s.rotate)&&(e.rotate=ur(t.rotate||0,s.rotate||0,i))}(r,i,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ce(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Pe.update((()=>{Aa.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,s){const i=mt(e)?e:Zs(e);return i.start(yn("",i,t,s)),i.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:i,latestValues:r}=e;if(t&&s&&i){if(this!==e&&this.layout&&i&&No(this.options.animationType,this.layout.layoutBox,i.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=qn(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const i=qn(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+i}Ka(t,s),ba(t,r),Yn(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new ro);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const i=this.getStack();i&&i.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const i={};s.z&&ho("z",e,i,this.animationValues);for(let r=0;r<oo.length;r++)ho(`rotate${oo[r]}`,e,i,this.animationValues),ho(`skew${oo[r]}`,e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}getProjectionStyles(e){var t,s;if(!this.instance||this.isSVG)return;if(!this.isVisible)return lo;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=gt(null==e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const n=this.getLead();if(!this.projectionDelta||!this.layout||!n.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=gt(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!la(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const a=n.animationValues||n.latestValues;this.applyTransformsToTarget(),i.transform=function(e,t,s){let i="";const r=e.x.translate/t.x,n=e.y.translate/t.y,a=(null==s?void 0:s.z)||0;if((r||n||a)&&(i=`translate3d(${r}px, ${n}px, ${a}px) `),1===t.x&&1===t.y||(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:n,skewX:a,skewY:o}=s;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),n&&(i+=`rotateY(${n}deg) `),a&&(i+=`skewX(${a}deg) `),o&&(i+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(i+=`scale(${o}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,a),r&&(i.transform=r(a,i.transform));const{x:o,y:l}=this.projectionDelta;i.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,n.animationValues?i.opacity=n===this?null!==(s=null!==(t=a.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==s?s:1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:i.opacity=n===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const c in es){if(void 0===a[c])continue;const{correct:e,applyTo:t}=es[c],s="none"===i.transform?a[c]:e(a[c],n);if(t){const e=t.length;for(let r=0;r<e;r++)i[t[r]]=s}else i[c]=s}return this.options.layoutId&&(i.pointerEvents=n===this?gt(null==e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(bo),this.root.sharedNodes.clear()}}}function mo(e){e.updateLayout()}function go(e){var t;const s=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,n=s.source!==e.layout.source;"size"===r?ra((e=>{const i=n?s.measuredBox[e]:s.layoutBox[e],r=qn(i);i.min=t[e].min,i.max=i.min+r})):No(r,s.layoutBox,t)&&ra((i=>{const r=n?s.measuredBox[i]:s.layoutBox[i],a=qn(t[i]);r.max=r.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+a)}));const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Yn(a,t,s.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};n?Yn(o,e.applyTransform(i,!0),s.measuredBox):Yn(o,t,s.layoutBox);const l=!Qa(a);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:n}=i;if(r&&n){const a={x:{min:0,max:0},y:{min:0,max:0}};Jn(a,s.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Jn(o,t,n.layoutBox),to(a,o)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=a,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:s,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function po(e){ao&&no.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function vo(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function yo(e){e.clearSnapshot()}function bo(e){e.clearMeasurements()}function xo(e){e.isLayoutDirty=!1}function Eo(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function To(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function So(e){e.resolveTargetDelta()}function wo(e){e.calcProjection()}function ko(e){e.resetSkewAndRotation()}function Ao(e){e.removeLeadSnapshot()}function Lo(e,t,s){e.translate=ur(t.translate,0,s),e.scale=ur(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function Ro(e,t,s,i){e.min=ur(t.min,s.min,i),e.max=ur(t.max,s.max,i)}function _o(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Io={duration:.45,ease:[.4,0,.1,1]},Po=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Co=Po("applewebkit/")&&!Po("chrome/")?Math.round:Te;function Do(e){e.min=Co(e.min),e.max=Co(e.max)}function No(e,t,s){return"position"===e||"preserve-aspect"===e&&(i=so(t),r=so(s),n=.2,!(Math.abs(i-r)<=n));var i,r,n}function Mo(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const Oo=fo({attachResizeListener:(e,t)=>Mn(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),jo={current:void 0},Fo=fo({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!jo.current){const e=new Oo({});e.mount(window),e.setOptions({layoutScroll:!0}),jo.current=e}return jo.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Uo={pan:{Feature:class extends Cn{constructor(){super(...arguments),this.removePointerDownListener=Te}onPointerDown(e){this.session=new Un(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ea(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:ka(e),onStart:ka(t),onMove:s,onEnd:(e,t)=>{delete this.session,i&&Pe.postRender((()=>i(e,t)))}}}mount(){this.removePointerDownListener=jn(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Cn{constructor(e){super(e),this.removeGroupControls=Te,this.removeListeners=Te,this.controls=new Sa(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Te}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Fo,MeasureLayout:Pa}};function Bo(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===s);const r=i["onHover"+s];r&&Pe.postRender((()=>r(t,On(t))))}function $o(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===s);const r=i["onTap"+("End"===s?"":s)];r&&Pe.postRender((()=>r(t,On(t))))}const Go=new WeakMap,Vo=new WeakMap,Ko=e=>{const t=Go.get(e.target);t&&t(e)},Ho=e=>{e.forEach(Ko)};function qo(e,t,s){const i=function({root:e,...t}){const s=e||document;Vo.has(s)||Vo.set(s,{});const i=Vo.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Ho,{root:e,...t})),i[r]}(t);return Go.set(e,s),i.observe(e),()=>{Go.delete(e),i.unobserve(e)}}const Wo={some:0,all:1};const Yo={inView:{Feature:class extends Cn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:r}=e,n={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof i?i:Wo[i]};return qo(this.node.current,n,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:i}=this.node.getProps(),n=t?s:i;n&&n(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Cn{mount(){const{current:e}=this.node;e&&(this.unmount=Vs(e,(e=>($o(this.node,e,"Start"),(e,{success:t})=>$o(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Cn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xr(Mn(this.node.current,"focus",(()=>this.onFocus())),Mn(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends Cn{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[i,r,n]=Ns(e,s),a=Ms((e=>{const{target:s}=e,i=t(e);if("function"!=typeof i||!s)return;const n=Ms((e=>{i(e),s.removeEventListener("pointerleave",n)}));s.addEventListener("pointerleave",n,r)}));return i.forEach((e=>{e.addEventListener("pointerenter",a,r)})),n}(e,(e=>(Bo(this.node,e,"Start"),e=>Bo(this.node,e,"End")))))}unmount(){}}}},zo={layout:{ProjectionNode:Fo,MeasureLayout:Pa}},Xo={current:null},Jo={current:!1};const Qo=[...rr,wi,Di],Zo=new WeakMap;const el=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class tl{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:r,visualState:n},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Zi,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Ws.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Pe.render(this.render,!1,!0))};const{latestValues:o,renderState:l,onUpdate:c}=n;this.onUpdate=c,this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=Ye(t),this.isVariantNode=ze(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const u in h){const e=h[u];void 0!==o[u]&&mt(e)&&e.set(o[u],!1)}}mount(e){this.current=e,Zo.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Jo.current||function(){if(Jo.current=!0,be)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Xo.current=e.matches;e.addListener(t),t()}else Xo.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Xo.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Zo.delete(this.current),this.projection&&this.projection.unmount(),Ce(this.notifyUpdate),Ce(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=bt.has(e),i=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Pe.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{i(),r(),n&&n(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in je){const t=je[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<el.length;s++){const t=el[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,s){for(const i in t){const r=t[i],n=s[i];if(mt(r))e.addValue(i,r);else if(mt(n))e.addValue(i,Zs(r,{owner:e}));else if(n!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,Zs(void 0!==t?t:r,{owner:e}))}}for(const i in s)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=Zs(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let i=void 0===this.latestValues[e]&&this.current?null!==(s=this.getBaseTargetFromProps(this.props,e))&&void 0!==s?s:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=i&&("string"==typeof i&&(er(i)||mi(i))?i=parseFloat(i):(r=i,!Qo.find(ir(r))&&Di.test(t)&&(i=Bi(e,t))),this.setBaseTarget(e,mt(i)?i.get():i)),mt(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:s}=this.props;let i;if("string"==typeof s||"object"==typeof s){const r=ut(this.props,s,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);r&&(i=r[e])}if(s&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||mt(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new Xs),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class sl extends tl{constructor(){super(...arguments),this.KeyframeResolver=ar}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;mt(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}class il extends sl{constructor(){super(...arguments),this.type="html",this.renderInstance=Jt}readValueFromInstance(e,t){if(bt.has(t)){const e=Ui(t);return e&&e.default||0}{const i=(s=e,window.getComputedStyle(s)),r=(Et(t)?i.getPropertyValue(t):i[t])||0;return"string"==typeof r?r.trim():r}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return xa(e,t)}build(e,t,s){Vt(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return ss(e,t,s)}}class rl extends sl{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ia}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(bt.has(t)){const e=Ui(t);return e&&e.default||0}return t=Qt.has(t)?t:tt(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return is(e,t,s)}build(e,t,s){Wt(e,t,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,s,i){Zt(e,t,0,i)}mount(e){this.isSVGTag=Xt(e.tagName),super.mount(e)}}const nl=Ge(us({...Nn,...Yo,...Uo,...zo},((e,t)=>dt(e)?new rl(t):new il(t,{allowProjection:e!==z.Fragment}))));function al(e){var t,s,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=al(e[t]))&&(i&&(i+=" "),i+=s)}else for(s in e)e[s]&&(i&&(i+=" "),i+=s);return i}function ol(){for(var e,t,s=0,i="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=al(e))&&(i&&(i+=" "),i+=t);return i}const ll=e=>{const t=ul(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),cl(s,t)||hl(e)},getConflictingClassGroupIds:(e,t)=>{const r=s[e]||[];return t&&i[e]?[...r,...i[e]]:r}}},cl=(e,t)=>{if(0===e.length)return t.classGroupId;const s=e[0],i=t.nextPart.get(s),r=i?cl(e.slice(1),i):void 0;if(r)return r;if(0===t.validators.length)return;const n=e.join("-");return t.validators.find((({validator:e})=>e(n)))?.classGroupId},dl=/^\[(.+)\]$/,hl=e=>{if(dl.test(e)){const t=dl.exec(e)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},ul=e=>{const{theme:t,prefix:s}=e,i={nextPart:new Map,validators:[]};return pl(Object.entries(e.classGroups),s).forEach((([e,s])=>{fl(s,i,e,t)})),i},fl=(e,t,s,i)=>{e.forEach((e=>{if("string"!=typeof e){if("function"==typeof e)return gl(e)?void fl(e(i),t,s,i):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach((([e,r])=>{fl(r,ml(t,e),s,i)}))}else{(""===e?t:ml(t,e)).classGroupId=s}}))},ml=(e,t)=>{let s=e;return t.split("-").forEach((e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)})),s},gl=e=>e.isThemeGetter,pl=(e,t)=>t?e.map((([e,s])=>[e,s.map((e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,s])=>[t+e,s]))):e))])):e,vl=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,i=new Map;const r=(r,n)=>{s.set(r,n),t++,t>e&&(t=0,i=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=i.get(e))?(r(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):r(e,t)}}},yl=e=>{const{separator:t,experimentalParseClassName:s}=e,i=1===t.length,r=t[0],n=t.length,a=e=>{const s=[];let a,o=0,l=0;for(let h=0;h<e.length;h++){let c=e[h];if(0===o){if(c===r&&(i||e.slice(h,h+n)===t)){s.push(e.slice(l,h)),l=h+n;continue}if("/"===c){a=h;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:a&&a>l?a-l:void 0}};return s?e=>s({className:e,parseClassName:a}):a},bl=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach((e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)})),t.push(...s.sort()),t},xl=/\s+/;function El(){let e,t,s=0,i="";for(;s<arguments.length;)(e=arguments[s++])&&(t=Tl(e))&&(i&&(i+=" "),i+=t);return i}const Tl=e=>{if("string"==typeof e)return e;let t,s="";for(let i=0;i<e.length;i++)e[i]&&(t=Tl(e[i]))&&(s&&(s+=" "),s+=t);return s};function Sl(e,...t){let s,i,r,n=function(o){const l=t.reduce(((e,t)=>t(e)),e());return s=(e=>({cache:vl(e.cacheSize),parseClassName:yl(e),...ll(e)}))(l),i=s.cache.get,r=s.cache.set,n=a,a(o)};function a(e){const t=i(e);if(t)return t;const n=((e,t)=>{const{parseClassName:s,getClassGroupId:i,getConflictingClassGroupIds:r}=t,n=[],a=e.trim().split(xl);let o="";for(let l=a.length-1;l>=0;l-=1){const e=a[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:h}=s(e);let u=Boolean(h),f=i(u?d.substring(0,h):d);if(!f){if(!u){o=e+(o.length>0?" "+o:o);continue}if(f=i(d),!f){o=e+(o.length>0?" "+o:o);continue}u=!1}const m=bl(t).join(":"),g=c?m+"!":m,p=g+f;if(n.includes(p))continue;n.push(p);const v=r(f,u);for(let s=0;s<v.length;++s){const e=v[s];n.push(g+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return r(e,n),n}return function(){return n(El.apply(null,arguments))}}const wl=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},kl=/^\[(?:([a-z-]+):)?(.+)\]$/i,Al=/^\d+\/\d+$/,Ll=new Set(["px","full","screen"]),Rl=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_l=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Il=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Pl=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Cl=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Dl=e=>Ml(e)||Ll.has(e)||Al.test(e),Nl=e=>Yl(e,"length",zl),Ml=e=>Boolean(e)&&!Number.isNaN(Number(e)),Ol=e=>Yl(e,"number",Ml),jl=e=>Boolean(e)&&Number.isInteger(Number(e)),Fl=e=>e.endsWith("%")&&Ml(e.slice(0,-1)),Ul=e=>kl.test(e),Bl=e=>Rl.test(e),$l=new Set(["length","size","percentage"]),Gl=e=>Yl(e,$l,Xl),Vl=e=>Yl(e,"position",Xl),Kl=new Set(["image","url"]),Hl=e=>Yl(e,Kl,Ql),ql=e=>Yl(e,"",Jl),Wl=()=>!0,Yl=(e,t,s)=>{const i=kl.exec(e);return!!i&&(i[1]?"string"==typeof t?i[1]===t:t.has(i[1]):s(i[2]))},zl=e=>_l.test(e)&&!Il.test(e),Xl=()=>!1,Jl=e=>Pl.test(e),Ql=e=>Cl.test(e),Zl=()=>{const e=wl("colors"),t=wl("spacing"),s=wl("blur"),i=wl("brightness"),r=wl("borderColor"),n=wl("borderRadius"),a=wl("borderSpacing"),o=wl("borderWidth"),l=wl("contrast"),c=wl("grayscale"),d=wl("hueRotate"),h=wl("invert"),u=wl("gap"),f=wl("gradientColorStops"),m=wl("gradientColorStopPositions"),g=wl("inset"),p=wl("margin"),v=wl("opacity"),y=wl("padding"),b=wl("saturate"),x=wl("scale"),E=wl("sepia"),T=wl("skew"),S=wl("space"),w=wl("translate"),k=()=>["auto",Ul,t],A=()=>[Ul,t],L=()=>["",Dl,Nl],R=()=>["auto",Ml,Ul],_=()=>["","0",Ul],I=()=>[Ml,Ul];return{cacheSize:500,separator:":",theme:{colors:[Wl],spacing:[Dl,Nl],blur:["none","",Bl,Ul],brightness:I(),borderColor:[e],borderRadius:["none","","full",Bl,Ul],borderSpacing:A(),borderWidth:L(),contrast:I(),grayscale:_(),hueRotate:I(),invert:_(),gap:A(),gradientColorStops:[e],gradientColorStopPositions:[Fl,Nl],inset:k(),margin:k(),opacity:I(),padding:A(),saturate:I(),scale:I(),sepia:_(),skew:I(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",Ul]}],container:["container"],columns:[{columns:[Bl]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ul]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",jl,Ul]}],basis:[{basis:k()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ul]}],grow:[{grow:_()}],shrink:[{shrink:_()}],order:[{order:["first","last","none",jl,Ul]}],"grid-cols":[{"grid-cols":[Wl]}],"col-start-end":[{col:["auto",{span:["full",jl,Ul]},Ul]}],"col-start":[{"col-start":R()}],"col-end":[{"col-end":R()}],"grid-rows":[{"grid-rows":[Wl]}],"row-start-end":[{row:["auto",{span:[jl,Ul]},Ul]}],"row-start":[{"row-start":R()}],"row-end":[{"row-end":R()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ul]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ul]}],gap:[{gap:[u]}],"gap-x":[{"gap-x":[u]}],"gap-y":[{"gap-y":[u]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[p]}],mx:[{mx:[p]}],my:[{my:[p]}],ms:[{ms:[p]}],me:[{me:[p]}],mt:[{mt:[p]}],mr:[{mr:[p]}],mb:[{mb:[p]}],ml:[{ml:[p]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ul,t]}],"min-w":[{"min-w":[Ul,t,"min","max","fit"]}],"max-w":[{"max-w":[Ul,t,"none","full","min","max","fit","prose",{screen:[Bl]},Bl]}],h:[{h:[Ul,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ul,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ul,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ul,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Bl,Nl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ol]}],"font-family":[{font:[Wl]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ul]}],"line-clamp":[{"line-clamp":["none",Ml,Ol]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Dl,Ul]}],"list-image":[{"list-image":["none",Ul]}],"list-style-type":[{list:["none","disc","decimal",Ul]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Dl,Nl]}],"underline-offset":[{"underline-offset":["auto",Dl,Ul]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ul]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ul]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Vl]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Gl]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Hl]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[Dl,Ul]}],"outline-w":[{outline:[Dl,Nl]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[Dl,Nl]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Bl,ql]}],"shadow-color":[{shadow:[Wl]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[i]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Bl,Ul]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[b]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ul]}],duration:[{duration:I()}],ease:[{ease:["linear","in","out","in-out",Ul]}],delay:[{delay:I()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ul]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[x]}],"scale-x":[{"scale-x":[x]}],"scale-y":[{"scale-y":[x]}],rotate:[{rotate:[jl,Ul]}],"translate-x":[{"translate-x":[w]}],"translate-y":[{"translate-y":[w]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ul]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ul]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ul]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Dl,Nl,Ol]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ec=Sl(Zl);function tc(...e){return ec(ol(e))}const sc=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,ic=ol,rc=(e,t)=>s=>{var i;if(null==(null==t?void 0:t.variants))return ic(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:r,defaultVariants:n}=t,a=Object.keys(r).map((e=>{const t=null==s?void 0:s[e],i=null==n?void 0:n[e];if(null===t)return null;const a=sc(t)||sc(i);return r[e][a]})),o=s&&Object.entries(s).reduce(((e,t)=>{let[s,i]=t;return void 0===i||(e[s]=i),e}),{}),l=null==t||null===(i=t.compoundVariants)||void 0===i?void 0:i.reduce(((e,t)=>{let{class:s,className:i,...r}=t;return Object.entries(r).every((e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...n,...o}[t]):{...n,...o}[t]===s}))?[...e,s,i]:e}),[]);return ic(e,a,l,null==s?void 0:s.class,null==s?void 0:s.className)},nc=rc("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ac=X.forwardRef((({className:s,variant:i,size:r,asChild:n=!1,...a},o)=>{const l=n?t:"button";return e.jsx(l,{className:tc(nc({variant:i,size:r,className:s})),ref:o,...a})}));ac.displayName="Button";const oc=({className:t})=>e.jsx("img",{src:"/LOGO UFC.png",alt:"UFC Logo",className:`h-24 w-auto object-contain ${t}`});
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var lc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cc=(e,t)=>{const s=z.forwardRef((({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:o,...l},c)=>{return z.createElement("svg",{ref:c,...lc,width:i,height:i,stroke:s,strokeWidth:n?24*Number(r)/Number(i):r,className:["lucide",`lucide-${d=e,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,a].join(" "),...l},[...t.map((([e,t])=>z.createElement(e,t))),...Array.isArray(o)?o:[o]]);var d}));return s.displayName=`${e}`,s},dc=cc("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),hc=cc("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),uc=cc("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),fc=cc("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),mc=cc("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),gc=cc("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),pc=cc("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),vc=cc("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),yc=cc("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),bc=cc("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),xc=cc("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ec=cc("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Tc=cc("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),Sc=cc("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),wc=cc("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),kc=cc("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ac=cc("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),Lc=cc("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),Rc=cc("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),_c=cc("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Ic=cc("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Pc=cc("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Cc=cc("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Dc=cc("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Nc=cc("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),Mc=cc("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Oc=cc("Rss",[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),jc=cc("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Fc=cc("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Uc=cc("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Bc=cc("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),$c=cc("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),Gc=cc("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Vc=cc("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Kc=cc("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Hc=cc("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),qc=cc("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Wc=cc("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Yc=cc("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),zc=cc("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),Xc=cc("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Jc=cc("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Qc=cc("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Zc=cc("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ed=l,td=c,sd=n,id=i,rd=X.forwardRef((({className:t,...i},r)=>e.jsx(s,{className:tc("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i,ref:r})));rd.displayName=s.displayName;const nd=rc("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ad=X.forwardRef((({side:t="right",className:s,children:i,...a},o)=>e.jsxs(id,{children:[e.jsx(rd,{}),e.jsxs(r,{ref:o,className:tc(nd({side:t}),s),...a,children:[i,e.jsxs(n,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Qc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));ad.displayName=r.displayName;const od=({className:t,...s})=>e.jsx("div",{className:tc("flex flex-col space-y-2 text-center sm:text-left",t),...s});od.displayName="SheetHeader";const ld=X.forwardRef((({className:t,...s},i)=>e.jsx(a,{ref:i,className:tc("text-lg font-semibold text-foreground",t),...s})));ld.displayName=a.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(o,{ref:i,className:tc("text-sm text-muted-foreground",t),...s}))).displayName=o.displayName;const cd=({trigger:t,navItems:s})=>{const i=[...(s||[]).map((e=>({icon:e.icon,label:e.name,path:e.path}))),{icon:Xc,label:"Mi Perfil",path:"/profile"},{icon:hc,label:"Mis Rankings",path:"/rankings"}];return e.jsxs(ed,{children:[e.jsx(td,{asChild:!0,children:t}),e.jsxs(ad,{side:"left",className:"bg-black border-gray-800 text-white w-[280px] sm:w-[320px] flex flex-col",children:[e.jsx(od,{className:"mb-6 border-b border-gray-700 pb-4",children:e.jsx(ld,{children:e.jsxs(J,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(oc,{className:"h-8 w-auto"}),e.jsx("span",{className:"font-bold text-xl text-white",children:"SMASH"})]})})}),e.jsxs("div",{className:"flex flex-col h-full pb-10 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6 px-4 py-3 bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Mis Puntos:"}),e.jsxs("div",{className:"flex items-center text-yellow-400 font-bold text-lg",children:[e.jsx(Tc,{className:"h-5 w-5 mr-2"}),1250..toLocaleString()]})]}),e.jsx("nav",{className:"flex-grow space-y-1",children:i.map((t=>e.jsx(sd,{asChild:!0,children:e.jsxs(J,{to:t.path,className:"flex items-center px-4 py-2.5 rounded-md text-gray-300 hover:bg-gray-800 hover:text-white transition-colors duration-200",children:[t.icon&&e.jsx(t.icon,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium text-sm",children:t.label})]})},t.label)))}),e.jsxs("div",{className:"mt-auto space-y-2 border-t border-gray-700 pt-4",children:[e.jsx(sd,{asChild:!0,children:e.jsx(ac,{variant:"ghost",className:"w-full justify-start",asChild:!0,children:e.jsx(J,{to:"/login",children:"Iniciar Sesión"})})}),e.jsx(sd,{asChild:!0,children:e.jsx(ac,{className:"w-full bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(J,{to:"/register",children:"Registrarse"})})})]}),e.jsx("div",{className:"mt-4 border-t border-gray-700 pt-4",children:e.jsx(sd,{asChild:!0,children:e.jsxs(ac,{variant:"ghost",className:"w-full flex items-center justify-start text-red-500 hover:bg-red-900/50 hover:text-red-400",onClick:()=>{},children:[e.jsx(_c,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium",children:"Cerrar Sesión"})]})})})]})]})]})},dd=m,hd=g,ud=z.forwardRef((({className:t,...s},i)=>e.jsx(d,{ref:i,className:`z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-700 bg-black p-1 text-white shadow-md ${t||""}`,...s})));ud.displayName=d.displayName;z.forwardRef((({className:t,...s},i)=>e.jsx(h,{ref:i,className:`px-2 py-1.5 text-sm font-semibold ${t||""}`,...s}))).displayName=h.displayName;const fd=z.forwardRef((({className:t,...s},i)=>e.jsx(u,{ref:i,className:`flex cursor-pointer select-none items-center rounded-sm px-2 py-2 text-sm outline-none transition-colors hover:bg-gray-800 ${t||""}`,...s})));fd.displayName=u.displayName;const md=z.forwardRef((({className:t,...s},i)=>e.jsx(f,{ref:i,className:`my-1 h-px bg-gray-700 ${t||""}`,...s})));md.displayName=f.displayName;const gd={},pd=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");i=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in gd)return;gd[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise(((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};class vd extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class yd extends vd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class bd extends vd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class xd extends vd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ed;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Ed||(Ed={}));var Td=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};class Sd{constructor(e,{headers:t={},customFetch:s,region:i=Ed.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>pd((async()=>{const{default:e}=await Promise.resolve().then((()=>Od));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Td(this,void 0,void 0,(function*(){try{const{headers:i,method:r,body:n}=t;let a,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),n&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",a=n):"string"==typeof n?(o["Content-Type"]="text/plain",a=n):"undefined"!=typeof FormData&&n instanceof FormData?a=n:(o["Content-Type"]="application/json",a=JSON.stringify(n)));const c=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:a}).catch((e=>{throw new yd(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new bd(c);if(!c.ok)throw new xd(c);let h,u=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),{data:h,error:null}}catch(i){return{data:null,error:i}}}))}}var wd={},kd={},Ad={},Ld={},Rd={},_d={},Id=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Pd=Id.fetch,Cd=Id.fetch.bind(Id),Dd=Id.Headers,Nd=Id.Request,Md=Id.Response,Od=Object.freeze(Object.defineProperty({__proto__:null,Headers:Dd,Request:Nd,Response:Md,default:Cd,fetch:Pd},Symbol.toStringTag,{value:"Module"})),jd=Q(Od);var Fd={};Object.defineProperty(Fd,"__esModule",{value:!0});let Ud=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Fd.default=Ud;var Bd=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_d,"__esModule",{value:!0});const $d=Bd(jd),Gd=Bd(Fd);_d.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=$d.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,i;let r=null,n=null,a=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const i=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");i&&c&&c.length>1&&(a=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(r={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,a=null,o=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{const t=await e.text();try{r=JSON.parse(t),Array.isArray(r)&&404===e.status&&(n=[],r=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):r={message:t}}if(r&&this.isMaybeSingle&&(null===(i=null==r?void 0:r.details)||void 0===i?void 0:i.includes("0 rows"))&&(r=null,o=200,l="OK"),r&&this.shouldThrowOnError)throw new Gd.default(r)}return{error:r,data:n,count:a,status:o,statusText:l}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,i;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(i=null==e?void 0:e.code)&&void 0!==i?i:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var Vd=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Rd,"__esModule",{value:!0});const Kd=Vd(_d);let Hd=class extends Kd.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:r=i}={}){const n=r?`${r}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const r=void 0===i?"offset":`${i}.offset`,n=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:r=!1,format:n="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.Accept)&&void 0!==a?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Rd.default=Hd;var qd=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ld,"__esModule",{value:!0});const Wd=qd(Rd);let Yd=class extends Wd.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let r="";"plain"===i?r="pl":"phrase"===i?r="ph":"websearch"===i&&(r="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ld.default=Yd;var zd=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ad,"__esModule",{value:!0});const Xd=zd(Ld);Ad.default=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let r=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e))).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),new Xd.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new Xd.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:r=!0}={}){const n=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),i&&n.push(`count=${i}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new Xd.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Xd.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Xd.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Jd={},Qd={};Object.defineProperty(Qd,"__esModule",{value:!0}),Qd.version=void 0,Qd.version="0.0.0-automated",Object.defineProperty(Jd,"__esModule",{value:!0}),Jd.DEFAULT_HEADERS=void 0;const Zd=Qd;Jd.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Zd.version}`};var eh=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kd,"__esModule",{value:!0});const th=eh(Ad),sh=eh(Ld),ih=Jd;kd.default=class e{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},ih.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new th.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:r}={}){let n;const a=new URL(`${this.url}/rpc/${e}`);let o;s||i?(n=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(n="POST",o=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new sh.default({method:n,url:a,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var rh=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wd,"__esModule",{value:!0}),wd.PostgrestError=wd.PostgrestBuilder=wd.PostgrestTransformBuilder=wd.PostgrestFilterBuilder=wd.PostgrestQueryBuilder=wd.PostgrestClient=void 0;const nh=rh(kd);wd.PostgrestClient=nh.default;const ah=rh(Ad);wd.PostgrestQueryBuilder=ah.default;const oh=rh(Ld);wd.PostgrestFilterBuilder=oh.default;const lh=rh(Rd);wd.PostgrestTransformBuilder=lh.default;const ch=rh(_d);wd.PostgrestBuilder=ch.default;const dh=rh(Fd);wd.PostgrestError=dh.default;var hh=wd.default={PostgrestClient:nh.default,PostgrestQueryBuilder:ah.default,PostgrestFilterBuilder:oh.default,PostgrestTransformBuilder:lh.default,PostgrestBuilder:ch.default,PostgrestError:dh.default};const{PostgrestClient:uh,PostgrestQueryBuilder:fh,PostgrestFilterBuilder:mh,PostgrestTransformBuilder:gh,PostgrestBuilder:ph,PostgrestError:vh}=hh;let yh;yh="undefined"==typeof window?require("ws"):window.WebSocket;const bh={"X-Client-Info":"realtime-js/2.11.10"};var xh,Eh,Th,Sh,wh,kh;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(xh||(xh={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(Eh||(Eh={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(Th||(Th={})),function(e){e.websocket="websocket"}(Sh||(Sh={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(wh||(wh={}));class Ah{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let n=this.HEADER_LENGTH+2;const a=s.decode(e.slice(n,n+i));n+=i;const o=s.decode(e.slice(n,n+r));n+=r;return{ref:null,topic:a,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class Lh{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(kh||(kh={}));const Rh=(e,t,s={})=>{var i;const r=null!==(i=s.skipTypes)&&void 0!==i?i:[];return Object.keys(t).reduce(((s,i)=>(s[i]=_h(i,e,t,r),s)),{})},_h=(e,t,s,i)=>{const r=t.find((t=>t.name===e)),n=null==r?void 0:r.type,a=s[e];return n&&!i.includes(n)?Ih(n,a):Ph(a)},Ih=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Mh(t,s)}switch(e){case kh.bool:return Ch(t);case kh.float4:case kh.float8:case kh.int2:case kh.int4:case kh.int8:case kh.numeric:case kh.oid:return Dh(t);case kh.json:case kh.jsonb:return Nh(t);case kh.timestamp:return Oh(t);case kh.abstime:case kh.date:case kh.daterange:case kh.int4range:case kh.int8range:case kh.money:case kh.reltime:case kh.text:case kh.time:case kh.timestamptz:case kh.timetz:case kh.tsrange:case kh.tstzrange:default:return Ph(t)}},Ph=e=>e,Ch=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Dh=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Nh=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},Mh=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,i=e[s];if("{"===e[0]&&"}"===i){let i;const n=e.slice(1,s);try{i=JSON.parse("["+n+"]")}catch(r){i=n?n.split(","):[]}return i.map((e=>Ih(t,e)))}return e},Oh=e=>"string"==typeof e?e.replace(" ","T"):e,jh=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Fh{constructor(e,t,s={},i=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Uh,Bh,$h,Gh;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Uh||(Uh={}));class Vh{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Vh.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=Vh.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],i()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Vh.syncDiff(this.state,e,t,s),i())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,i){const r=this.cloneDeep(e),n=this.transformState(t),a={},o={};return this.map(r,((e,t)=>{n[e]||(o[e]=t)})),this.map(n,((e,t)=>{const s=r[e];if(s){const i=t.map((e=>e.presence_ref)),r=s.map((e=>e.presence_ref)),n=t.filter((e=>r.indexOf(e.presence_ref)<0)),l=s.filter((e=>i.indexOf(e.presence_ref)<0));n.length>0&&(a[e]=n),l.length>0&&(o[e]=l)}else a[e]=t})),this.syncDiff(r,{joins:a,leaves:o},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,((t,i)=>{var r;const n=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(i),n.length>0){const s=e[t].map((e=>e.presence_ref)),i=n.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...i)}s(t,n,i)})),this.map(n,((t,s)=>{let r=e[t];if(!r)return;const n=s.map((e=>e.presence_ref));r=r.filter((e=>n.indexOf(e.presence_ref)<0)),e[t]=r,i(t,r,s),0===r.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const i=e[s];return t[s]="metas"in i?i.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):i,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Bh||(Bh={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}($h||($h={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Gh||(Gh={}));class Kh{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Eh.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Fh(this,Th.join,this.params,this.timeout),this.rejoinTimer=new Lh((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=Eh.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Eh.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Eh.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Eh.errored,this.rejoinTimer.scheduleTimeout())})),this._on(Th.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new Vh(this),this.broadcastEndpointURL=jh(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:n,private:a}}=this.params;this._onError((t=>null==e?void 0:e(Gh.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(Gh.CLOSED)));const o={},l={broadcast:r,presence:n,postgres_changes:null!==(i=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==i?i:[],private:a};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const i=this.bindings.postgres_changes,r=null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0,n=[];for(let s=0;s<r;s++){const r=i[s],{filter:{event:a,schema:o,table:l,filter:c}}=r,d=t&&t[s];if(!d||d.event!==a||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=Eh.errored,void(null==e||e(Gh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},r),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(Gh.SUBSCRIBED))}null==e||e(Gh.SUBSCRIBED)})).receive("error",(t=>{this.state=Eh.errored,null==e||e(Gh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(Gh.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var i,r,n;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(r=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.ack)||s("ok"),a.receive("ok",(()=>s("ok"))),a.receive("error",(()=>s("error"))),a.receive("timeout",(()=>s("timed out")))}));{const{event:n,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(i=e.body)||void 0===i?void 0:i.cancel()),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Eh.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Th.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise((s=>{const i=new Fh(this,Th.leave,{},e);i.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),i.send(),this._canPush()||i.trigger("ok",{})}))}teardown(){this.pushBuffer.forEach((e=>e.destroy())),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout((()=>i.abort()),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Fh(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const n=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=Th;if(s&&[a,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter((e=>{var t,s,i;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(i=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===i?void 0:i.toLocaleLowerCase())===n})).map((e=>e.callback(d,s))):null===(r=this.bindings[n])||void 0===r||r.filter((e=>{var s,i,r,a,o,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,a=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(i=t.ids)||void 0===i?void 0:i.includes(n))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const s=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:i,type:r,errors:n}=e,a={schema:t,table:s,commit_timestamp:i,eventType:r,new:{},old:{},errors:n};d=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===Eh.closed}_isJoined(){return this.state===Eh.joined}_isJoining(){return this.state===Eh.joining}_isLeaving(){return this.state===Eh.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var i;return!((null===(i=e.type)||void 0===i?void 0:i.toLocaleLowerCase())===s&&Kh.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Th.close,{},e)}_onError(e){this._on(Th.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Eh.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Rh(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Rh(e.columns,e.old_record)),t}}const Hh=()=>{};class qh{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=bh,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Hh,this.ref=0,this.logger=Hh,this.conn=null,this.sendBuffer=[],this.serializer=new Ah,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>pd((async()=>{const{default:e}=await Promise.resolve().then((()=>Od));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Sh.websocket}`,this.httpEndpoint=jh(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Lh((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=yh),this.transport){const e="undefined"!=typeof window&&this.transport===window.WebSocket;return this.conn=e?new this.transport(this.endpointURL()):new this.transport(this.endpointURL(),void 0,{headers:this.headers}),void this.setupConnection()}this.conn=new Wh(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach((e=>e.teardown())))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels=this.channels.filter((t=>t._joinRef!==e._joinRef)),0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case xh.connecting:return wh.Connecting;case xh.open:return wh.Open;case xh.closing:return wh.Closing;default:return wh.Closed}}isConnected(){return this.connectionState()===wh.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find((e=>e.topic===s));if(i)return i;{const s=new Kh(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:i,ref:r}=e,n=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),e.joinedOnce&&e._isJoined()&&e._push(Th.access_token,{access_token:t})})))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t.topic!==e.topic))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:i,ref:r}=e;"phoenix"===t&&"phx_reply"===s&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${s} ${r&&"("+r+")"||""}`,i),Array.from(this.channels).filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,i,r))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(Th.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Wh{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=xh.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Yh extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function zh(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Xh extends Yh{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Jh extends Yh{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Qh=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};const Zh=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>pd((async()=>{const{default:e}=await Promise.resolve().then((()=>Od));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},eu=e=>{if(Array.isArray(e))return e.map((e=>eu(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const i=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[i]=eu(s)})),t};var tu=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};const su=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),iu=(e,t,s)=>tu(void 0,void 0,void 0,(function*(){const i=yield Qh(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield pd((()=>Promise.resolve().then((()=>Od))),void 0)).Response:Response}));e instanceof i&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new Xh(su(s),e.status||500))})).catch((e=>{t(new Jh(su(e),e))})):t(new Jh(su(e),e))}));function ru(e,t,s,i,r,n){return tu(this,void 0,void 0,(function*(){return new Promise(((a,o)=>{e(s,((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i&&(r.body=JSON.stringify(i)),Object.assign(Object.assign({},r),s))})(t,i,r,n)).then((e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()})).then((e=>a(e))).catch((e=>iu(e,o,i)))}))}))}function nu(e,t,s,i){return tu(this,void 0,void 0,(function*(){return ru(e,"GET",t,s,i)}))}function au(e,t,s,i,r){return tu(this,void 0,void 0,(function*(){return ru(e,"POST",t,i,r,s)}))}function ou(e,t,s,i,r){return tu(this,void 0,void 0,(function*(){return ru(e,"DELETE",t,i,r,s)}))}var lu=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};const cu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},du={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class hu{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Zh(i)}uploadOrUpdate(e,t,s,i){return lu(this,void 0,void 0,(function*(){try{let r;const n=Object.assign(Object.assign({},du),i);let a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const o=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(r=new FormData,r.append("cacheControl",n.cacheControl),o&&r.append("metadata",this.encodeMetadata(o)),r.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(r=s,r.append("cacheControl",n.cacheControl),o&&r.append("metadata",this.encodeMetadata(o))):(r=s,a["cache-control"]=`max-age=${n.cacheControl}`,a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==i?void 0:i.headers)&&(a=Object.assign(Object.assign({},a),i.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:r,headers:a},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),h=yield d.json();if(d.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(r){if(zh(r))return{data:null,error:r};throw r}}))}upload(e,t,s){return lu(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,i){return lu(this,void 0,void 0,(function*(){const r=this._removeEmptyFolders(e),n=this._getFinalPath(r),a=new URL(this.url+`/object/upload/sign/${n}`);a.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:du.upsert},i),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);const o=yield this.fetch(a.toString(),{method:"PUT",body:e,headers:n}),l=yield o.json();if(o.ok)return{data:{path:r,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(zh(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return lu(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(i["x-upsert"]="true");const r=yield au(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),n=new URL(this.url+r.url),a=n.searchParams.get("token");if(!a)throw new Yh("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:a},error:null}}catch(s){if(zh(s))return{data:null,error:s};throw s}}))}update(e,t,s){return lu(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return lu(this,void 0,void 0,(function*(){try{return{data:yield au(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(zh(i))return{data:null,error:i};throw i}}))}copy(e,t,s){return lu(this,void 0,void 0,(function*(){try{return{data:{path:(yield au(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(zh(i))return{data:null,error:i};throw i}}))}createSignedUrl(e,t,s){return lu(this,void 0,void 0,(function*(){try{let i=this._getFinalPath(e),r=yield au(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${n}`)},{data:r,error:null}}catch(i){if(zh(i))return{data:null,error:i};throw i}}))}createSignedUrls(e,t,s){return lu(this,void 0,void 0,(function*(){try{const i=yield au(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:i.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${r}`):null}))),error:null}}catch(i){if(zh(i))return{data:null,error:i};throw i}}))}download(e,t){return lu(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),r=i?`?${i}`:"";try{const t=this._getFinalPath(e),i=yield nu(this.fetch,`${this.url}/${s}/${t}${r}`,{headers:this.headers,noResolveJson:!0});return{data:yield i.blob(),error:null}}catch(n){if(zh(n))return{data:null,error:n};throw n}}))}info(e){return lu(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield nu(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:eu(e),error:null}}catch(s){if(zh(s))return{data:null,error:s};throw s}}))}exists(e){return lu(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,i){return tu(this,void 0,void 0,(function*(){return ru(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),i)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(zh(s)&&s instanceof Jh){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==r&&i.push(r);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&i.push(a);let o=i.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${o}`)}}}remove(e){return lu(this,void 0,void 0,(function*(){try{return{data:yield ou(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(zh(t))return{data:null,error:t};throw t}}))}list(e,t,s){return lu(this,void 0,void 0,(function*(){try{const i=Object.assign(Object.assign(Object.assign({},cu),t),{prefix:e||""});return{data:yield au(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(zh(i))return{data:null,error:i};throw i}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const uu={"X-Client-Info":"storage-js/2.7.1"};var fu=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};class mu{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},uu),t),this.fetch=Zh(s)}listBuckets(){return fu(this,void 0,void 0,(function*(){try{return{data:yield nu(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(zh(e))return{data:null,error:e};throw e}}))}getBucket(e){return fu(this,void 0,void 0,(function*(){try{return{data:yield nu(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(zh(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return fu(this,void 0,void 0,(function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(zh(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return fu(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,i,r){return tu(this,void 0,void 0,(function*(){return ru(e,"PUT",t,i,r,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(zh(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return fu(this,void 0,void 0,(function*(){try{return{data:yield au(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(zh(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return fu(this,void 0,void 0,(function*(){try{return{data:yield ou(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(zh(t))return{data:null,error:t};throw t}}))}}class gu extends mu{constructor(e,t={},s){super(e,t,s)}from(e){return new hu(this.url,this.headers,e,this.fetch)}}let pu="";pu="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const vu={headers:{"X-Client-Info":`supabase-js-${pu}/2.50.0`}},yu={schema:"public"},bu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},xu={};var Eu=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};const Tu=e=>{let t;return t=e||("undefined"==typeof fetch?Cd:fetch),(...e)=>t(...e)},Su=(e,t,s)=>{const i=Tu(s),r="undefined"==typeof Headers?Dd:Headers;return(s,n)=>Eu(void 0,void 0,void 0,(function*(){var a;const o=null!==(a=yield t())&&void 0!==a?a:e;let l=new r(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),i(s,Object.assign(Object.assign({},n),{headers:l}))}))};var wu=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};const ku="2.70.0",Au=3e4,Lu=9e4,Ru={"X-Client-Info":`gotrue-js/${ku}`},_u="X-Supabase-Api-Version",Iu={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Pu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Cu extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Du(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Nu extends Cu{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Mu extends Cu{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ou extends Cu{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class ju extends Ou{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Fu extends Ou{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Uu extends Ou{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Bu extends Ou{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $u extends Ou{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Gu extends Ou{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Vu(e){return Du(e)&&"AuthRetryableFetchError"===e.name}class Ku extends Ou{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Hu extends Ou{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const qu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Wu=" \t\n\r=".split(""),Yu=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Wu.length;t+=1)e[Wu[t].charCodeAt(0)]=-2;for(let t=0;t<qu.length;t+=1)e[qu[t].charCodeAt(0)]=t;return e})();function zu(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(qu[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(qu[e]),t.queuedBits-=6}}function Xu(e,t,s){const i=Yu[e];if(!(i>-1)){if(-2===i)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Ju(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,i,s)};for(let a=0;a<e.length;a+=1)Xu(e.charCodeAt(a),r,n);return t.join("")}function Qu(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Zu(e){const t=[],s={queue:0,queuedBits:0},i=e=>{t.push(e)};for(let r=0;r<e.length;r+=1)Xu(e.charCodeAt(r),s,i);return new Uint8Array(t)}function ef(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let i=e.charCodeAt(s);if(i>55295&&i<=56319){const t=1024*(i-55296)&65535;i=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Qu(i,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}function tf(e){const t=[],s={queue:0,queuedBits:0},i=e=>{t.push(e)};return e.forEach((e=>zu(e,s,i))),zu(null,s,i),t.join("")}const sf=()=>"undefined"!=typeof window&&"undefined"!=typeof document,rf={tested:!1,writable:!1},nf=()=>{if(!sf())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(rf.tested)return rf.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),rf.tested=!0,rf.writable=!0}catch(t){rf.tested=!0,rf.writable=!1}return rf.writable};const af=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>pd((async()=>{const{default:e}=await Promise.resolve().then((()=>Od));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},of=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},lf=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(Sw){return s}},cf=async(e,t)=>{await e.removeItem(t)};class df{constructor(){this.promise=new df.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function hf(e){const t=e.split(".");if(3!==t.length)throw new Hu("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Pu.test(t[s]))throw new Hu("JWT not in base64url format");return{header:JSON.parse(Ju(t[0])),payload:JSON.parse(Ju(t[1])),signature:Zu(t[2]),raw:{header:t[0],payload:t[1]}}}function uf(e){return("0"+e.toString(16)).substr(-2)}async function ff(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function mf(e,t,s=!1){const i=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let i=0;i<56;i++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,uf).join("")}();let r=i;s&&(r+="/PASSWORD_RECOVERY"),await of(e,`${t}-code-verifier`,r);const n=await ff(i);return[n,i===n?"plain":"s256"]}df.promiseConstructor=Promise;const gf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const pf=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function vf(e){if(!pf.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var yf=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};const bf=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),xf=[502,503,504];async function Ef(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Gu(bf(e),0);if(xf.includes(e.status))throw new Gu(bf(e),e.status);let i,r;try{i=await e.json()}catch(a){throw new Mu(bf(a),a)}const n=function(e){const t=e.headers.get(_u);if(!t)return null;if(!t.match(gf))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(a){return null}}(e);if(n&&n.getTime()>=Iu.timestamp&&"object"==typeof i&&i&&"string"==typeof i.code?r=i.code:"object"==typeof i&&i&&"string"==typeof i.error_code&&(r=i.error_code),r){if("weak_password"===r)throw new Ku(bf(i),e.status,(null===(t=i.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new ju}else if("object"==typeof i&&i&&"object"==typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new Ku(bf(i),e.status,i.weak_password.reasons);throw new Nu(bf(i),e.status||500,r)}async function Tf(e,t,s,i){var r;const n=Object.assign({},null==i?void 0:i.headers);n[_u]||(n[_u]=Iu.name),(null==i?void 0:i.jwt)&&(n.Authorization=`Bearer ${i.jwt}`);const a=null!==(r=null==i?void 0:i.query)&&void 0!==r?r:{};(null==i?void 0:i.redirectTo)&&(a.redirect_to=i.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,s,i,r,n){const a=((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),s))})(t,i,r,n);let o;try{o=await e(s,Object.assign({},a))}catch(l){throw new Gu(bf(l),0)}o.ok||await Ef(o);if(null==i?void 0:i.noResolveJson)return o;try{return await o.json()}catch(l){await Ef(l)}}(e,t,s+o,{headers:n,noResolveJson:null==i?void 0:i.noResolveJson},{},null==i?void 0:i.body);return(null==i?void 0:i.xform)?null==i?void 0:i.xform(l):{data:Object.assign({},l),error:null}}function Sf(e){var t;let s=null;var i;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(i=e.expires_in,Math.round(Date.now()/1e3)+i)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function wf(e){const t=Sf(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function kf(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Af(e){return{data:e,error:null}}function Lf(e){const{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:n}=e,a=yf(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:n},user:Object.assign({},a)},error:null}}function Rf(e){return e}const _f=["global","local","others"];var If=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};class Pf{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=af(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=_f[0]){if(_f.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_f.join(", ")}`);try{return await Tf(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Du(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Tf(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:kf})}catch(s){if(Du(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=If(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=null==s?void 0:s.newEmail,delete i.newEmail),await Tf(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Lf,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Du(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Tf(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:kf})}catch(t){if(Du(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,n,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Tf(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(i=null==e?void 0:e.perPage)||void 0===i?void 0:i.toString())&&void 0!==r?r:""},xform:Rf});if(c.error)throw c.error;const d=await c.json(),h=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,u=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return u.length>0&&(u.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Du(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){vf(e);try{return await Tf(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:kf})}catch(t){if(Du(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){vf(e);try{return await Tf(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:kf})}catch(s){if(Du(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){vf(e);try{return await Tf(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:kf})}catch(s){if(Du(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){vf(e.userId);try{const{data:t,error:s}=await Tf(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Du(t))return{data:null,error:t};throw t}}async _deleteFactor(e){vf(e.userId),vf(e.id);try{return{data:await Tf(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Du(t))return{data:null,error:t};throw t}}}const Cf={getItem:e=>nf()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{nf()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{nf()&&globalThis.localStorage.removeItem(e)}};function Df(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Nf=!!(globalThis&&nf()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Mf extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Of extends Mf{}async function jf(e,t,s){const i=new globalThis.AbortController;return t>0&&setTimeout((()=>{i.abort()}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},(async i=>{if(!i){if(0===t)throw new Of(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Nf)try{await globalThis.navigator.locks.query()}catch(r){}return await s()}try{return await s()}finally{}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Ff={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ru,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Uf(e,t,s){return await s()}class Bf{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Bf.nextInstanceID,Bf.nextInstanceID+=1,this.instanceID>0&&sf();const i=Object.assign(Object.assign({},Ff),e);if(this.logDebugMessages=!!i.debug,"function"==typeof i.debug&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Pf({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=af(i.fetch),this.lock=i.lock||Uf,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:sf()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=jf:this.lock=Uf,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:nf()?this.storage=Cf:(this.memoryStorage={},this.storage=Df(this.memoryStorage)):(this.memoryStorage={},this.storage=Df(this.memoryStorage)),sf()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ku}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(i){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),sf()&&this.detectSessionInUrl&&"none"!==s){const{data:i,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return Du(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return await this._removeSession(),{error:r}}const{session:n,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",n,"redirect type",a),await this._saveSession(n),setTimeout((async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Du(t)?{error:t}:{error:new Mu("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await Tf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken}},xform:Sf}),{data:n,error:a}=r;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Du(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:s,password:i,options:n}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await mf(this.storage,this.storageKey)),r=await Tf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:i,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},xform:Sf})}else{if(!("phone"in e))throw new Uu("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:a}=e;r=await Tf(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{},channel:null!==(i=null==a?void 0:a.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Sf})}}const{data:n,error:a}=r;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Du(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:i,options:r}=e;t=await Tf(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:wf})}else{if(!("phone"in e))throw new Uu("You must provide either an email or phone number and a password");{const{phone:s,password:i,options:r}=e;t=await Tf(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:wf})}}const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i}):{data:{user:null,session:null},error:new Fu}}catch(t){if(Du(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,r,n,a,o,l,c,d,h,u;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:h,wallet:u,statement:g,options:p}=e;let v;if(sf())if("object"==typeof u)v=u;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof u||!(null==p?void 0:p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=u}const y=new URL(null!==(t=null==p?void 0:p.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==p?void 0:p.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),m=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${y.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(i=null===(s=null==p?void 0:p.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:(new Date).toISOString()}`,...(null===(r=null==p?void 0:p.signInWithSolana)||void 0===r?void 0:r.notBefore)?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...(null===(n=null==p?void 0:p.signInWithSolana)||void 0===n?void 0:n.expirationTime)?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...(null===(a=null==p?void 0:p.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...(null===(o=null==p?void 0:p.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...(null===(l=null==p?void 0:p.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==p?void 0:p.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...p.signInWithSolana.resources.map((e=>`- ${e}`))]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=e}}try{const{data:t,error:s}=await Tf(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:tf(m)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:Sf});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Fu}}catch(g){if(Du(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await lf(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(null!=t?t:"").split("/");try{const{data:t,error:r}=await Tf(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Sf});if(await cf(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=i?i:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Fu}}catch(r){if(Du(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:n}=e,a=await Tf(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Sf}),{data:o,error:l}=a;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Fu}}catch(t){if(Du(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,n;try{if("email"in e){const{email:i,options:r}=e;let n=null,a=null;"pkce"===this.flowType&&([n,a]=await mf(this.storage,this.storageKey));const{error:o}=await Tf(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:n,code_challenge_method:a},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:a,error:o}=await Tf(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(i=null==s?void 0:s.data)&&void 0!==i?i:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new Uu("You must provide either an email or phone number.")}catch(a){if(Du(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:a}=await Tf(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:Sf});if(a)throw a;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(Du(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,n=null;return"pkce"===this.flowType&&([r,n]=await mf(this.storage,this.storageKey)),await Tf(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:n}),headers:this.headers,xform:Af})}catch(r){if(Du(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ju;const{error:i}=await Tf(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}}))}catch(e){if(Du(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:n}=await Tf(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:i,options:r}=e,{data:n,error:a}=await Tf(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new Uu("You must provide either an email or phone number and a type")}catch(t){if(Du(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await lf(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<Lu;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,i)=>(t||"user"!==s||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,i))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await Tf(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:kf}):await this._useSession((async e=>{var t,s,i;const{data:r,error:n}=e;if(n)throw n;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Tf(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0,xform:kf}):{data:{user:null},error:new ju}}))}catch(t){if(Du(t))return function(e){return Du(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await cf(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new ju;const n=i.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await mf(this.storage,this.storageKey));const{data:l,error:c}=await Tf(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:n.access_token,xform:kf});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(s){if(Du(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ju;const t=Date.now()/1e3;let s=t,i=!0,r=null;const{payload:n}=hf(e.access_token);if(n.exp&&(s=n.exp,i=s<=t),i){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:i,error:n}=await this._getUser(e.access_token);if(n)throw n;r={access_token:e.access_token,refresh_token:e.refresh_token,user:i.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Du(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:i,error:r}=t;if(r)throw r;e=null!==(s=i.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new ju;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Du(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!sf())throw new Bu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Bu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new $u("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Bu("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $u("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:n,expires_in:a,expires_at:o,token_type:l}=e;if(!(r&&a&&n&&l))throw new Bu("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(a);let h=c+d;o&&(h=parseInt(o));const{data:u,error:f}=await this._getUser(r);if(f)throw f;const m={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:d,expires_at:h,refresh_token:n,token_type:l,user:u.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(s){if(Du(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await lf(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const n=null===(s=i.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return Du(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await cf(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,i;try{const{data:{session:i},error:r}=t;if(r)throw r;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(r){await(null===(i=this.stateChangeEmitters.get(e))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r)}}))}async resetPasswordForEmail(e,t={}){let s=null,i=null;"pkce"===this.flowType&&([s,i]=await mf(this.storage,this.storageKey,!0));try{return await Tf(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Du(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Du(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession((async t=>{var s,i,r,n,a;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(i=e.options)||void 0===i?void 0:i.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await Tf(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==a?a:void 0})}));if(i)throw i;return sf()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Du(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:n}=t;if(n)throw n;return await Tf(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0})}))}catch(t){if(Du(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Tf(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Sf})),i=(e,t)=>{const s=200*Math.pow(2,e);return t&&Vu(t)&&Date.now()+s-r<Au},new Promise(((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await s(n);if(!i(n,null,t))return void e(t)}catch(r){if(!i(n,r))return void t(r)}})()})))}catch(r){if(this._debug(t,"error",r),Du(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}var s,i}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),sf()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await lf(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const i=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<Lu;if(this._debug(t,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(Vu(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return void this._debug(t,"error",s)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ju;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new df;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new ju;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const i={session:t.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(r){if(this._debug(i,"error",r),Du(r)){const e={session:null,error:r};return Vu(r)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],r=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(r){i.push(r)}}));if(await Promise.all(r),i.length>0){for(let e=0;e<i.length;e+=1);throw i[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await of(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await cf(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&sf()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),Au);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*s.expires_at-t)/Au);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof Mf))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!sf()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await mf(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});i.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);i.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Tf(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Du(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:n}=t;if(n)return{data:null,error:n};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await Tf(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(i=null==o?void 0:o.totp)||void 0===i?void 0:i.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(Du(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:n,error:a}=await Tf(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:a})}))}catch(t){if(Du(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await Tf(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Du(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],i=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),r=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=hf(i.access_token);let a=null;n.aal&&(a=n.aal);let o=a;(null!==(s=null===(t=i.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:i,error:r}=await Tf(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;if(!i.keys||0===i.keys.length)throw new Hu("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find((t=>t.kid===e)),!s)throw new Hu("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:i,payload:r,signature:n,raw:{header:a,payload:o}}=hf(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp),!i.kid||"HS256"===i.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:r,header:i,signature:n},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(i.alg),c=await this.fetchJwk(i.kid,t),d=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,d,n,ef(`${a}.${o}`))))throw new Hu("Invalid JWT signature");return{data:{claims:r,header:i,signature:n},error:null}}catch(s){if(Du(s))return{data:null,error:s};throw s}}}Bf.nextInstanceID=0;const $f=Bf;class Gf extends $f{constructor(e){super(e)}}var Vf=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(t){n(t)}}function o(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))};class Kf{constructor(e,t,s){var i,r,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,i;const{db:r,auth:n,realtime:a,global:o}=e,{db:l,auth:c,realtime:d,global:h}=t,u={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},null!==(s=null==h?void 0:h.headers)&&void 0!==s?s:{}),null!==(i=null==o?void 0:o.headers)&&void 0!==i?i:{})}),accessToken:()=>wu(this,void 0,void 0,(function*(){return""}))};return e.accessToken?u.accessToken=e.accessToken:delete u.accessToken,u}(null!=s?s:{},{db:yu,realtime:xu,auth:Object.assign(Object.assign({},bu),{storageKey:c}),global:vu});this.storageKey=null!==(i=d.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(r=d.global.headers)&&void 0!==r?r:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=d.auth)&&void 0!==n?n:{},this.headers,d.global.fetch),this.fetch=Su(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new uh(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Sd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new gu(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Vf(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:n,lock:a,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Gf({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:n,lock:a,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new qh(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const Hf=((e,t,s)=>new Kf(e,t,s))("https://gqylknstxjwlybyvvcvx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdxeWxrbnN0eGp3bHlieXZ2Y3Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwOTMyNzIsImV4cCI6MjA2NTY2OTI3Mn0.fdOlalxcPaKzpjaUnFowsY3gz6f0LYmCdE--aJ76zc8"),qf=()=>{ee();const[t,s]=z.useState(null);z.useEffect((()=>{const e=async()=>{const e=JSON.parse(localStorage.getItem("user"));if(!e)return;const{data:t}=await Hf.from("usuario").select("*").eq("correo",e.email).single();t&&s(t)};e();const t=()=>e();return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)}),[]);return e.jsxs(dd,{children:[e.jsx(hd,{asChild:!0,children:e.jsx(ac,{variant:"ghost",size:"icon",className:"relative",children:e.jsx(bc,{className:"h-8 w-8"})})}),e.jsxs(ud,{className:"w-72",align:"end",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-red-900/20 to-black border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t?.avatar||"/pain.png",alt:t?.nombre_usuario||"Usuario",className:"h-20 w-20 rounded-full object-cover ring-2 ring-red-600"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-yellow-500 text-black text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:t?.nivel||1})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-lg font-bold text-white",children:t?.nombre_usuario||"Usuario"}),e.jsx("p",{className:"text-xs text-gray-400",children:t?.correo||"-"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(dc,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-500",children:[t?.puntos?.toLocaleString()||0," pts"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-gray-900/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx(hc,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Win Rate"}),e.jsx("p",{className:"text-sm font-medium text-white",children:t?.winRate||"-"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx(Vc,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Predicciones"}),e.jsx("p",{className:"text-sm font-medium text-white",children:t?.predictions||"-"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx(fd,{asChild:!0,children:e.jsxs(J,{to:"/profile",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(bc,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Mi Perfil"})]})}),e.jsx(fd,{asChild:!0,children:e.jsxs(J,{to:"/rankings",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(zc,{className:"mr-2 h-4 w-4 text-gray-300"}),e.jsx("span",{children:"Ranking Global"})]})})]}),e.jsx(md,{}),e.jsx("div",{className:"p-2",children:e.jsxs(fd,{className:"text-red-500 hover:text-red-400 hover:bg-red-900/20 rounded-md",onClick:()=>{localStorage.removeItem("user"),localStorage.removeItem("access_token"),window.location.reload()},children:[e.jsx(_c,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Cerrar Sesión"})]})})]})]})},Wf=()=>{const t=[{name:"Inicio",path:"/",icon:null},{name:"Foro",path:"/forum",icon:Cc},{name:"Peleadores",path:"/fighters",icon:Jc},{name:"Comparar",path:"/compare",icon:Ac},{name:"Clips Destacados",path:"/highlights",icon:Vc},{name:"Eventos",path:"/events",icon:mc},{name:"Clips Guardados",path:"/clips",icon:jc},{name:"Ver en Vivo",path:"/live",icon:Nc}],[s,i]=z.useState(!1);return z.useEffect((()=>{const e=()=>i(!!localStorage.getItem("user"));return e(),window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),e.jsx(nl.header,{initial:{y:-100},animate:{y:0},transition:{duration:.5},className:"fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-gray-800",children:e.jsxs("nav",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsx(J,{to:"/",className:"flex items-center",children:e.jsx(oc,{className:"h-12 w-auto"})}),e.jsx("div",{className:"hidden lg:flex items-center space-x-1",children:t.map((t=>e.jsxs(te,{to:t.path,className:({isActive:e})=>"px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center "+(e?"text-red-500 bg-red-900/20":"text-gray-300 hover:text-white hover:bg-gray-800"),children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4 mr-2"}),t.name]},t.path)))})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(ac,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(J,{to:"/login",children:"Iniciar Sesión"})}),e.jsx(ac,{size:"sm",className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(J,{to:"/register",children:"Registrarse"})})]}),e.jsx(qf,{})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(cd,{trigger:e.jsx(ac,{variant:"ghost",size:"icon",children:e.jsx(bc,{className:"h-6 w-6"})}),navItems:t})})]})]})})},Yf=T,zf=X.forwardRef((({className:t,...s},i)=>e.jsx(p,{ref:i,className:tc("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s})));zf.displayName=p.displayName;const Xf=rc("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Jf=X.forwardRef((({className:t,variant:s,...i},r)=>e.jsx(v,{ref:r,className:tc(Xf({variant:s}),t),...i})));Jf.displayName=v.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(y,{ref:i,className:tc("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}))).displayName=y.displayName;const Qf=X.forwardRef((({className:t,...s},i)=>e.jsx(b,{ref:i,className:tc("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(Qc,{className:"h-4 w-4"})})));Qf.displayName=b.displayName;const Zf=X.forwardRef((({className:t,...s},i)=>e.jsx(x,{ref:i,className:tc("text-sm font-semibold",t),...s})));Zf.displayName=x.displayName;const em=X.forwardRef((({className:t,...s},i)=>e.jsx(E,{ref:i,className:tc("text-sm opacity-90",t),...s})));em.displayName=E.displayName;let tm=0;const sm={state:{toasts:[]},listeners:[],getState:()=>sm.state,setState:e=>{sm.state="function"==typeof e?e(sm.state):{...sm.state,...e},sm.listeners.forEach((e=>e(sm.state)))},subscribe:e=>(sm.listeners.push(e),()=>{sm.listeners=sm.listeners.filter((t=>t!==e))})},im=({...e})=>{const t=(tm=(tm+1)%Number.MAX_VALUE,tm.toString()),s=()=>sm.setState((e=>({...e,toasts:e.toasts.filter((e=>e.id!==t))})));return sm.setState((i=>({...i,toasts:[{...e,id:t,dismiss:s},...i.toasts].slice(0,1)}))),{id:t,dismiss:s,update:e=>sm.setState((s=>({...s,toasts:s.toasts.map((s=>s.id===t?{...s,...e}:s))})))}};function rm(){const{toasts:t}=function(){const[e,t]=z.useState(sm.getState());return z.useEffect((()=>{const e=sm.subscribe((e=>{t(e)}));return e}),[]),z.useEffect((()=>{const t=[];return e.toasts.forEach((e=>{if(e.duration===1/0)return;const s=setTimeout((()=>{e.dismiss()}),e.duration||5e3);t.push(s)})),()=>{t.forEach((e=>clearTimeout(e)))}}),[e.toasts]),{toast:im,toasts:e.toasts}}();return e.jsxs(Yf,{children:[t.map((({id:t,title:s,description:i,action:r,...n})=>e.jsxs(Jf,{...n,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Zf,{children:s}),i&&e.jsx(em,{children:i})]}),r,e.jsx(Qf,{})]},t))),e.jsx(zf,{})]})}const nm=({children:t})=>e.jsxs("div",{className:"min-h-screen bg-black text-white font-sans",children:[e.jsx(Wf,{}),e.jsx("main",{className:"pt-16",children:t}),e.jsx(rm,{})]}),am=()=>{const t=`JUNIO 29, ${(new Date).getFullYear()+1}`;return e.jsxs(nl.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"relative flex flex-col items-center",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"bg-gradient-to-r from-red-700 via-red-600 to-red-700 rounded-full p-1",children:e.jsx("div",{className:"bg-black rounded-full p-4",children:e.jsx("span",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-700 filter drop-shadow-lg",children:"VS"})})})}),e.jsx(nl.div,{animate:{scale:[1,1.2,1]},transition:{duration:10,repeat:1/0,ease:"linear",repeatType:"mirror"},className:"absolute inset-x-0 top-0 h-full bg-gradient-to-r from-red-600/20 to-red-800/20 rounded-full blur-xl",style:{top:"-10%",height:"120%"}}),e.jsx("p",{className:"mt-3 text-sm font-semibold text-gray-400 uppercase tracking-wider z-10",children:t})]})},om={A:62,B:38},lm=()=>{const[t,s]=z.useState(null),[i,r]=z.useState(om),[n,a]=z.useState(!1),o=e=>{const i=t===e?null:e;s(i),a(!0),i&&r((e=>"A"===i&&e.A<95?{A:e.A+1,B:e.B-1}:"B"===i&&e.B<95?{A:e.A-1,B:e.B+1}:e))};return z.useEffect((()=>{let e;return n&&!t&&(e=setTimeout((()=>a(!1)),3e3)),()=>clearTimeout(e)}),[n,t]),e.jsxs("section",{className:"relative min-h-[90vh] mt-16 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:"UFC featured fight background octagon lights",src:"https://images.unsplash.com/photo-1687519930490-db2e9a2efa03"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/60 to-transparent"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-5xl mx-auto px-4 py-8",children:e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs("div",{className:"bg-black/70 p-6 md:p-8 rounded-xl backdrop-blur-md border border-gray-800 shadow-lg shadow-red-900/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(zc,{className:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"text-lg font-bold tracking-wide uppercase",children:"Evento Principal"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400 animate-pulse",children:[e.jsx(Yc,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Predicciones Abiertas"})]})]}),e.jsx("h2",{className:"text-3xl md:text-5xl font-black mb-2 text-center uppercase tracking-wider",children:"UFC 300: PELEA ESTELAR"}),e.jsx("p",{className:"text-lg md:text-xl mb-8 text-center text-gray-300 font-light",children:"Pelea estelar por el título mundial"}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-4 md:gap-8 mb-8 items-center",children:[e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>o("A"),className:tc("absolute -top-2 -left-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","A"===t&&"medal-selected"),"aria-label":"Seleccionar a Luchador A como favorito",children:e.jsx(dc,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:"Fighter A portrait",src:"/foto jon.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"Jon "}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Campeón | 28-0-0"}),e.jsx(Ee,{children:n&&e.jsxs(nl.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(Jc,{className:"w-4 h-4 mr-1.5"}),i.A,"% de los votos"]})})]}),e.jsx("div",{className:"flex flex-col items-center justify-center self-center pt-8 md:pt-0",children:e.jsx(am,{})}),e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>o("B"),className:tc("absolute -top-2 -right-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","B"===t&&"medal-selected"),"aria-label":"Seleccionar a Luchador B como favorito",children:e.jsx(dc,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:"Fighter B portrait",src:"/foto khabib.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"khabib "}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Retador | 25-2-0"}),e.jsx(Ee,{children:n&&e.jsxs(nl.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(Jc,{className:"w-4 h-4 mr-1.5"}),i.B,"% de los votos"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 md:gap-4 justify-center mt-6",children:[e.jsx(ac,{size:"lg",className:"bg-red-600 hover:bg-red-700 text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(J,{to:"/live",children:"Ver en Vivo"})}),e.jsx(ac,{size:"lg",variant:"outline",className:"border-red-600 text-red-600 hover:bg-red-600 hover:text-white text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(J,{to:"/predict",children:"Hacer Predicción"})})]})]})})})]})},cm=[{id:1,title:"UFC 303: McGregor vs. Chandler",date:"2025-06-29",fighters:"McGregor vs. Chandler",imageSlug:"arena-lights-crowd",altText:"Brightly lit arena packed with spectators for a UFC event",link:"/ufc303"},{id:2,title:"UFC Fight Night: Namajunas vs. Barber",date:"2025-07-13",fighters:"Namajunas vs. Barber",imageSlug:"octagon-side-view",altText:"Side view of the UFC octagon during a fight",link:"/ufcnamajunasbarber"},{id:3,title:"UFC 304: Edwards vs. Muhammad 2",date:"2025-07-27",fighters:"Edwards vs. Muhammad",imageSlug:"fighters-staredown",altText:"Two fighters facing off intensely before a match",link:"/ufc304"},{id:4,title:"UFC Fight Night: Sandhagen vs. Nurmagomedov",date:"2025-08-03",fighters:"Sandhagen vs. Nurmagomedov",imageSlug:"fighter-celebrating-victory",altText:"A victorious fighter celebrating in the octagon",link:"/ufcsandhagennurmagomedov"}],dm=()=>e.jsxs("section",{className:"py-16 px-4 bg-gradient-to-b from-black via-gray-950 to-black",children:[" ",e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center text-white",children:[e.jsx(mc,{className:"mr-3 text-red-500"})," ","Próximos Eventos"]}),e.jsx(ac,{variant:"link",className:"text-red-400 hover:text-red-300",asChild:!0,children:e.jsx(J,{to:"/events",children:"Ver Todos →"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:cm.slice(0,3).map(((t,s)=>e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s},className:"bg-black/60 rounded-lg overflow-hidden card-hover border border-gray-800 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[" ",e.jsx("img",{className:"w-full h-full object-cover",alt:t.altText,src:"https://images.unsplash.com/photo-1649190800807-6f1d42a4bc05"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h4",{className:"text-lg font-bold text-white shadow-text",children:t.title})})]}),e.jsxs("div",{className:"p-4",children:[" ",e.jsxs("div",{className:"flex items-center text-sm text-gray-400 mb-2",children:[e.jsx(mc,{className:"w-4 h-4 mr-2 text-red-500"}),new Date(t.date).toLocaleDateString("es-ES",{month:"short",day:"numeric"})]}),e.jsxs("p",{className:"text-gray-300 mb-3 text-sm flex items-center",children:[e.jsx(Jc,{className:"w-4 h-4 mr-2 text-red-500"})," ",t.fighters]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(ac,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 hover:bg-red-900/30",asChild:!0,children:e.jsxs(J,{to:t.link,children:[" ","Ver Detalles"]})})})]})]},t.id)))})]})]}),hm=()=>e.jsxs(nl.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"bg-black text-white",children:[e.jsx(lm,{}),e.jsx(dm,{})]}),um=X.forwardRef((({className:t,type:s,...i},r)=>e.jsx("input",{type:s,className:tc("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})));um.displayName="Input";const fm=rc("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),mm=X.forwardRef((({className:t,...s},i)=>e.jsx(S,{ref:i,className:tc(fm(),t),...s})));mm.displayName=S.displayName;const gm=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})));gm.displayName="Card";const pm=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("flex flex-col space-y-1.5 p-6",t),...s})));pm.displayName="CardHeader";const vm=X.forwardRef((({className:t,...s},i)=>e.jsx("h3",{ref:i,className:tc("text-2xl font-semibold leading-none tracking-tight",t),...s})));vm.displayName="CardTitle";const ym=X.forwardRef((({className:t,...s},i)=>e.jsx("p",{ref:i,className:tc("text-sm text-muted-foreground",t),...s})));ym.displayName="CardDescription";const bm=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("p-6 pt-0",t),...s})));bm.displayName="CardContent";const xm=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:tc("flex items-center p-6 pt-0",t),...s})));xm.displayName="CardFooter";const Em=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(!1),[n,a]=z.useState({correo:"","contraseña":""}),[o,l]=z.useState(""),c=ee(),d=e=>{a({...n,[e.target.name]:e.target.value})};return e.jsxs(gm,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(pm,{className:"space-y-3",children:[e.jsx(vm,{className:"text-3xl font-black text-red-600 tracking-wider",children:"INICIAR SESIÓN"}),e.jsx(ym,{className:"text-gray-400 text-base",children:"Ingresa tus credenciales para acceder a tu cuenta"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l(""),r(!0);try{const{data:e,error:t}=await Hf.auth.signInWithPassword({email:n.correo,password:n.contraseña});if(t)throw new Error(t.message);localStorage.setItem("user",JSON.stringify(e.user)),localStorage.setItem("access_token",e.session?.access_token||""),window.dispatchEvent(new Event("storage")),c("/")}catch(t){l(t.message)}finally{r(!1)}},children:[o&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:o})}),e.jsxs(bm,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"correo",className:"text-sm font-medium text-gray-300",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ic,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"correo",name:"correo",type:"email",placeholder:"tu@email.com",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:n.correo,onChange:d})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"contraseña",className:"text-sm font-medium text-gray-300",children:"Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"contraseña",name:"contraseña",type:t?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:n.contraseña,onChange:d}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t?e.jsx(wc,{className:"h-5 w-5"}):e.jsx(kc,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"remember",className:"rounded border-gray-700 bg-gray-900/50 text-red-600 focus:ring-red-600"}),e.jsx("label",{htmlFor:"remember",className:"text-gray-400",children:"Recordarme"})]}),e.jsx(J,{to:"/forgot-password",className:"text-red-500 hover:text-red-400 hover:underline",children:"¿Olvidaste tu contraseña?"})]})]}),e.jsxs(xm,{className:"flex flex-col space-y-4",children:[e.jsx(ac,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200",disabled:i,children:i?"Iniciando sesión...":"Iniciar Sesión"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-black/80 px-2 text-gray-400",children:"O continúa con"})})]}),e.jsxs(ac,{type:"button",onClick:async()=>{r(!0);try{await new Promise((e=>setTimeout(e,1e3))),c("/")}catch(e){}finally{r(!1)}},className:"w-full bg-white hover:bg-gray-100 text-gray-900 font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2",disabled:i,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{children:"Continuar con Google"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["¿No tienes cuenta?"," ",e.jsx(J,{to:"/register",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:"Regístrate aquí"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Al iniciar sesión, aceptas nuestros"," ",e.jsx(J,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:"Términos y Condiciones"})]})]})]})]})]})},Tm=()=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(nl.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(oc,{className:"h-72 w-auto mx-auto"})}),e.jsxs(nl.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:["Bienvenido a"," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(nl.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:"Tu plataforma definitiva para el mundo del MMA"})]}),e.jsx(nl.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(Em,{})})]})})]}),Sm=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(!1),[n,a]=z.useState(!1),[o,l]=z.useState({nombre_usuario:"",correo:"","contraseña":"","confirmar_contraseña":""}),[c,d]=z.useState(""),h=ee(),u=e=>{l({...o,[e.target.name]:e.target.value})};return e.jsxs(gm,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(pm,{className:"space-y-3",children:[e.jsx(vm,{className:"text-3xl font-black text-red-600 tracking-wider",children:"CREAR CUENTA"}),e.jsx(ym,{className:"text-gray-400 text-base",children:"Completa tus datos para unirte a la comunidad"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d(""),o.contraseña===o.confirmar_contraseña){a(!0);try{const{data:e,error:t}=await Hf.auth.signUp({email:o.correo,password:o.contraseña,options:{data:{nombre_usuario:o.nombre_usuario}}});if(t)throw new Error(t.message);const{user:s}=e,{error:i}=await Hf.from("usuario").insert([{nombre_usuario:o.nombre_usuario,correo:o.correo,fecha_registro:(new Date).toISOString(),puntos:0,rango:"Novato",avatar:null,notificaciones:!0,tema:"dark","contraseña":"",saldo:0}]);if(i)throw new Error(i.message);h("/login")}catch(t){d(t.message)}finally{a(!1)}}else d("Las contraseñas no coinciden")},children:[e.jsxs(bm,{className:"space-y-4",children:[c&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:c})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"nombre_usuario",className:"text-sm font-medium text-gray-300",children:"Nombre de Usuario"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"nombre_usuario",name:"nombre_usuario",placeholder:"TuUsuario",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:o.nombre_usuario,onChange:u})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"correo",className:"text-sm font-medium text-gray-300",children:"Correo Electrónico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ic,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"correo",name:"correo",type:"email",placeholder:"tu@email.com",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600",value:o.correo,onChange:u})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"contraseña",className:"text-sm font-medium text-gray-300",children:"Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"contraseña",name:"contraseña",type:t?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10",value:o.contraseña,onChange:u}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t?e.jsx(wc,{className:"h-5 w-5"}):e.jsx(kc,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{htmlFor:"confirmar_contraseña",className:"text-sm font-medium text-gray-300",children:"Confirmar Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(um,{id:"confirmar_contraseña",name:"confirmar_contraseña",type:i?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10",value:o.confirmar_contraseña,onChange:u}),e.jsx("button",{type:"button",onClick:()=>r(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:i?e.jsx(wc,{className:"h-5 w-5"}):e.jsx(kc,{className:"h-5 w-5"})})]})]})]}),e.jsxs(xm,{className:"flex flex-col space-y-4",children:[e.jsx(ac,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200",disabled:n,children:n?"Registrando...":"Registrarse"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["¿Ya tienes cuenta?"," ",e.jsx(J,{to:"/login",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:"Inicia sesión aquí"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Al registrarte, aceptas nuestros"," ",e.jsx(J,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:"Términos y Condiciones"})]})]})]})]})]})},wm=()=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(nl.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(oc,{className:"h-72 w-auto mx-auto"})}),e.jsxs(nl.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:["Únete a la Comunidad"," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(nl.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:"Crea tu cuenta y empieza a predecir resultados de MMA"})]}),e.jsx(nl.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(Sm,{})})]})})]}),km=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:i,className:tc("w-full caption-bottom text-sm",t),...s})})));km.displayName="Table";const Am=X.forwardRef((({className:t,...s},i)=>e.jsx("thead",{ref:i,className:tc("[&_tr]:border-b",t),...s})));Am.displayName="TableHeader";const Lm=X.forwardRef((({className:t,...s},i)=>e.jsx("tbody",{ref:i,className:tc("[&_tr:last-child]:border-0",t),...s})));Lm.displayName="TableBody";X.forwardRef((({className:t,...s},i)=>e.jsx("tfoot",{ref:i,className:tc("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}))).displayName="TableFooter";const Rm=X.forwardRef((({className:t,...s},i)=>e.jsx("tr",{ref:i,className:tc("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s})));Rm.displayName="TableRow";const _m=X.forwardRef((({className:t,...s},i)=>e.jsx("th",{ref:i,className:tc("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s})));_m.displayName="TableHead";const Im=X.forwardRef((({className:t,...s},i)=>e.jsx("td",{ref:i,className:tc("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s})));Im.displayName="TableCell";X.forwardRef((({className:t,...s},i)=>e.jsx("caption",{ref:i,className:tc("mt-4 text-sm text-muted-foreground",t),...s}))).displayName="TableCaption";const Pm=[{rank:1,user:"MMA_Master",points:15200,streak:5},{rank:2,user:"StrikerSupreme",points:14850,streak:3},{rank:3,user:"GrappleGod",points:14500,streak:0},{rank:4,user:"NostradamusUFC",points:13900,streak:8},{rank:5,user:"KOPredictor",points:13550,streak:2},{rank:6,user:"You",points:12500,streak:1},{rank:7,user:"CageWizard",points:12100,streak:0},{rank:8,user:"FightFanatic",points:11800,streak:4},{rank:9,user:"SubmissionSavvy",points:11500,streak:0},{rank:10,user:"OctagonOracle",points:11200,streak:6}],Cm=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-4xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(zc,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Ranking Global de Predicciones"]}),e.jsx("div",{className:"bg-black/70 rounded-lg border border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:e.jsxs(km,{children:[e.jsx(Am,{children:e.jsxs(Rm,{className:"border-gray-700 hover:bg-gray-800/50",children:[e.jsx(_m,{className:"w-[80px] text-center font-bold text-red-500",children:"Rank"}),e.jsx(_m,{className:"font-bold text-red-500",children:"Usuario"}),e.jsx(_m,{className:"text-right font-bold text-red-500",children:"Puntos"}),e.jsxs(_m,{className:"text-center font-bold text-red-500",children:["Racha ",e.jsx(Vc,{className:"inline w-4 h-4 mb-1 ml-1 text-yellow-400"})]})]})}),e.jsx(Lm,{children:Pm.map((t=>e.jsxs(Rm,{className:"border-gray-800 hover:bg-gray-700/50 transition-colors "+("You"===t.user?"bg-red-900/30 font-bold text-yellow-300":""),children:[e.jsx(Im,{className:"text-center font-medium",children:t.rank}),e.jsx(Im,{children:t.user}),e.jsx(Im,{className:"text-right",children:t.points.toLocaleString()}),e.jsx(Im,{className:"text-center",children:t.streak>0?`${t.streak} 🔥`:"-"})]},t.rank)))})]})}),e.jsx("p",{className:"text-center text-gray-500 mt-6 text-sm",children:"El ranking se actualiza después de cada evento principal. ¡Sigue prediciendo!"})]})}),Dm=X.forwardRef((({className:t,...s},i)=>e.jsx(w,{className:tc("grid gap-2",t),...s,ref:i})));Dm.displayName=w.displayName;const Nm=X.forwardRef((({className:t,...s},i)=>e.jsx(k,{ref:i,className:tc("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(A,{className:"flex items-center justify-center",children:e.jsx(xc,{className:"h-2.5 w-2.5 fill-current text-current"})})})));Nm.displayName=k.displayName;const Mm=U,Om=B,jm=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(L,{ref:r,className:tc("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[s,e.jsx(R,{asChild:!0,children:e.jsx(pc,{className:"h-4 w-4 opacity-50"})})]})));jm.displayName=L.displayName;const Fm=X.forwardRef((({className:t,...s},i)=>e.jsx(_,{ref:i,className:tc("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(vc,{className:"h-4 w-4"})})));Fm.displayName=_.displayName;const Um=X.forwardRef((({className:t,...s},i)=>e.jsx(I,{ref:i,className:tc("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(pc,{className:"h-4 w-4"})})));Um.displayName=I.displayName;const Bm=X.forwardRef((({className:t,children:s,position:i="popper",...r},n)=>e.jsx(P,{children:e.jsxs(C,{ref:n,className:tc("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[e.jsx(Fm,{}),e.jsx(D,{className:tc("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Um,{})]})})));Bm.displayName=C.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(N,{ref:i,className:tc("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}))).displayName=N.displayName;const $m=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(M,{ref:r,className:tc("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(O,{children:e.jsx(gc,{className:"h-4 w-4"})})}),e.jsx(j,{children:s})]})));$m.displayName=M.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(F,{ref:i,className:tc("-mx-1 my-1 h-px bg-muted",t),...s}))).displayName=F.displayName;const Gm=X.forwardRef((({className:t,...s},i)=>e.jsxs($,{ref:i,className:tc("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(G,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(V,{className:"absolute h-full bg-primary"})}),e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}),Array.isArray(s.value)&&s.value.length>1&&e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})));Gm.displayName=$.displayName;const Vm=()=>{const[t,s]=z.useState(null),[i,r]=z.useState(!1),[n,a]=z.useState("dark"),[o,l]=z.useState("public"),[c,d]=z.useState(!1),[h,u]=z.useState(""),[f,m]=z.useState("");z.useEffect((()=>{(async()=>{const e=JSON.parse(localStorage.getItem("user"));if(!e)return;const{data:t,error:i}=await Hf.from("usuario").select("*").eq("correo",e.email).single();t&&(s(t),r(t.notificaciones),a(t.tema),u(t.nombre_usuario),m(t.correo))})()}),[]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx(nl.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(gm,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsxs(pm,{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("img",{className:"w-32 h-32 rounded-full mx-auto border-4 border-red-600 object-cover",alt:"User Avatar",src:t?.avatar||"/pain.png"}),e.jsx(ac,{variant:"ghost",size:"icon",className:"absolute bottom-0 right-0 bg-gray-700/80 rounded-full hover:bg-red-600",children:e.jsx(Gc,{className:"w-4 h-4"})})]}),e.jsx(vm,{className:"text-3xl font-black uppercase tracking-wider text-red-500",children:t?.nombre_usuario||"Usuario"}),e.jsxs(ym,{className:"text-gray-300",children:["Miembro desde ",t?new Date(t.fecha_registro).toLocaleDateString():"-"]})]}),e.jsxs(bm,{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(Xc,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Nombre de Usuario"}),c?e.jsx(um,{className:"font-semibold text-white bg-gray-800 border-gray-700",value:h,onChange:e=>u(e.target.value)}):e.jsx("p",{className:"font-semibold text-white",children:t?.nombre_usuario})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(Ic,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Correo Electrónico"}),c?e.jsx(um,{className:"font-semibold text-white bg-gray-800 border-gray-700",value:f,onChange:e=>m(e.target.value)}):e.jsx("p",{className:"font-semibold text-white",children:t?.correo})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(dc,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Puntos Totales"}),e.jsx("p",{className:"font-semibold text-xl text-white",children:t?.puntos??0})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(zc,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Ranking"}),e.jsx("p",{className:"font-semibold text-xl text-white",children:t?.rango??"-"})]})]})]})]}),e.jsx(xm,{className:"flex justify-between",children:e.jsx(ac,{className:"bg-red-600 hover:bg-red-700 font-bold uppercase tracking-wider",onClick:()=>{d(!c),c||(u(t?.nombre_usuario||""),m(t?.correo||""))},children:c?"Guardar Cambios":"Editar Perfil"})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(gm,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsx(pm,{children:e.jsxs(vm,{className:"text-xl flex items-center gap-2 text-white",children:[e.jsx(fc,{className:"w-5 h-5 text-red-500"}),"Notificaciones"]})}),e.jsxs(bm,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(mm,{className:"text-gray-300",children:"Notificaciones Push"}),e.jsx(Gm,{defaultValue:[50],max:100,step:1,className:"w-[60%]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(mm,{className:"text-gray-300",children:"Correos Electrónicos"}),e.jsx(Gm,{defaultValue:[75],max:100,step:1,className:"w-[60%]"})]})]})]}),e.jsxs(gm,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsx(pm,{children:e.jsxs(vm,{className:"text-xl flex items-center gap-2 text-white",children:[e.jsx($c,{className:"w-5 h-5 text-red-500"}),"Seguridad"]})}),e.jsxs(bm,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(mm,{className:"text-gray-300",children:"Cambiar Contraseña"}),e.jsx(um,{type:"password",placeholder:"Nueva contraseña",className:"bg-gray-900/50 border-gray-700"})]}),e.jsx(ac,{variant:"outline",className:"w-full",children:"Actualizar Contraseña"})]})]})]})]})})})},Km=[{id:"jones",name:"Jon Jones",image:"https://images.unsplash.com/photo-1545191488-2682adc1dfe4",stats:{strikesLanded:12.5,accuracy:55,takedowns:2.8,defense:95,avgFightTime:18.2}},{id:"khabib",name:"Khabib Nurmagomedov",image:"https://images.unsplash.com/photo-1656968385791-eff0b664d0ba",stats:{strikesLanded:4.1,accuracy:48,takedowns:5.3,defense:65,avgFightTime:14.5}},{id:"mcgregor",name:"Conor McGregor",image:"https://images.unsplash.com/photo-1680022702604-292f21514497",stats:{strikesLanded:5.3,accuracy:50,takedowns:.7,defense:55,avgFightTime:8.1}},{id:"adesanya",name:"Israel Adesanya",image:"https://images.unsplash.com/photo-1692264895705-27017e9cf1be",stats:{strikesLanded:3.9,accuracy:49,takedowns:0,defense:85,avgFightTime:17.8}}],Hm=({icon:t,label:s,value:i,unit:r="",highlight:n="none"})=>{const a="better"===n?"text-green-400":"worse"===n?"text-red-500":"text-white",o="better"===n?Yc:"worse"===n?Wc:Dc;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded mb-2 border-l-4 border-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{className:"w-5 h-5 mr-3 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:s})]}),e.jsxs("div",{className:`flex items-center font-semibold ${a}`,children:[e.jsx(o,{className:"w-4 h-4 mr-1 "+("none"===n?"opacity-0":"")}),i," ",r]})]})},qm=()=>{const[t,s]=z.useState(Km[0]),[i,r]=z.useState(Km[1]),n=(e,t)=>{const i=Km.find((t=>t.id===e));1===t?s(i):r(i)},a=e=>t&&i?t.stats[e]>i.stats[e]?"better":t.stats[e]<i.stats[e]?"worse":"none":"none",o=e=>t&&i?t.stats[e]<i.stats[e]?"better":t.stats[e]>i.stats[e]?"worse":"none":"none";return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(nl.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"container mx-auto max-w-5xl",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider",children:"Comparador de Peleadores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-6 md:gap-10 items-start",children:[e.jsx("div",{children:e.jsxs(gm,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(pm,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:void 0!==Mm?e.jsxs(Mm,{onValueChange:e=>n(e,1),value:t?.id,children:[e.jsx(jm,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(Om,{placeholder:"Seleccionar Peleador 1"})}),e.jsx(Bm,{className:"bg-black border-gray-700 text-white",children:Km.map((t=>e.jsx($m,{value:t.id,disabled:t.id===i?.id,children:t.name},t.id)))})]},t?.id):e.jsx("p",{className:"text-center text-gray-400",children:"Componente Select no encontrado"})}),e.jsx(bm,{className:"p-4 text-center",children:t&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-48 h-48 mx-auto mb-4 object-cover"})," ",e.jsx("h3",{className:"text-2xl font-bold mb-4",children:t.name}),e.jsx(Hm,{icon:uc,label:"Golpes / min",value:t.stats.strikesLanded.toFixed(1),highlight:a("strikesLanded")}),e.jsx(Hm,{icon:Kc,label:"Precisión (%)",value:t.stats.accuracy,unit:"%",highlight:a("accuracy")}),e.jsx(Hm,{icon:Zc,label:"Derribos / 15min",value:t.stats.takedowns.toFixed(1),highlight:a("takedowns")}),e.jsx(Hm,{icon:$c,label:"Defensa (%)",value:t.stats.defense,unit:"%",highlight:a("defense")}),e.jsx(Hm,{icon:Ec,label:"Tiempo Medio Pelea",value:t.stats.avgFightTime.toFixed(1),unit:"min",highlight:o("avgFightTime")})]})})]})}),e.jsx("div",{className:"hidden md:flex items-center justify-center h-full pt-24",children:e.jsx(am,{})}),e.jsx("div",{children:e.jsxs(gm,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(pm,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:void 0!==Mm?e.jsxs(Mm,{onValueChange:e=>n(e,2),value:i?.id,children:[e.jsx(jm,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(Om,{placeholder:"Seleccionar Peleador 2"})}),e.jsx(Bm,{className:"bg-black border-gray-700 text-white",children:Km.map((s=>e.jsx($m,{value:s.id,disabled:s.id===t?.id,children:s.name},s.id)))})]},i?.id):e.jsx("p",{className:"text-center text-gray-400",children:"Componente Select no encontrado"})}),e.jsx(bm,{className:"p-4 text-center",children:i&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.image,alt:i.name,className:"w-48 h-48 mx-auto mb-4 object-cover"})," ",e.jsx("h3",{className:"text-2xl font-bold mb-4",children:i.name}),e.jsx(Hm,{icon:uc,label:"Golpes / min",value:i.stats.strikesLanded.toFixed(1),highlight:"better"===a("strikesLanded")?"worse":"worse"===a("strikesLanded")?"better":"none"}),e.jsx(Hm,{icon:Kc,label:"Precisión (%)",value:i.stats.accuracy,unit:"%",highlight:"better"===a("accuracy")?"worse":"worse"===a("accuracy")?"better":"none"}),e.jsx(Hm,{icon:Zc,label:"Derribos / 15min",value:i.stats.takedowns.toFixed(1),highlight:"better"===a("takedowns")?"worse":"worse"===a("takedowns")?"better":"none"}),e.jsx(Hm,{icon:$c,label:"Defensa (%)",value:i.stats.defense,unit:"%",highlight:"better"===a("defense")?"worse":"worse"===a("defense")?"better":"none"}),e.jsx(Hm,{icon:Ec,label:"Tiempo Medio Pelea",value:i.stats.avgFightTime.toFixed(1),unit:"min",highlight:"better"===o("avgFightTime")?"worse":"worse"===o("avgFightTime")?"better":"none"})]})})]})})]})]})})},Wm=rc("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ym({className:t,variant:s,...i}){return e.jsx("div",{className:tc(Wm({variant:s}),t),...i})}const zm=({peleador:t,visible:s,position:i={top:0,left:0}})=>t&&s?e.jsx("div",{className:"fixed z-50 bg-gray-900 rounded-lg shadow-lg p-4 w-72 border-2 border-red-500",style:{top:i.top,left:i.left,transition:"opacity 0.2s",pointerEvents:"none"},children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:t.foto,alt:t.nombre,className:"w-24 h-24 rounded-full object-cover border-4 border-red-500 mb-2"}),e.jsx("h2",{className:"text-xl font-bold mb-1 text-yellow-400 text-center",children:t.nombre}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:"División:"})," ",t.division]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:"País:"})," ",t.pais]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:"Récord:"})," ",t.record]}),e.jsxs("p",{className:"mb-1 text-center",children:[e.jsx("b",{children:"Status:"})," ",t.status]}),e.jsx("p",{className:"mt-2 text-sm text-gray-300 italic text-center",children:t.datoExtra})]})}):null,Xm=[{rank:1,name:"Jon Jones",division:"Peso Pesado",record:"27-1-0 (1 NC)",points:2850,status:"Campeón",pais:"Estados Unidos",foto:"https://static.ufcstats.com/images/athlete/Jon-Jones.png",datoExtra:"Considerado uno de los mejores peleadores libra por libra de la historia."},{rank:2,name:"Islam Makhachev",division:"Peso Ligero",record:"25-1-0",points:2780,status:"Campeón",pais:"Rusia",foto:"https://static.ufcstats.com/images/athlete/Islam-Makhachev.png",datoExtra:"Discípulo de Khabib Nurmagomedov, gran dominio en lucha y sumisiones."},{rank:3,name:"Alexander Volkanovski",division:"Peso Pluma",record:"26-4-0",points:2750,status:"Top Contender",pais:"Australia",foto:"https://static.ufcstats.com/images/athlete/Alexander-Volkanovski.png",datoExtra:"Exjugador de rugby, famoso por su cardio y presión constante."},{rank:4,name:"Leon Edwards",division:"Peso Wélter",record:"22-3-0 (1 NC)",points:2710,status:"Campeón",pais:"Reino Unido",foto:"https://static.ufcstats.com/images/athlete/Leon-Edwards.png",datoExtra:"Conocido por su striking técnico y defensa sólida."},{rank:5,name:"Alex Pereira",division:"Peso Semipesado",record:"10-2-0",points:2690,status:"Campeón",pais:"Brasil",foto:"https://static.ufcstats.com/images/athlete/Alex-Pereira.png",datoExtra:"Excampeón de kickboxing, famoso por su poder de nocaut."},{rank:6,name:"Ilia Topuria",division:"Peso Pluma",record:"15-0-0",points:2650,status:"Campeón",pais:"España / Georgia",foto:"https://static.ufcstats.com/images/athlete/Ilia-Topuria.png",datoExtra:"Invicto, gran pegada y jiu-jitsu de alto nivel."},{rank:7,name:"Sean O'Malley",division:"Peso Gallo",record:"18-1-0 (1 NC)",points:2620,status:"Campeón",pais:"Estados Unidos",foto:"https://static.ufcstats.com/images/athlete/Sean-OMalley.png",datoExtra:"Estilo único y creativo, gran precisión en el golpeo."},{rank:8,name:"Charles Oliveira",division:"Peso Ligero",record:"34-10-0 (1 NC)",points:2600,status:"Top Contender",pais:"Brasil",foto:"https://static.ufcstats.com/images/athlete/Charles-Oliveira.png",datoExtra:"Récord de finalizaciones en UFC, experto en sumisiones."},{rank:9,name:"Dricus du Plessis",division:"Peso Mediano",record:"21-2-0",points:2580,status:"Campeón",pais:"Sudáfrica",foto:"https://static.ufcstats.com/images/athlete/Dricus-DuPlessis.png",datoExtra:"Gran resistencia y agresividad en el octágono."},{rank:10,name:"Alexandre Pantoja",division:"Peso Mosca",record:"27-5-0",points:2550,status:"Campeón",pais:"Brasil",foto:"https://static.ufcstats.com/images/athlete/Alexandre-Pantoja.png",datoExtra:"Especialista en grappling y sumisiones rápidas."}],Jm=e=>{switch(e){case"Campeón":return"destructive";case"Top Contender":return"secondary";default:return"outline"}},Qm={top:40,left:40},Zm=()=>{const[t,s]=X.useState(null),[i,r]=X.useState(null),[n,a]=X.useState({top:0,left:0}),[o,l]=X.useState(!1);X.useEffect((()=>{if(!o)return;const e=e=>{e.target.closest(".hovercard-peleador")||e.target.closest(".peleador-nombre")||(l(!1),r(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[o]);const c=(e,t)=>{r(e),l(!0)},d=()=>{r(null),l(!1)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:[e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Lc,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Ranking Oficial de Peleadores (P4P)"]}),e.jsx("div",{className:"bg-black/70 rounded-lg border border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:void 0!==km&&void 0!==Ym?e.jsxs(km,{children:[e.jsx(Am,{children:e.jsxs(Rm,{className:"border-gray-700 hover:bg-gray-800/50",children:[e.jsx(_m,{className:"w-[80px] text-center font-bold text-red-500",children:"Rank"}),e.jsx(_m,{className:"font-bold text-red-500",children:"Nombre"}),e.jsx(_m,{className:"font-bold text-red-500 hidden md:table-cell",children:"División"}),e.jsx(_m,{className:"font-bold text-red-500 hidden lg:table-cell",children:"Récord"}),e.jsx(_m,{className:"text-center font-bold text-red-500",children:"Status"}),e.jsxs(_m,{className:"text-right font-bold text-red-500",children:["Puntos ",e.jsx(Vc,{className:"inline w-4 h-4 mb-1 ml-1 text-yellow-400"})]})]})}),e.jsx(Lm,{children:Xm.map((t=>e.jsxs(Rm,{className:"border-gray-800 hover:bg-gray-700/50 transition-colors cursor-pointer",children:[e.jsx(Im,{className:"text-center font-medium",children:t.rank}),e.jsx(Im,{className:"font-semibold relative peleador-nombre",onMouseEnter:e=>c(t),onMouseMove:e=>c(t),onMouseLeave:d,onClick:()=>(e=>{r(e),l(!0)})(t),tabIndex:0,style:{outline:"none"},children:t.name}),e.jsx(Im,{className:"hidden md:table-cell text-gray-400",children:t.division}),e.jsx(Im,{className:"hidden lg:table-cell text-gray-400",children:t.record}),e.jsx(Im,{className:"text-center",children:e.jsxs(Ym,{variant:Jm(t.status),className:"uppercase text-xs px-2 py-0.5",children:["Campeón"===t.status&&e.jsx(Bc,{className:"w-3 h-3 mr-1 inline"}),t.status]})}),e.jsx(Im,{className:"text-right font-bold text-yellow-300",children:t.points.toLocaleString()})]},t.rank)))})]}):e.jsx("p",{className:"p-6 text-center text-gray-400",children:"Componentes de Tabla o Badge no encontrados. Por favor, créalos si no existen."})}),e.jsx("p",{className:"text-center text-gray-500 mt-6 text-sm",children:"Ranking Libra por Libra (P4P) basado en el rendimiento y dominio divisional."})]}),e.jsx(zm,{peleador:t,onClose:()=>s(null)}),e.jsx(zm,{peleador:i,visible:o&&!!i,position:Qm,className:"hovercard-peleador"})]})},eg=[{id:1,title:"UFC 303: McGregor vs. Chandler",date:"2025-06-29",location:"Las Vegas, NV",mainEvent:"Conor McGregor vs. Michael Chandler",coMainEvent:"Jamahal Hill vs. Khalil Rountree Jr.",venue:"T-Mobile Arena",imageSlug:"arena-lights-crowd",altText:"Brightly lit arena packed with spectators for a UFC event"},{id:2,title:"UFC Fight Night: Namajunas vs. Barber",date:"2025-07-13",location:"Denver, CO",mainEvent:"Rose Namajunas vs. Maycee Barber",coMainEvent:"TBD",venue:"Ball Arena",imageSlug:"octagon-side-view",altText:"Side view of the UFC octagon during a fight"},{id:3,title:"UFC 304: Edwards vs. Muhammad 2",date:"2025-07-27",location:"Manchester, England",mainEvent:"Leon Edwards vs. Belal Muhammad",coMainEvent:"Tom Aspinall vs. Curtis Blaydes",venue:"Co-op Live",imageSlug:"fighters-staredown",altText:"Two fighters facing off intensely before a match"},{id:4,title:"UFC Fight Night: Sandhagen vs. Nurmagomedov",date:"2025-08-03",location:"Abu Dhabi, UAE",mainEvent:"Cory Sandhagen vs. Umar Nurmagomedov",coMainEvent:"TBD",venue:"Etihad Arena",imageSlug:"fighter-celebrating-victory",altText:"A victorious fighter celebrating in the octagon"}],tg=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-10 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(mc,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Próximos Eventos"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8",children:eg.map(((t,s)=>e.jsx(nl.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1*s},children:e.jsxs(gm,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col card-hover",children:[e.jsxs("div",{className:"relative h-48 md:h-56",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:t.altText,src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"}),e.jsx("div",{className:"absolute bottom-4 left-4",children:e.jsx("h2",{className:"text-2xl font-bold text-white shadow-text",children:t.title})})]}),e.jsxs(bm,{className:"p-6 flex-grow flex flex-col",children:[e.jsxs("div",{className:"space-y-3 text-gray-300 mb-5 flex-grow",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(mc,{className:"w-4 h-4 mr-2 text-red-500"})," ",new Date(t.date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx(Pc,{className:"w-4 h-4 mr-2 text-red-500"})," ",t.location," (",t.venue,")"]}),e.jsxs("p",{className:"flex items-start",children:[e.jsx(Jc,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"})," ",e.jsx("span",{className:"font-semibold",children:"Pelea Principal:"})," ",t.mainEvent]}),"TBD"!==t.coMainEvent&&e.jsxs("p",{className:"flex items-start",children:[e.jsx(Jc,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"})," ",e.jsx("span",{className:"font-semibold",children:"Co-Estelar:"})," ",t.coMainEvent]})]}),e.jsx("div",{className:"mt-auto flex justify-end",children:"UFC 303: McGregor vs. Chandler"===t.title||"UFC Fight Night: Namajunas vs. Barber"===t.title||"UFC 304: Edwards vs. Muhammad 2"===t.title||"UFC Fight Night: Sandhagen vs. Nurmagomedov"===t.title?e.jsx(ac,{className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsxs("a",{href:"UFC 303: McGregor vs. Chandler"===t.title?"/ufc303":"UFC Fight Night: Namajunas vs. Barber"===t.title?"/ufcnamajunasbarber":"UFC 304: Edwards vs. Muhammad 2"===t.title?"/ufc304":"/ufcsandhagennurmagomedov",children:[e.jsx(Hc,{className:"w-4 h-4 mr-2"}),"Ver Detalles / Comprar"]})}):e.jsxs(ac,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Hc,{className:"w-4 h-4 mr-2"}),"Ver Detalles / Comprar"]})})]})]})},t.id)))})]})}),sg=[{id:1,title:"KO Épico: McGregor vs. Aldo",fighters:"McGregor, Aldo",views:"1.2M",imageSlug:"fighter-knockout-punch",altText:"Fighter landing a knockout punch in the octagon"},{id:2,title:"Sumisión Increíble: Nurmagomedov",fighters:"Nurmagomedov",views:"980K",imageSlug:"fighter-submission-hold",altText:"Fighter applying a submission hold on the mat"},{id:3,title:"Guerra Total: Jones vs. Gustafsson I",fighters:"Jones, Gustafsson",views:"850K",imageSlug:"two-fighters-exchanging-blows",altText:"Two fighters intensely exchanging blows during a match"},{id:4,title:"Patada Voladora Sorpresa",fighters:"Pettis",views:"760K",imageSlug:"fighter-executing-flying-kick",altText:"Fighter executing a spectacular flying kick"},{id:5,title:"Remontada Histórica",fighters:"Silva",views:"690K",imageSlug:"fighter-celebrating-comeback-victory",altText:"Fighter celebrating an unlikely comeback victory"},{id:6,title:"Noche de Nocauts",fighters:"Varios",views:"550K",imageSlug:"multiple-fighters-highlight-reel",altText:"Montage of various fighters during exciting moments"}],ig=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-10 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Vc,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Clips Destacados"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:sg.map(((t,s)=>e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*s},className:"card-hover",children:e.jsxs(gm,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col",children:[e.jsxs("div",{className:"relative group aspect-video",children:[e.jsx("img",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",alt:t.altText,src:"https://images.unsplash.com/photo-1675023112817-52b789fd2ef0"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(Nc,{className:"w-16 h-16 text-white/80 drop-shadow-lg"})}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h3",{className:"text-lg font-bold text-white shadow-text",children:t.title})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(kc,{className:"w-3 h-3 mr-1 text-red-500"})," ",t.views]})]}),e.jsxs(bm,{className:"p-4 flex-grow flex flex-col",children:[e.jsxs("p",{className:"text-sm text-gray-400 mb-3 flex-grow",children:["Peleadores: ",t.fighters]}),e.jsx(ac,{variant:"outline",className:"w-full border-red-600 text-red-500 hover:bg-red-600 hover:text-white mt-auto",children:"Ver Clip"})]})]})},t.id)))})]})}),rg=X.forwardRef((({className:t,...s},i)=>e.jsx("textarea",{className:tc("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:i,...s})));rg.displayName="Textarea";const ng=({threadId:t})=>{const s=ee();return e.jsx("button",{onClick:e=>{e.stopPropagation(),s(`/thread/${t}`)},className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"45 respuestas"})},ag=[{id:1,name:"Discusión General",description:"Habla de todo sobre UFC",icon:Cc},{id:2,name:"Predicciones y Apuestas",description:"Comparte tus pronósticos",icon:Yc},{id:3,name:"Noticias y Rumores",description:"Últimas novedades del octágono",icon:Oc},{id:4,name:"Peleadores y Divisiones",description:"Análisis por categoría",icon:Jc}],og=[{id:"1",title:"¿Quién gana en UFC 303?",author:"FanUFC_123",replies:45,category:"Predicciones",time:"hace 2 horas"},{id:"2",title:"El legado de Khabib",author:"MMA_Guru",replies:102,category:"General",time:"hace 5 horas"},{id:"3",title:"Posible regreso de GSP",author:"NostalgicFan",replies:30,category:"Rumores",time:"hace 1 día"},{id:"4",title:"Top 5 Peso Pluma Actual",author:"AnalistaX",replies:67,category:"Peleadores",time:"hace 1 día"}],lg=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-6 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Cc,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Foro de la Comunidad"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(um,{type:"text",placeholder:"Buscar en el foro...",className:"pl-10 bg-gray-900/50 border-gray-700 focus:border-red-500 focus:ring-red-500"}),e.jsx(Fc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsxs(ac,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Mc,{className:"w-5 h-5 mr-2"}),"Crear Nuevo Hilo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Categorías"}),ag.map((t=>e.jsx(nl.div,{whileHover:{scale:1.03},transition:{type:"spring",stiffness:300},children:e.jsxs(J,{to:`/category/${t.id}`,children:[" ",e.jsxs(gm,{className:"bg-black/60 border-gray-800 hover:border-red-600/50 transition-colors duration-200 cursor-pointer",children:[e.jsxs(pm,{className:"flex flex-row items-center gap-4 pb-2",children:[e.jsx(t.icon,{className:"w-6 h-6 text-red-500"}),e.jsx(vm,{className:"text-lg text-white",children:t.name})]}),e.jsx(bm,{children:e.jsx(ym,{className:"text-gray-400",children:t.description})})]})]})},t.id)))]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Hilos Recientes"}),e.jsx(gm,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx(bm,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:og.map((t=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(J,{to:`/thread/${t.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["por ",e.jsx("span",{className:"font-medium text-gray-400",children:t.author})," en ",e.jsx("span",{className:"text-red-400",children:t.category})," - ",t.time]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(ng,{threadId:t.id})})]},t.id)))})})})]})]})]})}),cg={id:1,fighter1:"Conor McGregor",fighter2:"Michael Chandler",event:"UFC 303",rounds:5},dg=5e3,hg={winner:1.8,method:2.5,round:3,firstStrike:1.5,firstTakedown:2,willBeKO:1.6,willBeSub:3.5,goToDecision:2.2,mostSignificantStrikes:1.9},ug=["KO/TKO","Submission","Decision"],fg=({predictionKey:t,value:s,onChange:i,fighters:r,label:n,icon:a,iconColor:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(mm,{className:"text-lg font-semibold flex items-center text-gray-200",children:[a&&e.jsx(a,{className:`w-5 h-5 mr-2 ${o||"text-gray-400"}`}),n]}),e.jsxs(Dm,{value:s,onValueChange:e=>i(t,e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nm,{value:r.fighter1,id:`${t}-${r.fighter1}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(mm,{htmlFor:`${t}-${r.fighter1}`,className:"text-gray-300",children:r.fighter1})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nm,{value:r.fighter2,id:`${t}-${r.fighter2}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(mm,{htmlFor:`${t}-${r.fighter2}`,className:"text-gray-300",children:r.fighter2})]})]})]}),mg=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(mm,{className:"text-lg font-semibold text-gray-200",children:"¿Cómo ganarás?"}),e.jsxs(Dm,{value:t,onValueChange:e=>s("method",e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nm,{value:"KO/TKO",id:"method-KO",className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(mm,{htmlFor:"method-KO",className:"text-gray-300",children:"KO/TKO"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nm,{value:"Submission",id:"method-Submission",className:"border-gray-600 text-blue-500 focus:ring-blue-500"}),e.jsx(mm,{htmlFor:"method-Submission",className:"text-gray-300",children:"Sumisión"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nm,{value:"Decision",id:"method-Decision",className:"border-gray-600 text-green-500 focus:ring-green-500"}),e.jsx(mm,{htmlFor:"method-Decision",className:"text-gray-300",children:"Decisión"})]})]})]}),gg=({value:t,onChange:s,maxRounds:i})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(mm,{htmlFor:"round",className:"text-lg font-semibold text-gray-200",children:"¿En qué round terminará?"}),e.jsxs("div",{className:"flex items-center space-x-4 pt-1",children:[e.jsx(Gm,{id:"round",min:1,max:i,step:1,value:t,onValueChange:s,className:"flex-grow [&>span:first-child]:bg-red-600"}),e.jsx("span",{className:"font-bold text-xl text-red-400 w-8 text-center",children:t[0]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"(Solo aplica si no es decisión)"})]}),pg=({betAmount:t,balance:s,potentialWinnings:i,onBetChange:r})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(mm,{htmlFor:"betAmount",className:"text-lg font-semibold flex items-center text-gray-200",children:[e.jsx(Tc,{className:"w-5 h-5 mr-2 text-yellow-500"})," Monto de la Apuesta"]}),e.jsxs("div",{className:"relative",children:[e.jsx(um,{type:"text",id:"betAmount",value:t,onChange:r,placeholder:"0",className:"w-full bg-gray-900/50 border-gray-700 pl-4 pr-24 text-lg text-white",inputMode:"numeric"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-yellow-400 font-bold",children:"Monedas"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm mt-2",children:[e.jsxs("p",{className:"text-gray-400",children:["Saldo: ",e.jsx("span",{className:"font-semibold text-gray-200",children:s.toLocaleString()})," ",e.jsx(Tc,{className:"inline h-3 w-3 ml-0.5 text-yellow-400"})]}),e.jsxs("p",{className:"text-gray-400",children:["Ganancia Potencial: ",e.jsx("span",{className:"font-bold text-green-400",children:i.toLocaleString()})," ",e.jsx(Tc,{className:"inline h-4 w-4 ml-1 text-yellow-400"})]})]})]}),vg=()=>{const[t,s]=z.useState({winner:void 0,method:void 0,round:[Math.ceil(cg.rounds/2)],firstStrike:void 0,firstTakedown:void 0,willBeKO:void 0,willBeSub:void 0,goToDecision:void 0,mostSignificantStrikes:void 0}),[i,r]=z.useState(""),[n,a]=z.useState(0),o=(e,t)=>{const s=Object.values(t).filter((e=>null!==e&&!Array.isArray(e))).length+(t.round?1:0);if(0===s||!e||e<=0)return 0;return(e*(Object.entries(hg).filter((([e])=>null!==t[e]&&void 0!==t[e])).reduce(((e,[,t])=>e+t),0)/s||1)).toFixed(0)},l=(e,t)=>{try{let r=t;"method"!==e||ug.includes(t)||(r=void 0),"round"!==e||Array.isArray(t)&&0!==t.length||(r=[Math.ceil(cg.rounds/2)]),s((t=>{const s={...t,[e]:r},n=parseInt(i,10)||0;return a(o(n,s)),s}))}catch(r){return}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-2xl",children:e.jsxs(gm,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsxs(pm,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(vm,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Predicción y Apuesta"}),e.jsxs(ym,{className:"text-base sm:text-lg text-gray-300 mt-1",children:[cg.event,": ",cg.fighter1," vs. ",cg.fighter2]})]}),e.jsxs(bm,{className:"pt-6 space-y-8",children:[e.jsx(fg,{predictionKey:"winner",value:t.winner,onChange:l,fighters:cg,label:"¿Quién ganará la pelea?",icon:dc,iconColor:"text-yellow-400"}),e.jsx(mg,{value:t.method,onChange:l}),e.jsx(gg,{value:t.round,onChange:e=>{l("round",e)},maxRounds:cg.rounds}),e.jsx("hr",{className:"border-gray-700"}),e.jsx("h3",{className:"text-xl font-semibold text-center text-gray-300 pt-2 mb-6",children:"Predicciones Adicionales"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(fg,{predictionKey:"firstStrike",value:t.firstStrike,onChange:l,fighters:cg,label:"¿Primer golpe significativo?",icon:Kc,iconColor:"text-blue-400"}),e.jsx(fg,{predictionKey:"firstTakedown",value:t.firstTakedown,onChange:l,fighters:cg,label:"¿Primer derribo?",icon:yc,iconColor:"text-green-400"}),e.jsx(fg,{predictionKey:"mostSignificantStrikes",value:t.mostSignificantStrikes,onChange:l,fighters:cg,label:"¿Más golpes significativos?",icon:Jc,iconColor:"text-purple-400"})]}),e.jsx("hr",{className:"border-gray-700 mt-8"}),e.jsx(pg,{betAmount:i,balance:dg,potentialWinnings:n,onBetChange:e=>{const s=e.target.value;if(/^\d*$/.test(s)){const e=parseInt(s,10)||0,i=Math.min(e,dg),n=i>0?i.toString():"";r(n),a(o(i,t))}}})]}),e.jsx(xm,{className:"border-t border-gray-700 pt-6",children:e.jsx(ac,{type:"submit",onClick:e=>{e.preventDefault();const t=parseInt(i,10)||0;t<=0?alert("Por favor, ingresa un monto válido para apostar."):t>dg?alert("No tienes suficientes monedas para esta apuesta."):alert(`Predicciones enviadas con apuesta de ${t} monedas (ver consola)`)},className:"w-full bg-red-600 hover:bg-red-700 text-lg py-3 font-bold uppercase tracking-wider",disabled:!i||parseInt(i,10)<=0,children:"Enviar Predicción y Apuesta"})})]})})})},yg=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},bg=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=xg},xg=Number.MAX_SAFE_INTEGER||9007199254740991;let Eg=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),Tg=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),Sg=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var wg="manifest",kg="level",Ag="audioTrack",Lg="subtitleTrack",Rg="main",_g="audio",Ig="subtitle";class Pg{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Cg{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Pg(e),this.fast_=new Pg(t),this.defaultTTFB_=i,this.ttfb_=new Pg(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Pg(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Pg(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Pg(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Dg(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ng(){return Ng=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},Ng.apply(null,arguments)}function Mg(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function Og(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Mg(Object(s),!0).forEach((function(t){Dg(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Mg(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class jg{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Fg,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Fg=function(){},Ug={trace:Fg,debug:Fg,log:Fg,warn:Fg,info:Fg,error:Fg};function Bg(){return Ng({},Ug)}function $g(e,t,s){return t[e]?t[e].bind(t):function(e,t){const s=self.console[e];return s?s.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):Fg}(e,s)}const Gg=Bg();const Vg=Gg;function Kg(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Hg(e,t){const s=Object.keys(e),i=Object.keys(t),r=s.length,n=i.length;return!r||!n||r===n&&!s.some((e=>-1===i.indexOf(e)))}function qg(e,t=!1){if("undefined"!=typeof TextDecoder){const s=new TextDecoder("utf-8").decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let i,r,n,a="",o=0;for(;o<s;){if(i=e[o++],0===i&&t)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=e[o++],a+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[o++],n=e[o++],a+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&n)}}return a}const Wg=function(e){let t="";for(let s=0;s<e.length;s++){let i=e[s].toString(16);i.length<2&&(i="0"+i),t+=i}return t};function Yg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var zg,Xg={exports:{}};var Jg,Qg,Zg,ep,tp,sp=zg?Xg.exports:(zg=1,Jg=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Qg=/^(?=([^\/?#]*))\1([^]*)$/,Zg=/(?:\/|^)\.(?=\/)/g,ep=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Xg.exports=tp={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var i=tp.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=tp.normalizePath(i.path),tp.buildURLFromParts(i)}var r=tp.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return s.alwaysNormalize?(r.path=tp.normalizePath(r.path),tp.buildURLFromParts(r)):t;var n=tp.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");if(!n.netLoc&&n.path&&"/"!==n.path[0]){var a=Qg.exec(n.path);n.netLoc=a[1],n.path=a[2]}n.netLoc&&!n.path&&(n.path="/");var o={scheme:n.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=n.netLoc,"/"!==r.path[0]))if(r.path){var l=n.path,c=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=tp.normalizePath(c)}else o.path=n.path,r.params||(o.params=n.params,r.query||(o.query=n.query));return null===o.path&&(o.path=s.alwaysNormalize?tp.normalizePath(r.path):r.path),tp.buildURLFromParts(o)},parseURL:function(e){var t=Jg.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(Zg,"");e.length!==(e=e.replace(ep,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}});class ip{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var rp="audio",np="video",ap="audiovideo";class op{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const s=hp(e,t);s&&(s.enumerable=!0,Object.defineProperty(e,t,s))}(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;i=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[rp]:null,[np]:null,[ap]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new ip),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=sp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[rp]=null,e[np]=null,e[ap]=null}}function lp(e){return"initSegment"!==e.sn}class cp extends op{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(yg(e)&&yg(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=yg(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){yg(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return lp(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,s,i,r,n=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:n}}}class dp extends op{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function hp(e,t){const s=Object.getPrototypeOf(e);if(s){const e=Object.getOwnPropertyDescriptor(s,t);return e||hp(s,t)}}const up=Math.pow(2,32)-1,fp=[].push,mp={video:1,audio:2,id3:3,text:4};function gp(e){return String.fromCharCode.apply(null,e)}function pp(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function vp(e,t){const s=bp(e,t);return s<0?4294967296+s:s}function yp(e,t){let s=vp(e,t);return s*=Math.pow(2,32),s+=vp(e,t+4),s}function bp(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function xp(e,t,s){e[t]=s>>24,e[t+1]=s>>16&255,e[t+2]=s>>8&255,e[t+3]=255&s}function Ep(e,t){const s=[];if(!t.length)return s;const i=e.byteLength;for(let r=0;r<i;){const n=vp(e,r),a=n>1?r+n:i;if(gp(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,a));else{const i=Ep(e.subarray(r+8,a),t.slice(1));i.length&&fp.apply(s,i)}r=a}return s}function Tp(e){const t=[],s=e[0];let i=8;const r=vp(e,i);i+=4;let n=0,a=0;0===s?(n=vp(e,i),a=vp(e,i+4),i+=8):(n=yp(e,i),a=yp(e,i+8),i+=16),i+=2;let o=e.length+a;const l=pp(e,i);i+=2;for(let c=0;c<l;c++){let s=i;const n=vp(e,s);s+=4;const a=2147483647&n;if(1===(2147483648&n)>>>31)return Vg.warn("SIDX has hierarchical references (not supported)"),null;const l=vp(e,s);s+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+a-1}}),o+=a,s+=4,i=s}return{earliestPresentationTime:n,timescale:r,version:s,referencesCount:l,references:t}}function Sp(e){const t=[],s=Ep(e,["moov","trak"]);for(let i=0;i<s.length;i++){const e=s[i],r=Ep(e,["tkhd"])[0];if(r){let s=r[0];const i=vp(r,0===s?12:20),n=Ep(e,["mdia","mdhd"])[0];if(n){s=n[0];const r=vp(n,0===s?12:20),a=Ep(e,["mdia","hdlr"])[0];if(a){const s=gp(a.subarray(8,12)),n={soun:rp,vide:np}[s],o=wp(Ep(e,["mdia","minf","stbl","stsd"])[0]);n?(t[i]={timescale:r,type:n,stsd:o},t[n]=Og({timescale:r,id:i},o)):t[i]={timescale:r,type:s,stsd:o}}}}}return Ep(e,["moov","mvex","trex"]).forEach((e=>{const s=vp(e,4),i=t[s];i&&(i.default={duration:vp(e,12),flags:vp(e,20)})})),t}function wp(e){const t=e.subarray(8),s=t.subarray(86),i=gp(t.subarray(4,8));let r,n=i;const a="enca"===i||"encv"===i;if(a){const e=Ep(t,[i])[0];Ep(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=Ep(e,["schm"])[0];if(t){const s=gp(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=Ep(e,["frma"])[0];t&&(n=gp(t))}}}))}const o=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Ep(s,["avcC"])[0];e&&e.length>3&&(n+="."+Lp(e[1])+Lp(e[2])+Lp(e[3]),r=kp("avc1"===o?"dva1":"dvav",s));break}case"mp4a":{const e=Ep(t,[i])[0],s=Ep(e.subarray(28),["esds"])[0];if(s&&s.length>7){let e=4;if(3!==s[e++])break;e=Ap(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=Ap(s,e);const i=s[e++];if(64!==i)break;if(n+="."+Lp(i),e+=12,5!==s[e++])break;e=Ap(s,e);const r=s[e++];let a=(248&r)>>3;31===a&&(a+=1+((7&r)<<3)+((224&s[e])>>5)),n+="."+a}break}case"hvc1":case"hev1":{const e=Ep(s,["hvcC"])[0];if(e&&e.length>12){const t=e[1],s=["","A","B","C"][t>>6],i=31&t,r=vp(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);n+="."+s+i,n+="."+r.toString(16).toUpperCase(),n+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}n+=c}r=kp("hev1"==o?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":n=kp(n,s)||n;break;case"vp09":{const e=Ep(s,["vpcC"])[0];if(e&&e.length>6){const t=e[4],s=e[5],i=e[6]>>4&15;n+="."+Rp(t)+"."+Rp(s)+"."+Rp(i)}break}case"av01":{const e=Ep(s,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,d=(16&e[2])>>4,h=(8&e[2])>>3,u=(4&e[2])>>2,f=3&e[2],m=1,g=1,p=1,v=0;n+="."+t+"."+Rp(i)+a+"."+Rp(c)+"."+d+"."+h+u+f+"."+Rp(m)+"."+Rp(g)+"."+Rp(p)+"."+v,r=kp("dav1",s)}break}}return{codec:n,encrypted:a,supplemental:r}}function kp(e,t){const s=Ep(t,["dvvC"]),i=s.length?s[0]:Ep(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return e+"."+Rp(t)+"."+Rp(s)}}function Ap(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function Lp(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Rp(e){return(e<10?"0":"")+e}function _p(e){const t=Ep(e,["schm"])[0];if(t){const s=gp(t.subarray(4,8));if("cbcs"===s||"cenc"===s)return Ep(e,["schi","tenc"])[0]}return null}function Ip(e){const t=vp(e,0);let s=8;1&t&&(s+=4),4&t&&(s+=4);let i=0;const r=vp(e,4);for(let n=0;n<r;n++){if(256&t){i+=vp(e,s),s+=4}512&t&&(s+=4),1024&t&&(s+=4),2048&t&&(s+=4)}return i}function Pp(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function Cp(e,t){const s=[],i=t.samples,r=t.timescale,n=t.id;let a=!1;return Ep(i,["moof"]).map((o=>{const l=o.byteOffset-8;Ep(o,["traf"]).map((o=>{const c=Ep(o,["tfdt"]).map((e=>{const t=e[0];let s=vp(e,4);return 1===t&&(s*=Math.pow(2,32),s+=vp(e,8)),s/r}))[0];return void 0!==c&&(e=c),Ep(o,["tfhd"]).map((c=>{const d=vp(c,4),h=16777215&vp(c,0);let u=0;const f=!!(16&h);let m=0;const g=!!(32&h);let p=8;d===n&&(!!(1&h)&&(p+=8),!!(2&h)&&(p+=4),!!(8&h)&&(u=vp(c,p),p+=4),f&&(m=vp(c,p),p+=4),g&&(p+=4),"video"===t.type&&(a=Dp(t.codec)),Ep(o,["trun"]).map((n=>{const o=n[0],c=16777215&vp(n,0),d=!!(1&c);let h=0;const f=!!(4&c),g=!!(256&c);let p=0;const v=!!(512&c);let y=0;const b=!!(1024&c),x=!!(2048&c);let E=0;const T=vp(n,4);let S=8;d&&(h=vp(n,S),S+=4),f&&(S+=4);let w=h+l;for(let l=0;l<T;l++){if(g?(p=vp(n,S),S+=4):p=u,v?(y=vp(n,S),S+=4):y=m,b&&(S+=4),x&&(E=0===o?vp(n,S):bp(n,S),S+=4),t.type===np){let t=0;for(;t<y;){const n=vp(i,w);if(w+=4,Np(a,i[w])){Mp(i.subarray(w,w+n),a?2:1,e+E/r,s)}w+=n,t+=n+4}}e+=p/r}})))}))}))})),s}function Dp(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function Np(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Mp(e,t,s,i){const r=Op(e);let n=0;n+=t;let a=0,o=0,l=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;l=r[n++],a+=l}while(255===l);o=0;do{if(n>=r.length)break;l=r[n++],o+=l}while(255===l);const e=r.length-n;let t=n;if(o<e)n+=o;else if(o>e){Vg.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===r[t++]){const e=pp(r,t);if(t+=2,49===e){const e=vp(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const n=r[t++],o=64&n,l=o?2+3*(31&n):0,c=new Uint8Array(l);if(o){c[0]=n;for(let e=1;e<l;e++)c[e]=r[t++]}i.push({type:e,payloadType:a,pts:s,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let s=0;s<16;s++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const n=o-16,l=new Uint8Array(n);for(let s=0;s<n;s++)l[s]=r[t++];i.push({payloadType:a,pts:s,uuid:e.join(""),userData:qg(l),userDataBytes:l})}}}function Op(e){const t=e.byteLength,s=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(s.push(i+2),i+=2):i++;if(0===s.length)return e;const r=t-s.length,n=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===s[0]&&(a++,s.shift()),n[i]=e[a];return n}function jp(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,n;i=0,r=new Uint8Array,n=new Uint8Array;const a=new Uint8Array(4);return s&&s.byteLength>0&&new DataView(a.buffer).setUint32(0,s.byteLength,!1),function(e,...t){const s=t.length;let i=8,r=s;for(;r--;)i+=t[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=255&i,n.set(e,4),r=0,i=8;r<s;r++)n.set(t[r],i),i+=t[r].byteLength;return n}([112,115,115,104],new Uint8Array([0,0,0,0]),e,n,r,a,s||new Uint8Array)}function Fp(e){const t=e.getUint32(0),s=e.byteOffset,i=e.byteLength;if(i<t)return{offset:s,size:i};if(1886614376!==e.getUint32(4))return{offset:s,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:s,size:t};const n=e.buffer,a=Wg(new Uint8Array(n,s+12,16)),o=e.getUint32(28);let l=null,c=null;if(0===r){if(t-32<o||o<22)return{offset:s,size:t};c=new Uint8Array(n,s+32,o)}else if(1===r){if(!o||i<s+32+16*o+16)return{offset:s,size:t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(n,s+32+16*e,16))}return{version:r,systemId:a,kids:l,data:c,offset:s,size:t}}const Up=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Bp={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function $p(e,t){const s=Bp[t];return!!s&&!!s[e.slice(0,4)]}function Gp(e,t,s=!0){return!e.split(",").some((e=>!Vp(e,t,s)))}function Vp(e,t,s=!0){var i;const r=Kg(s);return null!=(i=null==r?void 0:r.isTypeSupported(Kp(e,t)))&&i}function Kp(e,t){return`${t}/mp4;codecs=${e}`}function Hp(e){if(e){const t=e.substring(0,4);return Bp.video[t]}return 2}function qp(e){const t=Up();return e.split(",").reduce(((e,s)=>{const i=t&&Dp(s)?9:Bp.video[s];return i?(2*i+e)/(e?3:2):(Bp.audio[s]+e)/(e?2:1)}),0)}const Wp={};const Yp=/flac|opus|mp4a\.40\.34/i;function zp(e,t=!0){return e.replace(Yp,(e=>function(e,t=!0){if(Wp[e])return Wp[e];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<s.length;r++){var i;if(Vp(s[r],"audio",t))return Wp[e]=s[r],s[r];if("mp3"===s[r]&&null!=(i=Kg(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t)))}function Xp(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e)))return e;if(t){const s=t.split(",");if(s.length>1){if(e)for(let t=s.length;t--;)if(s[t].substring(0,4)===e.substring(0,4))return s[t];return s[0]}}return t||e}function Jp(e){if(e.startsWith("av01.")){const t=e.split("."),s=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=s[e-4];return t.join(".")}return e}function Qp(e){const t=Kg(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Zp(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const ev={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function tv(e,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:e}}const sv={};function iv(e,t,s,i,r,n){const a=e.audioCodec?e.audioGroups:null,o=null==n?void 0:n.audioCodec,l=null==n?void 0:n.channels,c=l?parseInt(l):o?1/0:2;let d=null;if(null!=a&&a.length)try{d=1===a.length&&a[0]?t.groups[a[0]].channels:a.reduce(((e,s)=>{if(s){const i=t.groups[s];if(!i)throw new Error(`Audio track group ${s} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{2:0})}catch(h){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(r,8e6))||!!d&&yg(c)&&Object.keys(d).some((e=>parseInt(e)>c))}function rv(e,t,s){const i=e.videoCodec,r=e.audioCodec;if(!i&&!r||!s)return Promise.resolve(ev);const n=[];if(i){const t={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},s=e.videoRange;"SDR"!==s&&(t.transferFunction=s.toLowerCase());const r=i.split(","),a=navigator.userAgent;if(r.some((e=>Dp(e)))&&Up())return Promise.resolve(tv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${a})`),n));n.push.apply(n,r.map((e=>({type:"media-source",video:Og(Og({},t),{},{contentType:Kp(Jp(e),"video")})}))))}return r&&e.audioGroups&&e.audioGroups.forEach((e=>{var s;e&&(null==(s=t.groups[e])||s.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",s=parseFloat(e);yg(s)&&s>2&&n.push.apply(n,r.split(",").map((e=>({type:"media-source",audio:{contentType:Kp(e,"audio"),channels:""+s}}))))}})))})),Promise.all(n.map((e=>{const t=function(e){const{audio:t,video:s}=e,i=s||t;if(i){const e=Zp(i.contentType);if(s)return`r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${e}_${Math.ceil(s.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return sv[t]||(sv[t]=s.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:n,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:n,decodingInfoResults:[],error:e})))}const nv=["NONE","TYPE-0","TYPE-1",null];const av=["SDR","PQ","HLG"];var ov="",lv="YES",cv="v2";function dv(e){const{canSkipUntil:t,canSkipDateRanges:s,age:i}=e;return t&&i<t/2?s?cv:lv:ov}class hv{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class uv{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=null==(t=e.supplemental)?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return fv(this._audioGroups,e)}hasSubtitleGroup(e){return fv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function fv(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function mv(e,t){let s=!1,i=[];if(e&&(s="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||av.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;s=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),s||(i=["SDR"])}return{preferHDR:s,allowedVideoRanges:i}}const gv=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(s,i)=>{if(e&&(i=e(s,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function pv(e,t){Vg.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function vv(e){return e.reduce(((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function yv(e){if(!e)return e;const{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:n}=e;return{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:n}}function bv(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let i=0;i<t.length;i++){if(xv(e,t[i],s))return i}return-1}function xv(e,t,s){const{groupId:i,name:r,lang:n,assocLang:a,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===n||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(n,t.lang))&&(void 0===n||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const s=e.split(","),i=t.split(",");return s.length===i.length&&!s.some((e=>-1===i.indexOf(e)))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function Ev(e,t){const{audioCodec:s,channels:i}=e;return!(void 0!==s&&(t.audioCodec||"").substring(0,4)!==s.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function Tv(e,t,s){for(let i=t;i>-1;i--)if(s(e[i]))return i;for(let i=t+1;i<e.length;i++)if(s(e[i]))return i;return-1}function Sv(e,t){var s;return!!e&&e!==(null==(s=t.loadLevelObj)?void 0:s.uri)}const wv=function(e,t){let s=0,i=e.length-1,r=null,n=null;for(;s<=i;){r=(s+i)/2|0,n=e[r];const a=t(n);if(a>0)s=r+1;else{if(!(a<0))return n;i=r-1}}return null};function kv(e,t,s=0,i=0,r=.005){let n=null;if(e){n=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-s;i>0&&i<15e-7&&(s+=15e-7),n&&e.level!==n.level&&n.end<=e.end&&(n=t[2+e.sn-t[0].sn]||null)}else 0===s&&0===t[0].start&&(n=t[0]);if(n&&((!e||e.level===n.level)&&0===Av(s,i,n)||function(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),s);return e.start<=i}return!1}(n,e,Math.min(r,i))))return n;const a=wv(t,Av.bind(null,s,i));return!a||a===e&&n?n:a}function Av(e=0,t=0,s){if(s.start<=e&&s.start+s.duration>e)return 0;const i=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-i<=e?1:s.start-i>e&&s.start?-1:0}function Lv(e,t,s){const i=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-i>e}function Rv(e,t){return wv(e,(e=>e.cc<t?1:e.cc>t?-1:0))}function _v(e){switch(e.details){case Tg.FRAG_LOAD_TIMEOUT:case Tg.KEY_LOAD_TIMEOUT:case Tg.LEVEL_LOAD_TIMEOUT:case Tg.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Iv(e,t){const s=_v(t);return e.default[(s?"timeout":"error")+"Retry"]}function Pv(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function Cv(e){return Og(Og({},e),{errorRetry:null,timeoutRetry:null})}function Dv(e,t,s,i){if(!e)return!1;const r=null==i?void 0:i.code,n=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,i,n):n}var Nv=0,Mv=2,Ov=3,jv=5,Fv=0,Uv=1,Bv=2;function $v(e){const t={action:Nv,flags:Fv};return e&&(t.resolved=!0),t}var Gv="NOT_LOADED",Vv="APPENDING",Kv="PARTIAL",Hv="OK";class qv{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Sg.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Sg.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const t=s[i];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let n=r.length;n--;){const a=i[r[n]];if((null==a?void 0:a.body.type)===t&&(!s||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const n=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const a=this.fragments[i];if(!a)return;if(n>=a.body.sn)return;if(!a.buffered&&(!a.loaded||r))return void(a.body.type===s&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some((e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(a.body),s})):this.removeFragment(a.body))}))}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const s=e.frag,i=Yv(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const n=!s.relurl;if(Object.keys(t).forEach((i=>{const a=s.elementaryStreams[i];if(!a)return;const o=t[i],l=n||!0===a.partial;r.range[i]=this.getBufferedTimes(s,e.part,l,o)})),r.loaded=null,Object.keys(r.range).length){r.buffered=!0;(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),Wv(r)||this.removeParts(s.sn-1,s.type)}else this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=zv(s,(t=>t.fragment.sn>=e)))}fragBuffered(e,t){const s=Yv(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},n=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||n;for(let c=0;c<i.length;c++){const e=i.start(c)-this.bufferPadding,t=i.end(c)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(n,i.start(c)),endPTS:Math.min(a,i.end(c))});break}if(n<t&&a>e){const e=Math.max(n,i.start(c)),t=Math.min(a,i.end(c));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return r}getPartialFragment(e){let t,s,i,r=null,n=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const c=o[l];c&&Wv(c)&&(s=c.body.start-a,i=c.body.end+a,e>=s&&e<=i&&(t=Math.min(e-s,i-e),n<=t&&(r=c.body,n=t)))})),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Wv(t))}getState(e){const t=Yv(e),s=this.fragments[t];return s?s.buffered?Wv(s)?Kv:Hv:Vv:Gv}isTimeBuffered(e,t,s){let i,r;for(let n=0;n<s.length;n++){if(i=s.start(n)-this.bufferPadding,r=s.end(n)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=Yv(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:n}=t;if("initSegment"===s.sn)return;const a=s.type;if(i){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(i)}this.timeRanges=r;const o=r[n];this.detectEvictedFragments(n,o,a,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Yv(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;const o=a.body;o.type!==s||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)}))}removeFragment(e){const t=Yv(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=zv(s,(e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=null==(e=this.hls)||null==(t=e.latestLevelDetails)?void 0:t.partList;s&&s.forEach((e=>e.clearElementaryStreamInfo()))}}function Wv(e){var t,s,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(s=e.range.audio)?void 0:s.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function Yv(e){return`${e.type}_${e.level}_${e.sn}`}function zv(e,t){return e.filter((e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s}))}var Xv=0,Jv=1;class Qv{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Xv:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Jv:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class Zv{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(4*i);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],n=s[2],a=s[3],o=this.invSubMix,l=o[0],c=o[1],d=o[2],h=o[3],u=new Uint32Array(256);let f=0,m=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let s=m^m<<1^m<<2^m<<3^m<<4;s=s>>>8^255&s^99,e[f]=s,t[s]=f;const o=u[f],g=u[o],p=u[g];let v=257*u[s]^16843008*s;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,n[f]=v<<8|v>>>24,a[f]=v,v=16843009*p^65537*g^257*o^16843008*f,l[s]=v<<24|v>>>8,c[s]=v<<16|v>>>16,d[s]=v<<8|v>>>24,h[s]=v,f?(f=o^u[u[u[p^o]]],m^=u[u[m]]):f=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const n=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),c=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,u=this.invSubMix,f=u[0],m=u[1],g=u[2],p=u[3];let v,y;for(a=0;a<n;a++)a<r?v=l[a]=t[a]:(y=v,a%r==0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=h[a/r|0]<<24):r>6&&a%r==4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<n;o++)a=n-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[d[y>>>24]]^m[d[y>>>16&255]]^g[d[y>>>8&255]]^p[d[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(s);let u=h[0],f=h[1],m=h[2],g=h[3];const p=new Int32Array(e),v=new Int32Array(p.length);let y,b,x,E,T,S,w,k,A,L,R,_,I,P;const C=this.networkToHostOrderSwap;for(;t<p.length;){for(A=C(p[t]),L=C(p[t+1]),R=C(p[t+2]),_=C(p[t+3]),T=A^r[0],S=_^r[1],w=R^r[2],k=L^r[3],I=4,P=1;P<i;P++)y=o[T>>>24]^l[S>>16&255]^c[w>>8&255]^d[255&k]^r[I],b=o[S>>>24]^l[w>>16&255]^c[k>>8&255]^d[255&T]^r[I+1],x=o[w>>>24]^l[k>>16&255]^c[T>>8&255]^d[255&S]^r[I+2],E=o[k>>>24]^l[T>>16&255]^c[S>>8&255]^d[255&w]^r[I+3],T=y,S=b,w=x,k=E,I+=4;y=n[T>>>24]<<24^n[S>>16&255]<<16^n[w>>8&255]<<8^n[255&k]^r[I],b=n[S>>>24]<<24^n[w>>16&255]<<16^n[k>>8&255]<<8^n[255&T]^r[I+1],x=n[w>>>24]<<24^n[k>>16&255]<<16^n[T>>8&255]<<8^n[255&S]^r[I+2],E=n[k>>>24]<<24^n[T>>16&255]<<16^n[S>>8&255]<<8^n[255&w]^r[I+3],v[t]=C(y^u),v[t+1]=C(E^f),v[t+2]=C(x^m),v[t+3]=C(b^g),u=A,f=L,m=R,g=_,t+=4}return v.buffer}}class ey{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=function(e){switch(e){case Xv:return"AES-CBC";case Jv:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class ty{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(s){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?e.slice(0,t-s):e}(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise(((r,n)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,i);const o=this.flush();o?r(o.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:n,remainderData:a}=this;if(i!==Xv||16!==t.byteLength)return Vg.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Pp(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(s=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Zv),l.expandKey(t);const c=n;return this.currentResult=l.decrypt(o.buffer,0,s),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new ey(this.subtle,t,i)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new Qv(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,t)})).catch((r=>(Vg.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i))))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Vg.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const sy=Math.pow(2,17);class iy{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new ay({type:Eg.NETWORK_ERROR,details:Tg.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(s?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(ny(e));e.gap=!1}const l=this.loader=r?new r(i):new n(i),c=ry(e);e.loader=l;const d=Cv(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:sy};e.stats=l.stats;const u={onSuccess:(t,s,i,r)=>{this.resetLoader(e,l);let n=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),a({frag:e,part:null,payload:n,networkDetails:r})},onError:(t,i,r,n)=>{this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Og({url:s,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:n}))},onAbort:(t,s,i)=>{this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,s,i)=>{this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:t}))}};t&&(u.onProgress=(s,i,r,n)=>t({frag:e,part:null,payload:r,networkDetails:n})),l.load(c,h,u)}))}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(ny(e,t));const l=this.loader=r?new r(i):new n(i),c=ry(e,t);e.loader=l;const d=Cv(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:sy};t.stats=l.stats,l.load(c,h,{onSuccess:(i,r,n,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:i.data,networkDetails:o};s(c),a(c)},onError:(s,i,r,n)=>{this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Og({url:c.url,data:void 0},s),error:new Error(`HTTP Error ${s.code} ${s.text}`),networkDetails:r,stats:n}))},onAbort:(s,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:s}))},onTimeout:(s,i,r)=>{this.resetLoader(e,l),o(new ay({type:Eg.NETWORK_ERROR,details:Tg.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:s}))}})}))}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),n=Math.min(Math.round(s.loaded/r),i),a=(i-n)*Math.round(s.loaded/n);s.total=s.loaded+a}else s.total=Math.max(s.loaded,s.total);const n=s.loading,a=i.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ry(e,t=null){const s=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},r=s.byteRangeStartOffset,n=s.byteRangeEndOffset;if(yg(r)&&yg(n)){var a;let t=r,s=n;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=n-r;e%16&&(s=n+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=s}var o;return i}function ny(e,t){const s=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:Eg.MEDIA_ERROR,details:Tg.FRAG_GAP,fatal:!1,frag:e,error:s,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new ay(i)}class ay extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class oy extends jg{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ly{constructor(e,t,s,i=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=n}}const cy={length:0,start:()=>0,end:()=>0};class dy{static isBuffered(e,t){if(e){const s=dy.getBuffered(e);for(let e=s.length;e--;)if(t>=s.start(e)&&t<=s.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=dy.getBuffered(e);return dy.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=dy.bufferedRanges(e);if(i.length)return dy.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort(((e,t)=>e.start-t.start||t.end-e.end));let i=-1,r=[];if(s)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const n=r.length;if(n){const t=r[n-1].end;e[c].start-t<s?e[c].end>t&&(r[n-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let n,a=0,o=t,l=t;for(let c=0;c<r.length;c++){const e=r[c].start,d=r[c].end;if(-1===i&&t>=e&&t<=d&&(i=c),t+s>=e&&t<d)o=e,l=d,a=l-t;else if(t+s<e){n=e;break}}return{len:a,start:o||0,end:l||0,nextStart:n,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||cy}catch(t){return Vg.log("failed to get media.buffered",t),cy}}}const hy=/\{\$([a-zA-Z0-9-_]+)\}/g;function uy(e){return hy.test(e)}function fy(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(hy,(t=>{const i=t.substring(2,t.length-1),r=null==s?void 0:s[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r}))}return t}function my(e,t,s){let i,r,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`);r=e.get(i)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=t.NAME,r=t.VALUE;i in n?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=r||""}function gy(e,t,s){const i=t.IMPORT;if(s&&i in s){let t=e.variableList;t||(e.variableList=t={}),t[i]=s[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const py=/^(\d+)x(\d+)$/,vy=/(.+?)=(".*?"|.*?)(?:,|$)/g;class yy{constructor(e,t){"string"==typeof e&&(e=yy.parseAttrList(e,t)),Ng(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce(((e,t)=>(e[t.toLowerCase()]=!0,e)),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=py.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(vy.lastIndex=0;null!==(s=vy.exec(e));){const r=s[1].trim();let n=s[2];const a=0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1;let o=!1;if(a)n=n.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))n=fy(t,n);else if(!o&&!a)switch(r){case"CLOSED-CAPTIONS":if("NONE"===n)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Vg.warn(`${e}: attribute ${r} is missing quotes`)}i[r]=n}return i}}function by(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class xy{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(i=null==t?void 0:t.tagOrder)?i:s,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){Vg.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=Ng(new yy({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);yg(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(Vg.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(yg(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&yg(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Ey{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}get hasProgramDateTime(){return!!this.fragments.length&&yg(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ty(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Sy(e){switch(e){case"AES-128":case"AES-256":return Xv;case"AES-256-CTR":return Jv;default:throw new Error(`invalid full segment method ${e}`)}}function wy(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function ky(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}function Ay(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),s=wy(r)):s=function(e){const t=ky(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}const Ly="undefined"!=typeof self?self:void 0;var Ry={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_y="org.w3.clearkey",Iy="com.apple.streamingkeydelivery",Py="com.microsoft.playready",Cy="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Dy(e){switch(e){case Iy:return Ry.FAIRPLAY;case Py:return Ry.PLAYREADY;case Cy:return Ry.WIDEVINE;case _y:return Ry.CLEARKEY}}var Ny="1077efecc0b24d02ace33c1e52e2fb4b",My="e2719d58a985b3c9781ab030af78d30e",Oy="9a04f07998404286ab92e65be0885f95",jy="edef8ba979d64acea3c827dcd51d21ed";function Fy(e){return e===jy?Ry.WIDEVINE:e===Oy?Ry.PLAYREADY:e===Ny||e===My?Ry.CLEARKEY:void 0}function Uy(e){switch(e){case Ry.FAIRPLAY:return Iy;case Ry.PLAYREADY:return Py;case Ry.WIDEVINE:return Cy;case Ry.CLEARKEY:return _y}}function By(e){const{drmSystems:t,widevineLicenseUrl:s}=e,i=t?[Ry.FAIRPLAY,Ry.WIDEVINE,Ry.PLAYREADY,Ry.CLEARKEY].filter((e=>!!t[e])):[];return!i[Ry.WIDEVINE]&&s&&i.push(Ry.WIDEVINE),i}const $y=null!=Ly&&null!=(Gy=Ly.navigator)&&Gy.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Gy;function Vy(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),i=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=wy(e).subarray(0,16);return function(e){const t=function(e,t,s){const i=e[t];e[t]=e[s],e[s]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}let Ky={};class Hy{static clearKeyUriToKeyIdMap(){Ky={}}constructor(e,t,s,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Ty(e)}isSupported(){if(this.method){if(Ty(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Iy:case Cy:case Py:case _y:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Ty(this.method)&&this.uri&&!this.iv){"number"!=typeof e&&(Vg.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e);return new Hy(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=Ay(this.uri);if(t)switch(this.keyFormat){case Cy:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Py:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=jp(e,0,t),this.keyId=Vy(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Ky[this.uri];if(!e){const t=Object.keys(Ky).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),Ky[this.uri]=e}this.keyId=e}return this}}const qy=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Wy=/#EXT-X-MEDIA:(.*)/g,Yy=/^#EXT(?:INF|-X-TARGETDURATION):/m,zy=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Xy=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Jy{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return sp.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Yy.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:uy(e)},i=[];let r;for(qy.lastIndex=0;null!=(r=qy.exec(e));)if(r[1]){var n;const e=new yy(r[1],s),a=fy(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:Jy.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),sb(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},sb(c,o.supplemental)),null!=(n=o.unknownCodecs)&&n.length||i.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new yy(i,s),t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=eb(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):Vg.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":my(s,new yy(i,s),t);break;case"CONTENT-STEERING":{const e=new yy(i,s);s.contentSteering={uri:Jy.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=tb(i)}}const a=i.length>0&&i.length<s.levels.length;return s.levels=a?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,s){let i;const r={},n=s.levels,a={AUDIO:n.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:n.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(Wy.lastIndex=0;null!==(i=Wy.exec(e));){const e=new yy(i[1],s),n=e.TYPE;if(n){const s=a[n],i=r[n]||[];r[n]=i;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],d=e.CHANNELS,h=e.CHARACTERISTICS,u=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:n,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?Jy.resolve(e.URI,t):""};if(c&&(f.assocLang=c),d&&(f.channels=d),h&&(f.characteristics=h),u&&(f.instreamId=u),null!=s&&s.length){const e=Jy.findGroup(s,f.groupId)||s[0];ib(f,e,"audioCodec"),ib(f,e,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(e,t,s,i,r,n){var a;const o={url:t},l=new Ey(t),c=l.fragments,d=[];let h,u,f,m,g=null,p=0,v=0,y=0,b=0,x=0,E=null,T=new cp(i,o),S=-1,w=!1,k=null;if(zy.lastIndex=0,l.m3u8=e,l.hasVariableRefs=uy(e),"#EXTM3U"!==(null==(a=zy.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=zy.exec(e));){w&&(w=!1,T=new cp(i,o),T.playlistOffset=y,T.start=y,T.sn=p,T.cc=b,x&&(T.bitrate=x),T.level=s,g&&(T.initSegment=g,g.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),k&&(T.setByteRange(k),k=null)));const e=h[1];if(e){T.duration=parseFloat(e);const t=(" "+h[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(h[3]){if(yg(T.duration)){T.playlistOffset=y,T.start=y,f&&ab(T,f,l),T.sn=p,T.level=s,T.cc=b,c.push(T);const e=(" "+h[3]).slice(1);T.relurl=fy(l,e),rb(T,E,d),E=T,y+=T.duration,p++,v=0,w=!0}}else{if(h=h[0].match(Xy),!h){Vg.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<h.length&&void 0===h[u];u++);const e=(" "+h[u]).slice(1),r=(" "+h[u+1]).slice(1),a=h[u+2]?(" "+h[u+2]).slice(1):null;switch(e){case"BYTERANGE":E?T.setByteRange(r,E):T.setByteRange(r);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=r,T.tagList.push(["PROGRAM-DATE-TIME",r]),-1===S&&(S=c.length);break;case"PLAYLIST-TYPE":l.type&&ob(l,e,h),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?ob(l,e,h):c.length>0&&lb(l,e,h),p=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&ob(l,e,h);const t=new yy(r,l),s=t.decimalInteger("SKIPPED-SEGMENTS");if(yg(s)){l.skippedSegments+=s;for(let e=s;e--;)c.push(null);p+=s}const i=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(i.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&ob(l,e,h),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&ob(l,e,h),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||ob(l,e,h),l.live=!1;break;case"#":(r||a)&&T.tagList.push(a?[r,a]:[r]);break;case"DISCONTINUITY":b++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,r]),x=1e3*parseInt(r),yg(x)?T.bitrate=x:x=0;break;case"DATERANGE":{const e=new yy(r,l),t=new xy(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:Vg.warn(`Ignoring invalid DATERANGE tag: "${r}"`),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new yy(r,l);"IMPORT"in e?gy(l,e,n):my(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?ob(l,e,h):c.length>0&&lb(l,e,h),l.startCC=b=parseInt(r);break;case"KEY":{const e=eb(r,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={}),f[e.keyFormat]&&(f=Ng({},f)),f[e.keyFormat]=e}else Vg.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":l.startTimeOffset=tb(r);break;case"MAP":{const e=new yy(r,l);if(T.duration){const t=new cp(i,o);nb(t,e,s,f),g=t,T.initSegment=g,g.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;k=`${t-e}@${e}`}else k=null;nb(T,e,s,f),g=T,w=!0}g.cc=b;break}case"SERVER-CONTROL":m&&ob(l,e,h),m=new yy(r),l.canBlockReload=m.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=m.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&m.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=m.optionalFloat("PART-HOLD-BACK",0),l.holdBack=m.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&ob(l,e,h);const t=new yy(r);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,s=v++,i=new yy(r,l),n=new dp(i,T,o,s,t);e.push(n),T.duration+=n.duration;break}case"PRELOAD-HINT":{const e=new yy(r,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new yy(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:Vg.warn(`line parsed but not handled: ${h}`)}}}E&&!E.relurl?(c.pop(),y-=E.duration,l.partList&&(l.fragmentHint=E)):l.partList&&(rb(T,E,d),T.cc=b,l.fragmentHint=T,f&&ab(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const A=c.length,L=c[0],R=c[A-1];if(y+=l.skippedSegments*l.targetduration,y>0&&A&&R){l.averagetargetduration=y/A;const e=R.sn;l.endSN="initSegment"!==e?e:0,l.live||(R.endList=!0),L&&void 0===l.startCC&&(l.startCC=L.cc),S>0&&(!function(e,t){let s=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(c,S),L&&d.unshift(L))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,d.length&&l.dateRangeTagCount&&L&&Qy(d,l),l.endCC=b,l}}function Qy(e,t){const s=e.length,i=e[s-1],r=t.live?1/0:t.totalduration,n=Object.keys(t.dateRanges);for(let a=n.length;a--;){const o=t.dateRanges[n[a]],l=o.startDate.getTime();o.tagAnchor=i.ref;for(let i=s;i--;){const s=Zy(t,l,e,i,r);if(-1!==s){o.tagAnchor=t.fragments[s].ref;break}}}}function Zy(e,t,s,i,r){const n=s[i];if(n){const o=n.programDateTime;if(t>=o||0===i){var a;if(t<=o+1e3*(((null==(a=s[i+1])?void 0:a.start)||r)-n.start)){const r=s[i].sn-e.startSN,n=e.fragments;if(n.length>s.length){for(let a=(s[i+1]||n[n.length-1]).sn-e.startSN;a>r;a--){const e=n[a].programDateTime;if(t>=e&&t<e+1e3*n[a].duration)return a}}return r}}}return-1}function eb(e,t,s){var i,r;const n=new yy(e,s),a=null!=(i=n.METHOD)?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),c=n.KEYFORMATVERSIONS,d=null!=(r=n.KEYFORMAT)?r:"identity";o&&n.IV&&!l&&Vg.error(`Invalid IV: ${n.IV}`);const h=o?Jy.resolve(o,t):"",u=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Hy(a,h,d,u,l)}function tb(e){const t=new yy(e).decimalFloatingPoint("TIME-OFFSET");return yg(t)?t:null}function sb(e,t){let s=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=s.filter((t=>$p(t,e)));i.length&&(t[`${e}Codec`]=i.map((e=>e.split("/")[0])).join(","),s=s.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=s}function ib(e,t,s){const i=t[s];i&&(e[s]=i)}function rb(e,t,s){e.rawProgramDateTime?s.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function nb(e,t,s,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function ab(e,t,s){e.levelkeys=t;const{encryptedFragments:i}=s;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}function ob(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${s[0]})`)}function lb(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${s[0]})`)}function cb(e,t){const s=t.startPTS;if(yg(s)){let i,r=0;t.sn>e.sn?(r=s-e.start,i=e):(r=e.start-s,i=t),i.duration!==r&&i.setDuration(r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function db(e,t,s,i,r,n){i-s<=0&&(Vg.warn("Fragment should have a positive duration",t),i=s+t.duration,n=r+t.duration);let a=s,o=i;const l=t.startPTS,c=t.endPTS;if(yg(l)){const e=Math.abs(l-s);yg(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(s,l),s=Math.min(s,l),r=Math.min(r,t.startDTS),o=Math.min(i,c),i=Math.max(i,c),n=Math.max(n,t.endDTS)}const d=s-t.start;0!==t.start&&t.setStart(s),t.setDuration(i-t.start),t.startPTS=s,t.maxStartPTS=a,t.startDTS=r,t.endPTS=i,t.minEndPTS=o,t.endDTS=n;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;const f=h-e.startSN,m=e.fragments;for(m[f]=t,u=f;u>0;u--)cb(m[u],m[u-1]);for(u=f;u<m.length-1;u++)cb(m[u],m[u+1]);return e.fragmentHint&&cb(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function hb(e,t){if(e===t)return;let s=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){s=e;break}}let r;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,s){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,n=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=n;c++){const r=l[a+c];let n=o[c];if(i&&!n&&r&&(n=t.fragments[c]=r),r&&n){if(s(r,n,c,o),r.url&&r.url!==n.url)return void(t.playlistParsingError=ub(`media sequence mismatch ${n.sn}:`,e,t,r,n));if(r.cc!==n.cc)return void(t.playlistParsingError=ub(`discontinuity sequence mismatch (${r.cc}!=${n.cc})`,e,t,r,n))}}}(e,t,((i,n,a,o)=>{if(!t.startCC&&n.cc!==i.cc){var l,c;const s=i.cc-n.cc;for(let e=a;e<o.length;e++)o[e].cc+=s;t.startCC=null!=(l=null==(c=pb(e,t.startSN-1))?void 0:c.cc)?l:o[0].cc,t.endCC=o[o.length-1].cc}yg(i.startPTS)&&yg(i.endPTS)&&(n.setStart(n.startPTS=i.startPTS),n.startDTS=i.startDTS,n.maxStartPTS=i.maxStartPTS,n.endPTS=i.endPTS,n.endDTS=i.endDTS,n.minEndPTS=i.minEndPTS,n.setDuration(i.endPTS-i.startPTS),n.duration&&(r=n),t.PTSKnown=t.alignedSliding=!0),i.hasStreams&&(n.elementaryStreams=i.elementaryStreams),n.loader=i.loader,i.hasStats&&(n.stats=i.stats),i.initSegment&&(n.initSegment=i.initSegment,s=i.initSegment)}));const n=t.fragments,a=t.fragmentHint?n.concat(t.fragmentHint):n;if(s&&a.forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)})),t.skippedSegments)if(t.deltaUpdateFailed=n.some((e=>!e)),t.deltaUpdateFailed){Vg.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)n.shift();t.startSN=n[0].sn}else{t.endCC=n[n.length-1].cc,t.canSkipDateRanges&&(t.dateRanges=function(e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=t,r=Ng({},e);i&&i.forEach((e=>{delete r[e]}));const n=Object.keys(r).length;n&&Object.keys(s).forEach((e=>{const t=r[e],i=new xy(s[e].attr,t);i.isValid?(r[e]=i,t||(i.tagOrder+=n)):Vg.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${gv(s[e].attr)}"`)}));return r}(e.dateRanges,t));const s=e.fragments.filter((e=>e.rawProgramDateTime));if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<a.length;e++)null===a[e].programDateTime&&rb(a[e],a[e-1],s);Qy(s,t)}!function(e,t,s){if(e&&t){let i=0;for(let r=0,n=e.length;r<=n;r++){const n=e[r],a=t[r+i];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?s(n,a):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),r?db(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):fb(e,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function ub(e,t,s,i,r){return new Error(`${e} ${r.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${s.startSN}\n${s.m3u8}`)}function fb(e,t,s=!0){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,n=i>=0;let a=0;if(n&&i<r.length)a=r[i].start;else if(n&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(n&&s)a=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}mb(t,a)}function mb(e,t){if(t){const s=e.fragments;for(let i=e.skippedSegments;i<s.length;i++)s[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function gb(e,t=1/0){let s=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&s*r>t){const e=1e3*i[i.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}function pb(e,t,s){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t?i:t<e.startSN&&s&&s.sn===t?s:null)}function vb(e,t,s){return e?yb(e.partList,t,s):null}function yb(e,t,s){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===s&&r.fragment.sn===t)return r}return null}function bb(e){e.forEach(((e,t)=>{var s;null==(s=e.details)||s.fragments.forEach((e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)}))}))}function xb(e,t){for(let i=0,r=e.length;i<r;i++){var s;if((null==(s=e[i])?void 0:s.cc)===t)return e[i]}return null}function Eb(e,t){if(e){const s=e.start+t;e.start=e.startPTS=s,e.endPTS=s+e.duration}}function Tb(e,t){const s=t.fragments;for(let i=0,r=s.length;i<r;i++)Eb(s[i],e);t.fragmentHint&&Eb(t.fragmentHint,e),t.alignedSliding=!0}function Sb(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const s=Math.min(t.endCC,e.endCC),i=xb(t.fragments,s),r=xb(e.fragments,s);if(!i||!r)return;Vg.log(`Aligning playlist at start of dicontinuity sequence ${s}`);Tb(i.start-r.start,e)}function wb(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,i=t.fragments;if(!s.length||!i.length)return;let r,n;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=xb(i,a),n=xb(s,a)),r&&n||(r=i[Math.floor(i.length/2)],n=xb(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=n.programDateTime;if(!o||!l)return;Tb((l-o)/1e3-(n.start-r.start),e)}const kb=function(e){let t="";const s=e.length;for(let i=0;i<s;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t},Ab="STOPPED",Lb="IDLE",Rb="KEY_LOADING",_b="FRAG_LOADING",Ib="FRAG_LOADING_WAITING_RETRY",Pb="WAITING_TRACK",Cb="PARSING",Db="PARSED",Nb="ENDED",Mb="ERROR",Ob="WAITING_INIT_PTS",jb="WAITING_LEVEL";class Fb extends oy{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ab,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:s,mediaBuffer:i,state:r}=this,n=s?s.currentTime:0,a=dy.bufferInfo(i||s,n,e.maxBufferHole);if(this.log(`media seeking to ${yg(n)?n.toFixed(3):n}, state: ${r}`),this.state===Nb)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,i=t.start-s,r=t.start+t.duration+s;if(!a.len||r<a.start||i>a.end){const e=n>r;(n<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(s){this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0);if(n>this.lastCurrentTime&&(this.lastCurrentTime=n),!this.loadingParts){const e=Math.max(a.end,n),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${n.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||a.len||(this.log(`setting startPosition to ${n} because of seek before start`),this.nextLoadPosition=this.startPosition=n),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new iy(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ty(e.config)}registerListeners(){const{hls:e}=this;e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Sg.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Ab)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ab}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.nextStart;if(r&&r>i&&r<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const n=t.partList;if(null!=n&&n.length){const e=n[n.length-1];return dy.isBuffered(this.media,e.start+e.duration/2)}const a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Ab&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Ab,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){this._doFragLoad(e,t,s,(e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)})).then((e=>{if(!e)return;const t=this.state,s=e.frag;this.fragContextChanged(s)?(t===_b||!this.fragCurrent&&t===Cb)&&(this.fragmentTracker.removeFragment(s),this.state=Lb):("payload"in e&&(this.log(`Loaded ${s.type} sn: ${s.sn} of ${this.playlistLabel()} ${s.level}`),this.hls.trigger(Sg.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))})).catch((t=>{this.state!==Ab&&this.state!==Mb&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===Vv){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),n=this.backtrackFragment;(1===(n?e.sn-n.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===Kv&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(Sg.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e})).then((e=>{const{hls:t}=this,{frag:s,payload:i}=e,r=s.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&Ty(r.method)){const n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Sy(r.method)).catch((e=>{throw t.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e})).then((i=>{const r=self.performance.now();return t.trigger(Sg.FRAG_DECRYPTED,{frag:s,payload:i,stats:{tstart:n,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)}))}return this.completeInitSegmentLoad(e)})).catch((t=>{this.state!==Ab&&this.state!==Mb&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==Ab&&(this.state=Lb),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?kb(dy.getBuffered(s)):"(detached)"})`),lp(e)){var i;if(e.type!==Ig){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=Lb)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Lb}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,n=!r||0===r.length||r.some((e=>!e)),a=new ly(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!n);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const n=null==t?void 0:t.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Rb,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(Sg.KEY_LOADED,e),this.state===Rb&&(this.state=Lb),e})),this.hls.trigger(Sg.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));const o=this.fragPrevious;if(lp(e)&&(!o||e.sn!==o.sn)){const s=this.shouldLoadParts(t.details,e.end);s!==this.loadingParts&&(this.log(`LL-Part loading ${s?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=s)}if(s=Math.max(e.start,s||0),this.loadingParts&&lp(e)){const r=n.partList;if(r&&i){s>e.end&&n.fragmentHint&&(e=n.fragmentHint);const o=this.getNextPart(r,e,s);if(o>-1){const l=r[o];let c;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${r.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${n.startSN}-${n.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=_b,c=a?a.then((s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,l,t,i))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,i).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(Sg.FRAG_LOADING,{frag:e,part:l,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(r,s))return Promise.resolve(null)}}if(lp(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${n?"["+n.startSN+"-"+n.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),yg(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=_b;const l=this.config.progressive;let c;return c=l&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,l?i:void 0),a]).then((([e])=>(!l&&e&&i&&i(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(Sg.FRAG_LOADING,{frag:e,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,s,i){return new Promise(((r,n)=>{var a;const o=[],l=null==(a=s.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const n=i.part;this.hls.trigger(Sg.FRAG_LOADED,i);const a=vb(s.details,e.sn,t.index+1)||yb(l,e.sn,t.index+1);if(!a)return r({frag:e,part:n,partsLoaded:o});c(a)})).catch(n)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Tg.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(Sg.ERROR,t)}else this.hls.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Cb)return void(this.fragCurrent||this.state===Ab||this.state===Mb||(this.state=Lb));const{frag:s,part:i,level:r}=t,n=self.performance.now();s.stats.parsing.end=n,i&&(i.stats.parsing.end=n);const a=this.getLevelDetails(),o=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(null!=e&&e.partList){var s;const r=e.partList[0];if(t>=r.end+((null==(s=e.fragmentHint)?void 0:s.duration)||0)){var i;if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:n}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const a=t[i],o=a.details,l=n>-1?vb(o,r,n):null,c=l?l.fragment:pb(o,r,s);return c?(s&&s!==c&&(c.stats=s.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,s,i,r){var n;if(!e||this.state!==Cb)return;const{data1:a,data2:o}=e;let l=a;if(a&&o&&(l=Pp(a,o)),null==(n=l)||!n.length)return;const c={type:e.type,frag:t,part:s,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(Sg.BUFFER_APPENDING,c),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!dy.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,i=dy.bufferInfo(t,s,0),r=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-n,i.end-n),s+n);e.start-a>n&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!yg(i))return null;const r=this.lastCurrentTime>i||null!=(s=this.media)&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}getFwdBufferInfoAtPos(e,t,s,i){const r=dy.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const n=this.fragmentTracker.getBufferedFrag(t,s);if(n&&(r.nextStart<=n.end||n.gap)){const s=Math.max(Math.min(r.nextStart,n.end)-t,i);return dy.bufferInfo(e,t,s)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,i);return r>=i&&(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=Rg){var s;const i=null==(s=this.fragmentTracker)?void 0:s.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,n=s[0].start,a=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const c=r.initialLiveManifestSize;if(i<c)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${c})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<n){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t,s);const i=this.hls.startPosition,r=this.hls.liveSyncPosition,c=o?(-1!==i&&i>=n?i:r)||o.start:e;this.log(`Setting startPosition to ${c} to match start frag at live edge. mainStart: ${i} liveSyncPosition: ${r} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=c}}else e<=n&&(o=s[0]);if(!o){const s=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,s,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(s[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===Hv||s===Kv&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let n=null;if(e.gap&&(n=this.getNextFragment(this.nextLoadPosition,t),n&&!n.gap&&s.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(null!==e&&s.len+e.len>=r){const e=n.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,n}get primaryPrefetch(){if(Ub(this.hls.config)){var e,t;if(null==(e=this.hls.interstitialsManager)||null==(t=e.playingItem)?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Ub(this.hls.config)&&e.type!==Ig){const s=this.hls.interstitialsManager,i=null==s?void 0:s.bufferingItem;if(i){const s=i.event;if(s){if(s.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else{if(e.end<=i.start&&!1===(null==t?void 0:t.live))return null;if(e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}}const r=null==s?void 0:s.playerQueue;if(r)for(let t=r.length;t--;){const s=r[t].interstitial;if(s.appendInPlace&&e.start>=s.startTime&&e.end<=s.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,s){let i=-1,r=!1,n=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(n=n&&!o.independent,i>-1&&s<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||n)&&o.fragment===t&&(i=a),r=l}return i}loadedEndOfParts(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}getInitialLiveFragment(e,t){const s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=function(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!yg(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;s=s||0;for(let i=0;i<e.length;++i){const r=e[i];if(Lv(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const n=t[r-e.startSN];s.cc===n.cc&&(i=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Rv(t,s.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:n,endSN:a}=s;const{fragmentHint:o}=s,{maxFragLookUpTolerance:l}=i,c=s.partList,d=!!(this.loadingParts&&null!=c&&c.length&&o);let h;if(d&&o&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(n=n.concat(o),a=o.sn),e<t){var u;h=kv(r,n,e,e<this.lastCurrentTime||e>t-l||null!=(u=this.media)&&u.paused||!this.startFragRequested?0:l)}else h=n[n.length-1];if(h){const e=h.sn-s.startSN,t=this.fragmentTracker.getState(h);if((t===Hv||t===Kv&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!d||c[0].fragment.sn>h.sn||!s.live&&!d)){if(r&&h.level===r.level){const t=n[e+1];h=h.sn<a&&this.fragmentTracker.getState(t)!==Hv?t:null}}}return h}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,n=!t,a=e.alignedSliding&&yg(r);if(n||!a&&!r){!function(e,t){e&&(Sb(t,e),!t.alignedSliding&&e&&wb(t,e),t.alignedSliding||!e||t.skippedSegments||fb(e,t,!1))}(s,e);const r=e.fragmentStart;return this.log(`Live playlist sliding: ${r.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),r}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(-1===s){const r=null!==this.startTimeOffset,n=r?this.startTimeOffset:e.startTimeOffset;null!==n&&yg(n)?(s=t+n,n<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${n} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&lp(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Ib)||(this.state=Lb)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var i;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===Tg.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const n=t.errorAction,{action:a,flags:o,retryCount:l=0,retryConfig:c}=n||{},d=!!n&&!!c,h=d&&a===jv,u=d&&!n.resolved&&o===Uv;if(!h&&u&&lp(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),n.resolved=!0;else if((h||u)&&l<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=Pv(c,l);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${i}ms`),n.resolved=!0,this.retryDate=self.performance.now()+i,this.state=Ib}else if(c&&n){if(this.resetFragmentErrors(e),!(l<c.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${l})`);r||a===Ov||(n.resolved=!0)}else this.state=a===Mv?jb:Mb;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Cb||this.state===Db){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const n=!r;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===_g&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Ab&&(this.state=Lb)}afterBufferFlushed(e,t,s){if(!e)return;const i=dy.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===Nb&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Ab&&(this.state=Lb)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r)return void this.warn("level.details undefined");var n;if(!Object.keys(e.elementaryStreams).reduce(((t,n)=>{const a=e.elementaryStreams[n];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${n} duration reliably (${o})`),t||!1;const l=i?0:db(r,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(Sg.LEVEL_PTS_UPDATED,{details:r,level:s,drift:l,type:n,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1)&&(0===s.fragmentError&&this.treatAsGap(e,s),null===(null==(n=this.transmuxer)?void 0:n.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Db,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(Sg.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Rg?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${(null!=(i=t&&!s?e.startPTS:(s||e).start)?i:NaN).toFixed(3)}-${(null!=(r=t&&!s?e.endPTS:(s||e).end)?r:NaN).toFixed(3)}]${s&&"main"===e.type?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ub(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class Bb{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;return e.length?(s=1===e.length?e[0]:function(e,t){const s=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];s.set(t,i),i+=t.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var $b,Gb={exports:{}};var Vb=($b||($b=1,function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function n(e,t,i,n,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,n||e,a),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,n,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,r),!0;case 5:return d.fn.call(d.context,t,i,r,n),!0;case 6:return d.fn.call(d.context,t,i,r,n,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var u,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,r);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];d[c].fn.apply(d[c].context,l)}}return!0},o.prototype.on=function(e,t,s){return n(this,e,t,s,!1)},o.prototype.once=function(e,t,s){return n(this,e,t,s,!0)},o.prototype.removeListener=function(e,t,i,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||a(this,n);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&c.push(o[l]);c.length?this._events[n]=1===c.length?c[0]:c:a(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}(Gb)),Gb.exports),Kb=Yg(Vb);const Hb="1.6.2",qb={};function Wb(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Yb(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function zb(e,t){let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s}function Xb(e,t){const s=t;let i=0;for(;Yb(e,t);){i+=10;i+=zb(e,t+6),Wb(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(s,s+i)}function Jb(e,t){return 255===e[t]&&240==(246&e[t+1])}function Qb(e,t){return 1&e[t+1]?7:9}function Zb(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function ex(e,t){return t+1<e.length&&Jb(e,t)}function tx(e,t){if(ex(e,t)){const s=Qb(e,t);if(t+s>=e.length)return!1;const i=Zb(e,t);if(i<=s)return!1;const r=t+i;return r===e.length||ex(e,r)}return!1}function sx(e,t,s,i,r){if(!e.samplerate){const n=function(e,t,s,i){const r=t[s+2],n=r>>2&15;if(n>12){const t=new Error(`invalid ADTS sampling index:${n}`);return void e.emit(Sg.ERROR,Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(r>>6&3),o=t[s+3]>>6&3|(1&r)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][n];let d=n;5!==a&&29!==a||(d-=3);const h=[a<<3|(14&d)>>1,(1&d)<<7|o<<3];return Vg.log(`manifest codec:${i}, parsed codec:${l}, channels:${o}, rate:${c} (ADTS object type:${a} sampling index:${n})`),{config:h,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:i}}(t,s,i,r);if(!n)return;Ng(e,n)}}function ix(e){return 9216e4/e}function rx(e,t,s,i,r){const n=i+r*ix(e.samplerate),a=function(e,t){const s=Qb(e,t);if(t+s<=e.length){const i=Zb(e,t)-s;if(i>0)return{headerLength:s,frameLength:i}}}(t,s);let o;if(a){const{frameLength:i,headerLength:r}=a,l=r+i,c=Math.max(0,s+l-t.length);c?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const d={unit:o,pts:n};return c||e.samples.push(d),{sample:d,length:l,missing:c}}const l=t.length-s;o=new Uint8Array(l),o.set(t.subarray(s,t.length),0);return{sample:{unit:o,pts:n},length:l,missing:-1}}function nx(e,t){return Yb(e,t)&&zb(e,t+6)+10<=e.length-t}function ax(e,t){if(e<0)return-ax(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2==0?t:t+1)/s}return Math.round(e*s)/s}function ox(e,t=0,s=1/0){return function(e,t,s,i){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let n=1;"BYTES_PER_ELEMENT"in i&&(n=i.BYTES_PER_ELEMENT);const a=(h=e,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/n,l=(a+t)/n,c=Math.floor(Math.max(0,Math.min(l,o))),d=Math.floor(Math.min(c+Math.max(s,0),o));var h;return new i(r,c,d-c)}(e,t,s,Uint8Array)}function lx(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return;const s=e.data.subarray(1).indexOf(0);if(-1===s)return;const i=qg(ox(e.data,1,s)),r=e.data[2+s],n=e.data.subarray(3+s).indexOf(0);if(-1===n)return;const a=qg(ox(e.data,3+s,n));let o;return o="--\x3e"===i?qg(ox(e.data,4+s+n)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+s+n)),t.mimeType=i,t.pictureType=r,t.description=a,t.data=o,t}function cx(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=qg(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:s.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=qg(e.data.subarray(t),!0);t+=s.length+1;const i=qg(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=qg(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?lx(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=qg(e.data.subarray(t),!0);t+=s.length+1;const i=qg(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=qg(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function dx(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=zb(e,4);return{type:t,size:s,data:e.subarray(10,10+s)}}function hx(e){let t=0;const s=[];for(;Yb(e,t);){const i=zb(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const i=dx(e.subarray(t)),r=cx(i);r&&s.push(r),t+=i.size+10}Wb(e,t)&&(t+=10)}return s}function ux(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function fx(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,s&&(i+=47721858.84),Math.round(i)}}function mx(e){const t=hx(e);for(let s=0;s<t.length;s++){const e=t[s];if(ux(e))return fx(e)}}let gx=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function px(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class vx{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Pp(this.cachedData,e),this.cachedData=null);let s,i=Xb(e,0),r=i?i.length:0;const n=this._audioTrack,a=this._id3Track,o=i?mx(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&yg(o))&&(this.basePTS=yx(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:gx.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(n,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,s=r):r=l}else nx(e,r)?(i=Xb(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:gx.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const t=e.slice(s);this.cachedData?this.cachedData=Pp(this.cachedData,t):this.cachedData=t}}return{audioTrack:n,videoTrack:px(),id3Track:a,textTrack:px()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:px(),id3Track:this._id3Track,textTrack:px()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const yx=(e,t,s)=>{if(yg(e))return 90*e;return 9e4*t+(s?9e4*s.baseTime/s.timescale:0)};let bx=null;const xx=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ex=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Tx=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Sx=[0,1,1,4];function wx(e,t,s,i,r){if(s+24>t.length)return;const n=kx(t,s);if(n&&s+n.frameLength<=t.length){const a=i+r*(9e4*n.samplesPerFrame/n.sampleRate),o={unit:t.subarray(s,s+n.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{sample:o,length:n.frameLength,missing:0}}}function kx(e,t){const s=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==n){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*xx[14*(3===s?3-i:3===i?3:4)+r-1],c=Ex[3*(3===s?0:2===s?1:2)+n],d=3===o?1:2,h=Tx[s][i],u=Sx[i],f=8*h*u,m=Math.floor(h*l/c+a)*u;if(null===bx){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);bx=e?parseInt(e[1]):0}return!!bx&&bx<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:m,samplesPerFrame:f}}}function Ax(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Lx(e,t){return t+1<e.length&&Ax(e,t)}function Rx(e,t){if(t+1<e.length&&Ax(e,t)){const s=4,i=kx(e,t);let r=s;null!=i&&i.frameLength&&(r=i.frameLength);const n=t+r;return n===e.length||Lx(e,n)}return!1}const _x=(e,t)=>{let s=0,i=5;t+=i;const r=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=e[t];const o=Math.min(i,8),l=8-o;n[0]=4278190080>>>24+l<<l,r[0]=(a[0]&n[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,i-=o}return s};class Ix extends vx{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=Px(e,t,s,this.basePTS,this.frameIndex);if(-1!==i){return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}static probe(e){if(!e)return!1;const t=Xb(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==mx(t)&&_x(e,s)<16}}function Px(e,t,s,i,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const n=t[s+4]>>6;if(n>=3)return-1;const a=[48e3,44100,32e3][n],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+n];if(s+l>t.length)return-1;const c=t[s+6]>>5;let d=0;2===c?d+=2:(1&c&&1!==c&&(d+=2),4&c&&(d+=2));const h=(t[s+6]<<8|t[s+7])>>12-d&1,u=[2,1,2,3,3,4,4,5][c]+h,f=t[s+5]>>3,m=7&t[s+5],g=new Uint8Array([n<<6|f<<1|m>>2,(3&m)<<6|c<<3|h<<2|o>>4,o<<4&224]),p=i+r*(1536/a*9e4),v=t.subarray(s,s+l);return e.config=g,e.channelCount=u,e.samplerate=a,e.samples.push({unit:v,pts:p}),l}const Cx=/\/emsg[-/]ID3/i;function Dx(e,t){return yg(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class Nx{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new ty(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Xv)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then((r=>{const n=new Uint8Array(r);i.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}))}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const n=Op(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then((a=>{r.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}))}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(s>=r.length);s++){const n=r[s];if(!(n.data.length<=48||1!==n.type&&5!==n.type||(this.decryptAvcSample(e,t,s,i,n),this.decrypter.isSync())))return}}}}class Mx{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;s=e[e.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,i=s.length;if(!i)return void t.dropped++;{const t=s[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const n=r,a=[];let o,l,c,d=0,h=-1,u=0;for(-1===r&&(h=0,u=this.getNALuType(t,0),r=0,d=1);d<i;)if(o=t[d++],r)if(1!==r)if(o)if(1===o){if(l=d-r-1,h>=0){const e={data:t.subarray(h,l),type:u};a.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(n&&d<=4-n&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-n)),l>0&&(s.data=Pp(s.data,t.subarray(0,l)),s.state=0))}d<i?(c=this.getNALuType(t,d),h=d,u=c,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(h>=0&&r>=0){const e={data:t.subarray(h,i),type:u,state:r};a.push(e)}if(0===a.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=Pp(s.data,t))}return e.naluState=r,a}}class Ox{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Vg.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class jx extends Mx{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let n,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 1:{let t=!1;n=!0;const r=i.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=t;break}case 5:n=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:n=!0,Mp(i.data,1,s.pts,t.samples);break;case 7:{var d,h;n=!0,o=!0;const t=i.data,s=this.readSPS(t);if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(d=e.pixelRatio)?void 0:d[0])!==s.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:n=!0,e.pps=[i.data];break;case 9:n=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:n=!0;break;default:n=!1}if(a&&n){a.units.push(i)}})),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new Ox(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s,i=8,r=8;for(let n=0;n<e;n++)0!==r&&(s=t.readEG(),r=(i+s+256)%256),i=0===r?i:r}readSPS(e){const t=new Ox(e);let s,i,r,n=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),u=t.readBoolean.bind(t),f=t.skipBits.bind(t),m=t.skipEG.bind(t),g=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);c();const v=c();if(d(5),f(3),c(),g(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=h();if(3===e&&f(1),g(),g(),f(1),u())for(i=3!==e?8:12,r=0;r<i;r++)u()&&p(r<6?16:64,t)}g();const y=h();if(0===y)h();else if(1===y)for(f(1),m(),m(),s=h(),r=0;r<s;r++)m();g(),f(1);const b=h(),x=h(),E=d(1);0===E&&f(1),f(1),u()&&(n=h(),a=h(),o=h(),l=h());let T=[1,1];if(u()&&u()){switch(c()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*n-2*a),height:(2-E)*(x+1)*16-(E?2:4)*(o+l),pixelRatio:T}}}class Fx extends Mx{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let n,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,n=!0;break;case 16:case 17:case 18:case 21:var c;if(n=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:n=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:n=!0,Mp(i.data,2,s.pts,t.samples);break;case 32:n=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=Ng(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(n=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const s in t.params)e.params[s]=t.params[s]}this.pushParameterSet(e.sps,i.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(n=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const s in t)e.params[s]=t[s]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:n=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:n=!1}if(a&&n){a.units.push(i)}})),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ox(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new Ox(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),n=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),u=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),p=t.readUByte(),v=[],y=[];for(let H=0;H<s;H++)v.push(t.readBoolean()),y.push(t.readBoolean());if(s>0)for(let H=s;H<8;H++)t.readBits(2);for(let H=0;H<s;H++)v[H]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[H]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const x=t.readUEG(),E=t.readUEG(),T=t.readBoolean();let S=0,w=0,k=0,A=0;T&&(S+=t.readUEG(),w+=t.readUEG(),k+=t.readUEG(),A+=t.readUEG());const L=t.readUEG(),R=t.readUEG(),_=t.readUEG();for(let H=t.readBoolean()?0:s;H<=s;H++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let s=0;s<(3===e?2:6);s++){if(t.readBoolean()){const s=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<s;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const I=t.readUEG();let P=0;for(let H=0;H<I;H++){let e=!1;if(0!==H&&(e=t.readBoolean()),e){H===I&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let s=0;s<=P;s++){const s=t.readBoolean();let i=!1;s||(i=t.readBoolean()),(s||i)&&e++}P=e}else{const e=t.readUEG(),s=t.readUEG();P=e+s;for(let i=0;i<e;i++)t.readUEG(),t.readBoolean();for(let i=0;i<s;i++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let s=0;s<e;s++){for(let e=0;e<_+4;e++)t.readBits(1);t.readBits(1)}}let C=0,D=1,N=1,M=!0,O=1,j=0;t.readBoolean(),t.readBoolean();let F=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],N=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(D=t.readBits(16),N=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),F=t.readBoolean(),F&&(S+=t.readUEG(),w+=t.readUEG(),k+=t.readUEG(),A+=t.readUEG());if(t.readBoolean()){O=t.readBits(32),j=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let n=0;n<=s;n++){M=t.readBoolean();let s=!1;M||t.readBoolean()?t.readEG():s=t.readBoolean();const n=s?1:t.readUEG()+1;if(e)for(let e=0;e<n;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<n;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let U=x,B=E;if(T||F){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),U=x-e*w-e*S,B=E-t*A-t*k}const $=i?["A","B","C"][i]:"",G=a<<24|o<<16|l<<8|c;let V=0;for(let H=0;H<32;H++)V=(V|(G>>H&1)<<31-H)>>>0;let K=V.toString(16);1===n&&"2"===K&&(K="6");return{codecString:`hvc1.${$}${n}.${K}.${r?"H":"L"}${p}.B0`,params:{general_tier_flag:r,general_profile_idc:n,general_profile_space:i,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[d,h,u,f,m,g],general_level_idc:p,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:C,chroma_format_idc:b,frame_rate:{fixed:M,fps:j/O}},width:U,height:B,pixelRatio:[D,N]}}readPPS(e){const t=new Ox(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let r=1;return i&&s?r=0:i?r=3:s&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ux=188;class Bx{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=Bx.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),-1!==s}static syncOffset(e){const t=e.length;let s=Math.min(940,t-Ux)+1,i=0;for(;i<s;){let r=!1,n=-1,a=0;for(let o=i;o<t;o+=Ux){if(71!==e[o]||t-o!==Ux&&71!==e[o+Ux]){if(a)return-1;break}if(a++,-1===n&&(n=o,0!==n&&(s=Math.min(n+18612,e.length-Ux)+1)),r||(r=0===$x(e,o)),r&&a>1&&(0===n&&a>2||o+Ux>s))return n}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:mp[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Bx.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Bx.createTrack("audio",i),this._id3Track=Bx.createTrack("id3"),this._txtTrack=Bx.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){let r;s||(this.sampleAes=null);const n=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=n.pid,d=n.pesData,h=a.pid,u=o.pid,f=a.pesData,m=o.pesData,g=null,p=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=Pp(this.remainderData,e)).length,this.remainderData=null),y<Ux&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};const b=Math.max(0,Bx.syncOffset(e));y-=(y-b)%Ux,y<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let x=0;for(let T=b;T<y;T+=Ux)if(71===e[T]){const t=!!(64&e[T+1]),i=$x(e,T);let y;if((48&e[T+3])>>4>1){if(y=T+5+e[T+4],y===T+Ux)continue}else y=T+4;switch(i){case c:if(t){if(d&&(r=qx(d,this.logger))){if(null===this.videoParser)switch(n.segmentCodec){case"avc":this.videoParser=new jx;break;case"hevc":this.videoParser=new Fx}null!==this.videoParser&&this.videoParser.parsePES(n,l,r,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(y,T+Ux)),d.size+=T+Ux-y);break;case h:if(t){if(f&&(r=qx(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,T+Ux)),f.size+=T+Ux-y);break;case u:t&&(m&&(r=qx(m,this.logger))&&this.parseID3PES(o,r),m={data:[],size:0}),m&&(m.data.push(e.subarray(y,T+Ux)),m.size+=T+Ux-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=Gx(e,y);break;case v:{t&&(y+=e[y]+1);const i=Vx(e,y,this.typeSupported,s,this.observer,this.logger);c=i.videoPid,c>0&&(n.pid=c,n.segmentCodec=i.segmentVideoCodec),h=i.audioPid,h>0&&(a.pid=h,a.segmentCodec=i.segmentAudioCodec),u=i.id3Pid,u>0&&(o.pid=u),null===g||p||(this.logger.warn(`MPEG-TS PMT found at ${T} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,T=b-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i}}else x++;x>0&&Kx(this.observer,new Error(`Found ${x} TS packet/s that do not start with 0x47`),void 0,this.logger),n.pesData=d,a.pesData=f,o.pesData=m;const E={audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(E),E}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,n=s.pesData,a=t.pesData,o=i.pesData;let l;if(n&&(l=qx(n,this.logger))){if(null===this.videoParser)switch(s.segmentCodec){case"avc":this.videoParser=new jx;break;case"hevc":this.videoParser=new Fx}null!==this.videoParser&&(this.videoParser.parsePES(s,r,l,!0),s.pesData=null)}else s.pesData=n;if(a&&(l=qx(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=qx(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new Nx(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise((s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)})):s(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)}))}))}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r,n,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=Pp(i.sample.unit,o);else{const n=r-t;i.sample.unit.set(o.subarray(0,t),n),e.samples.push(i.sample),s=i.missing}}for(r=s,n=o.length;r<n-1&&!ex(o,r);r++);if(r!==s){let e;const t=r<n-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",Kx(this.observer,new Error(e),t,this.logger),!t)return}if(sx(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=ix(e.samplerate);a=i.sample.pts+t}}let l,c=0;for(;r<n;){if(l=rx(e,o,r,a,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<n-1&&!ex(o,r);r++);}}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,n=0;const a=t.pts;if(void 0!==a)for(;n<i;)if(Lx(s,n)){const t=wx(e,s,n,a,r);if(!t)break;n+=t.length,r++}else n++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let n,a=0,o=0;for(;o<r&&(n=Px(e,s,o,i,a++))>0;)o+=n}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=Ng({},t,{type:this._videoTrack?gx.emsg:gx.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function $x(e,t){return((31&e[t+1])<<8)+e[t+2]}function Gx(e,t){return(31&e[t+10])<<8|e[t+11]}function Vx(e,t,s,i,r,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=$x(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){Hx("ADTS AAC",n);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!i){Hx("H.264",n);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:s.mpeg||s.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):n.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Hx("AC-3",n);break}case 129:s.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){if(106===e[i])!0!==s.ac3?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return Kx(r,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"))}t+=l+5}return a}function Kx(e,t,s,i){i.warn(`parsing error: ${t.message}`),e.emit(Sg.ERROR,Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:t,reason:t.message})}function Hx(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function qx(e,t){let s,i,r,n,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Pp(l[0],l[1]),l.splice(1,1);s=l[0];if(1===(s[0]<<16)+(s[1]<<8)+s[2]){if(i=(s[4]<<8)+s[5],i&&i>e.size-6)return null;const c=s[7];192&c&&(n=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&c?(a=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,n-a>54e5&&(t.warn(`${Math.round((n-a)/9e4)}s delta between PTS and DTS, align them`),n=a)):a=n),r=s[8];let d=r+9;if(e.size<=d)return null;e.size-=d;const h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){s=l[e];let t=s.byteLength;if(d){if(d>t){d-=t;continue}s=s.subarray(d),t-=d,d=0}h.set(s,o),o+=t}return i&&(i-=r+3),{data:h,pts:n,dts:a,len:i}}return null}class Wx{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Yx=Math.pow(2,32)-1;class zx{static init(){let e;for(e in zx.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},zx.types)zx.types.hasOwnProperty(e)&&(zx.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);zx.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);zx.STTS=zx.STSC=zx.STCO=r,zx.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),zx.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),zx.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),zx.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);zx.FTYP=zx.box(zx.types.ftyp,n,o,n,a),zx.DINF=zx.box(zx.types.dinf,zx.box(zx.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),i=0,s=8;i<r;i++)n.set(t[i],s),s+=t[i].byteLength;return n}static hdlr(e){return zx.box(zx.types.hdlr,zx.HDLR_TYPES[e])}static mdat(e){return zx.box(zx.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Yx+1)),i=Math.floor(t%(Yx+1));return zx.box(zx.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return zx.box(zx.types.mdia,zx.mdhd(e.timescale||0,e.duration||0),zx.hdlr(e.type),zx.minf(e))}static mfhd(e){return zx.box(zx.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?zx.box(zx.types.minf,zx.box(zx.types.smhd,zx.SMHD),zx.DINF,zx.stbl(e)):zx.box(zx.types.minf,zx.box(zx.types.vmhd,zx.VMHD),zx.DINF,zx.stbl(e))}static moof(e,t,s){return zx.box(zx.types.moof,zx.mfhd(e),zx.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=zx.trak(e[t]);return zx.box.apply(null,[zx.types.moov,zx.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(zx.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=zx.trex(e[t]);return zx.box.apply(null,[zx.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Yx+1)),i=Math.floor(t%(Yx+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return zx.box(zx.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return zx.box(zx.types.sdtp,s)}static stbl(e){return zx.box(zx.types.stbl,zx.stsd(e),zx.box(zx.types.stts,zx.STTS),zx.box(zx.types.stsc,zx.STSC),zx.box(zx.types.stsz,zx.STSZ),zx.box(zx.types.stco,zx.STCO))}static avc1(e){let t,s,i,r=[],n=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],i=s.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],i=s.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(s));const a=zx.box(zx.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return zx.box(zx.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,zx.box(zx.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),zx.box(zx.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return zx.box(zx.types.mp4a,zx.audioStsd(e),zx.box(zx.types.esds,zx.esds(e)))}static mp3(e){return zx.box(zx.types[".mp3"],zx.audioStsd(e))}static ac3(e){return zx.box(zx.types["ac-3"],zx.audioStsd(e),zx.box(zx.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return zx.box(zx.types.stsd,zx.STSD,zx.mp4a(e));if("ac3"===t&&e.config)return zx.box(zx.types.stsd,zx.STSD,zx.ac3(e));if("mp3"===t&&"mp3"===e.codec)return zx.box(zx.types.stsd,zx.STSD,zx.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return zx.box(zx.types.stsd,zx.STSD,zx.avc1(e));if("hevc"===t&&e.vps)return zx.box(zx.types.stsd,zx.STSD,zx.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,n=Math.floor(s/(Yx+1)),a=Math.floor(s%(Yx+1));return zx.box(zx.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const s=zx.sdtp(e),i=e.id,r=Math.floor(t/(Yx+1)),n=Math.floor(t%(Yx+1));return zx.box(zx.types.traf,zx.box(zx.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),zx.box(zx.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n])),zx.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,zx.box(zx.types.trak,zx.tkhd(e),zx.mdia(e))}static trex(e){const t=e.id;return zx.box(zx.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,n=new Uint8Array(r);let a,o,l,c,d,h;for(t+=8+r,n.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=s[a],l=o.duration,c=o.size,d=o.flags,h=o.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return zx.box(zx.types.trun,n)}static initSegment(e){zx.types||zx.init();const t=zx.moov(e);return Pp(zx.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let r=i.length;for(let u=0;u<s.length;u+=1){r+=3;for(let e=0;e<s[u].length;e+=1)r+=2+s[u][e].length}const n=new Uint8Array(r);n.set(i,0),r=i.length;const a=s.length-1;for(let u=0;u<s.length;u+=1){n.set(new Uint8Array([32+u|(u===a?128:0),0,s[u].length]),r),r+=3;for(let e=0;e<s[u].length;e+=1)n.set(new Uint8Array([s[u][e].length>>8,255&s[u][e].length]),r),r+=2,n.set(s[u][e],r),r+=s[u][e].length}const o=zx.box(zx.types.hvcC,n),l=e.width,c=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return zx.box(zx.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,zx.box(zx.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),zx.box(zx.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))}}zx.types=void 0,zx.HDLR_TYPES=void 0,zx.STTS=void 0,zx.STSC=void 0,zx.STCO=void 0,zx.STSZ=void 0,zx.VMHD=void 0,zx.SMHD=void 0,zx.STSD=void 0,zx.FTYP=void 0,zx.DINF=void 0;function Xx(e,t,s=1,i=!1){const r=e*t*s;return i?Math.round(r):r}function Jx(e,t=!1){return Xx(e,1e3,1/9e4,t)}let Qx,Zx=null,eE=null;function tE(e,t,s,i){return{duration:t,size:s,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class sE{constructor(e,t,s,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.ISGenerated=!1,null===Zx){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zx=e?parseInt(e[1]):0}if(null===eE){const e=navigator.userAgent.match(/Safari\/(\d+)/i);eE=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce(((e,i)=>{let r=i.pts,n=r-e;return n<-4294967296&&(t=!0,r=iE(r,s),n=r-e),n>0?e:r}),s);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,s,i,r,n,a,o){let l,c,d,h,u,f,m=r,g=r;const p=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,x=a&&y>0||y>1;if((!p||b)&&(!v||x)||this.ISGenerated||a){if(this.ISGenerated){var E,T,S,w;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(E=t.pixelRatio)?void 0:E[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(w=e.pixelRatio)?void 0:w[1]))||!e&&x||null===this.nextAudioPts&&b)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,r,n));const s=this.isVideoContiguous;let i,a=-1;if(x&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.logger.warn(`[mp4-remuxer]: Dropped ${a} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===a&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(b&&x){const s=this.getVideoStartPts(t.samples),i=(iE(e.samples[0].pts,s)-s)/t.inputTimeScale;m+=Math.max(0,i),g+=Math.max(0,-i)}if(b){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,n)),c=this.remuxAudio(e,m,this.isAudioContiguous,n,v||x||o===_g?g:void 0),x){const i=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,n)),l=this.remuxVideo(t,g,s,i)}}else x&&(l=this.remuxVideo(t,g,s,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(u=rE(s,r,this._initPTS,this._initDTS)),i.samples.length&&(h=nE(i,r,this._initPTS))),{audio:c,video:l,initSegment:d,independent:f,text:h,id3:u}}generateIS(e,t,s,i){const r=e.samples,n=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,d,h,u=!l||i,f="audio/mp4";if(u&&(c=d=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):zx.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=e.inputTimeScale,l&&h===l.timescale?u=!1:c=d=r[0].pts-Math.round(h*s))}if(t.sps&&t.pps&&n.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:zx.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(h=t.inputTimeScale,l&&h===l.timescale)u=!1;else{const e=this.getVideoStartPts(n),t=Math.round(h*s);d=Math.min(d,iE(n[0].dts,e)-t),c=Math.min(c,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:c,timescale:h},this._initDTS={baseTime:d,timescale:h}):c=h=void 0,{tracks:o,initPTS:c,timescale:h}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,n=e.samples,a=[],o=n.length,l=this._initPTS;let c,d,h=this.nextAvcDts,u=8,f=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=!1;if(!s||null===h){const e=t*r,i=n[0].pts-iE(n[0].dts,n[0].pts);Zx&&null!==h&&Math.abs(e-i-h)<15e3?s=!0:h=e-i}const v=l.baseTime*r/l.timescale;for(let D=0;D<o;D++){const e=n[D];e.pts=iE(e.pts-v,h),e.dts=iE(e.dts-v,h),e.dts<n[D>0?D-1:D].dts&&(p=!0)}p&&n.sort((function(e,t){const s=e.dts-t.dts,i=e.pts-t.pts;return s||i})),c=n[0].dts,d=n[n.length-1].dts;const y=d-c,b=y?Math.round(y/(o-1)):f||e.inputTimeScale/30;if(s){const s=c-h,i=s>b,r=s<-1;if((i||r)&&(i?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Jx(s,!0)} ms (${s}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Jx(-s,!0)} ms (${s}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||h>=n[0].pts||Zx)){c=h;const e=n[0].pts-s;if(i)n[0].dts=c,n[0].pts=e;else{let t=!0;for(let i=0;i<n.length&&!(n[i].dts>e&&t);i++){const e=n[i].pts;if(n[i].dts-=s,n[i].pts-=s,i<n.length-1){const s=n[i+1].pts;t=s<=n[i].pts==s<=e}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Jx(e,!0)}/${Jx(c,!0)}, delta: ${Jx(s,!0)} ms`)}}c=Math.max(0,c);let x=0,E=0,T=c;for(let D=0;D<o;D++){const e=n[D],t=e.units,s=t.length;let i=0;for(let r=0;r<s;r++)i+=t[r].data.length;E+=i,x+=s,e.length=i,e.dts<T?(e.dts=T,T+=b/4|0||1):T=e.dts,m=Math.min(e.pts,m),g=Math.max(e.pts,g)}d=n[o-1].dts;const S=E+4*x+8;let w;try{w=new Uint8Array(S)}catch(C){return void this.observer.emit(Sg.ERROR,Sg.ERROR,{type:Eg.MUX_ERROR,details:Tg.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:S,reason:`fail allocating video mdat ${S}`})}const k=new DataView(w.buffer);k.setUint32(0,S),w.set(zx.types.mdat,4);let A=!1,L=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,I=Number.NEGATIVE_INFINITY;for(let D=0;D<o;D++){const e=n[D],t=e.units;let s,l=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],s=e.data,r=e.data.byteLength;k.setUint32(u,r),u+=4,w.set(s,u),u+=r,l+=4+r}if(D<o-1)f=n[D+1].dts-e.dts,s=n[D+1].pts-e.pts;else{const t=this.config,a=D>0?e.dts-n[D-1].dts:b;if(s=D>0?e.pts-n[D-1].pts:b,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const s=Math.floor(t.maxBufferHole*r),n=(i?m+i*r:this.nextAudioPts)-e.pts;n>s?(f=n-a,f<0?f=a:A=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${n/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=a}else f=a}const c=Math.round(e.pts-e.dts);L=Math.min(L,f),_=Math.max(_,f),R=Math.min(R,s),I=Math.max(I,s),a.push(tE(e.key,f,l,c))}if(a.length)if(Zx){if(Zx<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(eE&&I-R<_-L&&b/_<.025&&0===a[0].cts){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,s=a.length;t<s;t++){const i=e+a[t].duration,r=e+a[t].cts;if(t<s-1){const e=i+a[t+1].cts;a[t].duration=e-r}else a[t].duration=t?a[t-1].duration:b;a[t].cts=0,e=i}}f=A||!f?b:f,this.nextAvcDts=h=d+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const P={data1:zx.moof(e.sequenceNumber++,c,Ng(e,{samples:a})),data2:w,startPTS:m/r,endPTS:(g+f)/r,startDTS:c/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,P}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,s,i,r){const n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],u=void 0!==r;let f=e.samples,m=d?0:8,g=this.nextAudioPts||-1;const p=t*n,v=c.baseTime*n/c.timescale;if(this.isAudioContiguous=s=s||f.length&&g>0&&(i&&Math.abs(p-g)<9e3||Math.abs(iE(f[0].pts-v,p)-g)<20*l),f.forEach((function(e){e.pts=iE(e.pts-v,p)})),!s||g<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;g=0===r?0:i&&!u?Math.max(0,p):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,i=g;s<f.length;s++){const r=f[s],a=r.pts,o=a-i,c=Math.abs(1e3*o/n);if(o<=-t*l&&u)0===s&&(this.logger.warn(`Audio frame @ ${(a/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=g=i=a);else if(o>=t*l&&c<1e4&&u){let t=Math.round(o/l);i=a-t*l,i<0&&(t--,i+=l),0===s&&(this.nextAudioPts=g=i),this.logger.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let n=0;n<t;n++){const t=Math.max(i,0);let n=Wx.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);n||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),n=r.unit.subarray()),f.splice(s,0,{unit:n,pts:t}),i+=l,s++}}r.pts=i,i+=l}}let y,b=null,x=null,E=0,T=f.length;for(;T--;)E+=f[T].unit.byteLength;for(let I=0,P=f.length;I<P;I++){const t=f[I],i=t.unit;let r=t.pts;if(null!==x){h[I-1].duration=Math.round((r-x)/a)}else{if(s&&"aac"===e.segmentCodec&&(r=g),b=r,!(E>0))return;E+=m;try{y=new Uint8Array(E)}catch(_){return void this.observer.emit(Sg.ERROR,Sg.ERROR,{type:Eg.MUX_ERROR,details:Tg.REMUX_ALLOC_ERROR,fatal:!1,error:_,bytes:E,reason:`fail allocating audio mdat ${E}`})}if(!d){new DataView(y.buffer).setUint32(0,E),y.set(zx.types.mdat,4)}}y.set(i,m);const n=i.byteLength;m+=n,h.push(tE(!0,o,n,0)),x=r}const S=h.length;if(!S)return;const w=h[h.length-1];this.nextAudioPts=g=x+a*w.duration;const k=d?new Uint8Array(0):zx.moof(e.sequenceNumber++,b/a,Ng({},e,{samples:h}));e.samples=[];const A=b/n,L=g/n,R={data1:k,data2:y,startPTS:A,endPTS:L,startDTS:A,endDTS:L,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,R}}function iE(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function rE(e,t,s,i){const r=e.samples.length;if(!r)return;const n=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=iE(r.pts-s.baseTime*n/s.timescale,t*n)/n,r.dts=iE(r.dts-i.baseTime*n/i.timescale,t*n)/n}const a=e.samples;return e.samples=[],{samples:a}}function nE(e,t,s){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=iE(i.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const n=e.samples;return e.samples=[],{samples:n}}function aE(e,t){const s=null==e?void 0:e.codec;if(s&&s.length>4)return s;if(t===rp){if("ec-3"===s||"ac-3"===s||"alac"===s)return s;if("fLaC"===s||"Opus"===s){return zp(s,!1)}return Vg.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"}return Vg.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1"}try{Qx=self.performance.now.bind(self.performance)}catch(ww){Qx=Date.now}const oE=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=px("video",1),n=this.audioTrack=px("audio",1),a=this.txtTrack=px("text",1);if(this.id3Track=px("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Sp(e);if(o.video){const{id:e,timescale:t,codec:s,supplemental:i}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=s,r.supplemental=i}if(o.audio){const{id:e,timescale:t,codec:s}=o.audio;n.id=e,n.timescale=t,n.codec=s}a.id=mp.text,r.sampleDuration=0,r.duration=n.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let s=0;s<t;){const i=vp(e,s);if(i>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=i>1?s+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Pp(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},s=Ep(e,["moof"]);if(s.length<2)return t.remainder=e,t;const i=s[s.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(s);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=s;const n=this.extractID3Track(i,t);return r.samples=Cp(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=Cp(e,t),{videoTrack:t,audioTrack:px(),id3Track:i,textTrack:px()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=Ep(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function(e){const t=e[0];let s="",i="",r=0,n=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==gp(e.subarray(c,c+1));)s+=gp(e.subarray(c,c+1)),c+=1;for(s+=gp(e.subarray(c,c+1)),c+=1;"\0"!==gp(e.subarray(c,c+1));)i+=gp(e.subarray(c,c+1)),c+=1;i+=gp(e.subarray(c,c+1)),c+=1,r=vp(e,12),n=vp(e,16),o=vp(e,20),l=vp(e,24),c=28}else if(1===t){c+=4,r=vp(e,c),c+=4;const t=vp(e,c);c+=4;const n=vp(e,c);for(c+=4,a=2**32*t+n,bg(a)||(a=Number.MAX_SAFE_INTEGER,Vg.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=vp(e,c),c+=4,l=vp(e,c),c+=4;"\0"!==gp(e.subarray(c,c+1));)s+=gp(e.subarray(c,c+1)),c+=1;for(s+=gp(e.subarray(c,c+1)),c+=1;"\0"!==gp(e.subarray(c,c+1));)i+=gp(e.subarray(c,c+1)),c+=1;i+=gp(e.subarray(c,c+1)),c+=1}return{schemeIdUri:s,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(Cx.test(i.schemeIdUri)){const e=Dx(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const n=i.payload;s.samples.push({data:n,len:n.byteLength,dts:e,pts:e,type:gx.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=Dx(i,t);s.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:gx.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class{constructor(e,t,s,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(function(e,t){if(!e||!t)return e;const s=t.keyId;s&&t.isCommonEncryption&&Ep(e,["moov","trak"]).forEach((e=>{const t=Ep(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=Ep(t,["enca"]);const r=i.length>0;r||(i=Ep(t,["encv"])),i.forEach((e=>{Ep(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=_p(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(Vg.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Wg(e)} -> ${Wg(s)}`),t.set(s,8))}}))}))}));return e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=Sp(e);i.audio&&(t=aE(i.audio,rp)),i.video&&(s=aE(i.video,np));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,i,r,n){var a,o;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};yg(c)||(c=this.lastEndTime=r||0);const h=t.samples;if(null==h||!h.length)return d;const u={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);const m=function(e,t){let s=0,i=0,r=0;const n=Ep(e,["moof","traf"]);for(let a=0;a<n.length;a++){const e=n[a],o=Ep(e,["tfhd"])[0],l=t[vp(o,4)];if(!l)continue;const c=l.default,d=vp(o,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&d&&(h=vp(o,2&d?12:8));const u=l.timescale||9e4,f=Ep(e,["trun"]);for(let t=0;t<f.length;t++)s=Ip(f[t]),!s&&h&&(s=h*vp(f[t],4)),l.type===np?i+=s/u:l.type===rp&&(r+=s/u)}if(0===i&&0===r){let t=1/0,s=0,i=0;const r=Ep(e,["sidx"]);for(let e=0;e<r.length;e++){const n=Tp(r[e]);if(null!=n&&n.references){t=Math.min(t,n.earliestPresentationTime/n.timescale);const e=n.references.reduce(((e,t)=>e+t.info.duration||0),0);s=Math.max(s,e+n.earliestPresentationTime/n.timescale),i=s-t}}if(i&&yg(i))return i}return i||r}(h,f),g=function(e,t){return Ep(t,["moof","traf"]).reduce(((t,s)=>{const i=Ep(s,["tfdt"])[0],r=i[0],n=Ep(s,["tfhd"]).reduce(((t,s)=>{const n=vp(s,4),a=e[n];if(a){let e=vp(i,4);if(1===r){if(e===up)return Vg.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=up+1,e+=vp(i,8)}const s=e/(a.timescale||9e4);if(yg(s)&&(null===t||s<t))return s}return t}),null);return null!==n&&yg(n)&&(null===t||n<t)?n:t}),null)}(f,h),p=null===g?r:g;!n&&l||!function(e,t,s,i){if(null===e)return!0;const r=Math.max(i,1),n=t-e.baseTime/e.timescale;return Math.abs(n-s)>r}(l,p,r,m)&&u.timescale===l.timescale||(u.initPTS=p-r,l&&1===l.timescale&&this.logger.warn(`Adjusting initPTS @${r} from ${l.baseTime/l.timescale} to ${u.initPTS}`),this.initPTS=l={baseTime:u.initPTS,timescale:1});const v=e?p-l.baseTime/l.timescale:c,y=v+m;!function(e,t,s){Ep(t,["moof","traf"]).forEach((t=>{Ep(t,["tfhd"]).forEach((i=>{const r=vp(i,4),n=e[r];if(!n)return;const a=n.timescale||9e4;Ep(t,["tfdt"]).forEach((e=>{const t=e[0],i=s*a;if(i){let s=vp(e,4);if(0===t)s-=i,s=Math.max(s,0),xp(e,4,s);else{s*=Math.pow(2,32),s+=vp(e,8),s-=i,s=Math.max(s,0);const t=Math.floor(s/(up+1)),r=Math.floor(s%(up+1));xp(e,4,t),xp(e,8,r)}}}))}))}))}(f,h,l.baseTime/l.timescale),m>0?this.lastEndTime=y:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const b=!!f.audio,x=!!f.video;let E="";b&&(E+="audio"),x&&(E+="video");const T={data1:h,startPTS:v,startDTS:v,endPTS:y,endDTS:y,type:E,hasAudio:b,hasVideo:x,nb:1,dropped:0};return d.audio="audio"===T.type?T:void 0,d.video="audio"!==T.type?T:void 0,d.initSegment=u,d.id3=rE(s,r,l,l),i.samples.length&&(d.text=nE(i,r,l)),d}}},{demux:Bx,remux:sE},{demux:class extends vx{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Xb(e,0);let i=(null==s?void 0:s.length)||0;if(Rx(e,i))return!1;for(let r=e.length;i<r;i++)if(tx(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Jb(e,t)&&Zb(e,t)<=e.length-t}(e,t)}appendFrame(e,t,s){sx(e,this.observer,t,s,e.manifestCodec);const i=rx(e,t,s,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:sE},{demux:class extends vx{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Xb(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==mx(t)&&_x(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(Rx(e,s))return Vg.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Ax(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,s){if(null!==this.basePTS)return wx(e,t,s,this.basePTS,this.frameIndex)}},remux:sE}];oE.splice(2,0,{demux:Ix,remux:sE});class lE{constructor(e,t,s,i,r,n){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=Qx();let n=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:u,initSegmentChange:f}=i||a,{audioCodec:m,videoCodec:g,defaultInitPts:p,duration:v,initSegmentData:y}=o,b=function(e,t){let s=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t);return s}(n,t);if(b&&Ty(b.method)){const e=this.getDecrypter(),t=Sy(b.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(n,b.key.buffer,b.iv.buffer,t).then((e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t})),this.decryptionPromise;{let i=e.softwareDecrypt(n,b.key.buffer,b.iv.buffer,t);if(s.part>-1){const t=e.flush();i=t?t.buffer:t}if(!i)return r.executeEnd=Qx(),cE(s);n=new Uint8Array(i)}}const x=this.needsProbing(c,d);if(x){const e=this.configureTransmuxer(n);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(Sg.ERROR,Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Qx(),cE(s)}(c||d||f||x)&&this.resetInitSegment(y,m,g,v,t),(c||f||x)&&this.resetInitialTimestamp(p),l||this.resetContiguity();const E=this.transmux(n,b,u,h,s);this.asyncResult=dE(E);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,r.executeEnd=Qx(),E}flush(e){const t=e.transmuxing;t.executeStart=Qx();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then((()=>this.flush(e)));const n=[],{timeOffset:a}=i;if(s){const t=s.flush();t&&n.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=Qx();const s=[cE(e)];return this.asyncResult?Promise.resolve(s):s}const c=o.flush(a);return dE(c)?(this.asyncResult=!0,c.then((t=>(this.flushRemux(n,t,e),n)))):(this.flushRemux(n,c,e),this.asyncResult?Promise.resolve(n):n)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:n,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===Rg?"level":"track"} ${s.level}`);const c=this.remuxer.remux(i,r,n,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:s}),s.transmuxing.executeEnd=Qx()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:n,remuxer:a}=this;n&&a&&(n.resetInitSegment(e,t,s,i),a.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let n;return n=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,i,r):this.transmuxUnencrypted(e,s,i,r),n}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,n,a,o,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,i,!1,this.id),chunkMeta:r})))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let d=0,h=oE.length;d<h;d++){var n;if(null!=(n=oE[d].demux)&&n.probe(e,this.logger)){r=oE[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=r.remux,c=r.demux;o&&o instanceof l||(this.remuxer=new l(s,t,i,this.logger)),a&&a instanceof c||(this.demuxer=new c(s,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ty(this.config)),e}}const cE=e=>({remuxResult:{},chunkMeta:e});function dE(e){return"then"in e&&e.then instanceof Function}class hE{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class uE{constructor(e,t,s,i,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=n}}let fE=0;class mE{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=fE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,s=this.hls;if(s&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,s.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const n=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===Sg.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new Kb,this.observer.on(Sg.FRAG_DECRYPTED,n),this.observer.on(Sg.ERROR,n);const a=Qp(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const s=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(s.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function(e){const t=qb[e];if(t)return t.clientCount++,t;const s=new self.URL(e,self.location.href).href,i={worker:new self.Worker(s),scriptURL:s,clientCount:1};return qb[e]=i,i}(r.workerPath)):(s.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=qb[Hb];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(t),i={worker:new self.Worker(s),objectURL:s,clientCount:1};return qb[Hb]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:gv(r)})}catch(ww){s.warn(`Error setting up "${t}" Web Worker, fallback to inline`,ww),this.terminateWorker(),this.error=null,this.transmuxer=new lE(this.observer,a,r,"",t,e.logger)}return}}this.transmuxer=new lE(this.observer,a,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=fE++;const t=this.hls.config,s=Qp(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:gv(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=qb[e||Hb];if(t&&1==t.clientCount--){const{worker:s,objectURL:i}=t;delete qb[e||Hb],i&&self.URL.revokeObjectURL(i),s.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,n,a,o,l,c){var d,h;l.transmuxing.start=self.performance.now();const{instanceNo:u,transmuxer:f}=this,m=n?n.start:r.start,g=r.decryptdata,p=this.frag,v=!(p&&r.cc===p.cc),y=!(p&&l.level===p.level),b=p?l.sn-p.sn:-1,x=this.part?l.part-this.part.index:-1,E=0===b&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),T=!y&&(1===b||0===b&&(1===x||E&&x<=0)),S=self.performance.now();(y||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!n||!x&&T||(n.stats.parsing.start=S);const w=!(p&&(null==(d=r.initSegment)?void 0:d.url)===(null==(h=p.initSegment)?void 0:h.url)),k=new uE(v,T,o,y,m,w);if(!T||v||w){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===Rg?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${v}\n        trackSwitch: ${y}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${m}\n        initSegmentChange: ${w}`);const e=new hE(s,i,t,a,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({instanceNo:u,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:k},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,g,l,k);dE(t)?t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const t=s.flush(e);dE(t)?t.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(t,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class gE extends jg{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=null==t?void 0:t.renditionReports;if(i){let n=-1;for(let s=0;s<i.length;s++){const a=i[s];let o;try{o=new self.URL(a.URI,t.url).href}catch(r){this.warn(`Could not construct new URL for Rendition Report: ${r}`),o=a.URI||""}if(o===e){n=s;break}o===e.substring(0,o.length)&&(n=s)}if(-1!==n){const e=i[n],r=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let a=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=s&&dv(s);return new hv(r,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,n=self.performance.now(),a=r.loading.first?Math.max(0,n-r.loading.first):0;i.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==i.appliedTimelineOffset){const e=Math.max(o||0,0);i.appliedTimelineOffset=e,i.fragments.forEach((t=>{t.start=t.playlistOffset+e}))}if(i.live||null!=s&&s.live){const o="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){hb(s,i);const e=i.playlistParsingError;if(e){this.warn(e);const s=this.hls;if(!s.config.ignorePlaylistParsingErrors){var l;const{networkDetails:n}=t;return void s.trigger(Sg.ERROR,{type:Eg.NETWORK_ERROR,details:Tg.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=i.fragments[0])?void 0:l.type,networkDetails:n,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const c=this.hls.mainForwardBufferInfo,d=c?c.end-c.len:0,h=gb(i,1e3*(i.edge-d));if(i.requestScheduled+h<n?i.requestScheduled=n:i.requestScheduled+=h,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let u,f,m;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,a=i.endSN,l=i.lastPartIndex,c=r===a;-1!==l?c?(f=a+1,m=e?0:l):(f=r,m=e?l+1:i.maxPartIndex):f=a+1;const d=i.age,h=d+i.ageHeader;let g=Math.min(h-i.partTarget,1.5*i.targetduration);if(g>0){if(h>3*i.targetduration)this.log(`Playlist last advanced ${d.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,m=void 0;else if(null!=s&&s.tuneInGoal&&h-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${g} with playlist age: ${i.age}`),g=0;else{const e=Math.floor(g/i.targetduration);if(f+=e,void 0!==m){m+=Math.round(g%i.targetduration/i.partTarget)}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${d.toFixed(2)}s goal: ${g} skip sn ${e} to part ${m}`)}i.tuneInGoal=g}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m),e||!c)return i.requestScheduled=n,void this.loadingPlaylist(o,u)}else(i.canBlockReload||i.canSkipUntil)&&(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m));u&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(h-2*a,h/2)),this.scheduleLoading(o,u,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),n=i.requestScheduled;if(r>=n)return void this.loadingPlaylist(e,t);const a=n-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout((()=>this.loadingPlaylist(e,t)),a)}getDeliveryDirectives(e,t,s,i){let r=dv(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=ov),new hv(s,i,r)}checkRetry(e){const t=e.details,s=_v(e),i=e.errorAction,{action:r,retryCount:n=0,retryConfig:a}=i||{},o=!!i&&!!a&&(r===jv||!i.resolved&&r===Mv);if(o){var l;if(n>=a.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Pv(a,n);this.clearTimer(),this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}function pE(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!vE(e[s].attrs,t[s].attrs))return!1;return!0}function vE(e,t,s){const i=e["STABLE-RENDITION-ID"];return i&&!s?i===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((s=>e[s]!==t[s]))}function yE(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class bE{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1!==i.length||s||this.executeNext(t)}appendBlocker(e){return new Promise((t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)}))}prependBlocker(e){return new Promise((t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}}))}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((e=>{var t;const s=null==(t=e[0])?void 0:t.label;"async-blocker"!==s&&"async-blocker-prepend"!==s||(e[0].execute(),e.splice(0,1))}))}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){var s;if(r.onError(i),null===this.queues||null===this.tracks)return;const t=null==(s=this.tracks[e])?void 0:s.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,s;return null!=(t=this.queues)&&t[e]||null!=(s=this.tracks)&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=null==(t=this.tracks)?void 0:t[e],i=null==s?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map((e=>e.label)).join(", "))||""}}const xE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,EE="HlsJsTrackRemovedError";class TE extends Error{constructor(e){super(e),this.name=EE}}function SE(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}function wE(e){return"audio"===e?1:0}class kE{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Sg.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Sg.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Sg.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Sg.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&yg(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter(((t,s)=>this.isLevelAllowed(t)&&s<=e));return this.clientRect=null,kE.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,s){if(null==e||!e.length)return-1;let i=e.length-1;const r=Math.max(t,s);for(let o=0;o<e.length;o+=1){const t=e[o];if((t.width>=r||t.height>=r)&&(n=t,!(a=e[o+1])||n.width!==a.width||n.height!==a.height)){i=o;break}}var n,a;return i}}const AE={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},LE={HLS:"h"},RE="CMCD-Object",_E="CMCD-Request",IE="CMCD-Session",PE="CMCD-Status",CE={[RE]:["br","d","ot","tb"],[_E]:["bl","dl","mtp","nor","nrr","su"],[IE]:["cid","pr","sf","sid","st","v"],[PE]:["bs","rtp"]};class DE{constructor(e,t){Array.isArray(e)&&(e=e.map((e=>e instanceof DE?e:new DE(e)))),this.value=e,this.params=t}}function NE(e,t,s,i){return new Error(`failed to ${e} "${r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"==typeof r?JSON.stringify(r):String(r)}" as ${s}`,{cause:i});var r}function ME(e,t,s){return NE("serialize",e,t,s)}class OE{constructor(e){this.description=e}}const jE="Bare Item";function FE(e){if(!1===ArrayBuffer.isView(e))throw ME(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function UE(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw ME(e,"Integer");return e.toString()}function BE(e){const t=ax(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw ME(e,"Decimal");const s=t.toString();return s.includes(".")?s:`${s}.0`}const $E=/[\x00-\x1f\x7f]+/;function GE(e){const t=(s=e).description||s.toString().slice(7,-1);var s;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw ME(t,"Token");return t}function VE(e){switch(typeof e){case"number":if(!yg(e))throw ME(e,jE);return Number.isInteger(e)?UE(e):BE(e);case"string":return function(e){if($E.test(e))throw ME(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return GE(e);case"boolean":return function(e){if("boolean"!=typeof e)throw ME(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${UE(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return FE(e);if(e instanceof OE)return GE(e);default:throw ME(e,jE)}}function KE(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw ME(e,"Key");return e}function HE(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${KE(e)}`:`;${KE(e)}=${VE(t)}`)).join("")}function qE(e){return e instanceof DE?`${VE(e.value)}${HE(e.params)}`:VE(e)}function WE(e,t={whitespace:!0}){if("object"!=typeof e)throw ME(e,"Dict");const s=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(s).map((([e,t])=>{t instanceof DE==!1&&(t=new DE(t));let s=KE(e);var i;return!0===t.value?s+=HE(t.params):(s+="=",Array.isArray(t.value)?s+=`(${(i=t).value.map(qE).join(" ")})${HE(i.params)}`:s+=qE(t)),s})).join(`,${i}`)}const YE=e=>Math.round(e),zE=e=>100*YE(e/100),XE={br:YE,d:YE,bl:zE,dl:zE,mtp:zE,nor:(e,t)=>((null==t?void 0:t.baseUrl)&&(e=function(e,t){const s=new URL(e),i=new URL(t);if(s.origin!==i.origin)return e;const r=s.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;r[0]===n[0];)r.shift(),n.shift();for(;n.length;)n.shift(),r.unshift("..");return r.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:zE,tb:YE};function JE(e,t){const s={};if(null==e||"object"!=typeof e)return s;const i=Object.keys(e).sort(),r=Ng({},XE,null==t?void 0:t.formatters),n=null==t?void 0:t.filter;return i.forEach((i=>{if(null==n?void 0:n(i))return;let a=e[i];const o=r[i];o&&(a=o(a,t)),"v"===i&&1===a||"pr"==i&&1===a||function(e){return"number"==typeof e?yg(e):null!=e&&""!==e&&!1!==e}(a)&&(function(e){return"ot"===e||"sf"===e||"st"===e}(i)&&"string"==typeof a&&(a=new OE(a)),s[i]=a)})),s}function QE(e,t={}){return e?function(e,t){return WE(e,t)}(JE(e,t),Ng({whitespace:!1},t)):""}function ZE(e,t,s){return Ng(e,function(e,t={}){const s={};if(!e)return s;const i=Object.entries(e),r=Object.entries(CE).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),n=i.reduce(((e,t)=>{var s,i;const[n,a]=t,o=(null===(s=r.find((e=>e[1].includes(n))))||void 0===s?void 0:s[0])||_E;return null!==(i=e[o])&&void 0!==i||(e[o]={}),e[o][n]=a,e}),{});return Object.entries(n).reduce(((e,[s,i])=>(e[s]=QE(i,t),e)),s)}(t,s))}const eT=/CMCD=[^&#]+/;function tT(e,t,s){const i=function(e,t={}){if(!e)return"";const s=QE(e,t);return`CMCD=${encodeURIComponent(s)}`}(t,s);if(!i)return e;if(eT.test(e))return e.replace(eT,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}function sT(e,t,s,i){e&&Object.keys(t).forEach((r=>{const n=e.filter((e=>e.groupId===r)).map((e=>{const n=Ng({},e);return n.details=void 0,n.attrs=new yy(n.attrs),n.url=n.attrs.URI=iT(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),n.groupId=n.attrs["GROUP-ID"]=t[r],n.attrs["PATHWAY-ID"]=i,n}));e.push(...n)}))}function iT(e,t,s,i){const{HOST:r,PARAMS:n,[s]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach((e=>{e&&l.searchParams.set(e,n[e])})),l.href}class rT extends jg{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=rT.CDMCleanupPromise?[rT.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:t,initData:s}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=By(this.config));const t=e.map(Uy).filter((e=>!!e));this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then((r=>{const n=Dy(r);let a,o;if("sinf"===t){if(n!==Ry.FAIRPLAY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=gp(new Uint8Array(s));try{const e=_p(wy(JSON.parse(r).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(e.subarray(8,24)),o=Ry.FAIRPLAY}catch(u){return void this.warn(`${i} Failed to parse sinf: ${u}`)}}else{if(n!==Ry.WIDEVINE&&n!==Ry.PLAYREADY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=function(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let i=0;for(;i+32<s;){const s=Fp(new DataView(e,i));t.push(s),i+=s.size}}return t}(s),l=r.filter((e=>!!e.systemId&&Fy(e.systemId)===n));l.length>1&&this.warn(`${i} Using first of ${l.length} pssh found for selected key-system ${n}`);const c=l[0];if(!c)return void(0===r.length||r.some((e=>!e.systemId))?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${r.map((e=>Fy(e.systemId))).join(",")} pssh data in favor of playlist keys`));if(o=Fy(c.systemId),0===c.version&&c.data)if(o===Ry.WIDEVINE){const e=c.data.length-22;a=new Uint8Array(c.data.subarray(e,e+16))}else o===Ry.PLAYREADY&&(a=Vy(c.data))}if(!o||!a)return;const l=Wg(a),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[l];for(let e=0;e<d.length;e++){const i=d[e],r=i.decryptdata;if(!r.keyId)continue;const n=Wg(r.keyId);if(l===n||-1!==r.uri.replace(/-/g,"").indexOf(l)){if(h=c[n],r.pssh)break;delete c[n],r.pssh=new Uint8Array(s),r.keyId=a,h=c[l]=h.then((()=>this.generateRequestWithPreferredKeySession(i,t,s,"encrypted-event-key-match"))),h.catch((e=>this.handleError(e)));break}}if(!h){if(o!==n)return void this.log(`Ignoring "${e.type}" event with ${o} init data for selected key-system ${n}`);h=c[l]=this.getKeySystemSelectionPromise([o]).then((({keySystem:e,mediaKeys:i})=>{var r;this.throwIfDestroyed();const n=new Hy("ISO-23001-7",l,null!=(r=Uy(e))?r:"");return n.pssh=new Uint8Array(s),n.keyId=a,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:n,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(r,t,s,"encrypted-event-no-match")}))})),h.catch((e=>this.handleError(e)))}}))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Sg.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Sg.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Sg.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Sg.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t[e];return i?i.licenseUrl:e===Ry.WIDEVINE&&s?s:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(e,t,s)=>!!e&&s.indexOf(e)===t,i=t.map((e=>e.audioCodec)).filter(s),r=t.map((e=>e.videoCodec)).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise(((t,s)=>{const n=e=>{const a=e.shift();this.getMediaKeysPromise(a,i,r).then((e=>t({keySystem:a,mediaKeys:e}))).catch((t=>{e.length?n(e):s(t instanceof nT?t:new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};n(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!=typeof s){let e=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===$y&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return s(e,t)}getMediaKeysPromise(e,t,s){const i=function(e,t,s,i){let r;switch(e){case Ry.FAIRPLAY:r=["cenc","sinf"];break;case Ry.WIDEVINE:case Ry.PLAYREADY:r=["cenc"];break;case Ry.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,s,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs=${e}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}))),videoCapabilities:s.map((e=>({contentType:`video/mp4; codecs=${e}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null})))}]}(r,t,s,i)}(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let n=null==r?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${gv(i)}`),n=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:n};return n.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),n.then((s=>{this.log(`Access for key-system "${s.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=s.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((s=>s?this.setMediaKeysServerCertificate(t,e,s):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return n.then((()=>r.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Wg(e.keyId||[])}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return Wg(e.keyId)}updateKeySession(e,t){var s;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Wg((null==(s=e.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,s)=>{const i=By(this.config),r=e.map(Dy).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({keySystem:e})=>{const i=Uy(e);i?t(i):s(new Error(`Unable to find format for key-system "${e}"`))})).catch(s)}))}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[s];if(!r){r=this.getKeySystemForKeyPromise(t).then((({keySystem:s,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(s,r).then((()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:s,mediaKeys:r,decryptdata:t})))))));(this.keyIdToKeySessionPromise[s]=r.then((e=>{const s=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",s,"playlist-key")}))).catch((e=>this.handleError(e)))}return r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof nT?this.hls.trigger(Sg.ERROR,e.data):this.hls.trigger(Sg.ERROR,{type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=Dy(e.keyFormat),s=t?[t]:By(this.config);return this.attemptKeySystemAccess(s)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=By(this.config)),0===e.length)throw new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${gv({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===s.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,s,i){var r,n;const a=null==(r=this.config.drmSystems)||null==(n=r[e.keySystem])?void 0:n.generateRequest;if(a)try{const i=a.call(this.hls,t,s,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,s=i.initData?i.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(f){var o;if(this.warn(f.message),null!=(o=this.hls)&&o.config.debug)throw f}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${s?s.byteLength:null})`);const c=new Kb,d=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void c.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${s.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch((e=>{c.eventNames().length?c.emit("error",e):this.handleError(e)})):"license-release"===i?e.keySystem===Ry.FAIRPLAY&&(this.updateKeySession(e,ky("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},h=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void c.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const s=e.keyStatus;c.emit("keyStatus",s),"expired"===s&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",h);const u=new Promise(((e,t)=>{c.on("error",t),c.on("keyStatus",(s=>{s.startsWith("usable")?e():"output-restricted"===s?t(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===s?t(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${s}"`)):"expired"===s?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${s}"`)}))}));return e.mediaKeysSession.generateRequest(t,s).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>u)).catch((t=>{throw c.removeAllListeners(),this.removeSession(e),t})).then((()=>(c.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,s)=>{if("string"==typeof s&&"object"==typeof t){const e=s;s=t,t=e}this.log(`key status change "${t}" for keyStatuses keyId: ${Wg("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${Wg(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,s=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((r,n)=>{const a={responseType:"arraybuffer",url:i},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,i)=>{r(e.data)},onError:(t,s,r,o)=>{n(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:Og({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,s,r)=>{n(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,s)=>{n(new Error("aborted"))}};s.load(a,l,c)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise(((i,r)=>{e.setServerCertificate(s).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${t}"`),i(e)})).catch((e=>{r(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,i=r.length;s<i;s++){var n,a;t=r[s];const i=null==(n=t.querySelector("name"))?void 0:n.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return ky(atob(l))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)})).catch((n=>{if(!s.decryptdata)throw n;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)})).then((s=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:s||i}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise(((i,r)=>{const n=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,a,n,e)}catch(o){this.error(o)}i(t)}else{const o=s.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new nT({type:Eg.KEY_SYSTEM_ERROR,details:Tg.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const s=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${s} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,n,e,t).then((({xhr:t,licenseChallenge:s})=>{e.keySystem==Ry.PLAYREADY&&(s=this.unpackPlayReadyKeyMessage(t,s)),t.send(s)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const s=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Hy.clearKeyUriToKeyIdMap();const i=s.length;rT.CDMCleanupPromise=Promise.all(s.map((e=>this.removeSession(e))).concat(null==e||null==(t=e.setMediaKeys(null))?void 0:t.catch((e=>{var t;this.log(`Could not clear media keys: ${e}`),null==(t=this.hls)||t.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),s.length=0)})).catch((e=>{var t;this.log(`Could not close sessions and clear media keys: ${e}`),null==(t=this.hls)||t.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:r}=this.config,n=function(e){var t;return"persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some((e=>"persistent-license"===e)))}(r)?new Promise(((e,s)=>{self.setTimeout((()=>s(new Error("MediaKeySession.remove() timeout"))),8e3),t.remove().then(e)})):Promise.resolve();return n.catch((e=>{var t;this.log(`Could not remove session: ${e}`),null==(t=this.hls)||t.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})})).then((()=>t.close())).catch((e=>{var t;this.log(`Could not close session: ${e}`),null==(t=this.hls)||t.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})}))}}}rT.CDMCleanupPromise=void 0;class nT extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function aT(e,t){let s;try{s=new Event("addtrack")}catch(ww){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function oT(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(ww){Vg.debug(`[texttrack-utils]: ${ww}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(i){Vg.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===s&&(e.mode=s)}function lT(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===s&&(e.mode=s)}function cT(e,t,s,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,s){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let i,r=0,n=s;for(;r<=n;)if(i=Math.floor((n+r)/2),t<e[i].startTime)n=i-1;else{if(!(t>e[i].startTime&&r<s))return i;r=i+1}return e[r].startTime-t<t-e[n].startTime?r:n}(e,t);if(r>-1)for(let n=r,a=e.length;n<a;n++){const r=e[n];if(r.startTime>=t&&r.endTime<=s)i.push(r);else if(r.startTime>s)return i}return i}(e.cues,t,s);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function dT(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[s])}return t}function hT(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()}const uT=.025;let fT=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function mT(e,t,s){return`${e.identifier}-${s+1}-${hT(t)}`}class gT{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;if(e<=0||isNaN(t))return!1;return this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return pT(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-pT(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=yg(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return pT(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<uT))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?fT.Range:fT.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function pT(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<uT)?t.start:t.start+t.duration}function vT(e,t,s){const i=new self.URL(e,s);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function yT(e){const t=e.timelineStart,s=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+s).toFixed(2)}]`}class bT{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const e=this.interstitial.playoutLimit,t=this.currentTime;this.startOffset+t>=e&&this.hls.trigger(Sg.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;let n=i.uri;try{n=vT(n,r.sessionId).href}catch(o){}r.loadSource(n);const a=()=>{this.hasDetails=!0};r.once(Sg.LEVEL_LOADED,a),r.once(Sg.AUDIO_TRACK_LOADED,a),r.once(Sg.SUBTITLE_TRACK_LOADED,a),r.on(Sg.MEDIA_ATTACHING,((e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&t.addEventListener("timeupdate",this.checkPlayout)}))}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const s=this.timelineOffset,i=dy.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=dy.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,s){this.hls.on(e,t)}once(e,t,s){this.hls.once(e,t)}off(e,t,s){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${yT(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${null!=(t=this.interstitial)&&t.appendInPlace?"append-in-place":""}`}}class xT extends jg{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((e=>e.reset())),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce(((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s),0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(void 0===t&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&null!=(r=i[s])&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const e=s[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if((null==(s=t[i].event)?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const e=s[r];if(!e.error){const s=e.timelineStart;if(t===s||t>s&&t<s+(e.duration||0))return r}}return 0}get assetIdAtEnd(){var e,t;const s=null==(e=this.items)||null==(t=e[this.length-1])?void 0:t.event;if(s){const e=s.assetList,t=e[e.length-1];if(t)return t.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,n=this.parseDateRanges(i,{url:s.url},t),a=Object.keys(i),o=r?r.filter((e=>!a.includes(e.identifier))):[];n.length&&n.sort(((e,t)=>{const s=e.cue.pre,i=e.cue.post,r=t.cue.pre,n=t.cue.post;if(s&&!r)return-1;if(r&&!s)return 1;if(i&&!n)return 1;if(n&&!i)return-1;if(!(s||r||i||n)){const s=e.startTime,i=t.startTime;if(s!==i)return s-i}return e.dateRange.tagOrder-t.dateRange.tagOrder})),this.events=n,o.forEach((e=>{this.removeEvent(e)})),this.updateSchedule(e,o)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,r=this.parseSchedule(s,e);(t.length||(null==i?void 0:i.length)!==r.length||r.some(((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005)))&&(this.items=r,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let n=0;n<r.length;n++){const a=r[n],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new gT(o,t),this.eventMap[a]=e,!1===s&&(e.appendInPlace=s)),i.push(e)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let n=0;if((e=e.filter((e=>!(e.error||e.cue.once&&e.hasPlayed)))).length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach(((t,a)=>{const l=t.cue.pre,c=t.cue.post,d=e[a-1]||null,h=t.appendInPlace,u=c?r:t.startOffset,f=t.duration,m=t.timelineOccupancy===fT.Range?f:0,g=t.resumptionOffset,p=(null==d?void 0:d.startTime)===u,v=u+t.cumulativeDuration;let y=h?v+f:u+g;if(l||!c&&u<=0){const e=o;o+=m,t.timelineStart=v;const i=n;n+=f,s.push({event:t,start:v,end:y,playout:{start:i,end:n},integrated:{start:e,end:o}})}else{if(!(u<=r))return;{if(!p){const r=u-i;if(r>.033){const l=i,c=o;o+=r;const d=n;n+=r;const h={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:d,end:n},integrated:{start:c,end:o}};s.push(h)}else r>0&&d&&(d.cumulativeDuration+=r,s[s.length-1].end=u)}c&&(y=v),t.timelineStart=v;const r=o;o+=m;const l=n;n+=f,s.push({event:t,start:v,end:y,playout:{start:l,end:n},integrated:{start:r,end:o}})}}const b=t.resumeTime;i=c||b>r?r:b})),i<r){var a;const e=i,t=o,l=r-i;o+=l;const c=n;n+=l,s.push({previousEvent:(null==(a=s[s.length-1])?void 0:a.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:c,end:n},integrated:{start:t,end:o}})}this.setDurations(r,n,o)}else{const e=0;s.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,n=-1;e.forEach(((a,o)=>{const l=a.cue.pre,c=a.cue.post,d=l?0:c?i:a.startTime;this.updateAssetDurations(a);if(n===d?a.cumulativeDuration=r:(r=0,n=d),!c&&a.snapOptions.in&&(a.resumeAnchor=kv(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`))}const h=yg(a.resumeOffset)?a.resumeOffset:a.duration;r+=h}))}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;if(Math.abs(s-i)>uT)return this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1;if(!t)return this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1;return!Object.keys(t).some((i=>{const r=t[i].details,n=r.edge;if(s>=n)return this.log(`"${e.identifier}" resumption ${s} past ${i} playlist end ${n}`),!1;const a=kv(null,r.fragments,s);if(!a)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${i} playlist (${r.fragStart}-${r.fragmentEnd})`),!0;const o="audio"===i?.175:0;return!(Math.abs(a.start-s)<uT+o||Math.abs(a.end-s)<uT+o)&&(this.log(`"${e.identifier}" resumption ${s} not aligned with ${i} fragment bounds (${a.start}-${a.end} sn: ${a.sn} cc: ${a.cc})`),!0)}))}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;e.assetList.forEach(((e,n)=>{const a=t+s;e.startOffset=s,e.timelineStart=a,i||(i=null===e.duration),r||(r=!!e.error);const o=e.error?0:e.duration||0;s+=o})),e.duration=i&&!r?Math.max(s,e.duration):s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ET(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class TT{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=vT(s,this.hls.sessionId,e.baseUrl)}catch(d){const t=this.assignAssetListError(e,Tg.ASSET_LIST_LOAD_ERROR,d,s);return void this.hls.trigger(Sg.ERROR,t)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,n=new(0,r.loader)(r),a={responseType:"json",url:i.href},o=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,s,i,r)=>{const n=t.data,a=null==n?void 0:n.ASSETS;if(Array.isArray(a))e.assetListResponse=n,this.hls.trigger(Sg.ASSET_LIST_LOADED,{event:e,assetListResponse:n,networkDetails:r});else{const t=this.assignAssetListError(e,Tg.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,s,r);this.hls.trigger(Sg.ERROR,t)}},onError:(t,s,i,r)=>{const n=this.assignAssetListError(e,Tg.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${s.url})`),s.url,r,i);this.hls.trigger(Sg.ERROR,n)},onTimeout:(t,s,i)=>{const r=this.assignAssetListError(e,Tg.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${s.url})`),s.url,t,i);this.hls.trigger(Sg.ERROR,r)}};return n.load(a,l,c),this.hls.trigger(Sg.ASSET_LIST_LOADING,{event:e}),n}assignAssetListError(e,t,s,i,r,n){return e.error=s,{type:Eg.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:n,stats:r}}}function ST(e,t,s){wT(e,t,s),e.addEventListener(t,s)}function wT(e,t,s){e.removeEventListener(t,s)}function kT(e){null==e||e.play().catch((()=>{}))}class AT{constructor(e){this.buffered=void 0;const t=(t,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][t]};this.buffered={get length(){return e.length},end:s=>t("end",s,e.length),start:s=>t("start",s,e.length)}}}const LT={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},RT=e=>String.fromCharCode(LT[e]||e),_T=15,IT=100,PT={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},CT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},DT={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},NT={25:2,26:4,29:6,30:8,31:10,27:13,28:15},MT=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class OT{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s="function"==typeof t?t():t;Vg.log(`${this.time} [${e}] ${s}`)}}}const jT=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class FT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class UT{constructor(){this.uchar=" ",this.penState=new FT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class BT{constructor(e){this.chars=[],this.pos=0,this.currPenState=new FT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<IT;t++)this.chars.push(new UT);this.logger=e}equals(e){for(let t=0;t<IT;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<IT;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<IT;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>IT&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=IT)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=RT(e);this.pos>=IT?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<IT;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<IT;s++){const i=this.chars[s].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class $T{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<_T;t++)this.rows.push(new BT(e));this.logger=e}reset(){for(let e=0;e<_T;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let s=0;s<_T;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<_T;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<_T;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+gv(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<_T;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const i=s.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(s.rows[e+n])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+gv(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<_T;r++){const s=this.rows[r].getTextString();s&&(i=r+1,e?t.push("Row "+i+": '"+s+"'"):t.push(s.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}getTextAndFormat(){return this.rows}}class GT{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new $T(s),this.nonDisplayedMemory=new $T(s),this.lastOutputScreen=new $T(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+gv(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class VT{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new OT;this.channels=[null,new GT(e,t,i),new GT(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const e=127&t[s],i=127&t[s+1];let r=!1,n=null;if(0===e&&0===i)continue;this.logger.log(3,(()=>"["+jT([t[s],t[s+1]])+"] -> ("+jT([e,i])+")"));const a=this.cmdHistory;if(e>=16&&e<=31){if(HT(e,i,a)){KT(null,null,a),this.logger.log(3,(()=>"Repeated command ("+jT([e,i])+") is dropped"));continue}KT(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else KT(null,null,a);if(!r&&(n=this.parseChars(e,i),n)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(n)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||n||this.logger.log(2,(()=>"Couldn't parse cleaned data "+jT([e,i])+" orig: "+jT([t[s],t[s+1]])))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,i=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+jT([e,t])+")")),!0)}return!1}parsePAC(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;s=t>=64&&t<=95?1===i?PT[e]:DT[e]:1===i?CT[e]:NT[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return s=t>95?t-96:t-64,i.underline=!(1&~s),s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((s-16)/2),i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,(()=>"Special char '"+RT(e)+"' in channel "+s)),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,(()=>"Char codes =  "+jT(i).join(","))),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let s;const i={};16===e||24===e?(s=Math.floor((t-32)/2),i.background=MT[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}KT(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function KT(e,t,s){s.a=e,s.b=t}function HT(e,t,s){return s.a===e&&s.b===t}var qT=function(){if(null!=Ly&&Ly.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function s(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function i(e){return s(t,e)}function r(e,...t){let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const s in t)e[s]=t[s]}return e}function n(t,n,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",d=!1,h=t,u=n,f=a,m=null,g="",p=!0,v="auto",y="start",b=50,x="middle",E=50,T="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(t){const i=function(t){return s(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return y},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return x},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");x=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return T},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class WT{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function YT(e){function t(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(i||0)}const s=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?t(s[2],s[3],0,s[4]):t(s[1],s[2],s[3],s[4]):null}class zT{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function XT(e,t,s,i){const r=i?e.split(i):[e];for(const n in r){if("string"!=typeof r[n])continue;const e=r[n].split(s);if(2!==e.length)continue;t(e[0],e[1])}}const JT=new qT(0,0,""),QT="middle"===JT.align?"middle":"center";function ZT(e,t,s){const i=e;function r(){const t=YT(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=r(),n(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),n(),t.endTime=r(),n(),function(e,t){const i=new zT;XT(e,(function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",QT,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",QT,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",QT,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===JT.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",QT);let n=i.get("position","auto");"auto"===n&&50===JT.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(e,t)}function eS(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class tS{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new WT,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function s(){let e=t.buffer,s=0;for(e=eS(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const i=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=s();const i=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=s(),t.state){case"HEADER":/:/.test(e)?XT(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new qT(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ZT(e,t.cue,t.regionList)}catch(i){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const s=-1!==e.indexOf("--\x3e");if(!e||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(i){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const sS=/\r\n|\n\r|\n|\r/g,iS=function(e,t,s=0){return e.slice(s,s+t.length)===t};function rS(e,t,s){return hT(e.toString())+hT(t.toString())+hT(s)}function nS(e,t,s,i,r,n,a){const o=new tS,l=qg(new Uint8Array(e)).trim().replace(sS,"\n").split("\n"),c=[],d=t?function(e,t=1){return Xx(e,9e4,1/t)}(t.baseTime,t.timescale):0;let h,u="00:00.000",f=0,m=0,g=!0;o.oncue=function(e){const n=s[i];let a=s.ccOffset;const o=(f-d)/9e4;if(null!=n&&n.new&&(void 0!==m?a=s.ccOffset=n.start:function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(n=r)&&n.new;){var n;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s}(s,i,o)),o){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));a=o-s.presentationOffset}const l=e.endTime-e.startTime,u=iE(9e4*(e.startTime+a-m),9e4*r)/9e4;e.startTime=Math.max(u,0),e.endTime=Math.max(u+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=rS(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?a(h):n(c)},l.forEach((e=>{if(g){if(iS(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((e=>{iS(e,"LOCAL:")?u=e.slice(6):iS(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{m=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(yg(t)&&yg(s)&&yg(i)&&yg(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=6e4*i,t+=36e5*r,t}(u)/1e3}catch(t){h=t}return}""===e&&(g=!1)}o.parse(e+"\n")})),o.flush()}const aS="stpp.ttml.im1t",oS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,lS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,cS={left:"start",center:"center",right:"end",start:"start",end:"end"};function dS(e,t,s,i){const r=Ep(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const n=r.map((e=>qg(e))),a=function(e,t,s=1,i=!1){return Xx(e,t,1/s,i)}(t.baseTime,1,t.timescale);try{n.forEach((e=>s(function(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),i=s.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e)),{}),a="preserve"!==i.getAttribute("xml:space"),o=uS(hS(i,"styling","style")),l=uS(hS(i,"layout","region")),c=hS(i,"body","[begin]");return[].map.call(c,(e=>{const s=fS(e,a);if(!s||!e.hasAttribute("begin"))return null;const i=pS(e.getAttribute("begin"),n),r=pS(e.getAttribute("dur"),n);let c=pS(e.getAttribute("end"),n);if(null===i)throw gS(e);if(null===c){if(null===r)throw gS(e);c=i+r}const d=new qT(i-t,c-t,s);d.id=rS(d.startTime,d.endTime,d.text);const h=function(e,t,s){const i="http://www.w3.org/ns/ttml#styling";let r=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&s.hasOwnProperty(a)&&(r=s[a]);return n.reduce(((s,n)=>{const a=mS(t,i,n)||mS(e,i,n)||mS(r,i,n);return a&&(s[n]=a),s}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:u}=h;if(u){const e=cS[u];e&&(d.lineAlign=e),d.align=u}return Ng(d,h),d})).filter((e=>null!==e))}(e,a))))}catch(o){i(o)}}function hS(e,t,s){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(s)):[]}function uS(e){return e.reduce(((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e}),{})}function fS(e,t){return[].slice.call(e.childNodes).reduce(((e,s,i)=>{var r;return"br"===s.nodeName&&i?e+"\n":null!=(r=s.childNodes)&&r.length?fS(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent}),"")}function mS(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function gS(e){return new Error(`Could not parse ttml timestamp ${e}`)}function pS(e,t){if(!e)return null;let s=YT(e);return null===s&&(oS.test(e)?s=function(e,t){const s=oS.exec(e),i=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+i/t.frameRate}(e,t):lS.test(e)&&(s=function(e,t){const s=lS.exec(e),i=Number(s[1]);switch(s[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}class vS{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function yS(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function bS(e,t){return!!e&&e.kind===yS(t)&&yE(t,e)}const xS=/\s/,ES={newCue(e,t,s,i){const r=[];let n,a,o,l,c;const d=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(n=i.rows[u],o=!0,l=0,c="",!n.isEmpty()){var h;for(let e=0;e<n.chars.length;e++)xS.test(n.chars[e].uchar)&&o?l++:(c+=n.chars[e].uchar,o=!1);n.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const i=eS(c.trim()),f=rS(t,s,i);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(a=new d(t,s,i),a.id=f,a.line=u+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>oT(e,t)))),r}};const TS=/(\d+)-(\d+)\/(\d+)/;class SS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||wS,this.controller=new self.AbortController,this.stats=new ip}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function(e,t){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Ng({},e.headers))};e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return s}(e,this.controller.signal),n="arraybuffer"===e.responseType,a=n?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=o&&yg(o)?o:l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),t.timeout);(dE(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((s=>{var r;this.response=this.loader=s;const a=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),l-(a-i.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new kS(t||"fetch, bad network response",e,s)}i.loading.first=a,i.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=TS.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(yg(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(s.headers)||i.total;const o=null==(r=this.callbacks)?void 0:r.onProgress;return o&&yg(t.highWaterMark)?this.loadProgressively(s,i,e,t.highWaterMark,o):n?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((s=>{var r,n;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=s[a];l&&(i.loaded=i.total=l);const c={url:o.url,data:s,code:o.status},d=null==(r=this.callbacks)?void 0:r.onProgress;d&&!yg(t.highWaterMark)&&d(i,e,s,o),null==(n=this.callbacks)||n.onSuccess(c,i,e,o)})).catch((t=>{var s;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,n=t?t.message:null;null==(s=this.callbacks)||s.onError({code:r,text:n},e,t?t.details:null,i)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const n=new Bb,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return n.dataLength&&r(t,s,n.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<i||n.dataLength?(n.push(l),n.dataLength>=i&&r(t,s,n.flush().buffer,e)):r(t,s,l.buffer,e),o()})).catch((()=>Promise.reject()));return o()}}function wS(e,t){return new self.Request(e.url,t)}class kS extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const AS=/^age:\s*[\d.]+\s*$/im;class LS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ip,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)})).catch((e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)})).then((()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)})).catch((e=>{var r;null==(r=this.callbacks)||r.onError({code:s.status,text:e.message},t,s,i)})):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:n}=s.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&yg(r)?r:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var n,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;s.loaded=s.total=o,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first);const l=null==(n=this.callbacks)?void 0:n.onProgress;l&&l(s,e,r,t);const c={url:t.responseURL,data:r,code:i};return void(null==(a=this.callbacks)||a.onSuccess(c,s,e,t))}}const c=r.loadPolicy.errorRetry;var o;if(Dv(c,s.retry,!1,{url:e.url,data:void 0,code:i}))this.retry(c);else Vg.error(`${i} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,s)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(Dv(e,this.stats.retry,!0))this.retry(e);else{var t;Vg.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Pv(e,s.retry),s.retry++,Vg.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&AS.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const RS=Og(Og({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:LS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends jg{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:s,partCurrent:i,hls:r}=this,{autoLevelEnabled:n,media:a}=r;if(!s||!a)return;const o=performance.now(),l=i?i.stats:s.stats,c=i?i.duration:s.duration,d=o-l.loading.start,h=r.minAutoLevel,u=s.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||u<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!n)return;const m=f>-1&&f!==u,g=!!e||m;if(!g&&(a.paused||!a.playbackRate||!a.readyState))return;const p=r.mainForwardBufferInfo;if(!g&&null===p)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(d<=Math.max(v,c/(2*y)*1e3))return;const b=p?p.len/y:0,x=l.loading.first?l.loading.first-l.loading.start:-1,E=l.loaded&&x>-1,T=this.getBwEstimate(),S=r.levels,w=S[u],k=Math.max(l.loaded,Math.round(c*(s.bitrate||w.averageBitrate)/8));let A=E?d-x:d;A<1&&E&&(A=Math.min(d,8*l.loaded/T));const L=E?1e3*l.loaded/A:0,R=v/1e3,_=L?(k-l.loaded)/L:8*k/T+R;if(_<=b)return;const I=L?8*L:T,P=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),C=this.hls.config.abrBandWidthUpFactor;let D,N=Number.POSITIVE_INFINITY;for(D=u-1;D>h;D--){const e=S[D].maxBitrate,t=!S[D].details||P;if(N=this.getTimeToLoadFrag(R,I,c*e,t),N<Math.min(b,c+R))break}if(N>=_)return;if(N>10*c)return;E?this.bwEstimator.sample(d-Math.min(v,x),l.loaded):this.bwEstimator.sampleTTFB(d);const M=S[D].maxBitrate;this.getBwEstimate()*C>M&&this.resetEstimator(M);const O=this.findBestLevel(M,h,D,0,b,1,1);O>-1&&(D=O),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${u} is loading too slowly;\n      Fragment duration: ${s.duration.toFixed(3)}\n      Time to underbuffer: ${b.toFixed(3)} s\n      Estimated load time for current fragment: ${_.toFixed(3)} s\n      Estimated load time for down switch fragment: ${N.toFixed(3)} s\n      TTFB estimate: ${0|x} ms\n      Current BW estimate: ${yg(T)?0|T:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${D} @ ${0|M} bps`),r.nextLoadLevel=r.nextAutoLevel=D,this.clearTimer();const j=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===D&&D>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${D>0?"and switching down":""}\n      Fragment duration: ${s.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,D>h){let t=this.findBestLevel(this.hls.levels[h].bitrate,h,D,0,e,1,1);-1===t&&(t=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};m||_>2*N?j():this.timer=self.setInterval(j,1e3*N),r.trigger(Sg.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Cg(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.FRAG_LOADING,this.onFragLoading,this),e.on(Sg.FRAG_LOADED,this.onFragLoaded,this),e.on(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Sg.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.FRAG_LOADING,this.onFragLoading,this),e.off(Sg.FRAG_LOADED,this.onFragLoaded,this),e.off(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Sg.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Sg.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){var i;if(!s.bitrateTest)this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Tg.BUFFER_ADD_CODEC_ERROR:case Tg.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Tg.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:s,partCurrent:i}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=i?i.stats:e.stats,r=t-s.loading.start,n=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&n>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,n),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,s,i){return e+s/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;yg(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===Rg&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=s?s.duration:t.duration,r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+i.loaded,a=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:n,duration:a},r.realBitrate=Math.round(8*n/a)}if(t.bitrateTest){const e={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(Sg.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Rg||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const n=this.hls.firstLevel,a=Math.min(Math.max(n,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${n} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&s&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:n}=s,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,n,i,l,0,c,d);if(e>=0)return this.rebufferNotice=-1,e}let h=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){h=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1}}const u=this.findBestLevel(o,n,i,l,h,c,d);if(this.rebufferNotice!==u&&(this.rebufferNotice=u,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${u}`)),u>-1)return u;const f=s.levels[n],m=s.loadLevelObj;return m&&(null==f?void 0:f.bitrate)<m.bitrate?n:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,n,a){var o;const l=i+r,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:u}=this,{levels:f,allAudioTracks:m,loadLevel:g,config:p}=this.hls;if(1===f.length)return 0;const v=f[d],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===g||-1===c;let x,E="SDR",T=(null==v?void 0:v.frameRate)||0;const{audioPreference:S,videoPreference:w}=p,k=this.audioTracksByGroup||(this.audioTracksByGroup=vv(m));let A=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(e,t,s,i){return e.slice(s,i+1).reduce(((e,s,i)=>{if(!s.codecSet)return e;const r=s.audioGroups;let n=e[s.codecSet];n||(e[s.codecSet]=n={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),n.minBitrate=Math.min(n.minBitrate,s.bitrate);const a=Math.min(s.height,s.width);return n.minHeight=Math.min(n.minHeight,a),n.minFramerate=Math.min(n.minFramerate,s.frameRate),n.minIndex=Math.min(n.minIndex,i),n.maxScore=Math.max(n.maxScore,s.score),n.fragmentError+=s.fragmentError,n.videoRanges[s.videoRange]=(n.videoRanges[s.videoRange]||0)+1,r&&r.forEach((e=>{if(!e)return;const s=t.groups[e];s&&(n.hasDefaultAudio=n.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach((e=>{n.channels[e]=(n.channels[e]||0)+s.channels[e]})))})),e}),{})}(f,k,t,s)),r=function(e,t,s,i,r){const n=Object.keys(e),a=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,c=a&&2===parseInt(a);let d=!1,h=!1,u=1/0,f=1/0,m=1/0,g=1/0,p=0,v=[];const{preferHDR:y,allowedVideoRanges:b}=mv(t,r);for(let S=n.length;S--;){const t=e[n[S]];d||(d=t.channels[2]>0),u=Math.min(u,t.minHeight),f=Math.min(f,t.minFramerate),m=Math.min(m,t.minBitrate),b.filter((e=>t.videoRanges[e]>0)).length>0&&(h=!0)}u=yg(u)?u:0,f=yg(f)?f:0;const x=Math.max(1080,u),E=Math.max(30,f);m=yg(m)?m:s,s=Math.max(m,s),h||(t=void 0);const T=n.length>1;return{codecSet:n.reduce(((t,i)=>{const r=e[i];if(i===t)return t;if(v=h?b.filter((e=>r.videoRanges[e]>0)):[],T){if(r.minBitrate>s)return pv(i,`min bitrate of ${r.minBitrate} > current estimate of ${s}`),t;if(!r.hasDefaultAudio)return pv(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return pv(i,`audio codec preference "${o}" not found`),t;if(a&&!c){if(!r.channels[a])return pv(i,`no renditions with ${a} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||c)&&d&&0===r.channels[2])return pv(i,"no renditions with stereo sound found"),t;if(r.minHeight>x)return pv(i,`min resolution of ${r.minHeight} > maximum of ${x}`),t;if(r.minFramerate>E)return pv(i,`min framerate of ${r.minFramerate} > maximum of ${E}`),t;if(!v.some((e=>r.videoRanges[e]>0)))return pv(i,`no variants with VIDEO-RANGE of ${gv(v)} found`),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return pv(i,`video codec preference "${l}" not found`),t;if(r.maxScore<p)return pv(i,`max score of ${r.maxScore} < selected max of ${p}`),t}return t&&(qp(i)>=qp(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,p=r.maxScore,i)}),void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:m,minIndex:g}}(i,E,e,S,w),{codecSet:n,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:d}=r;A=c,x=n,E=d?a[a.length-1]:a[0],T=o,e=Math.max(e,l),this.log(`picked start tier ${gv(r)}`)}else x=null==v?void 0:v.codecSet,E=null==v?void 0:v.videoRange;const L=u?u.duration:h?h.duration:0,R=this.bwEstimator.getEstimateTTFB()/1e3,_=[];for(let P=s;P>=t;P--){var I;const t=f[P],o=P>d;if(!t)continue;if(p.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"==typeof(null==s?void 0:s.decodingInfo)&&(iv(t,k,E,T,e,S)||Dp(t.videoCodec))?(t.supportedPromise=rv(t,k,s),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,i=s.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${gv(e)}`):e.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${i} ${gv(e)}`),i>-1&&s.length>1&&(this.log(`Removing unsupported level ${i}`),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}))):t.supportedResult=ev}if((x&&t.codecSet!==x||E&&t.videoRange!==E||o&&T>t.frameRate||!o&&T>0&&T<t.frameRate||t.supportedResult&&(null==(I=t.supportedResult.decodingInfoResults)||!I[0].smooth))&&(!b||P!==A)){_.push(P);continue}const h=t.details,m=(u?null==h?void 0:h.partTarget:null==h?void 0:h.averagetargetduration)||L;let v;v=o?a*e:n*e;const w=L&&i>=2*L&&0===r?t.averageBitrate:t.maxBitrate,C=this.getTimeToLoadFrag(R,v,w*m,void 0===h);if(v>=w&&(P===c||0===t.loadError&&0===t.fragmentError)&&(C<=R||!yg(C)||y&&!this.bitrateTestDelay||C<l)){const e=this.forcedAutoLevel;return P===g||-1!==e&&e===g||(_.length&&this.trace(`Skipped level(s) ${_.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${f[_[0]].codecs}" ${f[_[0]].videoRange}; not compatible with "${x}" ${E}`),this.info(`switch candidate:${d}->${P} adjustedbw(${Math.round(v)})-bitrate=${Math.round(v-w)} ttfb:${R.toFixed(1)} avgDuration:${m.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${C.toFixed(1)} firstSelection:${b} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${g}`)),b&&(this.firstSelection=P),P}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}},bufferController:class extends jg{constructor(e,t){var s;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:s}=this;e&&this.log("Media source opened"),t&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Sg.MEDIA_ATTACHED,{media:t,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(s=Kg(e.config.preferManagedMediaSource),"undefined"!=typeof self&&s===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.BUFFER_RESET,this.onBufferReset,this),e.on(Sg.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Sg.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Sg.BUFFER_EOS,this.onBufferEos,this),e.on(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Sg.FRAG_PARSED,this.onFragParsed,this),e.on(Sg.FRAG_CHANGED,this.onFragChanged,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.BUFFER_RESET,this.onBufferReset,this),e.off(Sg.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Sg.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Sg.BUFFER_EOS,this.onBufferEos,this),e.off(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Sg.FRAG_PARSED,this.onFragParsed,this),e.off(Sg.FRAG_CHANGED,this.onFragChanged,this),e.off(Sg.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Ng(s,i.tracks):this.sourceBuffers.forEach((e=>{const[t]=e;t&&(s[t]=Ng({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null})),{media:e,mediaSource:t,tracks:s}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(s=this.transferData)&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media,i=Kg(this.appendSource);if(this.transferData=this.overrides=void 0,s&&i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const n=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(n),e)this._objectUrl=s.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(n);if(this.appendSource)try{s.removeAttribute("src");const t=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||t&&n instanceof t,SE(s),function(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,e),s.load()}catch(r){s.src=e}else s.src=e}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(s=e.constructor)?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,n=r?r.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&r&&n){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${gv(s,((e,t)=>"initSegment"===e?void 0:t))};\ntransfer tracks: ${gv(i,((e,t)=>"initSegment"===e?void 0:t))}}`),!Hg(i,s)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,n=this.details,a=Math.max(r,(null==n?void 0:n.fragments[0].start)||0);return a-r>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${r} -> ${a}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${a} currentTime: ${r}`),this.onMediaDetaching(Sg.MEDIA_DETACHING,{}),this.onMediaAttaching(Sg.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,r.forEach((e=>{const t=e,s=i[t];if(s){const e=s.buffer;if(e){const i=this.fragmentTracker,r=s.id;if(i.hasFragments(r)||i.hasParts(r)){const s=dy.getBuffered(e);i.detectEvictedFragments(t,s,r,null,!0)}const n=wE(t),a=[t,e];this.sourceBuffers[n]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,s)}}})),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:n}=this;if(r){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach((([e])=>{e&&this.removeBuffer(e)})),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let s=t.length;s--;)e&&t[s].abort(),r.removeSourceBuffer(t[s]);e&&r.endOfStream()}catch(ww){this.warn(`onMediaDetaching: ${ww.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(i.removeAttribute("src"),this.appendSource&&SE(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Sg.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach((([e])=>{e&&this.resetBuffer(e)})),this.initTracks()}resetBuffer(e){var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(ww){this.warn(`onBufferReset ${e}`,ww)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[wE(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new bE(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),n=!r&&this.sourceBufferCount&&this.media&&i.some((e=>!s[e]));r||n?this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`):(i.forEach((e=>{var i,r,n;const a=t[e],{id:o,codec:l,levelCodec:c,container:d,metadata:h,supplemental:u}=a;let f=s[e];const m=null==(i=this.transferData)||null==(r=i.tracks)?void 0:r[e],g=null!=m&&m.buffer?m:f,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),v=null==g?void 0:g.levelCodec;f||(f=s[e]={buffer:void 0,listeners:[],codec:l,supplemental:u,container:d,levelCodec:c,metadata:h,id:o});const y=Xp(p,v),b=null==y?void 0:y.replace(xE,"$1");let x=Xp(l,c);const E=null==(n=x)?void 0:n.replace(xE,"$1");x&&y&&b!==E&&("audio"===e.slice(0,5)&&(x=zp(x,this.appendSource)),this.log(`switching codec ${p} to ${x}`),x!==(f.pendingCodec||f.codec)&&(f.pendingCodec=x),f.container=d,this.appendChangeType(e,d,x))})),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce(((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e}),{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const r=this.tracks[e];if(r){const n=r.buffer;null!=n&&n.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),n.changeType(i),r.codec=s,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(s,Rg))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&dy.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,Rg))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:n,frag:a,part:o,chunkMeta:l}=t,c=l.buffering[r],d=a.sn,h=self.performance.now();c.start=h;const u=a.stats.buffering,f=o?o.stats.buffering:null;0===u.start&&(u.start=h),f&&0===f.start&&(f.start=h);const m=s.audio;let g=!1;"audio"===r&&"audio/mpeg"===(null==m?void 0:m.container)&&(g=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const p=this.tracks.video,v=null==p?void 0:p.buffer;if(v&&"initSegment"!==d){const e=o||a,t=this.blockedAudioAppend;if("audio"!==r||"main"===n||this.blockedAudioAppend){if("video"===r){const s=e.end;if(t){const e=t.frag.start;(s>e||s<this.lastVideoAppendEnd||dy.isBuffered(v,e))&&this.unblockAudio()}this.lastVideoAppendEnd=s}}else{const t=e.start+.05*e.duration,s=v.buffered,i=this.currentOp("video");s.length||i?!i&&!dy.isBuffered(v,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const y=(o||a).start,b={label:`append-${r}`,execute:()=>{if(c.executeStart=self.performance.now(),g){const e=this.tracks[r];if(e){const t=e.buffer;if(t){const e=y-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${y} (delta: ${e}) sn: ${d})`),t.timestampOffset=y)}}}this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===u.first&&(u.first=e),f&&0===f.first&&(f.first=e);const t={};this.sourceBuffers.forEach((([e,s])=>{e&&(t[e]=dy.getBuffered(s))})),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Sg.BUFFER_APPENDED,{type:r,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const s={type:Eg.MEDIA_ERROR,parent:a.type,details:Tg.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR)s.details=Tg.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)s.errorAction=$v(!0);else if(e.name===EE&&0===this.sourceBufferCount)s.errorAction=$v(!0);else{const e=++this.appendErrors[r];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${i||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||i)&&(s.fatal=!0)}this.hls.trigger(Sg.ERROR,s)}};this.append(b,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Sg.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach((([e])=>{e&&this.append(this.getFlushOp(e,i,r),e)}))}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],n=i?i.elementaryStreams:s.elementaryStreams;n[ap]?r.push("audiovideo"):(n[rp]&&r.push("audio"),n[np]&&r.push("video"));0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers((()=>{const e=self.performance.now();s.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:s.stats;this.hls.trigger(Sg.FRAG_BUFFERED,{frag:s,part:i,stats:t,id:s.type})}),r).catch((e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}))}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t,s;return e&&(!(null!=(t=this.tracks[e])&&t.ended)||(null==(s=this.tracks[e])?void 0:s.ending))}))}onBufferEos(e,t){var s;this.sourceBuffers.forEach((([e])=>{if(e){const s=this.tracks[e];t.type&&t.type!==e||(s.ending=!0,s.ended||(s.ended=!0,this.log(`${e} buffer reached EOS`)))}}));const i=!1!==(null==(s=this.overrides)?void 0:s.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)}))&&(i?(this.log("Queueing EOS"),this.blockUntilOpen((()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(Sg.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))):(this.tracksEnded(),this.hls.trigger(Sg.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach((([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen((()=>this.updateMediaSource(e)))}onError(e,t){if(t.details===Tg.BUFFER_APPEND_ERROR&&t.frag){var s;const e=null==(s=t.errorAction)?void 0:s.nextAutoLevel;yg(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||null===t)return;if(!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,n=t.levelTargetDuration,a=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(yg(a)&&a>=0){const e=Math.max(a,n),t=Math.floor(r/n)*n-e;this.flushBackBuffer(r,n,t)}if(yg(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const e=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),t=Math.max(e,n),s=Math.floor(r/n)*n+t;this.flushFrontBuffer(r,n,s)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach((([e,t])=>{if(t){const r=dy.getBuffered(t);if(r.length>0&&s>r.start(0)){var i;this.hls.trigger(Sg.BACK_BUFFER_REACHED,{bufferEnd:s});const t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(Sg.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(Sg.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:e})}}}))}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach((([t,i])=>{if(i){const r=dy.getBuffered(i),n=r.length;if(n<2)return;const a=r.start(n-1),o=r.end(n-1);if(s>a||e>=a&&e<=o)return;this.hls.trigger(Sg.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:t})}}))}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||"open"!==(null==s?void 0:s.readyState))return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&s.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,i)}}return{duration:1/0}}const r=null==(e=this.overrides)?void 0:e.duration;if(r)return yg(r)?{duration:r}:null;const n=this.media.duration;return i>(yg(s.duration)?s.duration:0)&&i>n||!yg(n)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==e&&(yg(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),void 0!==t&&void 0!==s&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${gv(s)}`),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach((([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}})),this.hls.trigger(Sg.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach((([e])=>{this.executeNext(e)}))}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const a=n,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),n=`${o.container};codecs=${e}`;o.codec=e,this.log(`creating sourceBuffer(${n})${this.currentOp(a)?" Queued":""} ${gv(o)}`);try{const e=s.addSourceBuffer(n),i=wE(a),r=[a,e];t[i]=r,o.buffer=e}catch(r){var i;return this.error(`error while trying to add sourceBuffer: ${r.message}`),this.shiftAndExecuteNext(a),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[a],void this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,sourceBufferName:a,mimeType:n,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&("video"===t||"audiovideo"===t)&&Gp(s,"video")&&(i=function(e,t){const s=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)$p(t[e],"video")||s.push(t[e])}return t&&s.push(t),s.join(",")}(i,s));const r=Xp(i,e.levelCodec);return r?"audio"===t.slice(0,5)?zp(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",((e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(Sg.BUFFER_FLUSHED,{type:e})}))}get mediaSrc(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(s=this.mediaSource)?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,n=this.tracks[e],a=null==n?void 0:n.buffer;if(!i||!r||!a)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=yg(i.duration)?i.duration:1/0,l=yg(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(s,o,l);d>c&&(!n.ending||n.ended)?(n.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=null==s?void 0:s.buffer;if(!i)throw new TE(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch((e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}));else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some((([e,t])=>e&&t.updating))}isQueued(){return this.sourceBuffers.some((([e])=>e&&!!this.currentOp(e)))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map((e=>this.appendBlocker(e)));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then((t=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))}))}stepOperationQueue(e){e.forEach((e=>{var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;s&&!s.updating&&this.shiftAndExecuteNext(e)}))}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce(((e,t)=>e+(this.isPending(this.tracks[t])?1:0)),0)}get sourceBufferCount(){return this.sourceBuffers.reduce(((e,[t])=>e+(t?1:0)),0)}get sourceBufferTypes(){return this.sourceBuffers.map((([e])=>e)).filter((e=>!!e))}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const n=s.bind(this,e);i.listeners.push({event:t,listener:n}),r.addEventListener(t,n)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach((e=>{s.removeEventListener(e.event,e.listener)})),t.listeners.length=0)}},capLevelController:kE,errorController:class extends jg{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Sg.ERROR,this.onError,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Sg.ERROR,this.onError,this),e.off(Sg.ERROR,this.onErrorOut,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Rg?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case Tg.FRAG_LOAD_ERROR:case Tg.FRAG_LOAD_TIMEOUT:case Tg.KEY_LOAD_ERROR:case Tg.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case Tg.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction=$v());case Tg.FRAG_GAP:case Tg.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Mv);case Tg.LEVEL_EMPTY_ERROR:case Tg.LEVEL_PARSING_ERROR:{var n,a;const e=t.parent===Rg?t.level:i.loadLevel;t.details===Tg.LEVEL_EMPTY_ERROR&&null!=(n=t.context)&&null!=(a=n.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case Tg.LEVEL_LOAD_ERROR:case Tg.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case Tg.AUDIO_TRACK_LOAD_ERROR:case Tg.AUDIO_TRACK_LOAD_TIMEOUT:case Tg.SUBTITLE_LOAD_ERROR:case Tg.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===Ag&&e.hasAudioGroup(r.groupId)||r.type===Lg&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Mv,void(t.errorAction.flags=Uv)}return;case Tg.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.loadLevelObj,s=null==e?void 0:e.attrs["HDCP-LEVEL"];s?t.errorAction={action:Mv,flags:Bv,hdcpLevel:s}:this.keySystemError(t)}return;case Tg.BUFFER_ADD_CODEC_ERROR:case Tg.REMUX_ALLOC_ERROR:case Tg.BUFFER_APPEND_ERROR:var o;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(o=t.level)?o:i.loadLevel);return;case Tg.INTERNAL_EXCEPTION:case Tg.BUFFER_APPENDING_ERROR:case Tg.BUFFER_FULL_ERROR:case Tg.LEVEL_SWITCH_ERROR:case Tg.BUFFER_STALLED_ERROR:case Tg.BUFFER_SEEK_OVER_HOLE:case Tg.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=$v())}t.type===Eg.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=Iv(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(Dv(s,i,_v(e),e.response))return{action:jv,flags:Fv,retryConfig:s,retryCount:i};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:n}=t.config,a=Iv(e.details.startsWith("key")?n:r,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i){e.details!==Tg.FRAG_GAP&&i.fragmentError++;if(Dv(a,o,_v(e),e.response))return{action:jv,flags:Fv,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,s);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const s=this.hls;null==t&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,n;const t=e.details;i.loadError++,t===Tg.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:c,loadLevel:d,minAutoLevel:h,maxAutoLevel:u}=s;s.autoLevelEnabled||(s.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,m=(f===_g&&t===Tg.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===Tg.BUFFER_ADD_CODEC_ERROR||t===Tg.BUFFER_APPEND_ERROR))&&c.some((({audioCodec:e})=>i.audioCodec!==e)),g="video"===e.sourceBufferName&&(t===Tg.BUFFER_ADD_CODEC_ERROR||t===Tg.BUFFER_APPEND_ERROR)&&c.some((({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t)),{type:p,groupId:v}=null!=(n=e.context)?n:{};for(let s=c.length;s--;){const r=(s+d)%c.length;if(r!==d&&r>=h&&r<=u&&0===c[r].loadError){var a,o;const s=c[r];if(t===Tg.FRAG_GAP&&f===Rg&&e.frag){const t=c[r].details;if(t){const s=kv(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(p===Ag&&s.hasAudioGroup(v)||p===Lg&&s.hasSubtitleGroup(v))continue;if(f===_g&&null!=(a=i.audioGroups)&&a.some((e=>s.hasAudioGroup(e)))||f===Ig&&null!=(o=i.subtitleGroups)&&o.some((e=>s.hasSubtitleGroup(e)))||m&&i.audioCodec===s.audioCodec||!m&&i.audioCodec!==s.audioCodec||g&&i.codecSet===s.codecSet)continue}l=r;break}}if(l>-1&&s.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:Mv,flags:Fv,nextAutoLevel:l}}return{action:Mv,flags:Uv}}onErrorOut(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case Nv:break;case Mv:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===Tg.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i,hdcpLevel:r,nextAutoLevel:n}=s;switch(i){case Fv:this.switchLevel(e,n);break;case Bv:r&&(t.maxHdcpLevel=nv[nv.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}s.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Tg.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=Zp(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===t&&this.hls.removeLevel(i)}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=s-this.lastDroppedFrames,n=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(Sg.FPS_DROP,{currentDropped:r,currentDecoded:n,totalDroppedFrames:s}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(Sg.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:$y,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ES,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Fb{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Ig),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Sg.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Sg.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Sg.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Sg.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Sg.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Sg.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Sg.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Sg.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Lb,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(lp(s)&&(this.fragPrevious=s),this.state=Lb,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=s.start;for(let l=0;l<r.length;l++)if(a>=r[l].start&&a<=r[l].end){n=r[l];break}const o=s.start+s.duration;n?n.end=o:(n={start:a,end:o},r.push(n)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(0===s&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}})),this.fragmentTracker.removeFragmentsInRange(s,e,Ig)}}onError(e,t){const s=t.frag;(null==s?void 0:s.type)===Ig&&(t.details===Tg.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ab&&(this.state=Lb))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&pE(this.levels,t)?this.levels=t.map((e=>new uv(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new uv(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ig),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==Ab&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:n,id:a}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=r[a];if(a>=r.length||!o)return;this.log(`Subtitle track ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(n.live||null!=(s=o.details)&&s.live){const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(n,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,mb(n,l));else n.hasProgramDateTime&&e.hasProgramDateTime?(wb(n,e),l=n.fragmentStart):t&&(l=t.start,mb(n,l))}if(o.details=n,this.levelLastLoaded=o,a===i&&(this.hls.trigger(Sg.SUBTITLE_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===Lb)){kv(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=i&&i.key&&i.iv&&Ty(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,Sy(i.method)).catch((e=>{throw r.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((s=>{const i=performance.now();r.trigger(Sg.FRAG_DECRYPTED,{frag:t,payload:s,stats:{tstart:e,tdecrypt:i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=Lb}))}}doTick(){if(this.media){if(this.state===Lb){const{currentTrackId:e,levels:t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;if(this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),n=dy.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:a,len:o}=n,l=s.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,d=c.length,h=l.edge;let u=null;const f=this.fragPrevious;if(a<h){const e=i.maxFragLookUpTolerance,t=a>h-e?0:e;u=kv(f,c,Math.max(c[0].start,a),t),!u&&f&&f.start<c[0].start&&(u=c[0])}else u=c[d-1];if(u=this.filterReplacedPrimary(u,s.details),!u)return;const m=c[u.sn-l.startSN-1];if(m&&m.cc===u.cc&&this.fragmentTracker.getState(m)===Gv&&(u=m),this.fragmentTracker.getState(u)===Gv){const e=this.mapToInitFragWhenRequired(u);e&&this.loadFragment(e,s,a)}}}else this.state=Lb}loadFragment(e,t,s){lp(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new AT(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends gE{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=dT(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.on(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Sg.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.off(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Sg.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Sg.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;dT(s.textTracks).forEach((e=>{lT(e)}))}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Subtitle track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=bv(t,e);if(s>-1)r=e[s];else{const e=bv(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const n={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==s?void 0:s.join(",")}" group-id`),this.hls.trigger(Sg.SUBTITLE_TRACKS_UPDATED,n),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!s||r.default)&&(s||e)&&(!e||xv(r,e)))return i}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(vE(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(vE(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){if(yE(t[s],e))return s}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Lg||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&xv(e,s))return s;const i=bv(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(s)return null;{const s=bv(e,t);if(s>-1)return t[s]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),n=e.details,a=null==n?void 0:n.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&n.live?" age "+a.toFixed(1)+(n.type&&" "+n.type||""):""} ${r}`),this.hls.trigger(Sg.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=dT(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter((e=>yE(s,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!yg(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(Sg.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:n,groupId:a="",name:o,type:l,url:c}=i;this.hls.trigger(Sg.SUBTITLE_TRACK_SWITCH,{id:n,groupId:a,name:o,type:l,url:c});const d=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(d)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Sg.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Sg.FRAG_LOADING,this.onFragLoading,this),e.on(Sg.FRAG_LOADED,this.onFragLoaded,this),e.on(Sg.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Sg.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Sg.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Sg.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Sg.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Sg.FRAG_LOADING,this.onFragLoading,this),e.off(Sg.FRAG_LOADED,this.onFragLoaded,this),e.off(Sg.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Sg.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Sg.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Sg.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new vS(this,"textTrack1"),t=new vS(this,"textTrack2"),s=new vS(this,"textTrack3"),i=new vS(this,"textTrack4");this.cea608Parser1=new VT(1,e,t),this.cea608Parser2=new VT(3,s,i)}addCues(e,t,s,i,r){let n=!1;for(let d=r.length;d--;){const e=r[d],i=(a=e[0],o=e[1],l=t,c=s,Math.min(o,c)-Math.max(a,l));if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],s),n=!0,i/(s-t)>.5))return}var a,o,l,c;if(n||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,i)}else{const r=this.Cues.newCue(null,t,s,i);this.hls.trigger(Sg.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){const{unparsedVttFrags:n}=this;s===Rg&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),n.length&&(this.unparsedVttFrags=[],n.forEach((e=>{this.onFragLoaded(Sg.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(bS(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:n}=t[e],a=this.getExistingTrack(r,n);if(a)s[e]=a,lT(s[e]),aT(s[e],i);else{const t=this.createTextTrack("captions",r,n);t&&(t[e]=!0,s[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(Sg.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach((e=>{lT(i[e]),delete i[e]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)lT(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some((e=>e.textCodec===aS));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(pE(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?dT(e.textTracks):null;if(this.tracks.forEach(((e,s)=>{let i;if(t){let s=null;for(let i=0;i<t.length;i++)if(t[i]&&bS(t[i],e)){s=t[i],t[i]=null;break}s&&(i=s)}if(i)lT(i);else{const t=yS(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(Sg.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s=`textTrack${t[1]}`,i=this.captionsProperties[s];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Rg){var s,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:n}=this,{cc:a,sn:o}=t.frag,l=null!=(s=null==(i=t.part)?void 0:i.index)?s:-1;e&&r&&(o!==n+1||o===n&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===Ig)if(i.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),e&&e.textCodec===aS?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(Sg.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;dS(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),s.trigger(Sg.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{s.logger.log(`Failed to parse IMSC1: ${t}`),s.trigger(Sg.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:n}=this,a=r.length-1;if(!r[s.cc]&&-1===a)return void n.push(e);const o=this.hls;nS(null!=(t=s.initSegment)&&t.data?Pp(s.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,(e=>{this._appendCues(e,s.level),o.trigger(Sg.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?n.push(e):this._fallbackToIMSC1(s,i),o.logger.log(`Failed to parse VTT cue: ${t}`),r&&a>s.cc||o.trigger(Sg.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:t})}))}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||dS(t,this.initPTS[e.cc],(()=>{s.textCodec=aS,this._parseIMSC1(e,t)}),(()=>{s.textCodec="wvtt"}))}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach((e=>oT(s,e)))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(Sg.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Ig&&this.onFragLoaded(Sg.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(s.type!==Rg||"NONE"!==this.closedCaptionsForLevel(s))for(let r=0;r<i.length;r++){const e=i[r].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(i[r].pts,t[0]),this.cea608Parser2.addData(i[r].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:n}=this;if(n&&!(n.currentTime<s)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach((i=>cT(e[i],t,s)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach((s=>cT(e[s],t,i)))}}}extractCea608Data(e){const t=[[],[]],s=31&e[0];let i=2;for(let r=0;r<s;r++){const s=e[i++],r=127&e[i++],n=127&e[i++];if(0===r&&0===n)continue;if(!!(4&s)){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(n))}}return t}},audioStreamController:class extends Fb{constructor(e,t,s){super(e,t,s,"audio-stream-controller",_g),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Sg.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Sg.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Sg.BUFFER_RESET,this.onBufferReset,this),e.on(Sg.BUFFER_CREATED,this.onBufferCreated,this),e.on(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Sg.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Sg.FRAG_LOADING,this.onFragLoading,this),e.on(Sg.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Sg.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Sg.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Sg.BUFFER_RESET,this.onBufferReset,this),e.off(Sg.BUFFER_CREATED,this.onBufferCreated,this),e.off(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Sg.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Sg.FRAG_LOADING,this.onFragLoading,this),e.off(Sg.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){if(s===Rg){const e=t.cc,s=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}/${r}`),this.mainAnchor=t,this.state===Ob){const s=this.waitingData;(!s&&!this.loadingParts||s&&s.frag.cc!==e)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&s&&s.cc!==e?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,s.abortRequests(),this.resetLoadingState()):this.state===Lb&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),s=e.cc;return function(e,t,s){if(e&&e.startCC<=t&&e.endCC>=t){const i=s.start,r=s.end;let n=e.fragments;if(!s.relurl){const{fragmentHint:t}=e;t&&(n=n.concat(t))}return wv(n,(e=>e.cc<t||e.end<=i?1:e.cc>t||e.start>=r?-1:0))}return null}(t,s,e)||t&&Rv(t.fragments,s)||e}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=Ab);const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),s>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=Lb):this.state=Pb,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Lb:this.doTickIdle();break;case Pb:{const{levels:e,trackId:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=Ob}break}case Ib:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=Lb}break}case Ob:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,n=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=_b;const e={frag:t,part:s,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else n&&n.cc!==e.frag.cc&&(this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${n.cc}`),this.nextLoadPosition=this.findSyncFrag(n).start,this.clearWaitingFragment())}else this.state=Lb}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==Ab&&(this.state=Lb))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,n=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!n.startFragPrefetch)||null==s||!s[r])return;const a=s[r],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=Pb,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,rp,_g));const c=this.getFwdBufferInfo(l,_g);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(Sg.BUFFER_EOS,{type:"audio"}),void(this.state=Nb);const d=c.len,h=t.maxBufferLength,u=o.fragments,f=u[0].start,m=this.getLoadPosition(),g=this.flushing?m:c.end;if(this.switchingTrack&&i){const e=m;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05)}if(d>=h&&!this.switchingTrack&&g<u[u.length-1].start)return;let p=this.getNextFragment(g,o);if(p&&this.isLoopLoading(p,g)&&(p=this.getNextFragmentLoopLoading(p,o,c,Rg,h)),!p)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&lp(p)&&!p.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===Hv&&(this.mainFragLoading=v=null),v&&lp(v))){if(p.start>v.end){const e=this.fragmentTracker.getFragAtPos(g,Rg);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(p.start>v.end)return}this.loadFragment(p,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new uv(e)))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Ab&&(this.setInterval(100),this.state=Lb,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Sg.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:n,groupId:a,track:o}=t;if(!i)return void this.warn(`Audio tracks reset while loading track ${n} "${o.name}" of "${a}"`);const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==Ab&&(this.state=Pb));this.cachedTrackLoadedData=null,this.log(`Audio track ${n} "${o.name}" of "${a}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const c=i[n];let d=0;if(r.live||null!=(s=c.details)&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var h;if(c.details)d=this.alignPlaylists(r,c.details,null==(h=this.levelLastLoaded)?void 0:h.details);r.alignedSliding||(Sb(r,l),r.alignedSliding||wb(r,l),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(Sg.AUDIO_TRACK_UPDATED,{details:r,id:n,groupId:t.groupId}),this.state!==Pb||this.waitForCdnTuneIn(r)||(this.state=Lb),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:n,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const d=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new mE(this.hls,_g,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[s.cc],f=null==(t=s.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=i?i.index:-1,n=-1!==t,a=new ly(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,n);h.push(r,f,d,"",s,i,c.totalduration,e,a,u)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new Bb,complete:!1};e.push(new Uint8Array(r)),this.state!==Ab&&(this.state=Ob)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Rg&&lp(t.frag)&&(this.mainFragLoading=t,this.state===Lb&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type===_g)if(this.fragContextChanged(s))this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(lp(s)){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(Sg.AUDIO_TRACK_SWITCHED,Og({},e)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}else this.audioOnly||s.type!==Rg||s.elementaryStreams.video||s.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var s;if(t.fatal)this.state=Mb;else switch(t.details){case Tg.FRAG_GAP:case Tg.FRAG_PARSING_ERROR:case Tg.FRAG_DECRYPT_ERROR:case Tg.FRAG_LOAD_ERROR:case Tg.FRAG_LOAD_TIMEOUT:case Tg.KEY_LOAD_ERROR:case Tg.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_g,t);break;case Tg.AUDIO_TRACK_LOAD_ERROR:case Tg.AUDIO_TRACK_LOAD_TIMEOUT:case Tg.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Pb||(null==(s=t.context)?void 0:s.type)!==Ag||(this.state=Lb);break;case Tg.BUFFER_ADD_CODEC_ERROR:case Tg.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.resetLoadingState();break;case Tg.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Tg.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==np&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==np){this.flushing=!1,this.bufferFlushed=!0,this.state===Nb&&(this.state=Lb);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,_g),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:c}=a,{details:d}=c,{audio:h,text:u,id3:f,initSegment:m}=r;if(!this.fragContextChanged(o)&&d){if(this.state=Cb,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,m.tracks,e,n),i.trigger(Sg.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=h;l&&(l.elementaryStreams[rp]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(rp,e,t,s,i),this.bufferFragmentData(h,o,l,n)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=Ng({id:s,frag:o,details:d},f);i.trigger(Sg.FRAG_PARSING_METADATA,e)}if(u){const e=Ng({id:s,frag:o,details:d},u);i.trigger(Sg.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,s,i){if(this.state!==Cb)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=_g;const n=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${n}/${r.codec}]`),n&&1===n.split(",").length&&(r.levelCodec=n),this.hls.trigger(Sg.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:a};this.hls.trigger(Sg.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===Gv||i===Kv)if(lp(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ob;const s=this.mainDetails;s&&s.fragmentStart!==t.details.fragmentStart&&wb(t.details,s)}else super.loadFragment(e,t,s);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:n,channels:a}=this.bufferedTrack;xv({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:n,channels:a},e,Ev)||(Sv(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Sg.AUDIO_TRACK_SWITCHED,Og({},e))}},audioTrackController:class extends gE{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.on(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Sg.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.off(Sg.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Sg.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Sg.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Audio track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Audio track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=bv(t,e,Ev);if(s>-1)r=e[s];else{const e=bv(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==s?void 0:s.join(",")}`),this.hls.trigger(Sg.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var n;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(n=this.groupIds)?void 0:n.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Ag||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&xv(e,i,Ev))return i;const r=bv(e,this.tracksInGroup,Ev);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,s,i,r){const n=t[i],a=t.reduce(((e,t,s)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(s),e}),{})[n.uri];a.length>1&&(i=Math.max.apply(Math,a));const o=n.videoRange,l=n.frameRate,c=n.codecSet.substring(0,4),d=Tv(t,i,(t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return bv(e,n,r)>-1}));return d>-1?d:Tv(t,i,(t=>{const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return bv(e,n,r)>-1}))}(e,t.levels,s,i,Ev);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=bv(e,s);if(t>-1)return s[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(Sg.AUDIO_TRACK_SWITCHING,Og({},i)),r)return;const n=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(n)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if((!this.selectDefaultTrack||i.default)&&(!e||xv(e,i,Ev)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:n,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(xv({name:s,lang:i,assocLang:r,characteristics:n,audioCodec:a,channels:o},t[e],Ev))return e}for(let l=0;l<t.length;l++){const s=t[l];if(vE(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const s=t[l];if(vE(e.attrs,s.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Sv(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),n=e.details,a=null==n?void 0:n.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&n.live?" age "+a.toFixed(1)+(n.type&&" "+n.type||""):""} ${r}`),this.hls.trigger(Sg.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}},emeController:rT,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:AE.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:s}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),n={d:1e3*(s||t).duration,ot:r};r!==AE.VIDEO&&r!==AE.AUDIO&&r!=AE.MUXED||(n.br=i.bitrate/1e3,n.tb=this.getTopBandwidth(r)/1e3,n.bl=this.getBufferLength(r));const a=s?this.getNextPart(s):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(n.nor=a.url),this.apply(e,n)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Sg.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Sg.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:LE.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ng(t,this.createData());const s=t.ot===AE.INIT||t.ot===AE.VIDEO||t.ot===AE.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce(((e,s)=>(i.includes(s)&&(e[s]=t[s]),e)),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),ZE(e.headers,t,r)):e.url=tT(e.url,t,r)}getNextFrag(e){var t;const s=null==(t=this.hls.levels[e.level])?void 0:t.details;if(s){const t=e.sn-s.startSN;return s.fragments[t+1]}}getNextPart(e){var t,s;const{index:i,fragment:r}=e,n=null==(t=this.hls.levels[r.level])||null==(s=t.details)?void 0:s.partList;if(n){const{sn:e}=r;for(let t=n.length-1;t>=0;t--){const s=n[t];if(s.index===i&&s.fragment.sn===e)return n[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?AE.TIMED_TEXT:"initSegment"===e.sn?AE.INIT:"audio"===t?AE.AUDIO:"main"===t?this.hls.audioTracks.length?AE.VIDEO:AE.MUXED:void 0}getTopBandwidth(e){let t,s=0;const i=this.hls;if(e===AE.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,s=e>-1?e+1:i.levels.length;t=i.levels.slice(0,s)}for(const r of t)r.bitrate>s&&(s=r.bitrate);return s>0?s:NaN}getBufferLength(e){const t=this.media,s=e===AE.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!t)return NaN;return 1e3*dy.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}},contentSteeringController:class extends jg{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((null==s?void 0:s.action)===Mv&&s.flags===Uv){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:s,pathwayId:i,type:n}=t.context;s&&e?r=this.getPathwayForGroupId(s,n,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==r),s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${gv(i)} penalized: ${gv(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this._pathwayPriority=e;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach((e=>{i-s[e]>3e5&&delete s[e]}));for(let r=0;r<e.length;r++){const i=e[r];if(i in s)continue;if(i===this.pathwayId)return;const n=this.hls.nextLoadLevel,a=this.hls.levels[n];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,bb(t),this.hls.trigger(Sg.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[n];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=n);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===Ag&&i[r].hasAudioGroup(e)||t===Lg&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach((e=>{const{ID:r,"BASE-ID":n,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(n).map((e=>{const t=new yy(e.attrs);t["PATHWAY-ID"]=r;const n=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;n&&(s[t.AUDIO]=n,t.AUDIO=n),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=iT(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new uv({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let s=1;s<e.audioGroups.length;s++)c.addGroupId("audio",`${e.audioGroups[s]}_clone_${r}`);if(e.subtitleGroups)for(let s=1;s<e.subtitleGroups.length;s++)c.addGroupId("text",`${e.subtitleGroups[s]}_clone_${r}`);return c}));t.push(...o),sT(this.audioTracks,s,a,r),sT(this.subtitleTracks,i,a,r)}))}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new s(t);try{i=new self.URL(e)}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},n=t.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,s,r)=>{this.log(`Loaded steering manifest: "${i}"`);const n=e.data;if(1!==(null==n?void 0:n.VERSION))return void this.log(`Steering VERSION ${n.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=n.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=n;if(a)try{this.uri=new self.URL(a,i).href}catch(c){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const d={steeringManifest:n,url:i.toString()};this.hls.trigger(Sg.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},onError:(e,t,s,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,s)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}},interstitialsController:class extends jg{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const s=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(s){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule()}if(this.checkBuffer(),s&&e<i.start||e>=i.end){var r;const e=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!s){const t=this.findItemIndex(i);if(e>t){const s=this.schedule.findJumpRestrictedIndex(t+1,e);if(s>t)return void this.setSchedulePosition(s)}}return void this.setSchedulePosition(e)}const n=this.playingAsset;if(!n){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=n.timelineStart,o=n.duration||0;(s&&e<a||e>=a+o)&&this.setScheduleToAssetAtTime(e,n)},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const s=this.playingAsset;if(!s)return;e>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(e,s)},this.onScheduleUpdate=(e,t)=>{const s=this.schedule,i=this.playingItem,r=s.events||[],n=s.items||[],a=s.durations,o=e.map((e=>e.identifier)),l=!(!r.length&&!o.length);if(l&&this.log(`INTERSTITIALS_UPDATED (${r.length}): ${r}\nSchedule: ${n.map((e=>ET(e)))}`),o.length&&this.log(`Removed events ${o}`),this.playerQueue.forEach((e=>{if(e.interstitial.appendInPlace){const s=e.assetItem.timelineStart,i=e.timelineOffset-s;if(i)try{e.timelineOffset=s}catch(t){Math.abs(i)>uT&&this.warn(`${t} ("${e.assetId}" ${e.timelineOffset}->${s})`)}}})),i){const e=this.updateItem(i,this.timelinePos);this.itemsMatch(i,e)&&(this.playingItem=e,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const c=this.bufferingItem;if(c){const e=this.updateItem(c,this.bufferedPos);this.itemsMatch(c,e)?this.bufferingItem=e:c.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(c.event,null))}if(e.forEach((e=>{e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,null)}))})),l||t){if(this.hls.trigger(Sg.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:n.slice(0),durations:a,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn(`Interstitial "${i.event.identifier}" removed while playing`),void this.primaryFallback(i.event);this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new TT(e),this.schedule=new xT(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Sg.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Sg.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Sg.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Sg.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Sg.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Sg.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Sg.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Sg.MEDIA_ENDED,this.onMediaEnded,this),e.on(Sg.ERROR,this.onError,this),e.on(Sg.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Sg.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Sg.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Sg.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Sg.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Sg.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Sg.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Sg.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Sg.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Sg.MEDIA_ENDED,this.onMediaEnded,this),e.off(Sg.ERROR,this.onError,this),e.off(Sg.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){wT(e,"play",this.onPlay),wT(e,"pause",this.onPause),wT(e,"seeking",this.onSeeking),wT(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;ST(s,"seeking",this.onSeeking),ST(s,"timeupdate",this.onTimeupdate),ST(s,"play",this.onPlay),ST(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===s)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(s);this.setSchedulePosition(e)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,r,a,o)=>{if(t){let l=t[i].start;const c=t.event;if(c){if("playout"===i||c.timelineOccupancy!==fT.Point){const e=s(r);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?n():e[a])-t.start}return l}return 0},r=(t,s)=>{if(0!==t&&"primary"!==s&&e.schedule.length){var i;const r=e.schedule.findItemIndexAtTime(t),n=null==(i=e.schedule.items)?void 0:i[r];if(n){return t+(n[s].start-n.start)}}return t},n=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?a("primary"):Math.max(t,0)},a=t=>{var s;return null!=(s=e.primaryDetails)&&s.live?e.primaryDetails.edge:e.schedule.durations[t]},o=(t,r)=>{var n,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(n=o.event)&&n.restrictions.skip)return;e.log(`seek to ${t} "${r}"`);const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,r),d=null==(a=e.schedule.items)?void 0:a[c],h=e.getBufferingPlayer(),u=null==h?void 0:h.interstitial,f=null==u?void 0:u.appendInPlace,m=l&&e.itemsMatch(l,d);if(l&&(f||m)){const n=s(e.playingAsset),a=(null==n?void 0:n.media)||e.primaryMedia;if(a){const s="primary"===r?a.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-s,c=(f?s:a.currentTime)+o;if(c>=0&&(!n||f||c<=n.duration))return void(a.currentTime=c)}}if(d){let s=t;if("primary"!==r){const e=t-d[r].start;s=d.start+e}const i=!e.isInterstitial(d);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!d.event.appendInPlace){if(l){const n=e.findItemIndex(l);if(c>n){const t=e.schedule.findJumpRestrictedIndex(n+1,c);if(t>n)return void e.setSchedulePosition(t)}let a=0;if(i)e.timelinePos=s,e.checkBuffer();else{var g;const e=null==d||null==(g=d.event)?void 0:g.assetList;if(e){const s=t-(d[r]||d).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&s>=i.startOffset&&s<i.startOffset+i.duration){a=t;break}}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=s)}}},l=()=>{const s=e.effectivePlayingItem;if(e.isInterstitial(s))return s;const i=t();return e.isInterstitial(i)?i:null},c={get currentTime(){const t=l(),s=e.effectivePlayingItem;return s&&s===t?i(s,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-s.playout.start:0},set currentTime(t){const s=l(),i=e.effectivePlayingItem;i&&i===s&&o(t+i.playout.start,"playout")},get duration(){const e=l();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const s=null==(t=l())?void 0:t.event.assetList;return s?s.map((t=>e.getAssetPlayer(t.identifier))):[]},get playingIndex(){var t;const s=null==(t=l())?void 0:t.event;return s&&e.effectivePlayingAsset?s.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var t,s;return(null==(t=e.schedule)||null==(s=t.events)?void 0:s.slice(0))||[]},get schedule(){var t,s;return(null==(t=e.schedule)||null==(s=t.items)?void 0:s.slice(0))||[]},get interstitialPlayer(){return l()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const s=t();return e.findItemIndex(s)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return n()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){o(e,"primary")},get duration(){return a("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){o(e,"integrated")},get duration(){return a("integrated")},get seekableStart(){var t;return r((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,s=null==t?void 0:t.event;if(s&&!s.restrictions.skip){const i=e.findItemIndex(t);if(s.appendInPlace){const e=t.playout.start+t.event.duration;o(e+.001,"playout")}else e.advanceAfterAssetEnded(s,i,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&s)&&this.findItemIndex(t)===s.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t,s;if(null===this.mediaSelection)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(t=e.event)&&t.appendInPlace&&(r=this.primaryMedia);const n=null==(s=r)?void 0:s.currentTime;return void 0!==n&&yg(n)?n:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${gv(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const n=this.hls,a=e!==n,o=a&&e.interstitial.appendInPlace,l=null==(s=this.detachedData)?void 0:s.mediaSource;let c;if(n.media)o&&(r=n.transferMedia(),this.detachedData=r),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),c=`${e}`):c="detached MediaSource"}else c="detached media";if(!r)if(l)r=this.detachedData,this.log(`using detachedData: MediaSource ${gv(r)}`);else if(!this.detachedData||n.media===t){const e=this.playerQueue;e.length>1&&e.forEach((e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}})),this.hls.detachMedia(),this.detachedData={media:t}}const d=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),h=d&&r?r:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c}`),h===r){const t=a&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(-1===s){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const s=e.findEventIndex(t[0].identifier);this.setSchedulePosition(s)}else if(s>=0||!this.primaryLive){const t=this.timelinePos=s>0?s:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAfterAssetEnded(e,t,s){const i=s+1;if(e.isAssetPastPlayoutLimit(i)||e.assetList[i].error){const s=this.schedule.items;if(s){const i=t+1;if(i>=s.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.timelinePos=r,this.checkBuffer()),this.setSchedulePosition(i)}}else this.setSchedulePosition(t,i)}setScheduleToAssetAtTime(e,t){const s=this.schedule,i=t.parentIdentifier,r=s.getEvent(i);if(r){const t=s.findEventIndex(i),n=s.findAssetIndex(r,e);this.setSchedulePosition(t,n)}}setSchedulePosition(e,t){const s=this.schedule.items;if(!s||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?s[e]:null,r=this.playingItem,n=this.playingLastItem;if(this.isInterstitial(r)){var a;const l=r.event,c=this.playingAsset,d=null==c?void 0:c.identifier,h=d?this.getAssetPlayer(d):null;if(h&&d&&(!this.eventItemsMatch(r,i)||void 0!==t&&d!==(null==(a=l.assetList)?void 0:a[t].identifier))){var o;const t=l.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${l.assetList.length} ${yT(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(Sg.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(d,i),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(r,i)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${l} ${ET(r)}`),l.hasPlayed=!0,this.hls.trigger(Sg.INTERSTITIAL_ENDED,{event:l,schedule:s.slice(0),scheduleIndex:e}),l.cue.once)){this.updateSchedule();const e=this.schedule.items;if(i&&e){const s=this.schedule.findItemIndex(i);this.advanceSchedule(s,e,t,r,n)}return}}this.advanceSchedule(e,s,t,r,n)}advanceSchedule(e,t,s,i,r){const n=e>=0?t[e]:null,a=this.primaryMedia,o=this.playerQueue;if(o.length&&o.forEach((t=>{const s=t.interstitial,i=this.schedule.findEventIndex(s.identifier);(i<e||i>e+1)&&this.clearInterstitial(s,n)})),this.isInterstitial(n)){this.timelinePos=Math.min(Math.max(this.timelinePos,n.start),n.end);const r=n.event;void 0===s&&(s=this.schedule.findAssetIndex(r,this.timelinePos));const o=this.waitingItem;this.assetsBuffered(n,a)||this.setBufferingItem(n);let l=this.preloadAssets(r,s);if(this.eventItemsMatch(n,o||i)||(this.waitingItem=n,this.log(`INTERSTITIAL_STARTED ${ET(n)} ${r.appendInPlace?"append in place":""}`),this.hls.trigger(Sg.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${r}`);if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!a)return void this.log(`Waiting for attachMedia to start Interstitial ${r}`);this.waitingItem=this.endedItem=null,this.playingItem=n;const c=r.assetList[s];if(!c){const i=t[e+1],n=this.media;return i&&n&&!this.isInterstitial(i)&&n.currentTime<i.start&&(n.currentTime=this.timelinePos=i.start),void this.advanceAfterAssetEnded(r,e,s||0)}if(l||(l=this.getAssetPlayer(c.identifier)),null===l||l.destroyed){const e=r.assetList.length;this.warn(`asset ${s+1}/${e} player destroyed ${r}`),l=this.createAssetPlayer(r,c,s)}if(!this.eventItemsMatch(n,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(l,s,t,e,a),this.shouldPlay&&kT(l.media)}else null!==n?(this.resumePrimary(n,e,i),this.shouldPlay&&kT(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e,t;return null==(e=this.mediaSelection)||null==(t=e.main)?void 0:t.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,s){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ET(e)}`),null==(i=this.detachedData)||!i.mediaSource){let s=this.timelinePos;(s<e.start||s>=e.end)&&(s=this.getPrimaryResumption(e,t),this.timelinePos=s),this.attachPrimary(s,e)}if(!s)return;const r=this.schedule.items;r&&(this.log(`resumed ${ET(e)}`),this.hls.trigger(Sg.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(s<e.fragmentStart||s>e.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return dy.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(s=i.mainForwardBufferInfo)?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Sg.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Sg.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level)return;const s=this.hls.levels[t.level],i=Og(Og({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Og(Og({},this.altSelection),{},{audio:s}));const r=Og(Og({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Og(Og({},this.altSelection),{},{subtitles:s}));const r=Og(Og({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=yv(t);this.playerQueue.forEach((e=>e.hls.setAudioOption(t)||e.hls.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=yv(t);this.playerQueue.forEach((e=>e.hls.setSubtitleOption(t)||-1!==t.id&&e.hls.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var s;const e=this.schedule.findEventIndex(i.identifier),t=null==(s=this.schedule.items)?void 0:s[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){const s=this.schedule.items;if(e&&s){return s[this.findItemIndex(e,t)]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===(null==(s=t.event)?void 0:s.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const s=dy.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,t,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const n=this.playingItem,a=this.findItemIndex(n);let o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,c;const s=this.findItemIndex(r),i=Math.min(s+1,t.length-1),n=t[i];if((-1===o&&r&&e>=r.end||null!=(l=n.event)&&l.appendInPlace&&e+.01>=n.start)&&(o=i),i-a>1&&!1===(null==r||null==(c=r.event)?void 0:c.appendInPlace))return;if(this.bufferedPos=e,o>s&&o>a)this.bufferedToItem(n);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&n.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(n)&&this.preloadAssets(n.event,0)}}else s&&n&&!this.itemsMatch(n,r)&&(o===a?this.bufferedToItem(n):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some((e=>{const s=this.getAssetPlayer(e.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(t))}))}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:r}=s;if(!i||!r)return t;const n=this.isInterstitial(e),a=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const s=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${ET(e)}`+(t?` (${s.toFixed(2)} remaining)`:"")),n?e.event.assetList.forEach((e=>{const t=this.getAssetPlayer(e.identifier);t&&t.resumeBuffering()})):(this.hls.resumeBuffering(),this.playerQueue.forEach((e=>e.pauseBuffering())))}this.hls.trigger(Sg.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==s){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=0===s.assetList.length&&!s.assetListLoader,r=s.cue.once;if(i||!r){const e=this.preloadAssets(s,t);if(null!=e&&e.interstitial.appendInPlace){const i=s.assetList[t],r=this.primaryMedia;i&&r&&this.bufferAssetPlayer(e,r)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,n=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let n,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(n=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${n?` live-start: ${o} start-offset: ${n}`:""}`),s)return this.createAsset(e,0,0,r,e.duration,s);const l=this.assetListLoader.loadAssetList(e,n);l&&(e.assetListLoader=l)}else if(!n&&i){for(let s=t;s<i;s++){const t=e.assetList[s],i=this.getAssetPlayerQueueIndex(t.identifier);-1!==i&&!this.playerQueue[i].destroyed||t.error||this.createAssetPlayer(e,t,s)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach((t=>{this.hls.trigger(Sg.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s];return null}createAsset(e,t,s,i,r,n){const a={parentIdentifier:e.identifier,identifier:mT(e,n,t),duration:r,startOffset:s,timelineStart:i,uri:n};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){this.log(`create HLSAssetPlayer for ${yT(t)}`);const i=this.hls,r=i.userConfig;let n=r.videoPreference;const a=i.loadLevelObj||i.levels[i.currentLevel];(n||a)&&(n=Ng({},n),a.videoCodec&&(n.videoCodec=a.videoCodec),a.videoRange&&(n.allowedVideoRanges=[a.videoRange]));const o=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const s=t.duration;s&&e<s&&(c=e)}}const d=t.identifier,h=Og(Og({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:n,audioPreference:o||r.audioPreference,subtitlePreference:l||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const u=h.cmcd;null!=u&&u.sessionId&&u.contentId&&(h.cmcd=Ng({},u,{contentId:hT(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const f=new bT(this.HlsPlayerClass,h,e,t);this.playerQueue.push(f),e.assetList[s]=t;const m=i=>{if(i.live){const t=new Error(`Interstitials MUST be VOD assets ${e}`),i={fatal:!0,type:Eg.OTHER_ERROR,details:Tg.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};return void this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)}const r=i.edge-i.fragmentStart,n=t.duration;(null===n||r>n)&&(this.log(`Interstitial asset "${d}" duration change ${n} > ${r}`),t.duration=r,this.updateSchedule())};f.on(Sg.LEVEL_UPDATED,((e,{details:t})=>m(t))),f.on(Sg.LEVEL_PTS_UPDATED,((e,{details:t})=>m(t)));const g=(e,t)=>{const s=this.getAssetPlayer(d);if(s&&t.tracks){s.off(Sg.BUFFER_CODECS,g),s.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===s.assetItem&&e&&!s.media&&this.bufferAssetPlayer(s,e)}};f.on(Sg.BUFFER_CODECS,g);const p=()=>{var s;const i=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${i}`),!i)return;const r=this.schedule.findEventIndex(e.identifier),n=e.findAssetIndex(t),a=n+1,o=null==(s=this.schedule.items)?void 0:s[r];if(this.isInterstitial(o))if(-1===n||e.isAssetPastPlayoutLimit(a)||e.assetList[a].error){var l;const e=null==(l=this.schedule.items)?void 0:l[r+1];e&&this.bufferedToItem(e)}else this.bufferedToItem(o,a)};f.on(Sg.BUFFERED_TO_END,p);const v=t=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const s=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,t)};return f.once(Sg.MEDIA_ENDED,v(s)),f.once(Sg.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(Sg.ERROR,((t,i)=>{const r=this.getAssetPlayer(d);if(i.details!==Tg.BUFFER_STALLED_ERROR)this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${i.error} ${e}`);else if(null!=r&&r.media){const t=r.currentTime,s=r.duration-t;t&&e.appendInPlace&&s/r.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${r.media.currentTime}`),p()):(this.warn(`Stalled at ${t} of ${t+s} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}})),f.on(Sg.DESTROYING,(()=>{if(!this.getAssetPlayer(d))return;const t=new Error(`Asset player destroyed unexpectedly ${d}`),i={fatal:!0,type:Eg.OTHER_ERROR,details:Tg.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)})),this.hls.trigger(Sg.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:f}),f}clearInterstitial(e,t){e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,t)})),e.reset()}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(-1!==s){this.log(`clearAssetPlayer "${e}" toSegment: ${t?ET(t):t}`);const i=this.playerQueue[s];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:n,assetItem:a,assetId:o}=e,l=n.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,s[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${e}`),this.hls.trigger(Sg.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:n,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;const{interstitial:r,assetItem:n,assetId:a}=e,o=this.schedule.findEventIndex(r.identifier),l=null==(s=this.schedule.items)?void 0:s[o];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=n;const c=this.getBufferingPlayer();if(c===e)return;const d=r.appendInPlace;if(d&&!1===(null==c?void 0:c.interstitial.appendInPlace))return;const h=(null==c?void 0:c.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(d&&n!==this.playingAsset){if(!e.tracks)return;if(h&&!Hg(h,e.tracks)){const t=new Error(`Asset "${a}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),s={fatal:!0,type:Eg.OTHER_ERROR,details:Tg.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(n);return void this.handleAssetItemError(s,r,o,i,t.message)}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,s,i,r){if(e.details===Tg.BUFFER_STALLED_ERROR)return;const n=t.assetList[i]||null;let a=null;if(n){const e=this.getAssetPlayerQueueIndex(n.identifier);a=this.playerQueue[e]||null}const o=this.schedule.items,l=Ng({},e,{fatal:!1,errorAction:$v(!0),asset:n,assetListIndex:i,event:t,schedule:o,scheduleIndex:s,player:a});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(Sg.INTERSTITIAL_ASSET_ERROR,l),!e.fatal)return;const c=new Error(r);n&&(this.playingAsset!==n&&this.clearAssetPlayer(n.identifier,null),n.error=c),t.assetList.some((e=>!e.error))?t.appendInPlace&&(t.error=c):t.error=c,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${s?ET(s):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(s,i);if(this.itemsMatch(s,r))this.clearInterstitial(e,null);else{const e=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(e)}}else this.checkStart()}onAssetListLoaded(e,t){var s;const i=t.event,r=i.identifier,n=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const a=i.timelineStart,o=i.duration;let l=0;n.forEach(((e,t)=>{const s=parseFloat(e.DURATION);this.createAsset(i,t,l,a+l,s,e.URI),l+=s})),i.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${o}) ${i}`);const c=this.waitingItem,d=(null==c?void 0:c.event.identifier)===r;this.updateSchedule();const h=null==(s=this.bufferingItem)?void 0:s.event;if(d){var u;const e=this.schedule.findEventIndex(r),t=null==(u=this.schedule.items)?void 0:u[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===r&&h.appendInPlace){const e=i.assetList[0],t=this.getAssetPlayer(e.identifier),s=this.primaryMedia;e&&t&&s&&this.bufferAssetPlayer(t,s)}}onError(e,t){switch(t.details){case Tg.ASSET_LIST_PARSING_ERROR:case Tg.ASSET_LIST_LOAD_ERROR:case Tg.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&this.primaryFallback(e);break}case Tg.BUFFER_STALLED_ERROR:this.onTimeupdate(),this.checkBuffer(!0)}}}});function _S(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(_S):Object.keys(e).reduce(((t,s)=>(t[s]=_S(e[s]),t)),{}):e}function IS(e,t){const s=e.loader;if(s!==SS&&s!==LS)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=SS,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class PS extends oy{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(Sg.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const s=this.media=t.media;ST(s,"playing",this.onMediaPlaying),ST(s,"waiting",this.onMediaWaiting),ST(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(wT(s,"playing",this.onMediaPlaying),wT(s,"waiting",this.onMediaWaiting),wT(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=null==(s=this.hls)?void 0:s.config;if(!r)return;const{media:n,stalled:a}=this;if(!n)return;const{seeking:o}=n,l=this.seeking&&!o,c=!this.seeking&&o,d=n.paused&&!o||n.ended||0===n.playbackRate;if(this.seeking=o,e!==t)return t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(c||l)return void(l&&this.stallResolved(e));if(d)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&n.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Sg.MEDIA_ENDED,{stalled:!1})));if(!dy.getBuffered(n).length)return void(this.nudgeRetry=0);const h=dy.bufferInfo(n,e,0),u=h.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const t=CS(this.hls.inFlightFragments,e),s=h.len>2,i=!u||t||u-e>2&&!f.getPartialFragment(e);if(s||i)return;this.moved=!1}const m=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(h.len>0)&&!u)return;const t=Math.max(u,h.start||0)-e,s=!(null==m||!m.live)?2*m.targetduration:2,i=f.getPartialFragment(e);if(t>0&&(t<=s||i))return void(n.paused||this._trySkipBufferHole(i))}const g=r.detectStallWithCurrentTimeMs,p=self.performance.now(),v=this.waiting;if(null===a)return void(this.stalled=v>0&&p-v<g?v:p);const y=p-a;if(!o&&(y>=g||v)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==m||!m.live)&&Math.abs(e-((null==m?void 0:m.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(Sg.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(h),!this.media||!this.hls)return}const x=dy.bufferInfo(n,e,r.maxBufferHole);this._tryFixBufferStall(x,y)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(Sg.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(s=this.buffered.audio)&&s.length&&i&&i.length>1&&e>i.end(0)){const s=dy.bufferedInfo(dy.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const s=dy.timeRangesToArray(i),r=dy.bufferedInfo(s,t,0).bufferedIndex;if(r>-1&&r<s.length-1){const t=dy.bufferedInfo(s,e,0).bufferedIndex,i=s[r].end,n=s[r+1].start;if((-1===t||t>r)&&n-i<1&&e-i<2){const s=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${i} -> ${n} buffered index: ${t}`);this.warn(s.message),this.media.currentTime+=1e-6;const r=this.fragmentTracker.getPartialFragment(e)||void 0,a=dy.bufferInfo(this.media,e,0);this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:r,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t){var s,i;const{fragmentTracker:r,media:n}=this,a=null==(s=this.hls)?void 0:s.config;if(!n||!r||!a)return;const o=n.currentTime,l=null==(i=this.hls)?void 0:i.latestLevelDetails,c=r.getPartialFragment(o);if(c||null!=l&&l.live&&o<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const d=e.buffered;(d&&d.length>1&&e.len>a.maxBufferHole||e.nextStart&&e.nextStart-o<a.maxBufferHole)&&(t>1e3*a.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&null!==r&&s&&t){this.stallReported=!0;const i=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${gv(e)})`);this.warn(i.message),t.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!s||!r)return 0;const n=i.currentTime,a=dy.bufferInfo(i,n,0),o=n<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=r.maxBufferHole,c=a.len>0&&a.len<1&&i.readyState<3,d=o-n;if(d>0&&(t||c)){if(d>r.maxBufferHole){let t=!1;if(0===n){const e=s.getAppendedFrag(0,Rg);e&&o<e.end&&(t=!0)}if(!t){const t=e||s.getAppendedFrag(n,Rg);if(t){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(CS(this.hls.inFlightFragments,o))return 0;let e=!1,i=t.end;for(;i<o;){const t=s.getPartialFragment(i);if(!t){e=!0;break}i+=t.duration}if(e)return 0}}}const t=Math.max(o+.05,n+.1);if(this.warn(`skipping hole, adjusting currentTime from ${n} to ${t}`),this.moved=!0,i.currentTime=t,null==e||!e.gap){const s=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${t}`);this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:e||void 0,buffer:a.len,bufferInfo:a})}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!s||!r)return 0;const n=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const a=n+(i+1)*r.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${n} to ${a}`);this.warn(o.message),s.currentTime=a,t.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const s=new Error(`Playhead still not moving while enough data buffered @${n} after ${r.nudgeMaxRetry} nudges`);this.error(s.message),t.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.BUFFER_STALLED_ERROR,error:s,fatal:!0,buffer:e.len,bufferInfo:e})}}}function CS(e,t){const s=DS(e.main);if(s&&s.start<=t)return s;const i=DS(e.audio);return i&&i.start<=t?i:null}function DS(e){if(!e)return null;switch(e.state){case Lb:case Ab:case Nb:case Mb:return null}return e.frag}function NS(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function MS(e,t,s,i,r){let n=new e(t,s,"");try{n.value=i,r&&(n.type=r)}catch(a){n=new e(t,s,gv(r?Og({type:r},i):i))}return n}const OS=(()=>{const e=NS();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class jS{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Sg.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Sg.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(Sg.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Sg.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Sg.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var s;this.media=t.media,!1===(null==(s=t.overrides)?void 0:s.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&lT(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return aT(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:i}}}=this;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=NS();if(n)for(let a=0;a<r.length;a++){const e=r[a].type;if(e===gx.emsg&&!s||!i)continue;const t=hx(r[a].data);if(t){const s=r[a].pts;let i=s+r[a].duration;i>OS&&(i=OS);i-s<=0&&(i=s+.25);for(let r=0;r<t.length;r++){const a=t[r];if(!ux(a)){this.updateId3CueEnds(s,e);const t=MS(n,s,i,a,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var s;const i=null==(s=this.id3Track)?void 0:s.cues;if(i)for(let r=i.length;r--;){const s=i[r];s.type===t&&s.startTime<e&&s.endTime===OS&&(s.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=n;if(r&&(a||o)){let e;e="audio"===i?e=>e.type===gx.audioId3&&o:"video"===i?e=>e.type===gx.emsg&&a:e=>e.type===gx.audioId3&&o||e.type===gx.emsg&&a,cT(r,t,s,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:s}=this,{dateRanges:i}=e,r=Object.keys(i);let n=this.dateRangeCuesAppended;var a;if(s&&t)if(null!=(a=s.cues)&&a.length){const e=Object.keys(n).filter((e=>!r.includes(e)));for(let t=e.length;t--;){const i=e[t],r=n[i].cues;delete n[i],Object.keys(r).forEach((e=>{try{const t=r[e];t.removeEventListener("enter",this.onEventCueEnter),s.removeCue(t)}catch(t){}}))}}else n=this.dateRangeCuesAppended={};const o=e.fragments[e.fragments.length-1];if(0===r.length||!yg(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=NS();for(let h=0;h<r.length;h++){const e=r[h],t=i[e],s=t.startTime,a=n[e],o=(null==a?void 0:a.cues)||{};let u=(null==a?void 0:a.durationKnown)||!1,f=OS;const{duration:m,endDate:g}=t;if(g&&null!==m)f=s+m,u=!0;else if(t.endOnNext&&!u){const e=r.reduce(((e,s)=>{if(s!==t.id){const r=i[s];if(r.class===t.class&&r.startDate>t.startDate&&(!e||t.startDate<e.startDate))return r}return e}),null);e&&(f=e.startTime,u=!0)}const p=Object.keys(t.attr);for(let i=0;i<p.length;i++){const r=p[i];if("ID"===(d=r)||"CLASS"===d||"CUE"===d||"START-DATE"===d||"DURATION"===d||"END-DATE"===d||"END-ON-NEXT"===d)continue;const n=o[r];if(n)u&&!a.durationKnown?n.endTime=f:Math.abs(n.startTime-s)>.01&&(n.startTime=s,n.endTime=f);else if(l){let i=t.attr[r];by(r)&&(c=i,i=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const n=MS(l,s,f,{key:r,data:i},gx.dateRange);n&&(n.id=e,this.id3Track.addCue(n),o[r]=n,this.hls.config.interstitialsController&&("X-ASSET-LIST"!==r&&"X-ASSET-URL"!==r||n.addEventListener("enter",this.onEventCueEnter)))}}n[e]={cues:o,dateRange:t,durationKnown:u}}var c,d}}class FS{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const n=this.targetLatency;if(null===n)return;const a=s-n;if(a<Math.min(this.maxLatency,n+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,s));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&s||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:n*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const s=this.levelDetails;if(null===s)return null;const i=s.edge,r=e-t-this.edgeStalled,n=i-s.totalduration,a=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(n,r),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Sg.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Sg.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Sg.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Sg.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Tg.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(s=this.levelDetails)&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&(null==(s=this.hls)||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class US extends gE{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Sg.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Sg.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Sg.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},n={};let a=!1,o=!1,l=!1;t.levels.forEach((e=>{var t;const c=e.attrs;let{audioCodec:d,videoCodec:h}=e;d&&(e.audioCodec=d=zp(d,s)||void 0),0===(null==(t=h)?void 0:t.indexOf("avc1"))&&(h=e.videoCodec=function(e){const t=e.split(",");for(let s=0;s<t.length;s++){const e=t[s].split(".");if(e.length>2){let i=e.shift()+".";i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t[s]=i}}return t.join(",")}(h));const{width:u,height:f,unknownCodecs:m}=e;let g=m?m.length:0;if(m)for(let s=g;s--;){const t=m[s];this.isAudioSupported(t)?(e.audioCodec=d=d?`${d},${t}`:t,g--,Bp.audio[d.substring(0,4)]=2):this.isVideoSupported(t)&&(e.videoCodec=h=h?`${h},${t}`:t,g--,Bp.video[h.substring(0,4)]=2)}if(a||(a=!(!u||!f)),o||(o=!!h),l||(l=!!d),g||d&&!this.isAudioSupported(d)||h&&!this.isVideoSupported(h))return void this.log(`Some or all CODECS not supported "${c.CODECS}"`);const{CODECS:p,"FRAME-RATE":v,"HDCP-LEVEL":y,"PATHWAY-ID":b,RESOLUTION:x,"VIDEO-RANGE":E}=c,T=`${`${b||"."}-`}${e.bitrate}-${x}-${v}-${p}-${E}-${y}`;if(r[T])if(r[T].uri===e.url||e.attrs["PATHWAY-ID"])r[T].addGroupId("audio",c.AUDIO),r[T].addGroupId("text",c.SUBTITLES);else{const t=n[T]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=this.createLevel(e);r[T]=s,i.push(s)}else{const t=this.createLevel(e);r[T]=t,n[T]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,a,o,l)}createLevel(e){const t=new uv(e),s=e.supplemental;if(null!=s&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(e.message),t.supportedResult=tv(e,[])}return t}isAudioSupported(e){return Gp(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Gp(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){let n=[],a=[],o=e;if((s||i)&&r&&(o=o.filter((({videoCodec:e,videoRange:t,width:s,height:i})=>{return(!!e||!(!s||!i))&&(!!(r=t)&&av.indexOf(r)>-1);var r}))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){let e="no level with compatible codecs found in manifest",s=e;t.levels.length&&(s=`one or more CODECS in variant not supported: ${gv(t.levels.map((e=>e.attrs.CODECS)).filter(((e,t,s)=>s.indexOf(e)===t)))}`,this.warn(s),e+=` (${s})`);const i=new Error(e);this.hls.trigger(Sg.ERROR,{type:Eg.MEDIA_ERROR,details:Tg.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:s})}}));t.audioTracks&&(n=t.audioTracks.filter((e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),BS(n)),t.subtitles&&(a=t.subtitles,BS(a));const l=o.slice(0);o.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return av.indexOf(e.videoRange)-av.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=Hp(e.videoCodec),i=Hp(t.videoCodec);if(s!==i)return i-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=qp(e.codecSet),i=qp(t.codecSet);if(s!==i)return i-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let c=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let g=0;g<l.length;g++)if(l[g].pathwayId===o[0].pathwayId){c=l[g];break}this._levels=o;for(let g=0;g<o.length;g++)if(o[g]===c){var d;this._firstLevel=g;const e=c.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(d=this.hls.userConfig)?void 0:d.abrEwmaDefaultEstimate)){const s=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);s>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=s)}break}const h=r&&!i,u=this.hls.config,f=!(!u.audioStreamController||!u.audioTrackController),m={levels:o,audioTracks:n,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:f&&!h&&n.some((e=>!!e.url))};this.hls.trigger(Sg.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:s,reason:s.message}),i)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,n=t[e],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,s===e&&i&&r===a)return;this.log(`Switching to level ${e} (${n.height?n.height+"p ":""}${n.videoRange?n.videoRange+" ":""}${n.codecSet?n.codecSet+" ":""}@${n.bitrate})${a?" with Pathway "+a:""} from level ${s}${r?" with Pathway "+r:""}`);const o={level:e,attrs:n.attrs,details:n.details,bitrate:n.bitrate,averageBitrate:n.averageBitrate,maxBitrate:n.maxBitrate,realBitrate:n.realBitrate,width:n.width,height:n.height,codecSet:n.codecSet,audioCodec:n.audioCodec,videoCodec:n.videoCodec,audioGroups:n.audioGroups,subtitleGroups:n.subtitleGroups,loaded:n.loaded,loadError:n.loadError,fragmentError:n.fragmentError,name:n.name,id:n.id,uri:n.uri,url:n.url,urlId:0,audioGroupIds:n.audioGroupIds,textGroupIds:n.textGroupIds};this.hls.trigger(Sg.LEVEL_SWITCHING,o);const l=n.details;if(!l||l.live){const e=this.switchParams(n.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter((e=>-1!==t.indexOf(e)));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=s}}onError(e,t){!t.fatal&&t.context&&t.context.type===kg&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===Rg){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const s=this._levels[t.level];null!=s&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,n=t.levelInfo;var a;if(!n)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));if(n===this.currentLevel||t.withoutMultiVariant){0===n.fragmentError&&(n.loadError=0);let e=n.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],n=e.details,a=null==n?void 0:n.age;this.log(`Loading level index ${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${a&&n.live?" age "+a.toFixed(1)+(n.type&&" "+n.type||""):""} ${s}`),this.hls.trigger(Sg.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const s=this._levels.filter(((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));bb(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(Sg.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Sg.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function BS(e){const t={};e.forEach((e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++}))}function $S(){return self.SourceBuffer||self.WebKitSourceBuffer}function GS(){if(!Kg())return!1;const e=$S();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class VS extends Fb{constructor(e,t,s){super(e,t,s,"stream-controller",Rg),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!yg(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const s=this.getFwdBufferInfoAtPos(e,t,Rg,0);null!==s&&0!==s.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${s?s.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.on(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Sg.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Sg.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Sg.BUFFER_CREATED,this.onBufferCreated,this),e.on(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Sg.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Sg.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Sg.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Sg.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Sg.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Sg.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Sg.BUFFER_CREATED,this.onBufferCreated,this),e.off(Sg.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Sg.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=Lb,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Ab}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case jb:{const{levels:e,level:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=Lb;break}if(this.hls.nextLoadLevel!==this.level){this.state=Lb;break}break}case Ib:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,s=null==e?void 0:e[t];this.resetStartWhenNotLoaded(s||null),this.state=Lb}}}this.state===Lb&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const n=s[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(Sg.BUFFER_EOS,e),void(this.state=Nb)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=n.details;if(!l||this.state===jb||this.waitForLive(n))return this.level=r,this.state=jb,void(this.startFragRequested=!1);const c=a.len,d=this.getMaxBufferLength(n.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let u=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&u&&lp(u)&&this.fragmentTracker.getState(u)!==Hv){var f;const e=(null!=(f=this.backtrackFragment)?f:u).sn-l.startSN,t=l.fragments[e-1];t&&u.cc===t.cc&&(u=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(u&&this.isLoopLoading(u,h)){if(!u.gap){const e=this.audioOnly&&!this.altAudio?rp:np,t=(e===np?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Rg)}u=this.getNextFragmentLoopLoading(u,l,a,Rg,d)}u&&(!u.initSegment||u.initSegment.data||this.bitrateTest||(u=u.initSegment),this.loadFragment(u,n,h))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===Gv||i===Kv?lp(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Rg)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;s=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else s=0;const n=this.getBufferedFrag(t.currentTime+s);if(n){const e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,i=Math.max(n.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Rb:case _b:case Ib:case Cb:case Db:this.state=Lb}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;ST(s,"playing",this.onMediaPlaying),ST(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(wT(s,"playing",this.onMediaPlaying),wT(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Sg.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(s=s||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=s&&i&&!function(){var e;const t=$S();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==Lb)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=jb)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,n=t.level,a=t.details,o=a.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${n}`);this.log(`Level ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==_b&&this.state!==Ib||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||null!=(s=l.details)&&s.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=a,this.levelLastLoaded=l,r||this.setStartPosition(a,d),this.hls.trigger(Sg.LEVEL_UPDATED,{details:a,level:n}),this.state===jb){if(this.waitForCdnTuneIn(a))return;this.state=Lb}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),n=e.fragmentStart,a=e.edge,o=r>=n-t.maxFragLookUpTolerance&&r<=a;if(null!==i&&s.duration>i&&(r<i||!o)){const n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&s.readyState<4||r<a-n)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),s.currentTime=i))}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:n}=this;if(!n)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const a=n[s.level];if(!a)return void this.warn(`Level ${s.level} not found on progress`);const o=a.details;if(!o)return this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),void this.fragmentTracker.removeFragment(s);const l=a.videoCodec,c=o.PTSKnown||!o.live,d=null==(t=s.initSegment)?void 0:t.data,h=this._getAudioCodec(a),u=this.transmuxer=this.transmuxer||new mE(this.hls,Rg,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,m=-1!==f,g=new ly(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,m),p=this.initPTS[s.cc];u.push(r,d,h,l,s,i,o.totalduration,c,g,p)}onAudioTrackSwitching(e,t){const s=this.hls,i=2===this.altAudio;if(Sv(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),s.once(Sg.BUFFER_FLUSHED,(()=>{var e;null==(e=this.hls)||e.trigger(Sg.AUDIO_TRACK_SWITCHED,t)})),void s.trigger(Sg.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});s.trigger(Sg.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Sv(t.url,this.hls);if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,n=!1;for(const a in s){const e=s[a];if("main"===e.id){if(r=a,i=e,"video"===a){const e=s[a];e&&(this.videoBuffer=e.buffer)}}else n=!0}n&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===Rg;if(r){if(this.fragContextChanged(s))return this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Db&&(this.state=Lb));const e=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),lp(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const n=this.media;n&&(!this._hasEnoughToStart&&dy.getBuffered(n).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal)this.state=Mb;else switch(t.details){case Tg.FRAG_GAP:case Tg.FRAG_PARSING_ERROR:case Tg.FRAG_DECRYPT_ERROR:case Tg.FRAG_LOAD_ERROR:case Tg.FRAG_LOAD_TIMEOUT:case Tg.KEY_LOAD_ERROR:case Tg.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Rg,t);break;case Tg.LEVEL_LOAD_ERROR:case Tg.LEVEL_LOAD_TIMEOUT:case Tg.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==jb||(null==(s=t.context)?void 0:s.type)!==kg||(this.state=Lb);break;case Tg.BUFFER_ADD_CODEC_ERROR:case Tg.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.resetLoadingState();break;case Tg.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Tg.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=Lb,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==rp||!this.altAudio){const e=(t===np?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,Rg),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log(`could not seek to ${s}, already seeking at ${t}`);const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),n=dy.getBuffered(e),a=n.length?n.start(0):0,o=a-s,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0))&&(this.log(`adjusting start position by ${o} to match buffer start`),s+=o,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((e=>{const{hls:s}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=Lb,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(Sg.FRAG_LOADED,e),i.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:c}=a,{video:d,text:h,id3:u,initSegment:f}=r,{details:m}=c,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Cb,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,f.tracks,e,n),i.trigger(Sg.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;yg(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(Sg.INIT_PTS_FOUND,{frag:o,id:s,initPTS:e,timescale:t}))}if(d&&m){g&&"audiovideo"===d.type&&this.logMuxedErr(o);const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,s=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:a}=d;if(l)l.elementaryStreams[d.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:a};else if(d.firstKeyFrame&&d.independent&&1===n.id&&!s&&(this.couldBacktrack=!0),d.dropped&&d.independent){const r=this.getMainFwdBufferInfo(),n=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=d.firstKeyFramePTS?d.firstKeyFramePTS:e;if(!t&&n<l-this.config.maxBufferHole&&!s)return void this.backtrack(o);s&&(o.gap=!0),o.setElementaryStreamInfo(d.type,o.start,i,o.start,a,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(d.type,e,i,r,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(d,o,l,n,t||s)}else{if(!t&&!s)return void this.backtrack(o);o.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=g;l&&(l.elementaryStreams[rp]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(rp,e,t,s,i),this.bufferFragmentData(g,o,l,n)}if(m&&null!=u&&null!=(t=u.samples)&&t.length){const e={id:s,frag:o,details:m,samples:u.samples};i.trigger(Sg.FRAG_PARSING_METADATA,e)}if(m&&h){const e={id:s,frag:o,details:m,samples:h.samples};i.trigger(Sg.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${lp(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==Cb)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:n,audiovideo:a}=t;if(r){let s=Xp(r.codec,e.audioCodec);"mp4a"===s&&(s="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){s&&(s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(s="mp4a.40.5")}s&&-1!==s.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",this.log(`Android: force audio codec to ${s}`)),e.audioCodec&&e.audioCodec!==s&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${s}"`),r.levelCodec=s,r.id=Rg,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${s||""}/${e.audioCodec||""}/${r.codec}]`),delete t.audiovideo}if(n){n.levelCodec=e.videoCodec,n.id=Rg;const s=n.codec;if(4===(null==s?void 0:s.length))switch(s){case"hvc1":case"hev1":n.codec="hvc1.1.6.L120.90";break;case"av01":n.codec="av01.0.04M.08";break;case"avc1":n.codec="avc1.42e01e"}this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s}]${n.codec!==s?" parsed-corrected="+n.codec:""}${n.supplemental?" supplemental="+n.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(Sg.BUFFER_CODECS,t),!this.hls)return;o.forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(Sg.BUFFER_APPENDING,{type:e,data:r,frag:s,part:null,chunkMeta:i,parent:s.type})}))}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Rg)}get maxBufferLength(){const{levels:e,level:t}=this,s=null==e?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Lb}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(dy.isBuffered(e,s)?t=this.getAppendedFrag(s):dy.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(Sg.FRAG_CHANGED,{frag:t}),e&&e.level===s||this.hls.trigger(Sg.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return yg(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(yg(t)){const e=this.getLevelDetails(),s=this.currentFrag||(e?kv(null,e.fragments,t):null);if(s){const e=s.programDateTime;if(null!==e){const i=e+1e3*(t-s.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class KS{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[s].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Tg.KEY_LOAD_ERROR,s,i,r){return new ay({type:Eg.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:s,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===s||"initSegment"===r.sn||s<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Tg.KEY_LOAD_ERROR,s))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,Tg.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if(null!=(s=a)&&s.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[n]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,Tg.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(s);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,s)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=new(0,s.loader)(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((r,n)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=s.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,i)=>{const{frag:a,keyInfo:o,url:l}=s;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return n(this.createKeyLoadError(a,Tg.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,r({frag:a,keyInfo:o})},onError:(e,s,i,r)=>{this.resetLoader(s),n(this.createKeyLoadError(t,Tg.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,Og({url:a.url,data:void 0},e)))},onTimeout:(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,Tg.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,Tg.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,l,c)}))}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function HS(e){const{type:t}=e;switch(t){case Ag:return _g;case Lg:return Ig;default:return Rg}}function qS(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class WS{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.on(Sg.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Sg.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Sg.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Sg.LEVEL_LOADING,this.onLevelLoading,this),e.off(Sg.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Sg.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Sg.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=new(s||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:wg,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:n,deliveryDirectives:a,levelInfo:o}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:kg,url:n,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:n,track:a}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:Ag,url:r,deliveryDirectives:n,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:n,track:a}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:Lg,url:r,deliveryDirectives:n,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[kg];if(s){const e=s.context;e&&!t.levels.some((t=>t===e.levelOrTrack))&&(s.abort(),delete this.loaders[kg])}}load(e){var t;const s=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=this.hls.logger,s=r.context;if(s&&s.levelOrTrack===e.levelOrTrack&&(s.url===e.url||s.deliveryDirectives&&!e.deliveryDirectives))return void(s.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${s.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===wg?s.manifestLoadPolicy.default:Ng({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),yg(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===kg&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Ag&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Lg&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);i=Ng({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const n=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},o={onSuccess:(e,t,s,i)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),Jy.isMediaPlaylist(n)||s.type!==wg?this.handleTrackOrLevelPlaylist(e,t,s,i||null,r):this.handleMasterPlaylist(e,t,s,i)):this.handleManifestParsingError(e,s,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,s,i)=>{this.handleNetworkError(t,s,!1,e,i)},onTimeout:(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};r.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,n=e.data,a=qS(e,s),o=Jy.parseMasterPlaylist(n,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,s,o.playlistParsingError,i,t);const{contentSteering:l,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f}=o;this.variableList=f;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":p}=Jy.parseMasterPlaylistMedia(n,a,o);if(m.length){m.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new yy({}),bitrate:0,url:""}))}r.trigger(Sg.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:g,captions:p,contentSteering:l,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:u,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,i,r){const n=this.hls,{id:a,level:o,type:l}=s,c=qS(e,s),d=yg(o)?o:yg(a)?a:0,h=HS(s),u=Jy.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(l===wg){const e={attrs:new yy({}),bitrate:0,details:u,name:"",url:c};u.requestScheduled=t.loading.start+gb(u,0),n.trigger(Sg.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=u,this.handlePlaylistLoaded(u,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(Sg.ERROR,{type:Eg.NETWORK_ERROR,details:Tg.MANIFEST_PARSING_ERROR,fatal:t.type===wg,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let n=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===kg?n+=`: ${e.level} id: ${e.id}`:e.type!==Ag&&e.type!==Lg||(n+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(n);this.hls.logger.warn(`[playlist-loader]: ${n}`);let o=Tg.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case wg:o=s?Tg.MANIFEST_LOAD_TIMEOUT:Tg.MANIFEST_LOAD_ERROR,l=!0;break;case kg:o=s?Tg.LEVEL_LOAD_TIMEOUT:Tg.LEVEL_LOAD_ERROR,l=!1;break;case Ag:o=s?Tg.AUDIO_TRACK_LOAD_TIMEOUT:Tg.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Lg:o=s?Tg.SUBTITLE_TRACK_LOAD_TIMEOUT:Tg.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const d={type:Eg.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:r};if(i){const s=(null==t?void 0:t.url)||e.url;d.response=Og({url:s,data:void 0},i)}this.hls.trigger(Sg.ERROR,d)}handlePlaylistLoaded(e,t,s,i,r,n){const a=this.hls,{type:o,level:l,id:c,groupId:d,deliveryDirectives:h}=i,u=qS(t,i),f=HS(i),m="number"==typeof i.level&&f===Rg?l:void 0;if(!e.fragments.length){const n=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(Sg.ERROR,{type:Eg.NETWORK_ERROR,details:Tg.LEVEL_EMPTY_ERROR,fatal:!1,url:u,error:n,reason:n.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){if(this.hls.logger.warn(g),!a.config.ignorePlaylistParsingErrors)return void a.trigger(Sg.ERROR,{type:Eg.NETWORK_ERROR,details:Tg.LEVEL_PARSING_ERROR,fatal:!1,url:u,error:g,reason:g.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s});e.playlistParsingError=null}switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case wg:case kg:a.trigger(Sg.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||a.levels[0],level:m||0,id:c||0,stats:s,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:o===wg});break;case Ag:a.trigger(Sg.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:h});break;case Lg:a.trigger(Sg.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:s,networkDetails:r,deliveryDirectives:h})}}}class YS{static get version(){return Hb}static isMSESupported(){return GS()}static isSupported(){return function(){if(!GS())return!1;const e=Kg();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(Kp(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(Kp(t,"audio")))))}()}static getMediaSource(){return Kg()}static get Events(){return Sg}static get MetadataSchema(){return gx}static get ErrorTypes(){return Eg}static get ErrorDetails(){return Tg}static get DefaultConfig(){return YS.defaultConfig?YS.defaultConfig:RS}static set DefaultConfig(e){YS.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Kb,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,s){const i=Bg();if("object"==typeof console&&!0===e||"object"==typeof e){const n=["debug","log","info","warn","error"];n.forEach((t=>{i[t]=$g(t,e,s)}));try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.2`)}catch(r){return Bg()}n.forEach((t=>{Gg[t]=$g(t,e)}))}else Ng(Gg,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=function(e,t,s){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=_S(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const n=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[n],o=[];r.forEach((s=>{const r=`${e}Loading${s}`,l=t[r];if(void 0!==l&&a){o.push(r);const e=i[n].default;switch(t[n]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&s.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${n}": ${gv(t[n])}`)})),Og(Og({},i),t)}(YS.DefaultConfig,e,t);this.userConfig=e,s.progressive&&IS(s,t);const{abrController:i,bufferController:r,capLevelController:n,errorController:a,fpsController:o}=s,l=new a(this),c=this.abrController=new i(this),d=new qv(this),h=s.interstitialsController,u=h?this.interstitialsController=new h(this,YS):null,f=this.bufferController=new r(this,d),m=this.capLevelController=new n(this),g=new o(this),p=new WS(this),v=s.contentSteeringController,y=v?new v(this):null,b=this.levelController=new US(this,y),x=new jS(this),E=new KS(this.config),T=this.streamController=new VS(this,d,E),S=this.gapController=new PS(this,d);m.setStreamController(T),g.setStreamController(T);const w=[p,b,T];u&&w.splice(1,0,u),y&&w.splice(1,0,y),this.networkControllers=w;const k=[c,f,S,m,g,x,d];this.audioTrackController=this.createController(s.audioTrackController,w);const A=s.audioStreamController;A&&w.push(this.audioStreamController=new A(this,d,E)),this.subtitleTrackController=this.createController(s.subtitleTrackController,w);const L=s.subtitleStreamController;L&&w.push(this.subtititleStreamController=new L(this,d,E)),this.createController(s.timelineController,k),E.emeController=this.emeController=this.createController(s.emeController,k),this.cmcdController=this.createController(s.cmcdController,k),this.latencyController=this.createController(FS,k),this.coreComponents=k,w.push(l);const R=l.onErrorOut;"function"==typeof R&&this.on(Sg.ERROR,R,l),this.on(Sg.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const t=e===Sg.ERROR;this.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.INTERNAL_EXCEPTION,fatal:t,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Sg.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(Sg.ERROR,{type:Eg.OTHER_ERROR,details:Tg.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(Sg.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Sg.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Sg.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=sp.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Sg.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),this.started&&this.networkControllers);s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((e=>{e.resumeBuffering&&e.resumeBuffering()})))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((e=>{e.pauseBuffering&&e.pauseBuffering()})))}get inFlightFragments(){const e={[Rg]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[_g]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ig]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}));return s}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return nv.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return rv(e,vv(t),navigator.mediaCapabilities)}}YS.defaultConfig=void 0;const zS=z.createContext(),XS=()=>{const e=z.useContext(zS);if(!e)throw new Error("useClips debe ser usado dentro de un ClipsProvider");return e},JS=({children:t})=>{const[s,i]=z.useState((()=>{const e=localStorage.getItem("savedClips");return e?JSON.parse(e):[]}));z.useEffect((()=>{localStorage.setItem("savedClips",JSON.stringify(s))}),[s]);return e.jsx(zS.Provider,{value:{savedClips:s,addClip:e=>{i((t=>[...t,{id:Date.now(),...e,timestamp:(new Date).toISOString()}]))},deleteClip:e=>{i((t=>t.filter((t=>t.id!==e))))}},children:t})},QS=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(null),n=z.useRef(null),a=z.useRef(null),o=z.useRef([]),l=z.useRef(null),[c,d]=z.useState([]),[h,u]=z.useState(""),f=z.useRef(null),{addClip:m}=XS(),g="UsuarioDemo";z.useEffect((()=>{const e="https://x4bnd7lq.fubohd.com/foxsports2/mono.m3u8?token=eb1c7e07ae354055303a34818f4233d94fca4334-c3-1748834594-1748816594";return n.current&&(()=>{if(YS.isSupported()){const t=new YS({debug:!0,enableWorker:!0,lowLatencyMode:!0,backBufferLength:90});l.current=t,t.on(YS.Events.MEDIA_ATTACHED,(()=>{t.loadSource(e)})),t.on(YS.Events.MANIFEST_PARSED,((e,t)=>{n.current.play().catch((e=>{}))})),t.on(YS.Events.ERROR,((e,s)=>{if(s.fatal)switch(s.type){case YS.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case YS.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:t.destroy()}})),t.attachMedia(n.current)}else n.current.canPlayType("application/vnd.apple.mpegurl")?(n.current.src=e,n.current.addEventListener("loadedmetadata",(()=>{n.current.play().catch((e=>{}))}))):r("Tu navegador no soporta la reproducción de video en vivo")})(),()=>{l.current&&l.current.destroy()}}),[]),z.useEffect((()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})}),[c]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(gm,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(pm,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(vm,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Transmisión en Vivo"})}),e.jsxs(bm,{className:"pt-6",children:[i&&e.jsx("div",{className:"bg-red-900/50 border border-red-800 text-red-200 p-4 rounded-lg mb-6",children:i}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:n,className:"w-full h-full object-cover",controls:!0,autoPlay:!0,playsInline:!0}),e.jsxs("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center",children:[e.jsx(Ec,{className:"w-4 h-4 mr-2 animate-pulse"}),"EN VIVO"]})]}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:e.jsxs(ac,{onClick:t?()=>{a.current&&t&&(a.current.stop(),s(!1))}:()=>{if(n.current)try{const e=n.current.captureStream(),t=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5});a.current=t,o.current=[],t.ondataavailable=e=>{e.data.size>0&&o.current.push(e.data)},t.onstop=()=>{const e=new Blob(o.current,{type:"video/webm"}),t=URL.createObjectURL(e),s=(new Date).toLocaleTimeString();m({url:t,title:`Clip ${s}`,duration:"0:45",timestamp:(new Date).toISOString()})},t.start(),s(!0)}catch(e){r("No se pudo iniciar la grabación")}},className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(jc,{className:"w-5 h-5 mr-2"}),t?"Detener Grabación":"Grabar Clip"]})})]}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col h-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-200",children:"Chat en Vivo"}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-900/50 rounded-lg p-3 border border-gray-800 mb-2 max-h-96",children:[0===c.length&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay mensajes aún. ¡Sé el primero en comentar!"}),c.map(((t,s)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-bold text-red-400 mr-2",children:t.user}),e.jsx("span",{className:"text-gray-300",children:t.text}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:t.time})]},s))),e.jsx("div",{ref:f})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),""!==h.trim()&&(d((e=>[...e,{user:g,text:h,time:(new Date).toLocaleTimeString()}])),u(""))},className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:e=>u(e.target.value),placeholder:"Escribe tu mensaje...",className:"flex-1 rounded-md bg-gray-800 text-white px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsx(ac,{type:"submit",className:"bg-red-600 hover:bg-red-700 text-white font-bold px-4 py-2 rounded-md",children:"Enviar"})]})]})]})]})]})})})},ZS={"Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://static.ufcstats.com/images/athlete/Jamahal-Hill.png","Khalil Rountree Jr.":"https://static.ufcstats.com/images/athlete/Khalil-Rountree.png","Joe Pyfer":"https://static.ufcstats.com/images/athlete/Joe-Pyfer.png","Michel Pereira":"https://static.ufcstats.com/images/athlete/Michel-Pereira.png","Mayra Bueno Silva":"https://static.ufcstats.com/images/athlete/Mayra-Bueno-Silva.png","Irene Aldana":"https://static.ufcstats.com/images/athlete/Irene-Aldana.png","Ian Machado Garry":"https://static.ufcstats.com/images/athlete/Ian-Garry.png","Michael Page":"https://static.ufcstats.com/images/athlete/Michael-Page.png","Cub Swanson":"https://static.ufcstats.com/images/athlete/Cub-Swanson.png","Andre Fili":"https://static.ufcstats.com/images/athlete/Andre-Fili.png","Jessica Andrade":"https://static.ufcstats.com/images/athlete/Jessica-Andrade.png","Macy Chiasson":"https://static.ufcstats.com/images/athlete/Macy-Chiasson.png","Brandon Royval":"https://static.ufcstats.com/images/athlete/Brandon-Royval.png","Manel Kape":"https://static.ufcstats.com/images/athlete/Manel-Kape.png","Raul Rosas Jr.":"https://static.ufcstats.com/images/athlete/Raul-Rosas-Jr.png","Ricky Turcios":"https://static.ufcstats.com/images/athlete/Ricky-Turcios.png"},ew=[{left:{name:"Conor McGregor",flag:"🇮🇪",rank:null},right:{name:"Michael Chandler",flag:"🇺🇸",rank:null},weight:"Peso ligero"},{left:{name:"Jamahal Hill",flag:"🇺🇸",rank:null},right:{name:"Khalil Rountree Jr.",flag:"🇺🇸",rank:null},weight:"Peso semipesado"},{left:{name:"Joe Pyfer",flag:"🇺🇸",rank:null},right:{name:"Michel Pereira",flag:"🇧🇷",rank:null},weight:"Peso medio"},{left:{name:"Mayra Bueno Silva",flag:"🇧🇷",rank:null},right:{name:"Irene Aldana",flag:"🇲🇽",rank:null},weight:"Peso gallo femenino"},{left:{name:"Ian Machado Garry",flag:"🇮🇪",rank:null},right:{name:"Michael Page",flag:"🇬🇧",rank:null},weight:"Peso welter"}],tw=[{left:{name:"Cub Swanson",flag:"🇺🇸",rank:null},right:{name:"Andre Fili",flag:"🇺🇸",rank:null},weight:"Peso pluma"},{left:{name:"Jessica Andrade",flag:"🇧🇷",rank:null},right:{name:"Macy Chiasson",flag:"🇺🇸",rank:null},weight:"Peso gallo femenino"},{left:{name:"Brandon Royval",flag:"🇺🇸",rank:null},right:{name:"Manel Kape",flag:"🇦🇴",rank:null},weight:"Peso mosca"},{left:{name:"Raul Rosas Jr.",flag:"🇲🇽",rank:null},right:{name:"Ricky Turcios",flag:"🇺🇸",rank:null},weight:"Peso gallo"}],sw=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(gm,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC 303 Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(pm,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(vm,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC 303: McGregor vs. Chandler"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"28 de junio de 2025 - Las Vegas, NV (T-Mobile Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs(bm,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:ew.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:ZS[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:ZS[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:tw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:ZS[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:ZS[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),iw=()=>{const{savedClips:t,deleteClip:s}=XS();return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(gm,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(pm,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(vm,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Clips Guardados"})}),e.jsx(bm,{className:"pt-6",children:0===t.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No tienes clips guardados aún."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Graba clips durante las transmisiones en vivo para verlos aquí."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((t=>e.jsx(nl.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},children:e.jsxs(gm,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("video",{src:t.url,className:"w-full h-full object-cover",controls:!0}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(Ec,{className:"w-3 h-3 mr-1 text-red-500"}),t.duration]})]}),e.jsxs(bm,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-white",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Grabado el ",new Date(t.timestamp).toLocaleString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ac,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>((e,t)=>{const s=document.createElement("a");s.href=e,s.download=`${t}.webm`,document.body.appendChild(s),s.click(),document.body.removeChild(s)})(t.url,t.title),children:[e.jsx(Sc,{className:"w-4 h-4 mr-2"}),"Descargar"]}),e.jsxs(ac,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>{return e=t.url,void(navigator.share?navigator.share({title:"Clip de UFC",url:e}):(navigator.clipboard.writeText(e),alert("URL copiada al portapapeles")));var e},children:[e.jsx(Uc,{className:"w-4 h-4 mr-2"}),"Compartir"]}),e.jsx(ac,{variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>s(t.id),children:e.jsx(qc,{className:"w-4 h-4"})})]})]})]})},t.id)))})})]})})})},rw=z.forwardRef((({className:t,...s},i)=>e.jsx(H,{ref:i,className:tc("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s})));rw.displayName=H.displayName;const nw=z.forwardRef((({className:t,...s},i)=>e.jsx(q,{ref:i,className:tc("aspect-square h-full w-full",t),...s})));nw.displayName=q.displayName;const aw=z.forwardRef((({className:t,...s},i)=>e.jsx(W,{ref:i,className:tc("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s})));aw.displayName=W.displayName;const ow=()=>{const{id:t}=se(),s=[{id:"1",title:"¿Quién gana en UFC 303?",author:"FanUFC_123",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"¡Hola a todos! Con UFC 303 a la vuelta de la esquina, me pregunto cuáles son sus predicciones para las peleas principales. ¿Creen que habrá alguna sorpresa? ¿Quién creen que se llevará la victoria en el evento principal?\n\n¡Compartan sus pensamientos y análisis!",replies:[{id:"1",author:"MMA_Guru",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Creo que el evento principal será más reñido de lo que la gente espera. Mi predicción es..."},{id:"2",author:"PredictionPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"¡Definitivamente una sorpresa en la co-estelar! No me fío de las cuotas."},{id:"3",author:"CasualFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 15 minutos",content:"Yo solo espero nocauts espectaculares. 😎"}]},{id:"2",title:"El legado de Khabib",author:"MMA_Guru",authorAvatar:"https://github.com/shadcn.png",time:"hace 5 horas",content:"¿Cuál creen que es el verdadero legado de Khabib Nurmagomedov en el UFC? ¿Es el mejor de todos los tiempos en su categoría? ¡Debatamos!",replies:[{id:"1",author:"Fan_Histórico",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Invicto y dominante, no hay duda. Su impacto fue enorme."},{id:"2",author:"AnalistaPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Su control en el suelo era inigualable. Pocos podrían compararse."}]},{id:"3",title:"Posible regreso de GSP",author:"NostalgicFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 día",content:"He escuchado rumores sobre un posible regreso de Georges St-Pierre. ¿Creen que GSP podría volver al octágono y tener éxito a su edad?",replies:[{id:"1",author:"OldSchoolMMA",authorAvatar:"https://github.com/shadcn.png",time:"hace 12 horas",content:"Sería emocionante, pero el nivel actual es muy alto."},{id:"2",author:"TrueFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 8 horas",content:"GSP siempre se mantuvo en forma. Podría sorprender a muchos."}]},{id:"4",title:"Top 5 Peso Pluma Actual",author:"AnalistaX",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 día",content:"Quiero armar mi top 5 de peleadores de peso pluma actuales. ¿Quiénes creen que deberían estar en la lista y por qué? ¡Compartan sus opiniones!",replies:[{id:"1",author:"FightFanatic",authorAvatar:"https://github.com/shadcn.png",time:"hace 10 horas",content:"Volkanovski, sin duda. Luego, Holloway."},{id:"2",author:"StatsMan",authorAvatar:"https://github.com/shadcn.png",time:"hace 6 horas",content:"Consideren a Topuria, está en ascenso."}]},{id:"101",title:"¿Opiniones sobre el último evento?",author:"UFC_Fanatic",authorAvatar:"https://github.com/shadcn.png",time:"hace 3 horas",content:"¿Qué les pareció el último evento de UFC? ¿Hubo alguna pelea que les sorprendió o decepcionó?",replies:[{id:"1",author:"MMA_Expert",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"La pelea co-estelar fue fantástica, superó mis expectativas."},{id:"2",author:"FightWatcher",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"Pensé que el evento principal sería mejor, pero aun así fue sólido."}]},{id:"102",title:"Debate: ¿Es Jon Jones el GOAT?",author:"MMA_Historian",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 día",content:"Con la trayectoria de Jon Jones, ¿lo consideran el 'Greatest Of All Time' en el MMA? ¿Por qué sí o por qué no?",replies:[{id:"1",author:"Argumentador",authorAvatar:"https://github.com/shadcn.png",time:"hace 10 horas",content:"Sus logros son innegables, pero las controversias..."},{id:"2",author:"Fanatico_JJ",authorAvatar:"https://github.com/shadcn.png",time:"hace 5 horas",content:"Pura dominación, no hay quien se le compare en su prime."}]},{id:"201",title:"Mis picks para el UFC 303",author:"BettingGuru",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"¡Es hora de hacer mis predicciones para el UFC 303! Comparto mis favoritos y por qué creo que ganarán. ¿Cuáles son sus picks?",replies:[{id:"1",author:"HighStakes",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"Coincido con el evento principal, pero la segunda pelea me parece un riesgo."}]},{id:"202",title:"Análisis de cuotas para la pelea estelar",author:"OddsMaster",authorAvatar:"https://github.com/shadcn.png",time:"hace 6 horas",content:"He analizado las cuotas para la pelea estelar del próximo evento. Les doy mis perspectivas y dónde creo que hay valor.",replies:[{id:"1",author:"PunterPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Buen análisis, creo que el underdog tiene más chances de lo que indican."}]},{id:"301",title:"Últimos rumores de lesiones",author:"Insider_Info",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Se rumorea que X peleador podría estar lesionado y salir del próximo cartel. ¿Qué han oído ustedes?",replies:[{id:"1",author:"NewsHound",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Ojalá que no sea cierto, esa pelea es clave."}]},{id:"302",title:"Posibles peleas para fin de año",author:"FightNews",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 día",content:"Con el año llegando a su fin, ¿qué peleas soñadas les gustaría ver concretadas antes de 2025?",replies:[{id:"1",author:"DreamMatch",authorAvatar:"https://github.com/shadcn.png",time:"hace 8 horas",content:"Me encantaría ver A vs B en peso ligero."}]},{id:"401",title:"Mejores strikers en Peso Ligero",author:"StrikingFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 4 horas",content:"Abro debate: ¿Quiénes son los 5 mejores strikers de la división de peso ligero actualmente en el UFC?",replies:[{id:"1",author:"Kickboxer",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Dustin Poirier tiene manos increíbles."}]},{id:"402",title:"Comparativa de grappling en Peso Welter",author:"GrapplingKing",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 día",content:"Hagamos una comparativa de los mejores grapplers en la división de peso wélter. ¿Quién creen que tiene el mejor jiu-jitsu o lucha?",replies:[{id:"1",author:"BJJ_Lover",authorAvatar:"https://github.com/shadcn.png",time:"hace 9 horas",content:"Belal Muhammad ha mejorado mucho su lucha."}]}].find((e=>e.id===t));return s?e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(gm,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(pm,{children:[e.jsx(vm,{className:"text-3xl font-bold text-red-500 mb-2",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-400",children:["por ",e.jsx("span",{className:"font-medium text-red-400",children:s.author})," - ",s.time]})]})}),e.jsx(gm,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(bm,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(rw,{className:"h-10 w-10 mr-4",children:[e.jsx(nw,{src:s.authorAvatar,alt:s.author}),e.jsx(aw,{children:s.author.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.author}),e.jsx("p",{className:"text-xs text-gray-500",children:s.time})]})]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s.content})]})}),e.jsxs("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:["Respuestas (",s.replies.length,")"]}),e.jsx("div",{className:"space-y-4 mb-6",children:s.replies.map((t=>e.jsx(gm,{className:"bg-gray-900 border-gray-800",children:e.jsxs(bm,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsxs(rw,{className:"h-9 w-9 mr-3",children:[e.jsx(nw,{src:t.authorAvatar,alt:t.author}),e.jsx(aw,{children:t.author.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.author}),e.jsx("p",{className:"text-xs text-gray-500",children:t.time})]})]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:t.content})]})},t.id)))}),e.jsxs(gm,{className:"bg-gray-900 border-gray-800 mb-6",children:[e.jsx(pm,{children:e.jsx(vm,{className:"text-xl font-bold text-white",children:"Deja tu respuesta"})}),e.jsxs(bm,{children:[e.jsx(rg,{placeholder:"Escribe tu respuesta aquí...",className:"bg-gray-800 border-gray-700 text-white placeholder-gray-500 mb-4 focus:border-red-500 focus:ring-red-500",rows:5}),e.jsx(ac,{className:"bg-red-600 hover:bg-red-700 w-full sm:w-auto",children:"Enviar Respuesta"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:"Hilo no encontrado."})})},lw=()=>{const{id:t}=se(),s=[{id:"1",name:"Discusión General",description:"Habla de todo sobre UFC"},{id:"2",name:"Predicciones y Apuestas",description:"Comparte tus pronósticos"},{id:"3",name:"Noticias y Rumores",description:"Últimas novedades del octágono"},{id:"4",name:"Peleadores y Divisiones",description:"Análisis por categoría",icon:Mc}].find((e=>e.id===t)),i={1:[{id:"101",title:"¿Opiniones sobre el último evento?",author:"UFC_Fanatic",replies:25,time:"hace 3 horas"},{id:"102",title:"Debate: ¿Es Jon Jones el GOAT?",author:"MMA_Historian",replies:80,time:"hace 1 día"}],2:[{id:"201",title:"Mis picks para el UFC 303",author:"BettingGuru",replies:15,time:"hace 1 hora"},{id:"202",title:"Análisis de cuotas para la pelea estelar",author:"OddsMaster",replies:35,time:"hace 6 horas"}],3:[{id:"301",title:"Últimos rumores de lesiones",author:"Insider_Info",replies:10,time:"hace 2 horas"},{id:"302",title:"Posibles peleas para fin de año",author:"FightNews",replies:40,time:"hace 1 día"}],4:[{id:"401",title:"Mejores strikers en Peso Ligero",author:"StrikingFan",replies:50,time:"hace 4 horas"},{id:"402",title:"Comparativa de grappling en Peso Welter",author:"GrapplingKing",replies:20,time:"hace 1 día"}]}[t]||[];return s?e.jsx(nl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(gm,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(pm,{className:"text-center",children:[e.jsx(vm,{className:"text-4xl md:text-5xl font-black mb-2 uppercase text-red-500 tracking-wider",children:s.name}),e.jsx(ym,{className:"text-lg text-gray-400 mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center mt-4",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx(um,{type:"text",placeholder:`Buscar en ${s.name}...`,className:"pl-10 bg-gray-800 border-gray-700 focus:border-red-500 focus:ring-red-500 text-white"}),e.jsx(Fc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsxs(ac,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Mc,{className:"w-5 h-5 mr-2"}),"Crear Nuevo Hilo"]})]})]})}),e.jsxs("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:["Hilos en ",s.name," (",i.length,")"]}),e.jsx(gm,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx(bm,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:i.length>0?i.map((t=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(J,{to:`/thread/${t.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["por ",e.jsx("span",{className:"font-medium text-gray-400",children:t.author})," - ",t.time]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(ng,{threadId:t.id})})]},t.id))):e.jsx("li",{className:"p-4 text-center text-gray-500",children:"No hay hilos en esta categoría todavía."})})})})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:"Categoría no encontrada."})})},cw={"Rose Namajunas":"https://static.ufcstats.com/images/athlete/Rose-Namajunas.png","Maycee Barber":"https://static.ufcstats.com/images/athlete/Maycee-Barber.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://static.ufcstats.com/images/athlete/Jamahal-Hill.png","Khalil Rountree Jr.":"https://static.ufcstats.com/images/athlete/Khalil-Rountree.png","Joe Pyfer":"https://static.ufcstats.com/images/athlete/Joe-Pyfer.png","Michel Pereira":"https://static.ufcstats.com/images/athlete/Michel-Pereira.png","Mayra Bueno Silva":"https://static.ufcstats.com/images/athlete/Mayra-Bueno-Silva.png","Irene Aldana":"https://static.ufcstats.com/images/athlete/Irene-Aldana.png","Ian Machado Garry":"https://static.ufcstats.com/images/athlete/Ian-Garry.png","Michael Page":"https://static.ufcstats.com/images/athlete/Michael-Page.png","Cub Swanson":"https://static.ufcstats.com/images/athlete/Cub-Swanson.png","Andre Fili":"https://static.ufcstats.com/images/athlete/Andre-Fili.png","Jessica Andrade":"https://static.ufcstats.com/images/athlete/Jessica-Andrade.png","Macy Chiasson":"https://static.ufcstats.com/images/athlete/Macy-Chiasson.png","Brandon Royval":"https://static.ufcstats.com/images/athlete/Brandon-Royval.png","Manel Kape":"https://static.ufcstats.com/images/athlete/Manel-Kape.png","Raul Rosas Jr.":"https://static.ufcstats.com/images/athlete/Raul-Rosas-Jr.png","Ricky Turcios":"https://static.ufcstats.com/images/athlete/Ricky-Turcios.png"},dw=[{left:{name:"Rose Namajunas",flag:"🇺🇸",rank:null},right:{name:"Maycee Barber",flag:"🇺🇸",rank:null},weight:"Peso mosca"}],hw=[{left:{name:"Placeholder Fighter 1",flag:"🇺🇸",rank:null},right:{name:"Placeholder Fighter 2",flag:"🇧🇷",rank:null},weight:"Peso pluma"},{left:{name:"Placeholder Fighter 3",flag:"🇺🇸",rank:null},right:{name:"Placeholder Fighter 4",flag:"🇺🇸",rank:null},weight:"Peso gallo femenino"}],uw=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(gm,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC Fight Night Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(pm,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(vm,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC Fight Night: Namajunas vs. Barber"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"12 de julio de 2025 - Denver, CO (Ball Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs(bm,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:dw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:cw[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:cw[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:hw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:cw[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:cw[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),fw={"Leon Edwards":"https://static.ufcstats.com/images/athlete/Leon-Edwards.png","Belal Muhammad":"https://static.ufcstats.com/images/athlete/Belal-Muhammad.png","Tom Aspinall":"https://static.ufcstats.com/images/athlete/Tom-Aspinall.png","Curtis Blaydes":"https://static.ufcstats.com/images/athlete/Curtis-Blaydes.png","Paddy Pimblett":"https://static.ufcstats.com/images/athlete/Paddy-Pimblett.png","Bobby Green":"https://static.ufcstats.com/images/athlete/Bobby-Green.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://ufc.com/fighters/jamahal-hill.png","Khalil Rountree Jr.":"https://ufc.com/fighters/khalil-rountree-jr.png","Joe Pyfer":"https://ufc.com/fighters/joe-pyfer.png","Michel Pereira":"https://ufc.com/fighters/michel-pereira.png","Mayra Bueno Silva":"https://ufc.com/fighters/mayra-bueno-silva.png","Irene Aldana":"https://ufc.com/fighters/irene-aldana.png","Ian Machado Garry":"https://ufc.com/fighters/ian-machado-garry.png","Michael Page":"https://ufc.com/fighters/michael-page.png","Cub Swanson":"https://ufc.com/fighters/cub-swanson.png","Andre Fili":"https://ufc.com/fighters/andre-fili.png","Jessica Andrade":"https://ufc.com/fighters/jessica-andrade.png","Macy Chiasson":"https://ufc.com/fighters/macy-chiasson.png","Brandon Royval":"https://ufc.com/fighters/brandon-royval.png","Manel Kape":"https://ufc.com/fighters/manel-kape.png","Raul Rosas Jr.":"https://ufc.com/fighters/raul-rosas-jr.png","Ricky Turcios":"https://ufc.com/fighters/ricky-turcios.png"},mw=[{left:{name:"Leon Edwards",flag:"🇬🇧",rank:null},right:{name:"Belal Muhammad",flag:"🇺🇸",rank:null},weight:"Peso welter"},{left:{name:"Tom Aspinall",flag:"🇬🇧",rank:null},right:{name:"Curtis Blaydes",flag:"🇺🇸",rank:null},weight:"Peso pesado"}],gw=[{left:{name:"Paddy Pimblett",flag:"🇬🇧",rank:null},right:{name:"Bobby Green",flag:"🇺🇸",rank:null},weight:"Peso ligero"}],pw=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(gm,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC 304 Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(pm,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(vm,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC 304: Edwards vs. Muhammad 2"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"26 de julio de 2025 - Manchester, England (Co-op Live)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs(bm,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:mw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:fw[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:fw[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:gw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:fw[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:fw[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),vw={"Cory Sandhagen":"https://static.ufcstats.com/images/athlete/Cory-Sandhagen.png","Umar Nurmagomedov":"https://static.ufcstats.com/images/athlete/Umar-Nurmagomedov.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://ufc.com/fighters/jamahal-hill.png","Khalil Rountree Jr.":"https://ufc.com/fighters/khalil-rountree-jr.png","Joe Pyfer":"https://ufc.com/fighters/joe-pyfer.png","Michel Pereira":"https://ufc.com/fighters/michel-pereira.png","Mayra Bueno Silva":"https://ufc.com/fighters/mayra-bueno-silva.png","Irene Aldana":"https://ufc.com/fighters/irene-aldana.png","Ian Machado Garry":"https://ufc.com/fighters/ian-machado-garry.png","Michael Page":"https://ufc.com/fighters/michael-page.png","Cub Swanson":"https://ufc.com/fighters/cub-swanson.png","Andre Fili":"https://ufc.com/fighters/andre-fili.png","Jessica Andrade":"https://ufc.com/fighters/jessica-andrade.png","Macy Chiasson":"https://ufc.com/fighters/macy-chiasson.png","Brandon Royval":"https://ufc.com/fighters/brandon-royval.png","Manel Kape":"https://ufc.com/fighters/manel-kape.png","Raul Rosas Jr.":"https://ufc.com/fighters/raul-rosas-jr.png","Ricky Turcios":"https://ufc.com/fighters/ricky-turcios.png"},yw=[{left:{name:"Cory Sandhagen",flag:"🇺🇸",rank:null},right:{name:"Umar Nurmagomedov",flag:"🇷🇺",rank:null},weight:"Peso gallo"}],bw=[],xw=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(gm,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC Fight Night Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(pm,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(vm,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC Fight Night: Sandhagen vs. Nurmagomedov"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"2 de agosto de 2025 - Abu Dhabi, UAE (Etihad Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs(bm,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:yw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:vw[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:vw[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:bw.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:vw[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:vw[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),Ew=()=>e.jsxs(ie,{children:[e.jsx(re,{path:"/",element:e.jsx(hm,{})}),e.jsx(re,{path:"/login",element:e.jsx(Tm,{})}),e.jsx(re,{path:"/register",element:e.jsx(wm,{})}),e.jsx(re,{path:"/rankings",element:e.jsx(Cm,{})}),e.jsx(re,{path:"/profile",element:e.jsx(Vm,{})}),e.jsx(re,{path:"/compare",element:e.jsx(qm,{})}),e.jsx(re,{path:"/fighters",element:e.jsx(Zm,{})}),e.jsx(re,{path:"/events",element:e.jsx(tg,{})}),e.jsx(re,{path:"/highlights",element:e.jsx(ig,{})}),e.jsx(re,{path:"/forum",element:e.jsx(lg,{})}),e.jsx(re,{path:"/predict",element:e.jsx(vg,{})}),e.jsx(re,{path:"/live",element:e.jsx(QS,{})}),e.jsx(re,{path:"/ufc303",element:e.jsx(sw,{})}),e.jsx(re,{path:"/ufcnamajunasbarber",element:e.jsx(uw,{})}),e.jsx(re,{path:"/ufc304",element:e.jsx(pw,{})}),e.jsx(re,{path:"/ufcsandhagennurmagomedov",element:e.jsx(xw,{})}),e.jsx(re,{path:"/clips",element:e.jsx(iw,{})}),e.jsx(re,{path:"/thread/:id",element:e.jsx(ow,{})}),e.jsx(re,{path:"/category/:id",element:e.jsx(lw,{})})]}),Tw=()=>{const t=ee();return z.useEffect((()=>{const e=new URLSearchParams(window.location.search);"signup"===e.get("type")&&e.get("access_token")&&t("/login")}),[t]),e.jsx(nm,{children:e.jsx(Ew,{})})};ae(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(ne,{children:e.jsx(JS,{children:e.jsx(Tw,{})})})}));

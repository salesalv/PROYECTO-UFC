import{j as e,S as t,O as s,P as i,C as r,a,T as n,D as o,R as l,b as d,c,L as h,I as u,d as f,e as m,f as g,V as p,g as y,A as v,h as x,i as b,k as E,l as T,m as S,$ as A,n as w,o as k,p as L,q as R,r as I,s as P,t as D,u as C,v as N,w as _,x as M,y as F,z as O,B as j,E as B,F as U,G as $,H as G,J as V,K,M as H,N as Y,Q as W}from"./radix-CIxoaMoO.js";import{a as q,r as z,b as X,L as Q,N as J,u as Z,c as ee,d as te,e as se,B as ie}from"./vendor-DzbqGS7a.js";var re;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ae=q;re=ae.createRoot,ae.hydrateRoot;const ne=z.createContext({});function oe(e){const t=z.useRef(null);return null===t.current&&(t.current=e()),t.current}const le=z.createContext(null),de=z.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class ce extends z.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function he({children:t,isPresent:s}){const i=z.useId(),r=z.useRef(null),a=z.useRef({width:0,height:0,top:0,left:0}),{nonce:n}=z.useContext(de);return z.useInsertionEffect((()=>{const{width:e,height:t,top:o,left:l}=a.current;if(s||!r.current||!e||!t)return;r.current.dataset.motionPopId=i;const d=document.createElement("style");return n&&(d.nonce=n),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`\n          [data-motion-pop-id="${i}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${o}px !important;\n            left: ${l}px !important;\n          }\n        `),()=>{document.head.removeChild(d)}}),[s]),e.jsx(ce,{isPresent:s,childRef:r,sizeRef:a,children:z.cloneElement(t,{ref:r})})}const ue=({children:t,initial:s,isPresent:i,onExitComplete:r,custom:a,presenceAffectsLayout:n,mode:o})=>{const l=oe(fe),d=z.useId(),c=z.useCallback((e=>{l.set(e,!0);for(const t of l.values())if(!t)return;r&&r()}),[l,r]),h=z.useMemo((()=>({id:d,initial:s,isPresent:i,custom:a,onExitComplete:c,register:e=>(l.set(e,!1),()=>l.delete(e))})),n?[Math.random(),c]:[i,c]);return z.useMemo((()=>{l.forEach(((e,t)=>l.set(t,!1)))}),[i]),z.useEffect((()=>{!i&&!l.size&&r&&r()}),[i]),"popLayout"===o&&(t=e.jsx(he,{isPresent:i,children:t})),e.jsx(le.Provider,{value:h,children:t})};function fe(){return new Map}function me(e=!0){const t=z.useContext(le);if(null===t)return[!0,null];const{isPresent:s,onExitComplete:i,register:r}=t,a=z.useId();z.useEffect((()=>{e&&r(a)}),[e]);const n=z.useCallback((()=>e&&i&&i(a)),[a,i,e]);return!s&&i?[!1,n]:[!0]}const ge=e=>e.key||"";function pe(e){const t=[];return z.Children.forEach(e,(e=>{z.isValidElement(e)&&t.push(e)})),t}const ye="undefined"!=typeof window,ve=ye?z.useLayoutEffect:z.useEffect,xe=({children:t,custom:s,initial:i=!0,onExitComplete:r,presenceAffectsLayout:a=!0,mode:n="sync",propagate:o=!1})=>{const[l,d]=me(o),c=z.useMemo((()=>pe(t)),[t]),h=o&&!l?[]:c.map(ge),u=z.useRef(!0),f=z.useRef(c),m=oe((()=>new Map)),[g,p]=z.useState(c),[y,v]=z.useState(c);ve((()=>{u.current=!1,f.current=c;for(let e=0;e<y.length;e++){const t=ge(y[e]);h.includes(t)?m.delete(t):!0!==m.get(t)&&m.set(t,!1)}}),[y,h.length,h.join("-")]);const x=[];if(c!==g){let e=[...c];for(let t=0;t<y.length;t++){const s=y[t],i=ge(s);h.includes(i)||(e.splice(t,0,s),x.push(s))}return"wait"===n&&x.length&&(e=x),v(pe(e)),void p(c)}const{forceRender:b}=z.useContext(ne);return e.jsx(e.Fragment,{children:y.map((t=>{const g=ge(t),p=!(o&&!l)&&(c===y||h.includes(g));return e.jsx(ue,{isPresent:p,initial:!(u.current&&!i)&&void 0,custom:p?void 0:s,presenceAffectsLayout:a,mode:n,onExitComplete:p?void 0:()=>{if(!m.has(g))return;m.set(g,!0);let e=!0;m.forEach((t=>{t||(e=!1)})),e&&(null==b||b(),v(f.current),o&&(null==d||d()),r&&r())},children:t},g)}))})},be=e=>e;let Ee=be;function Te(e){let t;return()=>(void 0===t&&(t=e()),t)}const Se=(e,t,s)=>{const i=t-e;return 0===i?1:(s-e)/i},Ae=e=>1e3*e,we=e=>e/1e3,ke=!1;const Le=["read","resolveKeyframes","update","preRender","render","postRender"];function Re(e,t){let s=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=()=>s=!0,n=Le.reduce(((e,t)=>(e[t]=function(e){let t=new Set,s=new Set,i=!1,r=!1;const a=new WeakSet;let n={delta:0,timestamp:0,isProcessing:!1};function o(t){a.has(t)&&(l.schedule(t),e()),t(n)}const l={schedule:(e,r=!1,n=!1)=>{const o=n&&i?t:s;return r&&a.add(e),o.has(e)||o.add(e),e},cancel:e=>{s.delete(e),a.delete(e)},process:e=>{n=e,i?r=!0:(i=!0,[t,s]=[s,t],t.forEach(o),t.clear(),i=!1,r&&(r=!1,l.process(e)))}};return l}(a),e)),{}),{read:o,resolveKeyframes:l,update:d,preRender:c,render:h,postRender:u}=n,f=()=>{const a=performance.now();s=!1,r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1),r.timestamp=a,r.isProcessing=!0,o.process(r),l.process(r),d.process(r),c.process(r),h.process(r),u.process(r),r.isProcessing=!1,s&&t&&(i=!1,e(f))};return{schedule:Le.reduce(((t,a)=>{const o=n[a];return t[a]=(t,a=!1,n=!1)=>(s||(s=!0,i=!0,r.isProcessing||e(f)),o.schedule(t,a,n)),t}),{}),cancel:e=>{for(let t=0;t<Le.length;t++)n[Le[t]].cancel(e)},state:r,steps:n}}const{schedule:Ie,cancel:Pe,state:De,steps:Ce}=Re("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:be,!0),Ne=z.createContext({strict:!1}),_e={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Me={};for(const Wb in _e)Me[Wb]={isEnabled:e=>_e[Wb].some((t=>!!e[t]))};const Fe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Oe(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Fe.has(e)}let je=e=>!Oe(e);try{(Be=require("@emotion/is-prop-valid").default)&&(je=e=>e.startsWith("on")?!Oe(e):Be(e))}catch(Hb){}var Be;function Ue(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(s,i)=>"create"===i?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}const $e=z.createContext({});function Ge(e){return"string"==typeof e||Array.isArray(e)}function Ve(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}const Ke=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],He=["initial",...Ke];function Ye(e){return Ve(e.animate)||He.some((t=>Ge(e[t])))}function We(e){return Boolean(Ye(e)||e.variants)}function qe(e){const{initial:t,animate:s}=function(e,t){if(Ye(e)){const{initial:t,animate:s}=e;return{initial:!1===t||Ge(t)?t:void 0,animate:Ge(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,z.useContext($e));return z.useMemo((()=>({initial:t,animate:s})),[ze(t),ze(s)])}function ze(e){return Array.isArray(e)?e.join(" "):e}const Xe=Symbol.for("motionComponentSymbol");function Qe(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Je(e,t,s){return z.useCallback((i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),s&&("function"==typeof s?s(i):Qe(s)&&(s.current=i))}),[t])}const Ze=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),et="data-"+Ze("framerAppearId"),{schedule:tt}=Re(queueMicrotask,!1),st=z.createContext({});function it(e,t,s,i,r){var a,n;const{visualElement:o}=z.useContext($e),l=z.useContext(Ne),d=z.useContext(le),c=z.useContext(de).reducedMotion,h=z.useRef(null);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:o,props:s,presenceContext:d,blockInitialAnimation:!!d&&!1===d.initial,reducedMotionConfig:c}));const u=h.current,f=z.useContext(st);!u||u.projection||!r||"html"!==u.type&&"svg"!==u.type||function(e,t,s,i){const{layoutId:r,layout:a,drag:n,dragConstraints:o,layoutScroll:l,layoutRoot:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:rt(e.parent)),e.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:Boolean(n)||o&&Qe(o),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:d})}(h.current,s,r,f);const m=z.useRef(!1);z.useInsertionEffect((()=>{u&&m.current&&u.update(s,d)}));const g=s[et],p=z.useRef(Boolean(g)&&!(null===(a=window.MotionHandoffIsComplete)||void 0===a?void 0:a.call(window,g))&&(null===(n=window.MotionHasOptimisedAnimation)||void 0===n?void 0:n.call(window,g)));return ve((()=>{u&&(m.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),tt.render(u.render),p.current&&u.animationState&&u.animationState.animateChanges())})),z.useEffect((()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask((()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,g)})),p.current=!1))})),u}function rt(e){if(e)return!1!==e.options.allowProjection?e.projection:rt(e.parent)}function at({preloadedFeatures:t,createVisualElement:s,useRender:i,useVisualState:r,Component:a}){var n,o;function l(t,n){let o;const l={...z.useContext(de),...t,layoutId:nt(t)},{isStatic:d}=l,c=qe(t),h=r(t,d);if(!d&&ye){z.useContext(Ne).strict;const e=function(e){const{drag:t,layout:s}=Me;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==s?void 0:s.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(l);o=e.MeasureLayout,c.visualElement=it(a,h,l,s,e.ProjectionNode)}return e.jsxs($e.Provider,{value:c,children:[o&&c.visualElement?e.jsx(o,{visualElement:c.visualElement,...l}):null,i(a,t,Je(h,c.visualElement,n),h,d,c.visualElement)]})}t&&function(e){for(const t in e)Me[t]={...Me[t],...e[t]}}(t),l.displayName=`motion.${"string"==typeof a?a:`create(${null!==(o=null!==(n=a.displayName)&&void 0!==n?n:a.name)&&void 0!==o?o:""})`}`;const d=z.forwardRef(l);return d[Xe]=a,d}function nt({layoutId:e}){const t=z.useContext(ne).id;return t&&void 0!==e?t+"-"+e:e}const ot=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function lt(e){return"string"==typeof e&&!e.includes("-")&&!!(ot.indexOf(e)>-1||/[A-Z]/u.test(e))}function dt(e){const t=[{},{}];return null==e||e.values.forEach(((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()})),t}function ct(e,t,s,i){if("function"==typeof t){const[r,a]=dt(i);t=t(void 0!==s?s:e.custom,r,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,a]=dt(i);t=t(void 0!==s?s:e.custom,r,a)}return t}const ht=e=>Array.isArray(e),ut=e=>Boolean(e&&e.getVelocity);function ft(e){const t=ut(e)?e.get():e;return s=t,Boolean(s&&"object"==typeof s&&s.mix&&s.toValue)?t.toValue():t;var s}const mt=e=>(t,s)=>{const i=z.useContext($e),r=z.useContext(le),a=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:s},i,r,a){const n={latestValues:gt(i,r,a,e),renderState:t()};return s&&(n.onMount=e=>s({props:i,current:e,...n}),n.onUpdate=e=>s(e)),n}(e,t,i,r);return s?a():oe(a)};function gt(e,t,s,i){const r={},a=i(e,{});for(const u in a)r[u]=ft(a[u]);let{initial:n,animate:o}=e;const l=Ye(e),d=We(e);t&&d&&!l&&!1!==e.inherit&&(void 0===n&&(n=t.initial),void 0===o&&(o=t.animate));let c=!!s&&!1===s.initial;c=c||!1===n;const h=c?o:n;if(h&&"boolean"!=typeof h&&!Ve(h)){const t=Array.isArray(h)?h:[h];for(let s=0;s<t.length;s++){const i=ct(e,t[s]);if(i){const{transitionEnd:e,transition:t,...s}=i;for(const i in s){let e=s[i];if(Array.isArray(e)){e=e[c?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}const pt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],yt=new Set(pt),vt=e=>t=>"string"==typeof t&&t.startsWith(e),xt=vt("--"),bt=vt("var(--"),Et=e=>!!bt(e)&&Tt.test(e.split("/*")[0].trim()),Tt=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,St=(e,t)=>t&&"number"==typeof e?t.transform(e):e,At=(e,t,s)=>s>t?t:s<e?e:s,wt={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},kt={...wt,transform:e=>At(0,1,e)},Lt={...wt,default:1},Rt=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),It=Rt("deg"),Pt=Rt("%"),Dt=Rt("px"),Ct=Rt("vh"),Nt=Rt("vw"),_t={...Pt,parse:e=>Pt.parse(e)/100,transform:e=>Pt.transform(100*e)},Mt={borderWidth:Dt,borderTopWidth:Dt,borderRightWidth:Dt,borderBottomWidth:Dt,borderLeftWidth:Dt,borderRadius:Dt,radius:Dt,borderTopLeftRadius:Dt,borderTopRightRadius:Dt,borderBottomRightRadius:Dt,borderBottomLeftRadius:Dt,width:Dt,maxWidth:Dt,height:Dt,maxHeight:Dt,top:Dt,right:Dt,bottom:Dt,left:Dt,padding:Dt,paddingTop:Dt,paddingRight:Dt,paddingBottom:Dt,paddingLeft:Dt,margin:Dt,marginTop:Dt,marginRight:Dt,marginBottom:Dt,marginLeft:Dt,backgroundPositionX:Dt,backgroundPositionY:Dt},Ft={rotate:It,rotateX:It,rotateY:It,rotateZ:It,scale:Lt,scaleX:Lt,scaleY:Lt,scaleZ:Lt,skew:It,skewX:It,skewY:It,distance:Dt,translateX:Dt,translateY:Dt,translateZ:Dt,x:Dt,y:Dt,z:Dt,perspective:Dt,transformPerspective:Dt,opacity:kt,originX:_t,originY:_t,originZ:Dt},Ot={...wt,transform:Math.round},jt={...Mt,...Ft,zIndex:Ot,size:Dt,fillOpacity:kt,strokeOpacity:kt,numOctaves:Ot},Bt={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ut=pt.length;function $t(e,t,s){const{style:i,vars:r,transformOrigin:a}=e;let n=!1,o=!1;for(const l in t){const e=t[l];if(yt.has(l))n=!0;else if(xt(l))r[l]=e;else{const t=St(e,jt[l]);l.startsWith("origin")?(o=!0,a[l]=t):i[l]=t}}if(t.transform||(n||s?i.transform=function(e,t,s){let i="",r=!0;for(let a=0;a<Ut;a++){const n=pt[a],o=e[n];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(n.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=St(o,jt[n]);l||(r=!1,i+=`${Bt[n]||n}(${e}) `),s&&(t[n]=e)}}return i=i.trim(),s?i=s(t,r?"":i):r&&(i="none"),i}(t,e.transform,s):i.transform&&(i.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=a;i.transformOrigin=`${e} ${t} ${s}`}}const Gt={offset:"stroke-dashoffset",array:"stroke-dasharray"},Vt={offset:"strokeDashoffset",array:"strokeDasharray"};function Kt(e,t,s){return"string"==typeof e?e:Dt.transform(t+s*e)}function Ht(e,{attrX:t,attrY:s,attrScale:i,originX:r,originY:a,pathLength:n,pathSpacing:o=1,pathOffset:l=0,...d},c,h){if($t(e,d,h),c)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:f,dimensions:m}=e;u.transform&&(m&&(f.transform=u.transform),delete u.transform),m&&(void 0!==r||void 0!==a||f.transform)&&(f.transformOrigin=function(e,t,s){return`${Kt(t,e.x,e.width)} ${Kt(s,e.y,e.height)}`}(m,void 0!==r?r:.5,void 0!==a?a:.5)),void 0!==t&&(u.x=t),void 0!==s&&(u.y=s),void 0!==i&&(u.scale=i),void 0!==n&&function(e,t,s=1,i=0,r=!0){e.pathLength=1;const a=r?Gt:Vt;e[a.offset]=Dt.transform(-i);const n=Dt.transform(t),o=Dt.transform(s);e[a.array]=`${n} ${o}`}(u,n,o,l,!1)}const Yt=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Wt=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),qt=e=>"string"==typeof e&&"svg"===e.toLowerCase();function zt(e,{style:t,vars:s},i,r){Object.assign(e.style,t,r&&r.getProjectionStyles(i));for(const a in s)e.style.setProperty(a,s[a])}const Xt=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Qt(e,t,s,i){zt(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Xt.has(r)?r:Ze(r),t.attrs[r])}const Jt={};function Zt(e,{layout:t,layoutId:s}){return yt.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!Jt[e]||"opacity"===e)}function es(e,t,s){var i;const{style:r}=e,a={};for(const n in r)(ut(r[n])||t.style&&ut(t.style[n])||Zt(n,e)||void 0!==(null===(i=null==s?void 0:s.getValue(n))||void 0===i?void 0:i.liveStyle))&&(a[n]=r[n]);return a}function ts(e,t,s){const i=es(e,t,s);for(const r in e)if(ut(e[r])||ut(t[r])){i[-1!==pt.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}const ss=["x","y","width","height","cx","cy","r"],is={useVisualState:mt({scrapeMotionValuesFromProps:ts,createRenderState:Wt,onUpdate:({props:e,prevProps:t,current:s,renderState:i,latestValues:r})=>{if(!s)return;let a=!!e.drag;if(!a)for(const o in r)if(yt.has(o)){a=!0;break}if(!a)return;let n=!t;if(t)for(let o=0;o<ss.length;o++){const s=ss[o];e[s]!==t[s]&&(n=!0)}n&&Ie.read((()=>{!function(e,t){try{t.dimensions="function"==typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(s){t.dimensions={x:0,y:0,width:0,height:0}}}(s,i),Ie.render((()=>{Ht(i,r,qt(s.tagName),e.transformTemplate),Qt(s,i)}))}))}})},rs={useVisualState:mt({scrapeMotionValuesFromProps:es,createRenderState:Yt})};function as(e,t,s){for(const i in t)ut(t[i])||Zt(i,s)||(e[i]=t[i])}function ns(e,t){const s={};return as(s,e.style||{},e),Object.assign(s,function({transformTemplate:e},t){return z.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{}};return $t(s,t,e),Object.assign({},s.vars,s.style)}),[t])}(e,t)),s}function os(e,t){const s={},i=ns(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=i,s}function ls(e,t,s,i){const r=z.useMemo((()=>{const s={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Ht(s,t,qt(i),e.transformTemplate),{...s.attrs,style:{...s.style}}}),[t]);if(e.style){const t={};as(t,e.style,e),r.style={...t,...r.style}}return r}function ds(e=!1){return(t,s,i,{latestValues:r},a)=>{const n=(lt(t)?ls:os)(s,r,a,t),o=function(e,t,s){const i={};for(const r in e)"values"===r&&"object"==typeof e.values||(je(r)||!0===s&&Oe(r)||!t&&!Oe(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(s,"string"==typeof t,e),l=t!==z.Fragment?{...o,...n,ref:i}:{},{children:d}=s,c=z.useMemo((()=>ut(d)?d.get():d),[d]);return z.createElement(t,{...l,children:c})}}function cs(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){return at({...lt(s)?is:rs,preloadedFeatures:e,useRender:ds(i),createVisualElement:t,Component:s})}}function hs(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}function us(e,t,s){const i=e.getProps();return ct(i,t,void 0!==s?s:i.custom,e)}const fs=Te((()=>void 0!==window.ScrollTimeline));class ms{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map((e=>"finished"in e?e.finished:e)))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e,t){const s=this.animations.map((s=>fs()&&s.attachTimeline?s.attachTimeline(e):"function"==typeof t?t(s):void 0));return()=>{s.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class gs extends ms{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function ps(e,t){return e?e[t]||e.default||e:void 0}const ys=2e4;function vs(e){let t=0;let s=e.next(t);for(;!s.done&&t<ys;)t+=50,s=e.next(t);return t>=ys?1/0:t}function xs(e){return"function"==typeof e}function bs(e,t){e.timeline=t,e.onfinish=null}const Es=e=>Array.isArray(e)&&"number"==typeof e[0],Ts={linearEasing:void 0};function Ss(e,t){const s=Te(e);return()=>{var e;return null!==(e=Ts[t])&&void 0!==e?e:s()}}const As=Ss((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),ws=(e,t,s=10)=>{let i="";const r=Math.max(Math.round(t/s),2);for(let a=0;a<r;a++)i+=e(Se(0,r-1,a))+", ";return`linear(${i.substring(0,i.length-2)})`};function ks(e){return Boolean("function"==typeof e&&As()||!e||"string"==typeof e&&(e in Rs||As())||Es(e)||Array.isArray(e)&&e.every(ks))}const Ls=([e,t,s,i])=>`cubic-bezier(${e}, ${t}, ${s}, ${i})`,Rs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ls([0,.65,.55,1]),circOut:Ls([.55,0,1,.45]),backIn:Ls([.31,.01,.66,-.59]),backOut:Ls([.33,1.53,.69,.99])};function Is(e,t){return e?"function"==typeof e&&As()?ws(e,t):Es(e)?Ls(e):Array.isArray(e)?e.map((e=>Is(e,t)||Rs.easeOut)):Rs[e]:void 0}const Ps={x:!1,y:!1};function Ds(){return Ps.x||Ps.y}function Cs(e,t){const s=function(e){if(e instanceof Element)return[e];if("string"==typeof e){const t=document.querySelectorAll(e);return t?Array.from(t):[]}return Array.from(e)}(e),i=new AbortController;return[s,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function Ns(e){return t=>{"touch"===t.pointerType||Ds()||e(t)}}const _s=(e,t)=>!!t&&(e===t||_s(e,t.parentElement)),Ms=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Fs=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Os=new WeakSet;function js(e){return t=>{"Enter"===t.key&&e(t)}}function Bs(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Us(e){return Ms(e)&&!Ds()}function $s(e,t,s={}){const[i,r,a]=Cs(e,s),n=e=>{const i=e.currentTarget;if(!Us(e)||Os.has(i))return;Os.add(i);const a=t(e),n=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Us(e)&&Os.has(i)&&(Os.delete(i),"function"==typeof a&&a(e,{success:t}))},o=e=>{n(e,s.useGlobalTarget||_s(i,e.target))},l=e=>{n(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return i.forEach((e=>{(function(e){return Fs.has(e.tagName)||-1!==e.tabIndex})(e)||null!==e.getAttribute("tabindex")||(e.tabIndex=0);(s.useGlobalTarget?window:e).addEventListener("pointerdown",n,r),e.addEventListener("focus",(e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const i=js((()=>{if(Os.has(s))return;Bs(s,"down");const e=js((()=>{Bs(s,"up")}));s.addEventListener("keyup",e,t),s.addEventListener("blur",(()=>Bs(s,"cancel")),t)}));s.addEventListener("keydown",i,t),s.addEventListener("blur",(()=>s.removeEventListener("keydown",i)),t)})(e,r)),r)})),a}const Gs=new Set(["width","height","top","left","right","bottom",...pt]);let Vs;function Ks(){Vs=void 0}const Hs={now:()=>(void 0===Vs&&Hs.set(De.isProcessing||ke?De.timestamp:performance.now()),Vs),set:e=>{Vs=e,queueMicrotask(Ks)}};function Ys(e,t){-1===e.indexOf(t)&&e.push(t)}function Ws(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class qs{constructor(){this.subscriptions=[]}add(e){return Ys(this.subscriptions,e),()=>Ws(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,s);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function zs(e,t){return t?e*(1e3/t):0}class Xs{constructor(e,t={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const s=Hs.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),t&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Hs.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new qs);const s=this.events[e].add(t);return"change"===e?()=>{s(),Ie.read((()=>{this.events.change.getSize()||this.stop()}))}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Hs.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return zs(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Qs(e,t){return new Xs(e,t)}function Js(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Qs(s))}function Zs(e,t){const s=e.getValue("willChange");if(i=s,Boolean(ut(i)&&i.add))return s.add(t);var i}function ei(e){return e.props[et]}const ti=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function si(e,t,s,i){if(e===t&&s===i)return be;const r=t=>function(e,t,s,i,r){let a,n,o=0;do{n=t+(s-t)/2,a=ti(n,i,r)-e,a>0?s=n:t=n}while(Math.abs(a)>1e-7&&++o<12);return n}(t,0,1,e,s);return e=>0===e||1===e?e:ti(r(e),t,i)}const ii=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ri=e=>t=>1-e(1-t),ai=si(.33,1.53,.69,.99),ni=ri(ai),oi=ii(ni),li=e=>(e*=2)<1?.5*ni(e):.5*(2-Math.pow(2,-10*(e-1))),di=e=>1-Math.sin(Math.acos(e)),ci=ri(di),hi=ii(di),ui=e=>/^0[^.\s]+$/u.test(e);const fi=e=>Math.round(1e5*e)/1e5,mi=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const gi=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,pi=(e,t)=>s=>Boolean("string"==typeof s&&gi.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),yi=(e,t,s)=>i=>{if("string"!=typeof i)return i;const[r,a,n,o]=i.match(mi);return{[e]:parseFloat(r),[t]:parseFloat(a),[s]:parseFloat(n),alpha:void 0!==o?parseFloat(o):1}},vi={...wt,transform:e=>Math.round((e=>At(0,255,e))(e))},xi={test:pi("rgb","red"),parse:yi("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:i=1})=>"rgba("+vi.transform(e)+", "+vi.transform(t)+", "+vi.transform(s)+", "+fi(kt.transform(i))+")"};const bi={test:pi("#"),parse:function(e){let t="",s="",i="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:xi.transform},Ei={test:pi("hsl","hue"),parse:yi("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:i=1})=>"hsla("+Math.round(e)+", "+Pt.transform(fi(t))+", "+Pt.transform(fi(s))+", "+fi(kt.transform(i))+")"},Ti={test:e=>xi.test(e)||bi.test(e)||Ei.test(e),parse:e=>xi.test(e)?xi.parse(e):Ei.test(e)?Ei.parse(e):bi.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?xi.transform(e):Ei.transform(e)},Si=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const Ai="number",wi="color",ki=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Li(e){const t=e.toString(),s=[],i={color:[],number:[],var:[]},r=[];let a=0;const n=t.replace(ki,(e=>(Ti.test(e)?(i.color.push(a),r.push(wi),s.push(Ti.parse(e))):e.startsWith("var(")?(i.var.push(a),r.push("var"),s.push(e)):(i.number.push(a),r.push(Ai),s.push(parseFloat(e))),++a,"${}"))).split("${}");return{values:s,split:n,indexes:i,types:r}}function Ri(e){return Li(e).values}function Ii(e){const{split:t,types:s}=Li(e),i=t.length;return e=>{let r="";for(let a=0;a<i;a++)if(r+=t[a],void 0!==e[a]){const t=s[a];r+=t===Ai?fi(e[a]):t===wi?Ti.transform(e[a]):e[a]}return r}}const Pi=e=>"number"==typeof e?0:e;const Di={test:function(e){var t,s;return isNaN(e)&&"string"==typeof e&&((null===(t=e.match(mi))||void 0===t?void 0:t.length)||0)+((null===(s=e.match(Si))||void 0===s?void 0:s.length)||0)>0},parse:Ri,createTransformer:Ii,getAnimatableNone:function(e){const t=Ri(e);return Ii(e)(t.map(Pi))}},Ci=new Set(["brightness","contrast","saturate","opacity"]);function Ni(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=s.match(mi)||[];if(!i)return e;const r=s.replace(i,"");let a=Ci.has(t)?1:0;return i!==s&&(a*=100),t+"("+a+r+")"}const _i=/\b([a-z-]*)\(.*?\)/gu,Mi={...Di,getAnimatableNone:e=>{const t=e.match(_i);return t?t.map(Ni).join(" "):e}},Fi={...jt,color:Ti,backgroundColor:Ti,outlineColor:Ti,fill:Ti,stroke:Ti,borderColor:Ti,borderTopColor:Ti,borderRightColor:Ti,borderBottomColor:Ti,borderLeftColor:Ti,filter:Mi,WebkitFilter:Mi},Oi=e=>Fi[e];function ji(e,t){let s=Oi(e);return s!==Mi&&(s=Di),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Bi=new Set(["auto","none","0"]);const Ui=e=>e===wt||e===Dt,$i=(e,t)=>parseFloat(e.split(", ")[t]),Gi=(e,t)=>(s,{transform:i})=>{if("none"===i||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return $i(r[1],t);{const t=i.match(/^matrix\((.+)\)$/u);return t?$i(t[1],e):0}},Vi=new Set(["x","y","z"]),Ki=pt.filter((e=>!Vi.has(e)));const Hi={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Gi(4,13),y:Gi(5,14)};Hi.translateX=Hi.x,Hi.translateY=Hi.y;const Yi=new Set;let Wi=!1,qi=!1;function zi(){if(qi){const e=Array.from(Yi).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),s=new Map;t.forEach((e=>{const t=function(e){const t=[];return Ki.forEach((s=>{const i=e.getValue(s);void 0!==i&&(t.push([s,i.get()]),i.set(s.startsWith("scale")?1:0))})),t}(e);t.length&&(s.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=s.get(e);t&&t.forEach((([t,s])=>{var i;null===(i=e.getValue(t))||void 0===i||i.set(s)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}qi=!1,Wi=!1,Yi.forEach((e=>e.complete())),Yi.clear()}function Xi(){Yi.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(qi=!0)}))}class Qi{constructor(e,t,s,i,r,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Yi.add(this),Wi||(Wi=!0,Ie.read(Xi),Ie.resolveKeyframes(zi))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;for(let r=0;r<e.length;r++)if(null===e[r])if(0===r){const r=null==i?void 0:i.get(),a=e[e.length-1];if(void 0!==r)e[0]=r;else if(s&&t){const i=s.readValue(t,a);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=a),i&&void 0===r&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Yi.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Yi.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Ji=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Zi=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function er(e,t,s=1){const[i,r]=function(e){const t=Zi.exec(e);if(!t)return[,];const[,s,i,r]=t;return[`--${null!=s?s:i}`,r]}(e);if(!i)return;const a=window.getComputedStyle(t).getPropertyValue(i);if(a){const e=a.trim();return Ji(e)?parseFloat(e):e}return Et(r)?er(r,t,s+1):r}const tr=e=>t=>t.test(e),sr=[wt,Dt,Pt,It,Nt,Ct,{test:e=>"auto"===e,parse:e=>e}],ir=e=>sr.find(tr(e));class rr extends Qi{constructor(e,t,s,i,r){super(e,t,s,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),Et(s))){const i=er(s,t.current);void 0!==i&&(e[o]=i),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!Gs.has(s)||2!==e.length)return;const[i,r]=e,a=ir(i),n=ir(r);if(a!==n)if(Ui(a)&&Ui(n))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)("number"==typeof(i=e[r])?0===i:null===i||"none"===i||"0"===i||ui(i))&&s.push(r);var i;s.length&&function(e,t,s){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"==typeof t&&!Bi.has(t)&&Li(t).values.length&&(i=e[r]),r++}if(i&&s)for(const a of t)e[a]=ji(s,i)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Hi[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(s,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(s);r&&r.jump(this.measuredOrigin,!1);const a=i.length-1,n=i[a];i[a]=Hi[s](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((([e,s])=>{t.getValue(e).set(s)})),this.resolveNoneKeyframes()}}const ar=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!Di.test(e)&&"0"!==e||e.startsWith("url(")));function nr(e,t,s,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],n=ar(r,t),o=ar(a,t);return!(!n||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||xs(s))&&i)}const or=e=>null!==e;function lr(e,{repeat:t,repeatType:s="loop"},i){const r=e.filter(or),a=t&&"loop"!==s&&t%2==1?0:r.length-1;return a&&void 0!==i?i:r[a]}class dr{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",...n}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Hs.now(),this.options={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:r,repeatType:a,...n},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Xi(),zi()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Hs.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:r,delay:a,onComplete:n,onUpdate:o,isGenerator:l}=this.options;if(!l&&!nr(e,s,i,r)){if(!a)return o&&o(lr(e,this.options,t)),n&&n(),void this.resolveFinishedPromise();this.options.duration=0}const d=this.initPlayback(e,t);!1!==d&&(this._resolved={keyframes:e,finalKeyframe:t,...d},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}const cr=(e,t,s)=>e+(t-e)*s;function hr(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function ur(e,t){return s=>s>0?t:e}const fr=(e,t,s)=>{const i=e*e,r=s*(t*t-i)+i;return r<0?0:Math.sqrt(r)},mr=[bi,xi,Ei];function gr(e){const t=(s=e,mr.find((e=>e.test(s))));var s;if(!Boolean(t))return!1;let i=t.parse(e);return t===Ei&&(i=function({hue:e,saturation:t,lightness:s,alpha:i}){e/=360,s/=100;let r=0,a=0,n=0;if(t/=100){const i=s<.5?s*(1+t):s+t-s*t,o=2*s-i;r=hr(o,i,e+1/3),a=hr(o,i,e),n=hr(o,i,e-1/3)}else r=a=n=s;return{red:Math.round(255*r),green:Math.round(255*a),blue:Math.round(255*n),alpha:i}}(i)),i}const pr=(e,t)=>{const s=gr(e),i=gr(t);if(!s||!i)return ur(e,t);const r={...s};return e=>(r.red=fr(s.red,i.red,e),r.green=fr(s.green,i.green,e),r.blue=fr(s.blue,i.blue,e),r.alpha=cr(s.alpha,i.alpha,e),xi.transform(r))},yr=(e,t)=>s=>t(e(s)),vr=(...e)=>e.reduce(yr),xr=new Set(["none","hidden"]);function br(e,t){return s=>cr(e,t,s)}function Er(e){return"number"==typeof e?br:"string"==typeof e?Et(e)?ur:Ti.test(e)?pr:Ar:Array.isArray(e)?Tr:"object"==typeof e?Ti.test(e)?pr:Sr:ur}function Tr(e,t){const s=[...e],i=s.length,r=e.map(((e,s)=>Er(e)(e,t[s])));return e=>{for(let t=0;t<i;t++)s[t]=r[t](e);return s}}function Sr(e,t){const s={...e,...t},i={};for(const r in s)void 0!==e[r]&&void 0!==t[r]&&(i[r]=Er(e[r])(e[r],t[r]));return e=>{for(const t in i)s[t]=i[t](e);return s}}const Ar=(e,t)=>{const s=Di.createTransformer(t),i=Li(e),r=Li(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?xr.has(e)&&!r.values.length||xr.has(t)&&!i.values.length?function(e,t){return xr.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):vr(Tr(function(e,t){var s;const i=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const n=t.types[a],o=e.indexes[n][r[n]],l=null!==(s=e.values[o])&&void 0!==s?s:0;i[a]=l,r[n]++}return i}(i,r),r.values),s):ur(e,t)};function wr(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return cr(e,t,s);return Er(e)(e,t)}function kr(e,t,s){const i=Math.max(t-5,0);return zs(s-e(i),t-i)}const Lr=100,Rr=10,Ir=1,Pr=0,Dr=800,Cr=.3,Nr=.3,_r={granular:.01,default:2},Mr={granular:.005,default:.5},Fr=.01,Or=10,jr=.05,Br=1;function Ur({duration:e=Dr,bounce:t=Cr,velocity:s=Pr,mass:i=Ir}){let r,a,n=1-t;n=At(jr,Br,n),e=At(Fr,Or,we(e)),n<1?(r=t=>{const i=t*n,r=i*e;return.001-(i-s)/Gr(t,n)*Math.exp(-r)},a=t=>{const i=t*n*e,a=i*s+s,o=Math.pow(n,2)*Math.pow(t,2)*e,l=Math.exp(-i),d=Gr(Math.pow(t,2),n);return(.001-r(t)>0?-1:1)*((a-o)*l)/d}):(r=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,a=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let i=s;for(let r=1;r<$r;r++)i-=e(i)/t(i);return i}(r,a,5/e);if(e=Ae(e),isNaN(o))return{stiffness:Lr,damping:Rr,duration:e};{const t=Math.pow(o,2)*i;return{stiffness:t,damping:2*n*Math.sqrt(i*t),duration:e}}}const $r=12;function Gr(e,t){return e*Math.sqrt(1-t*t)}const Vr=["duration","bounce"],Kr=["stiffness","damping","mass"];function Hr(e,t){return t.some((t=>void 0!==e[t]))}function Yr(e=Nr,t=Cr){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=s;const a=s.keyframes[0],n=s.keyframes[s.keyframes.length-1],o={done:!1,value:a},{stiffness:l,damping:d,mass:c,duration:h,velocity:u,isResolvedFromDuration:f}=function(e){let t={velocity:Pr,stiffness:Lr,damping:Rr,mass:Ir,isResolvedFromDuration:!1,...e};if(!Hr(e,Kr)&&Hr(e,Vr))if(e.visualDuration){const s=e.visualDuration,i=2*Math.PI/(1.2*s),r=i*i,a=2*At(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Ir,stiffness:r,damping:a}}else{const s=Ur(e);t={...t,...s,mass:Ir},t.isResolvedFromDuration=!0}return t}({...s,velocity:-we(s.velocity||0)}),m=u||0,g=d/(2*Math.sqrt(l*c)),p=n-a,y=we(Math.sqrt(l/c)),v=Math.abs(p)<5;let x;if(i||(i=v?_r.granular:_r.default),r||(r=v?Mr.granular:Mr.default),g<1){const e=Gr(y,g);x=t=>{const s=Math.exp(-g*y*t);return n-s*((m+g*y*p)/e*Math.sin(e*t)+p*Math.cos(e*t))}}else if(1===g)x=e=>n-Math.exp(-y*e)*(p+(m+y*p)*e);else{const e=y*Math.sqrt(g*g-1);x=t=>{const s=Math.exp(-g*y*t),i=Math.min(e*t,300);return n-s*((m+g*y*p)*Math.sinh(i)+e*p*Math.cosh(i))/e}}const b={calculatedDuration:f&&h||null,next:e=>{const t=x(e);if(f)o.done=e>=h;else{let s=0;g<1&&(s=0===e?Ae(m):kr(x,e,t));const a=Math.abs(s)<=i,l=Math.abs(n-t)<=r;o.done=a&&l}return o.value=o.done?n:t,o},toString:()=>{const e=Math.min(vs(b),ys),t=ws((t=>b.next(e*t).value),e,30);return e+"ms "+t}};return b}function Wr({keyframes:e,velocity:t=0,power:s=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:n,min:o,max:l,restDelta:d=.5,restSpeed:c}){const h=e[0],u={done:!1,value:h},f=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let m=s*t;const g=h+m,p=void 0===n?g:n(g);p!==g&&(m=p-h);const y=e=>-m*Math.exp(-e/i),v=e=>p+y(e),x=e=>{const t=y(e),s=v(e);u.done=Math.abs(t)<=d,u.value=u.done?p:s};let b,E;const T=e=>{var t;(t=u.value,void 0!==o&&t<o||void 0!==l&&t>l)&&(b=e,E=Yr({keyframes:[u.value,f(u.value)],velocity:kr(v,e,u.value),damping:r,stiffness:a,restDelta:d,restSpeed:c}))};return T(0),{calculatedDuration:null,next:e=>{let t=!1;return E||void 0!==b||(t=!0,x(e),T(e)),void 0!==b&&e>=b?E.next(e-b):(!t&&x(e),u)}}}const qr=si(.42,0,1,1),zr=si(0,0,.58,1),Xr=si(.42,0,.58,1),Qr={linear:be,easeIn:qr,easeInOut:Xr,easeOut:zr,circIn:di,circInOut:hi,circOut:ci,backIn:ni,backInOut:oi,backOut:ai,anticipate:li},Jr=e=>{if(Es(e)){Ee(4===e.length);const[t,s,i,r]=e;return si(t,s,i,r)}return"string"==typeof e?Qr[e]:e};function Zr(e,t,{clamp:s=!0,ease:i,mixer:r}={}){const a=e.length;if(Ee(a===t.length),1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const n=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const i=[],r=s||wr,a=e.length-1;for(let n=0;n<a;n++){let s=r(e[n],e[n+1]);if(t){const e=Array.isArray(t)?t[n]||be:t;s=vr(e,s)}i.push(s)}return i}(t,i,r),l=o.length,d=s=>{if(n&&s<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(s<e[i+1]);i++);const r=Se(e[i],e[i+1],s);return o[i](r)};return s?t=>d(At(e[0],e[a-1],t)):d}function ea(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let i=1;i<=t;i++){const r=Se(0,t,i);e.push(cr(s,1,r))}}(t,e.length-1),t}function ta({duration:e=300,keyframes:t,times:s,ease:i="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(Jr):Jr(i),a={done:!1,value:t[0]},n=function(e,t){return e.map((e=>e*t))}(s&&s.length===t.length?s:ea(t),e),o=Zr(n,t,{ease:Array.isArray(r)?r:(l=t,d=r,l.map((()=>d||Xr)).splice(0,l.length-1))});var l,d;return{calculatedDuration:e,next:t=>(a.value=o(t),a.done=t>=e,a)}}const sa=e=>{const t=({timestamp:t})=>e(t);return{start:()=>Ie.update(t,!0),stop:()=>Pe(t),now:()=>De.isProcessing?De.timestamp:Hs.now()}},ia={decay:Wr,inertia:Wr,tween:ta,keyframes:ta,spring:Yr},ra=e=>e/100;class aa extends dr{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:s,element:i,keyframes:r}=this.options,a=(null==i?void 0:i.KeyframeResolver)||Qi;this.resolver=new a(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=this.options,n=xs(t)?t:ia[t]||ta;let o,l;n!==ta&&"number"!=typeof e[0]&&(o=vr(ra,wr(e[0],e[1])),e=[0,100]);const d=n({...this.options,keyframes:e});"mirror"===r&&(l=n({...this.options,keyframes:[...e].reverse(),velocity:-a})),null===d.calculatedDuration&&(d.calculatedDuration=vs(d));const{calculatedDuration:c}=d,h=c+i;return{generator:d,mirroredGenerator:l,mapPercentToKeyframes:o,calculatedDuration:c,resolvedDuration:h,totalDuration:h*(s+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:a,mapPercentToKeyframes:n,keyframes:o,calculatedDuration:l,totalDuration:d,resolvedDuration:c}=s;if(null===this.startTime)return r.next(0);const{delay:h,repeat:u,repeatType:f,repeatDelay:m,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-d/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),y=this.speed>=0?p<0:p>d;this.currentTime=Math.max(p,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=d);let v=this.currentTime,x=r;if(u){const e=Math.min(this.currentTime,d)/c;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===f?(s=1-s,m&&(s-=m/c)):"mirror"===f&&(x=a)),v=At(0,1,s)*c}const b=y?{done:!1,value:o[0]}:x.next(v);n&&(b.value=n(b.value));let{done:E}=b;y||null===l||(E=this.speed>=0?this.currentTime>=d:this.currentTime<=0);const T=null===this.holdTime&&("finished"===this.state||"running"===this.state&&E);return T&&void 0!==i&&(b.value=lr(o,this.options,i)),g&&g(b.value),T&&this.finish(),b}get duration(){const{resolved:e}=this;return e?we(e.calculatedDuration):0}get time(){return we(this.currentTime)}set time(e){e=Ae(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=we(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=sa,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!=s?s:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const na=new Set(["opacity","clipPath","filter","transform"]);function oa(e,t,s,{delay:i=0,duration:r=300,repeat:a=0,repeatType:n="loop",ease:o="easeInOut",times:l}={}){const d={[t]:s};l&&(d.offset=l);const c=Is(o,r);return Array.isArray(c)&&(d.easing=c),e.animate(d,{delay:i,duration:r,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:a+1,direction:"reverse"===n?"alternate":"normal"})}const la=Te((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const da={anticipate:li,backInOut:oi,circInOut:hi};class ca extends dr{constructor(e){super(e);const{name:t,motionValue:s,element:i,keyframes:r}=this.options;this.resolver=new rr(r,((e,t)=>this.onKeyframesResolved(e,t)),t,s,i),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:s=300,times:i,ease:r,type:a,motionValue:n,name:o,startTime:l}=this.options;if(!n.owner||!n.owner.current)return!1;var d;if("string"==typeof r&&As()&&r in da&&(r=da[r]),xs((d=this.options).type)||"spring"===d.type||!ks(d.ease)){const{onComplete:t,onUpdate:n,motionValue:o,element:l,...d}=this.options,c=function(e,t){const s=new aa({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let a=0;for(;!i.done&&a<2e4;)i=s.sample(a),r.push(i.value),a+=10;return{times:void 0,keyframes:r,duration:a-10,ease:"linear"}}(e,d);1===(e=c.keyframes).length&&(e[1]=e[0]),s=c.duration,i=c.times,r=c.ease,a="keyframes"}const c=oa(n.owner.current,o,e,{...this.options,duration:s,times:i,ease:r});return c.startTime=null!=l?l:this.calcStartTime(),this.pendingTimeline?(bs(c,this.pendingTimeline),this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:s}=this.options;n.set(lr(e,this.options,t)),s&&s(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:s,times:i,type:a,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return we(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return we(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.currentTime=Ae(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return be;const{animation:s}=t;bs(s,e)}else this.pendingTimeline=e;return be}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:s,duration:i,type:r,ease:a,times:n}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:o,element:l,...d}=this.options,c=new aa({...d,keyframes:s,duration:i,type:r,ease:a,times:n,isGenerator:!0}),h=Ae(this.time);e.setWithVelocity(c.sample(h-10).value,c.sample(h).value,10)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:s,repeatDelay:i,repeatType:r,damping:a,type:n}=e;if(!(t&&t.owner&&t.owner.current instanceof HTMLElement))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return la()&&s&&na.has(s)&&!o&&!l&&!i&&"mirror"!==r&&0!==a&&"inertia"!==n}}const ha={type:"spring",stiffness:500,damping:25,restSpeed:10},ua={type:"keyframes",duration:.8},fa={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ma=(e,{keyframes:t})=>t.length>2?ua:yt.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:ha:fa;const ga=(e,t,s,i={},r,a)=>n=>{const o=ps(i,e)||{},l=o.delay||i.delay||0;let{elapsed:d=0}=i;d-=Ae(l);let c={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-d,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{n(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:a?void 0:r};(function({when:e,delay:t,delayChildren:s,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:n,repeatDelay:o,from:l,elapsed:d,...c}){return!!Object.keys(c).length})(o)||(c={...c,...ma(e,c)}),c.duration&&(c.duration=Ae(c.duration)),c.repeatDelay&&(c.repeatDelay=Ae(c.repeatDelay)),void 0!==c.from&&(c.keyframes[0]=c.from);let h=!1;if((!1===c.type||0===c.duration&&!c.repeatDelay)&&(c.duration=0,0===c.delay&&(h=!0)),h&&!a&&void 0!==t.get()){const e=lr(c.keyframes,o);if(void 0!==e)return Ie.update((()=>{c.onUpdate(e),c.onComplete()})),new gs([])}return!a&&ca.supports(c)?new ca(c):new aa(c)};function pa({protectedKeys:e,needsAnimating:t},s){const i=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,i}function ya(e,t,{delay:s=0,transitionOverride:i,type:r}={}){var a;let{transition:n=e.getDefaultTransition(),transitionEnd:o,...l}=t;i&&(n=i);const d=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const t=e.getValue(h,null!==(a=e.latestValues[h])&&void 0!==a?a:null),i=l[h];if(void 0===i||c&&pa(c,h))continue;const r={delay:s,...ps(n||{},h)};let o=!1;if(window.MotionHandoffAnimation){const t=ei(e);if(t){const e=window.MotionHandoffAnimation(t,h,Ie);null!==e&&(r.startTime=e,o=!0)}}Zs(e,h),t.start(ga(h,t,i,e.shouldReduceMotion&&Gs.has(h)?{type:!1}:r,e,o));const u=t.animation;u&&d.push(u)}return o&&Promise.all(d).then((()=>{Ie.update((()=>{o&&function(e,t){const s=us(e,t);let{transitionEnd:i={},transition:r={},...a}=s||{};a={...a,...i};for(const o in a)Js(e,o,(n=a[o],ht(n)?n[n.length-1]||0:n));var n}(e,o)}))})),d}function va(e,t,s={}){var i;const r=us(e,t,"exit"===s.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};s.transitionOverride&&(a=s.transitionOverride);const n=r?()=>Promise.all(ya(e,r,s)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:r=0,staggerChildren:n,staggerDirection:o}=a;return function(e,t,s=0,i=0,r=1,a){const n=[],o=(e.variantChildren.size-1)*i,l=1===r?(e=0)=>e*i:(e=0)=>o-e*i;return Array.from(e.variantChildren).sort(xa).forEach(((e,i)=>{e.notify("AnimationStart",t),n.push(va(e,t,{...a,delay:s+l(i)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(n)}(e,t,r+i,n,o,s)}:()=>Promise.resolve(),{when:l}=a;if(l){const[e,t]="beforeChildren"===l?[n,o]:[o,n];return e().then((()=>t()))}return Promise.all([n(),o(s.delay)])}function xa(e,t){return e.sortNodePosition(t)}const ba=He.length;function Ea(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Ea(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<ba;s++){const i=He[s],r=e.props[i];(Ge(r)||!1===r)&&(t[i]=r)}return t}const Ta=[...Ke].reverse(),Sa=Ke.length;function Aa(e){return t=>Promise.all(t.map((({animation:t,options:s})=>function(e,t,s={}){let i;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>va(e,t,s)));i=Promise.all(r)}else if("string"==typeof t)i=va(e,t,s);else{const r="function"==typeof t?us(e,t,s.custom):t;i=Promise.all(ya(e,r,s))}return i.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,s))))}function wa(e){let t=Aa(e),s=Ra(),i=!0;const r=t=>(s,i)=>{var r;const a=us(e,i,"exit"===t?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(a){const{transition:e,transitionEnd:t,...i}=a;s={...s,...i,...t}}return s};function a(a){const{props:n}=e,o=Ea(e.parent)||{},l=[],d=new Set;let c={},h=1/0;for(let t=0;t<Sa;t++){const u=Ta[t],f=s[u],m=void 0!==n[u]?n[u]:o[u],g=Ge(m),p=u===a?f.isActive:null;!1===p&&(h=t);let y=m===o[u]&&m!==n[u]&&g;if(y&&i&&e.manuallyAnimateOnMount&&(y=!1),f.protectedKeys={...c},!f.isActive&&null===p||!m&&!f.prevProp||Ve(m)||"boolean"==typeof m)continue;const v=ka(f.prevProp,m);let x=v||u===a&&f.isActive&&!y&&g||t>h&&g,b=!1;const E=Array.isArray(m)?m:[m];let T=E.reduce(r(u),{});!1===p&&(T={});const{prevResolvedValues:S={}}=f,A={...S,...T},w=t=>{x=!0,d.has(t)&&(b=!0,d.delete(t)),f.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in A){const t=T[e],s=S[e];if(c.hasOwnProperty(e))continue;let i=!1;i=ht(t)&&ht(s)?!hs(t,s):t!==s,i?null!=t?w(e):d.add(e):void 0!==t&&d.has(e)?w(e):f.protectedKeys[e]=!0}f.prevProp=m,f.prevResolvedValues=T,f.isActive&&(c={...c,...T}),i&&e.blockInitialAnimation&&(x=!1);x&&(!(y&&v)||b)&&l.push(...E.map((e=>({animation:e,options:{type:u}}))))}if(d.size){const t={};d.forEach((s=>{const i=e.getBaseTarget(s),r=e.getValue(s);r&&(r.liveStyle=!0),t[s]=null!=i?i:null})),l.push({animation:t})}let u=Boolean(l.length);return!i||!1!==n.initial&&n.initial!==n.animate||e.manuallyAnimateOnMount||(u=!1),i=!1,u?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,i){var r;if(s[t].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach((e=>{var s;return null===(s=e.animationState)||void 0===s?void 0:s.setActive(t,i)})),s[t].isActive=i;const n=a(t);for(const e in s)s[e].protectedKeys={};return n},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=Ra(),i=!0}}}function ka(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!hs(t,e)}function La(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ra(){return{animate:La(!0),whileInView:La(),whileHover:La(),whileTap:La(),whileDrag:La(),whileFocus:La(),exit:La()}}class Ia{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Pa=0;const Da={animation:{Feature:class extends Ia{constructor(e){super(e),e.animationState||(e.animationState=wa(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ve(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Ia{constructor(){super(...arguments),this.id=Pa++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then((()=>t(this.id)))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}}};function Ca(e,t,s,i={passive:!0}){return e.addEventListener(t,s,i),()=>e.removeEventListener(t,s)}function Na(e){return{point:{x:e.pageX,y:e.pageY}}}function _a(e,t,s,i){return Ca(e,t,(e=>t=>Ms(t)&&e(t,Na(t)))(s),i)}const Ma=(e,t)=>Math.abs(e-t);class Fa{constructor(e,t,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Ba(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=Ma(e.x,t.x),i=Ma(e.y,t.y);return Math.sqrt(s**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!s)return;const{point:i}=e,{timestamp:r}=De;this.history.push({...i,timestamp:r});const{onStart:a,onMove:n}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),n&&n(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Oa(t,this.transformPagePoint),Ie.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Ba("pointercancel"===e.type?this.lastMoveEventInfo:Oa(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,a),i&&i(e,a)},!Ms(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=i||window;const a=Oa(Na(e),this.transformPagePoint),{point:n}=a,{timestamp:o}=De;this.history=[{...n,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,Ba(a,this.history)),this.removeListeners=vr(_a(this.contextWindow,"pointermove",this.handlePointerMove),_a(this.contextWindow,"pointerup",this.handlePointerUp),_a(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Pe(this.updatePoint)}}function Oa(e,t){return t?{point:t(e.point)}:e}function ja(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ba({point:e},t){return{point:e,delta:ja(e,$a(t)),offset:ja(e,Ua(t)),velocity:Ga(t,.1)}}function Ua(e){return e[0]}function $a(e){return e[e.length-1]}function Ga(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,i=null;const r=$a(e);for(;s>=0&&(i=e[s],!(r.timestamp-i.timestamp>Ae(t)));)s--;if(!i)return{x:0,y:0};const a=we(r.timestamp-i.timestamp);if(0===a)return{x:0,y:0};const n={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return n.x===1/0&&(n.x=0),n.y===1/0&&(n.y=0),n}function Va(e){return e.max-e.min}function Ka(e,t,s,i=.5){e.origin=i,e.originPoint=cr(t.min,t.max,e.origin),e.scale=Va(s)/Va(t),e.translate=cr(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Ha(e,t,s,i){Ka(e.x,t.x,s.x,i?i.originX:void 0),Ka(e.y,t.y,s.y,i?i.originY:void 0)}function Ya(e,t,s){e.min=s.min+t.min,e.max=e.min+Va(t)}function Wa(e,t,s){e.min=t.min-s.min,e.max=e.min+Va(t)}function qa(e,t,s){Wa(e.x,t.x,s.x),Wa(e.y,t.y,s.y)}function za(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function Xa(e,t){let s=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,i]=[i,s]),{min:s,max:i}}const Qa=.35;function Ja(e,t,s){return{min:Za(e,t),max:Za(e,s)}}function Za(e,t){return"number"==typeof e?e:e[t]||0}const en=()=>({x:{min:0,max:0},y:{min:0,max:0}});function tn(e){return[e("x"),e("y")]}function sn({top:e,left:t,right:s,bottom:i}){return{x:{min:t,max:s},y:{min:e,max:i}}}function rn(e){return void 0===e||1===e}function an({scale:e,scaleX:t,scaleY:s}){return!rn(e)||!rn(t)||!rn(s)}function nn(e){return an(e)||on(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function on(e){return ln(e.x)||ln(e.y)}function ln(e){return e&&"0%"!==e}function dn(e,t,s){return s+t*(e-s)}function cn(e,t,s,i,r){return void 0!==r&&(e=dn(e,r,i)),dn(e,s,i)+t}function hn(e,t=0,s=1,i,r){e.min=cn(e.min,t,s,i,r),e.max=cn(e.max,t,s,i,r)}function un(e,{x:t,y:s}){hn(e.x,t.translate,t.scale,t.originPoint),hn(e.y,s.translate,s.scale,s.originPoint)}const fn=.999999999999,mn=1.0000000000001;function gn(e,t){e.min=e.min+t,e.max=e.max+t}function pn(e,t,s,i,r=.5){hn(e,t,s,cr(e.min,e.max,r),i)}function yn(e,t){pn(e.x,t.x,t.scaleX,t.scale,t.originX),pn(e.y,t.y,t.scaleY,t.scale,t.originY)}function vn(e,t){return sn(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const xn=({current:e})=>e?e.ownerDocument.defaultView:null,bn=new WeakMap;class En{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Fa(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Na(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:i,onDragStart:r}=this.getProps();if(s&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=s)||"y"===a?Ps[a]?null:(Ps[a]=!0,()=>{Ps[a]=!1}):Ps.x||Ps.y?null:(Ps.x=Ps.y=!0,()=>{Ps.x=Ps.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),tn((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Pt.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const i=s.layout.layoutBox[e];if(i){t=Va(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Ie.postRender((()=>r(e,t))),Zs(this.visualElement,"transform");const{animationState:n}=this.visualElement;n&&n.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:s,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:n}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(n),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,n),this.updateAxis("y",t.point,n),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>tn((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:xn(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Ie.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!Tn(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:s},i){return void 0!==t&&e<t?e=i?cr(t,e,i.min):Math.max(e,t):void 0!==s&&e>s&&(e=i?cr(s,e,i.max):Math.min(e,s)),e}(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&Qe(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,{top:t,left:s,bottom:i,right:r}){return{x:za(e.x,s,r),y:za(e.y,t,i)}}(i.layoutBox,t),this.elastic=function(e=Qa){return!1===e?e=0:!0===e&&(e=Qa),{x:Ja(e,"left","right"),y:Ja(e,"top","bottom")}}(s),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&tn((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(i.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Qe(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,s){const i=vn(e,s),{scroll:r}=t;return r&&(gn(i.x,r.offset.x),gn(i.y,r.offset.y)),i}(s,i.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Xa(e.x,t.x),y:Xa(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=sn(e))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:n}=this.getProps(),o=this.constraints||{},l=tn((n=>{if(!Tn(n,t,this.currentDirection))return;let l=o&&o[n]||{};a&&(l={min:0,max:0});const d=i?200:1e6,c=i?40:1e7,h={type:"inertia",velocity:s?e[n]:0,bounceStiffness:d,bounceDamping:c,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(n,h)}));return Promise.all(l).then(n)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Zs(this.visualElement,e),s.start(ga(e,s,0,t,this.visualElement,!1))}stopAnimation(){tn((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){tn((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){tn((t=>{const{drag:s}=this.getProps();if(!Tn(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:s,max:a}=i.layout.layoutBox[t];r.set(e[t]-cr(s,a,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Qe(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};tn((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();i[e]=function(e,t){let s=.5;const i=Va(e),r=Va(t);return r>i?s=Se(t.min,t.max-i,e.min):i>r&&(s=Se(e.min,e.max-r,t.min)),At(0,1,s)}({min:s,max:s},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),tn((t=>{if(!Tn(t,e,null))return;const s=this.getAxisMotionValue(t),{min:r,max:a}=this.constraints[t];s.set(cr(r,a,i[t]))}))}addListeners(){if(!this.visualElement.current)return;bn.set(this.visualElement,this);const e=_a(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();Qe(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Ie.read(t);const r=Ca(window,"resize",(()=>this.scalePositionWithinConstraints())),a=s.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(tn((t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Qa,dragMomentum:n=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:n}}}function Tn(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const Sn=e=>(t,s)=>{e&&Ie.postRender((()=>e(t,s)))};const An={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wn(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const kn={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Dt.test(e))return e;e=parseFloat(e)}return`${wn(e,t.target.x)}% ${wn(e,t.target.y)}%`}},Ln={correct:(e,{treeScale:t,projectionDelta:s})=>{const i=e,r=Di.parse(e);if(r.length>5)return i;const a=Di.createTransformer(e),n="number"!=typeof r[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;r[0+n]/=o,r[1+n]/=l;const d=cr(o,l,.5);return"number"==typeof r[2+n]&&(r[2+n]/=d),"number"==typeof r[3+n]&&(r[3+n]/=d),a(r)}};class Rn extends z.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:r}=e;var a;a=Pn,Object.assign(Jt,a),r&&(t.group&&t.group.add(r),s&&s.register&&i&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),An.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:r}=this.props,a=s.projection;return a?(a.isPresent=r,i||e.layoutDependency!==t||void 0===t?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||Ie.postRender((()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),tt.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function In(t){const[s,i]=me(),r=z.useContext(ne);return e.jsx(Rn,{...t,layoutGroup:r,switchLayoutGroup:z.useContext(st),isPresent:s,safeToRemove:i})}const Pn={borderRadius:{...kn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kn,borderTopRightRadius:kn,borderBottomLeftRadius:kn,borderBottomRightRadius:kn,boxShadow:Ln};const Dn=(e,t)=>e.depth-t.depth;class Cn{constructor(){this.children=[],this.isDirty=!1}add(e){Ys(this.children,e),this.isDirty=!0}remove(e){Ws(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Dn),this.isDirty=!1,this.children.forEach(e)}}const Nn=["TopLeft","TopRight","BottomLeft","BottomRight"],_n=Nn.length,Mn=e=>"string"==typeof e?parseFloat(e):e,Fn=e=>"number"==typeof e||Dt.test(e);function On(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const jn=Un(0,.5,ci),Bn=Un(.5,.95,be);function Un(e,t,s){return i=>i<e?0:i>t?1:s(Se(e,t,i))}function $n(e,t){e.min=t.min,e.max=t.max}function Gn(e,t){$n(e.x,t.x),$n(e.y,t.y)}function Vn(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Kn(e,t,s,i,r){return e=dn(e-=t,1/s,i),void 0!==r&&(e=dn(e,1/r,i)),e}function Hn(e,t,[s,i,r],a,n){!function(e,t=0,s=1,i=.5,r,a=e,n=e){Pt.test(t)&&(t=parseFloat(t),t=cr(n.min,n.max,t/100)-n.min);if("number"!=typeof t)return;let o=cr(a.min,a.max,i);e===a&&(o-=t),e.min=Kn(e.min,t,s,o,r),e.max=Kn(e.max,t,s,o,r)}(e,t[s],t[i],t[r],t.scale,a,n)}const Yn=["x","scaleX","originX"],Wn=["y","scaleY","originY"];function qn(e,t,s,i){Hn(e.x,t,Yn,s?s.x:void 0,i?i.x:void 0),Hn(e.y,t,Wn,s?s.y:void 0,i?i.y:void 0)}function zn(e){return 0===e.translate&&1===e.scale}function Xn(e){return zn(e.x)&&zn(e.y)}function Qn(e,t){return e.min===t.min&&e.max===t.max}function Jn(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Zn(e,t){return Jn(e.x,t.x)&&Jn(e.y,t.y)}function eo(e){return Va(e.x)/Va(e.y)}function to(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class so{constructor(){this.members=[]}add(e){Ys(this.members,e),e.scheduleRender()}remove(e){if(Ws(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let s;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&s.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const io={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ro="undefined"!=typeof window&&void 0!==window.MotionDebug,ao=["","X","Y","Z"],no={visibility:"hidden"};let oo=0;function lo(e,t,s,i){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function co(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=ei(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Ie,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&co(i)}function ho({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},s=(null==t?void 0:t())){this.id=oo++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ro&&(io.totalNodes=io.resolvedTargetDeltas=io.recalculatedProjection=0),this.nodes.forEach(mo),this.nodes.forEach(Eo),this.nodes.forEach(To),this.nodes.forEach(go),ro&&window.MotionDebug.record(io)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Cn)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new qs),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t,s=this.root.hasTreeAnimated){if(this.instance)return;var i;this.isSVG=(i=t)instanceof SVGElement&&"svg"!==i.tagName,this.instance=t;const{layoutId:r,layout:a,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),s&&(a||r)&&(this.isLayoutDirty=!0),e){let s;const i=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Hs.now(),i=({timestamp:r})=>{const a=r-s;a>=t&&(Pe(i),e(a-t))};return Ie.read(i,!0),()=>Pe(i)}(i,250),An.hasAnimatedSinceResize&&(An.hasAnimatedSinceResize=!1,this.nodes.forEach(bo))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&n&&(r||a)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeTargetChanged:s,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||n.getDefaultTransition()||Ro,{onLayoutAnimationStart:a,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!Zn(this.targetLayout,i)||s,d=!t&&s;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||d||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,d);const t={...ps(r,"layout"),onPlay:a,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else t||bo(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Pe(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(So),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&co(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(yo);this.isUpdating||this.nodes.forEach(vo),this.isUpdating=!1,this.nodes.forEach(xo),this.nodes.forEach(uo),this.nodes.forEach(fo),this.clearAllSnapshots();const e=Hs.now();De.delta=At(0,1e3/60,e-De.timestamp),De.timestamp=e,De.isProcessing=!0,Ce.update.process(De),Ce.preRender.process(De),Ce.render.process(De),De.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tt.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(po),this.sharedNodes.forEach(Ao)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ie.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ie.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Xn(this.projectionDelta),s=this.getTransformTemplate(),i=s?s(this.latestValues,""):void 0,a=i!==this.prevTransformTemplateValue;e&&(t||nn(this.latestValues)||a)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var i;return e&&(s=this.removeTransform(s)),Do((i=s).x),Do(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const s=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(No))){const{scroll:e}=this.root;e&&(gn(s.x,e.offset.x),gn(s.y,e.offset.y))}return s}removeElementScroll(e){var t;const s={x:{min:0,max:0},y:{min:0,max:0}};if(Gn(s,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return s;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:a}=t;t!==this.root&&r&&a.layoutScroll&&(r.wasRoot&&Gn(s,e),gn(s.x,r.offset.x),gn(s.y,r.offset.y))}return s}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};Gn(s,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&yn(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),nn(e.latestValues)&&yn(s,e.latestValues)}return nn(this.latestValues)&&yn(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Gn(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!nn(e.latestValues))continue;an(e.latestValues)&&e.updateSnapshot();const i={x:{min:0,max:0},y:{min:0,max:0}};Gn(i,e.measurePageBox()),qn(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return nn(this.latestValues)&&qn(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==De.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==s;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=De.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},qa(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Gn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var n,o,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,o=this.relativeTarget,l=this.relativeParent.target,Ya(n.x,o.x,l.x),Ya(n.y,o.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Gn(this.target,this.layout.layoutBox),un(this.target,this.targetDelta)):Gn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},qa(this.relativeTargetOrigin,this.target,e.target),Gn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ro&&io.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!an(this.parent.latestValues)&&!on(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),s=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===De.timestamp&&(i=!1),i)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;Gn(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,o=this.treeScale.y;!function(e,t,s,i=!1){const r=s.length;if(!r)return;let a,n;t.x=t.y=1;for(let o=0;o<r;o++){a=s[o],n=a.projectionDelta;const{visualElement:r}=a.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&yn(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),n&&(t.x*=n.x.scale,t.y*=n.y.scale,un(e,n)),i&&nn(a.latestValues)&&yn(e,a.latestValues))}t.x<mn&&t.x>fn&&(t.x=1),t.y<mn&&t.y>fn&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,s),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(Vn(this.prevProjectionDelta.x,this.projectionDelta.x),Vn(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Ha(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===n&&this.treeScale.y===o&&to(this.projectionDelta.x,this.prevProjectionDelta.x)&&to(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),ro&&io.recalculatedProjection++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,i=s?s.latestValues:{},r={...this.latestValues},a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const n={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),d=!l||l.members.length<=1,c=Boolean(o&&!d&&!0===this.options.crossfade&&!this.path.some(Lo));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var l,u,f,m,g,p;wo(a.x,e.x,s),wo(a.y,e.y,s),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(qa(n,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,m=this.relativeTargetOrigin,g=n,p=s,ko(f.x,m.x,g.x,p),ko(f.y,m.y,g.y,p),h&&(l=this.relativeTarget,u=h,Qn(l.x,u.x)&&Qn(l.y,u.y))&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Gn(h,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,s,i,r,a){r?(e.opacity=cr(0,void 0!==s.opacity?s.opacity:1,jn(i)),e.opacityExit=cr(void 0!==t.opacity?t.opacity:1,0,Bn(i))):a&&(e.opacity=cr(void 0!==t.opacity?t.opacity:1,void 0!==s.opacity?s.opacity:1,i));for(let n=0;n<_n;n++){const r=`border${Nn[n]}Radius`;let a=On(t,r),o=On(s,r);void 0===a&&void 0===o||(a||(a=0),o||(o=0),0===a||0===o||Fn(a)===Fn(o)?(e[r]=Math.max(cr(Mn(a),Mn(o),i),0),(Pt.test(o)||Pt.test(a))&&(e[r]+="%")):e[r]=o)}(t.rotate||s.rotate)&&(e.rotate=cr(t.rotate||0,s.rotate||0,i))}(r,i,this.latestValues,s,c,d)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Pe(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ie.update((()=>{An.hasAnimatedSinceResize=!0,this.currentAnimation=function(e,t,s){const i=ut(e)?e:Qs(e);return i.start(ga("",i,t,s)),i.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:i,latestValues:r}=e;if(t&&s&&i){if(this!==e&&this.layout&&i&&Co(this.options.animationType,this.layout.layoutBox,i.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Va(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const i=Va(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+i}Gn(t,s),yn(t,r),Ha(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new so);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const i=this.getStack();i&&i.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const i={};s.z&&lo("z",e,i,this.animationValues);for(let r=0;r<ao.length;r++)lo(`rotate${ao[r]}`,e,i,this.animationValues),lo(`skew${ao[r]}`,e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}getProjectionStyles(e){var t,s;if(!this.instance||this.isSVG)return;if(!this.isVisible)return no;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=ft(null==e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=ft(null==e?void 0:e.pointerEvents)||""),this.hasProjected&&!nn(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const n=a.animationValues||a.latestValues;this.applyTransformsToTarget(),i.transform=function(e,t,s){let i="";const r=e.x.translate/t.x,a=e.y.translate/t.y,n=(null==s?void 0:s.z)||0;if((r||a||n)&&(i=`translate3d(${r}px, ${a}px, ${n}px) `),1===t.x&&1===t.y||(i+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:a,skewX:n,skewY:o}=s;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),a&&(i+=`rotateY(${a}deg) `),n&&(i+=`skewX(${n}deg) `),o&&(i+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(i+=`scale(${o}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,n),r&&(i.transform=r(n,i.transform));const{x:o,y:l}=this.projectionDelta;i.transformOrigin=`${100*o.origin}% ${100*l.origin}% 0`,a.animationValues?i.opacity=a===this?null!==(s=null!==(t=n.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==s?s:1:this.preserveOpacity?this.latestValues.opacity:n.opacityExit:i.opacity=a===this?void 0!==n.opacity?n.opacity:"":void 0!==n.opacityExit?n.opacityExit:0;for(const d in Jt){if(void 0===n[d])continue;const{correct:e,applyTo:t}=Jt[d],s="none"===i.transform?n[d]:e(n[d],a);if(t){const e=t.length;for(let r=0;r<e;r++)i[t[r]]=s}else i[d]=s}return this.options.layoutId&&(i.pointerEvents=a===this?ft(null==e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(yo),this.root.sharedNodes.clear()}}}function uo(e){e.updateLayout()}function fo(e){var t;const s=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,a=s.source!==e.layout.source;"size"===r?tn((e=>{const i=a?s.measuredBox[e]:s.layoutBox[e],r=Va(i);i.min=t[e].min,i.max=i.min+r})):Co(r,s.layoutBox,t)&&tn((i=>{const r=a?s.measuredBox[i]:s.layoutBox[i],n=Va(t[i]);r.max=r.min+n,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+n)}));const n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Ha(n,t,s.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?Ha(o,e.applyTransform(i,!0),s.measuredBox):Ha(o,t,s.layoutBox);const l=!Xn(n);let d=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:a}=i;if(r&&a){const n={x:{min:0,max:0},y:{min:0,max:0}};qa(n,s.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};qa(o,t,a.layoutBox),Zn(n,o)||(d=!0),i.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=n,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:s,delta:o,layoutDelta:n,hasLayoutChanged:l,hasRelativeTargetChanged:d})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function mo(e){ro&&io.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function go(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function po(e){e.clearSnapshot()}function yo(e){e.clearMeasurements()}function vo(e){e.isLayoutDirty=!1}function xo(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function bo(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Eo(e){e.resolveTargetDelta()}function To(e){e.calcProjection()}function So(e){e.resetSkewAndRotation()}function Ao(e){e.removeLeadSnapshot()}function wo(e,t,s){e.translate=cr(t.translate,0,s),e.scale=cr(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function ko(e,t,s,i){e.min=cr(t.min,s.min,i),e.max=cr(t.max,s.max,i)}function Lo(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const Ro={duration:.45,ease:[.4,0,.1,1]},Io=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Po=Io("applewebkit/")&&!Io("chrome/")?Math.round:be;function Do(e){e.min=Po(e.min),e.max=Po(e.max)}function Co(e,t,s){return"position"===e||"preserve-aspect"===e&&(i=eo(t),r=eo(s),a=.2,!(Math.abs(i-r)<=a));var i,r,a}function No(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const _o=ho({attachResizeListener:(e,t)=>Ca(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Mo={current:void 0},Fo=ho({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Mo.current){const e=new _o({});e.mount(window),e.setOptions({layoutScroll:!0}),Mo.current=e}return Mo.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Oo={pan:{Feature:class extends Ia{constructor(){super(...arguments),this.removePointerDownListener=be}onPointerDown(e){this.session=new Fa(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:xn(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:Sn(e),onStart:Sn(t),onMove:s,onEnd:(e,t)=>{delete this.session,i&&Ie.postRender((()=>i(e,t)))}}}mount(){this.removePointerDownListener=_a(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Ia{constructor(e){super(e),this.removeGroupControls=be,this.removeListeners=be,this.controls=new En(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||be}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Fo,MeasureLayout:In}};function jo(e,t,s){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===s);const r=i["onHover"+s];r&&Ie.postRender((()=>r(t,Na(t))))}function Bo(e,t,s){const{props:i}=e;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===s);const r=i["onTap"+("End"===s?"":s)];r&&Ie.postRender((()=>r(t,Na(t))))}const Uo=new WeakMap,$o=new WeakMap,Go=e=>{const t=Uo.get(e.target);t&&t(e)},Vo=e=>{e.forEach(Go)};function Ko(e,t,s){const i=function({root:e,...t}){const s=e||document;$o.has(s)||$o.set(s,{});const i=$o.get(s),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Vo,{root:e,...t})),i[r]}(t);return Uo.set(e,s),i.observe(e),()=>{Uo.delete(e),i.unobserve(e)}}const Ho={some:0,all:1};const Yo={inView:{Feature:class extends Ia{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:r}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof i?i:Ho[i]};return Ko(this.node.current,a,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:i}=this.node.getProps(),a=t?s:i;a&&a(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Ia{mount(){const{current:e}=this.node;e&&(this.unmount=$s(e,(e=>(Bo(this.node,e,"Start"),(e,{success:t})=>Bo(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Ia{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=vr(Ca(this.node.current,"focus",(()=>this.onFocus())),Ca(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends Ia{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[i,r,a]=Cs(e,s),n=Ns((e=>{const{target:s}=e,i=t(e);if("function"!=typeof i||!s)return;const a=Ns((e=>{i(e),s.removeEventListener("pointerleave",a)}));s.addEventListener("pointerleave",a,r)}));return i.forEach((e=>{e.addEventListener("pointerenter",n,r)})),a}(e,(e=>(jo(this.node,e,"Start"),e=>jo(this.node,e,"End")))))}unmount(){}}}},Wo={layout:{ProjectionNode:Fo,MeasureLayout:In}},qo={current:null},zo={current:!1};const Xo=[...sr,Ti,Di],Qo=new WeakMap;const Jo=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Zo{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},n={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Qi,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Hs.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Ie.render(this.render,!1,!0))};const{latestValues:o,renderState:l,onUpdate:d}=a;this.onUpdate=d,this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=n,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=Ye(t),this.isVariantNode=We(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const u in h){const e=h[u];void 0!==o[u]&&ut(e)&&e.set(o[u],!1)}}mount(e){this.current=e,Qo.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),zo.current||function(){if(zo.current=!0,ye)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>qo.current=e.matches;e.addListener(t),t()}else qo.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||qo.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Qo.delete(this.current),this.projection&&this.projection.unmount(),Pe(this.notifyUpdate),Pe(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=yt.has(e),i=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Ie.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{i(),r(),a&&a(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Me){const t=Me[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<Jo.length;s++){const t=Jo[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,s){for(const i in t){const r=t[i],a=s[i];if(ut(r))e.addValue(i,r);else if(ut(a))e.addValue(i,Qs(r,{owner:e}));else if(a!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,Qs(void 0!==t?t:r,{owner:e}))}}for(const i in s)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=Qs(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let i=void 0===this.latestValues[e]&&this.current?null!==(s=this.getBaseTargetFromProps(this.props,e))&&void 0!==s?s:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return null!=i&&("string"==typeof i&&(Ji(i)||ui(i))?i=parseFloat(i):(r=i,!Xo.find(tr(r))&&Di.test(t)&&(i=ji(e,t))),this.setBaseTarget(e,ut(i)?i.get():i)),ut(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:s}=this.props;let i;if("string"==typeof s||"object"==typeof s){const r=ct(this.props,s,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);r&&(i=r[e])}if(s&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||ut(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new qs),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class el extends Zo{constructor(){super(...arguments),this.KeyframeResolver=rr}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ut(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}class tl extends el{constructor(){super(...arguments),this.type="html",this.renderInstance=zt}readValueFromInstance(e,t){if(yt.has(t)){const e=Oi(t);return e&&e.default||0}{const i=(s=e,window.getComputedStyle(s)),r=(xt(t)?i.getPropertyValue(t):i[t])||0;return"string"==typeof r?r.trim():r}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return vn(e,t)}build(e,t,s){$t(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return es(e,t,s)}}class sl extends el{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=en}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(yt.has(t)){const e=Oi(t);return e&&e.default||0}return t=Xt.has(t)?t:Ze(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return ts(e,t,s)}build(e,t,s){Ht(e,t,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,s,i){Qt(e,t,0,i)}mount(e){this.isSVGTag=qt(e.tagName),super.mount(e)}}const il=Ue(cs({...Da,...Yo,...Oo,...Wo},((e,t)=>lt(e)?new sl(t):new tl(t,{allowProjection:e!==z.Fragment}))));function rl(e){var t,s,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=rl(e[t]))&&(i&&(i+=" "),i+=s)}else for(s in e)e[s]&&(i&&(i+=" "),i+=s);return i}function al(){for(var e,t,s=0,i="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=rl(e))&&(i&&(i+=" "),i+=t);return i}const nl=e=>{const t=cl(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),ol(s,t)||dl(e)},getConflictingClassGroupIds:(e,t)=>{const r=s[e]||[];return t&&i[e]?[...r,...i[e]]:r}}},ol=(e,t)=>{if(0===e.length)return t.classGroupId;const s=e[0],i=t.nextPart.get(s),r=i?ol(e.slice(1),i):void 0;if(r)return r;if(0===t.validators.length)return;const a=e.join("-");return t.validators.find((({validator:e})=>e(a)))?.classGroupId},ll=/^\[(.+)\]$/,dl=e=>{if(ll.test(e)){const t=ll.exec(e)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},cl=e=>{const{theme:t,prefix:s}=e,i={nextPart:new Map,validators:[]};return ml(Object.entries(e.classGroups),s).forEach((([e,s])=>{hl(s,i,e,t)})),i},hl=(e,t,s,i)=>{e.forEach((e=>{if("string"!=typeof e){if("function"==typeof e)return fl(e)?void hl(e(i),t,s,i):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach((([e,r])=>{hl(r,ul(t,e),s,i)}))}else{(""===e?t:ul(t,e)).classGroupId=s}}))},ul=(e,t)=>{let s=e;return t.split("-").forEach((e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)})),s},fl=e=>e.isThemeGetter,ml=(e,t)=>t?e.map((([e,s])=>[e,s.map((e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,s])=>[t+e,s]))):e))])):e,gl=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,i=new Map;const r=(r,a)=>{s.set(r,a),t++,t>e&&(t=0,i=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=i.get(e))?(r(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):r(e,t)}}},pl=e=>{const{separator:t,experimentalParseClassName:s}=e,i=1===t.length,r=t[0],a=t.length,n=e=>{const s=[];let n,o=0,l=0;for(let h=0;h<e.length;h++){let d=e[h];if(0===o){if(d===r&&(i||e.slice(h,h+a)===t)){s.push(e.slice(l,h)),l=h+a;continue}if("/"===d){n=h;continue}}"["===d?o++:"]"===d&&o--}const d=0===s.length?e:e.substring(l),c=d.startsWith("!");return{modifiers:s,hasImportantModifier:c,baseClassName:c?d.substring(1):d,maybePostfixModifierPosition:n&&n>l?n-l:void 0}};return s?e=>s({className:e,parseClassName:n}):n},yl=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach((e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)})),t.push(...s.sort()),t},vl=/\s+/;function xl(){let e,t,s=0,i="";for(;s<arguments.length;)(e=arguments[s++])&&(t=bl(e))&&(i&&(i+=" "),i+=t);return i}const bl=e=>{if("string"==typeof e)return e;let t,s="";for(let i=0;i<e.length;i++)e[i]&&(t=bl(e[i]))&&(s&&(s+=" "),s+=t);return s};function El(e,...t){let s,i,r,a=function(o){const l=t.reduce(((e,t)=>t(e)),e());return s=(e=>({cache:gl(e.cacheSize),parseClassName:pl(e),...nl(e)}))(l),i=s.cache.get,r=s.cache.set,a=n,n(o)};function n(e){const t=i(e);if(t)return t;const a=((e,t)=>{const{parseClassName:s,getClassGroupId:i,getConflictingClassGroupIds:r}=t,a=[],n=e.trim().split(vl);let o="";for(let l=n.length-1;l>=0;l-=1){const e=n[l],{modifiers:t,hasImportantModifier:d,baseClassName:c,maybePostfixModifierPosition:h}=s(e);let u=Boolean(h),f=i(u?c.substring(0,h):c);if(!f){if(!u){o=e+(o.length>0?" "+o:o);continue}if(f=i(c),!f){o=e+(o.length>0?" "+o:o);continue}u=!1}const m=yl(t).join(":"),g=d?m+"!":m,p=g+f;if(a.includes(p))continue;a.push(p);const y=r(f,u);for(let s=0;s<y.length;++s){const e=y[s];a.push(g+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return r(e,a),a}return function(){return a(xl.apply(null,arguments))}}const Tl=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},Sl=/^\[(?:([a-z-]+):)?(.+)\]$/i,Al=/^\d+\/\d+$/,wl=new Set(["px","full","screen"]),kl=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ll=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Rl=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Il=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Pl=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Dl=e=>Nl(e)||wl.has(e)||Al.test(e),Cl=e=>Yl(e,"length",Wl),Nl=e=>Boolean(e)&&!Number.isNaN(Number(e)),_l=e=>Yl(e,"number",Nl),Ml=e=>Boolean(e)&&Number.isInteger(Number(e)),Fl=e=>e.endsWith("%")&&Nl(e.slice(0,-1)),Ol=e=>Sl.test(e),jl=e=>kl.test(e),Bl=new Set(["length","size","percentage"]),Ul=e=>Yl(e,Bl,ql),$l=e=>Yl(e,"position",ql),Gl=new Set(["image","url"]),Vl=e=>Yl(e,Gl,Xl),Kl=e=>Yl(e,"",zl),Hl=()=>!0,Yl=(e,t,s)=>{const i=Sl.exec(e);return!!i&&(i[1]?"string"==typeof t?i[1]===t:t.has(i[1]):s(i[2]))},Wl=e=>Ll.test(e)&&!Rl.test(e),ql=()=>!1,zl=e=>Il.test(e),Xl=e=>Pl.test(e),Ql=()=>{const e=Tl("colors"),t=Tl("spacing"),s=Tl("blur"),i=Tl("brightness"),r=Tl("borderColor"),a=Tl("borderRadius"),n=Tl("borderSpacing"),o=Tl("borderWidth"),l=Tl("contrast"),d=Tl("grayscale"),c=Tl("hueRotate"),h=Tl("invert"),u=Tl("gap"),f=Tl("gradientColorStops"),m=Tl("gradientColorStopPositions"),g=Tl("inset"),p=Tl("margin"),y=Tl("opacity"),v=Tl("padding"),x=Tl("saturate"),b=Tl("scale"),E=Tl("sepia"),T=Tl("skew"),S=Tl("space"),A=Tl("translate"),w=()=>["auto",Ol,t],k=()=>[Ol,t],L=()=>["",Dl,Cl],R=()=>["auto",Nl,Ol],I=()=>["","0",Ol],P=()=>[Nl,Ol];return{cacheSize:500,separator:":",theme:{colors:[Hl],spacing:[Dl,Cl],blur:["none","",jl,Ol],brightness:P(),borderColor:[e],borderRadius:["none","","full",jl,Ol],borderSpacing:k(),borderWidth:L(),contrast:P(),grayscale:I(),hueRotate:P(),invert:I(),gap:k(),gradientColorStops:[e],gradientColorStopPositions:[Fl,Cl],inset:w(),margin:w(),opacity:P(),padding:k(),saturate:P(),scale:P(),sepia:I(),skew:P(),space:k(),translate:k()},classGroups:{aspect:[{aspect:["auto","square","video",Ol]}],container:["container"],columns:[{columns:[jl]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ol]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ml,Ol]}],basis:[{basis:w()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ol]}],grow:[{grow:I()}],shrink:[{shrink:I()}],order:[{order:["first","last","none",Ml,Ol]}],"grid-cols":[{"grid-cols":[Hl]}],"col-start-end":[{col:["auto",{span:["full",Ml,Ol]},Ol]}],"col-start":[{"col-start":R()}],"col-end":[{"col-end":R()}],"grid-rows":[{"grid-rows":[Hl]}],"row-start-end":[{row:["auto",{span:[Ml,Ol]},Ol]}],"row-start":[{"row-start":R()}],"row-end":[{"row-end":R()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ol]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ol]}],gap:[{gap:[u]}],"gap-x":[{"gap-x":[u]}],"gap-y":[{"gap-y":[u]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[p]}],mx:[{mx:[p]}],my:[{my:[p]}],ms:[{ms:[p]}],me:[{me:[p]}],mt:[{mt:[p]}],mr:[{mr:[p]}],mb:[{mb:[p]}],ml:[{ml:[p]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ol,t]}],"min-w":[{"min-w":[Ol,t,"min","max","fit"]}],"max-w":[{"max-w":[Ol,t,"none","full","min","max","fit","prose",{screen:[jl]},jl]}],h:[{h:[Ol,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ol,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ol,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ol,t,"auto","min","max","fit"]}],"font-size":[{text:["base",jl,Cl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",_l]}],"font-family":[{font:[Hl]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ol]}],"line-clamp":[{"line-clamp":["none",Nl,_l]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Dl,Ol]}],"list-image":[{"list-image":["none",Ol]}],"list-style-type":[{list:["none","disc","decimal",Ol]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Dl,Cl]}],"underline-offset":[{"underline-offset":["auto",Dl,Ol]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ol]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ol]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",$l]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ul]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Vl]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[Dl,Ol]}],"outline-w":[{outline:[Dl,Cl]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Dl,Cl]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",jl,Kl]}],"shadow-color":[{shadow:[Hl]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[i]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",jl,Ol]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[h]}],saturate:[{saturate:[x]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[x]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[n]}],"border-spacing-x":[{"border-spacing-x":[n]}],"border-spacing-y":[{"border-spacing-y":[n]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ol]}],duration:[{duration:P()}],ease:[{ease:["linear","in","out","in-out",Ol]}],delay:[{delay:P()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ol]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Ml,Ol]}],"translate-x":[{"translate-x":[A]}],"translate-y":[{"translate-y":[A]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ol]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ol]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ol]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Dl,Cl,_l]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Jl=El(Ql);function Zl(...e){return Jl(al(e))}const ed=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,td=al,sd=(e,t)=>s=>{var i;if(null==(null==t?void 0:t.variants))return td(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:r,defaultVariants:a}=t,n=Object.keys(r).map((e=>{const t=null==s?void 0:s[e],i=null==a?void 0:a[e];if(null===t)return null;const n=ed(t)||ed(i);return r[e][n]})),o=s&&Object.entries(s).reduce(((e,t)=>{let[s,i]=t;return void 0===i||(e[s]=i),e}),{}),l=null==t||null===(i=t.compoundVariants)||void 0===i?void 0:i.reduce(((e,t)=>{let{class:s,className:i,...r}=t;return Object.entries(r).every((e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...o}[t]):{...a,...o}[t]===s}))?[...e,s,i]:e}),[]);return td(e,n,l,null==s?void 0:s.class,null==s?void 0:s.className)},id=sd("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),rd=X.forwardRef((({className:s,variant:i,size:r,asChild:a=!1,...n},o)=>{const l=a?t:"button";return e.jsx(l,{className:Zl(id({variant:i,size:r,className:s})),ref:o,...n})}));rd.displayName="Button";const ad=({className:t})=>e.jsx("img",{src:"/LOGO UFC.png",alt:"UFC Logo",className:`h-24 w-auto object-contain ${t}`});
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var nd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const od=(e,t)=>{const s=z.forwardRef((({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,...l},d)=>{return z.createElement("svg",{ref:d,...nd,width:i,height:i,stroke:s,strokeWidth:a?24*Number(r)/Number(i):r,className:["lucide",`lucide-${c=e,c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,n].join(" "),...l},[...t.map((([e,t])=>z.createElement(e,t))),...Array.isArray(o)?o:[o]]);var c}));return s.displayName=`${e}`,s},ld=od("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),dd=od("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),cd=od("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),hd=od("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),ud=od("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),fd=od("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),md=od("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),gd=od("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),pd=od("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]),yd=od("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),vd=od("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),xd=od("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),bd=od("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),Ed=od("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Td=od("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Sd=od("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ad=od("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),wd=od("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),kd=od("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ld=od("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Rd=od("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Id=od("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Pd=od("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Dd=od("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Cd=od("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),Nd=od("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),_d=od("Rss",[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),Md=od("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Fd=od("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Od=od("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),jd=od("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Bd=od("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),Ud=od("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),$d=od("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Gd=od("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Vd=od("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),Kd=od("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Hd=od("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Yd=od("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Wd=od("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),qd=od("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),zd=od("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Xd=od("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Qd=od("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Jd=l,Zd=d,ec=a,tc=i,sc=X.forwardRef((({className:t,...i},r)=>e.jsx(s,{className:Zl("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...i,ref:r})));sc.displayName=s.displayName;const ic=sd("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),rc=X.forwardRef((({side:t="right",className:s,children:i,...n},o)=>e.jsxs(tc,{children:[e.jsx(sc,{}),e.jsxs(r,{ref:o,className:Zl(ic({side:t}),s),...n,children:[i,e.jsxs(a,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Xd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));rc.displayName=r.displayName;const ac=({className:t,...s})=>e.jsx("div",{className:Zl("flex flex-col space-y-2 text-center sm:text-left",t),...s});ac.displayName="SheetHeader";const nc=X.forwardRef((({className:t,...s},i)=>e.jsx(n,{ref:i,className:Zl("text-lg font-semibold text-foreground",t),...s})));nc.displayName=n.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(o,{ref:i,className:Zl("text-sm text-muted-foreground",t),...s}))).displayName=o.displayName;const oc=({trigger:t,navItems:s})=>{const i=[...(s||[]).map((e=>({icon:e.icon,label:e.name,path:e.path}))),{icon:qd,label:"Mi Perfil",path:"/profile"},{icon:dd,label:"Mis Rankings",path:"/rankings"}];return e.jsxs(Jd,{children:[e.jsx(Zd,{asChild:!0,children:t}),e.jsxs(rc,{side:"left",className:"bg-black border-gray-800 text-white w-[280px] sm:w-[320px] flex flex-col",children:[e.jsx(ac,{className:"mb-6 border-b border-gray-700 pb-4",children:e.jsx(nc,{children:e.jsxs(Q,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(ad,{className:"h-8 w-auto"}),e.jsx("span",{className:"font-bold text-xl text-white",children:"SMASH"})]})})}),e.jsxs("div",{className:"flex flex-col h-full pb-10 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6 px-4 py-3 bg-gray-900/50 rounded-lg border border-gray-700 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-300",children:"Mis Puntos:"}),e.jsxs("div",{className:"flex items-center text-yellow-400 font-bold text-lg",children:[e.jsx(bd,{className:"h-5 w-5 mr-2"}),1250..toLocaleString()]})]}),e.jsx("nav",{className:"flex-grow space-y-1",children:i.map((t=>e.jsx(ec,{asChild:!0,children:e.jsxs(Q,{to:t.path,className:"flex items-center px-4 py-2.5 rounded-md text-gray-300 hover:bg-gray-800 hover:text-white transition-colors duration-200",children:[t.icon&&e.jsx(t.icon,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium text-sm",children:t.label})]})},t.label)))}),e.jsxs("div",{className:"mt-auto space-y-2 border-t border-gray-700 pt-4",children:[e.jsx(ec,{asChild:!0,children:e.jsx(rd,{variant:"ghost",className:"w-full justify-start",asChild:!0,children:e.jsx(Q,{to:"/login",children:"Iniciar Sesin"})})}),e.jsx(ec,{asChild:!0,children:e.jsx(rd,{className:"w-full bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(Q,{to:"/register",children:"Registrarse"})})})]}),e.jsx("div",{className:"mt-4 border-t border-gray-700 pt-4",children:e.jsx(ec,{asChild:!0,children:e.jsxs(rd,{variant:"ghost",className:"w-full flex items-center justify-start text-red-500 hover:bg-red-900/50 hover:text-red-400",onClick:()=>{},children:[e.jsx(Ld,{className:"h-5 w-5 mr-3"}),e.jsx("span",{className:"font-medium",children:"Cerrar Sesin"})]})})})]})]})]})},lc=m,dc=g,cc=z.forwardRef((({className:t,...s},i)=>e.jsx(c,{ref:i,className:`z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-700 bg-black p-1 text-white shadow-md ${t||""}`,...s})));cc.displayName=c.displayName;z.forwardRef((({className:t,...s},i)=>e.jsx(h,{ref:i,className:`px-2 py-1.5 text-sm font-semibold ${t||""}`,...s}))).displayName=h.displayName;const hc=z.forwardRef((({className:t,...s},i)=>e.jsx(u,{ref:i,className:`flex cursor-pointer select-none items-center rounded-sm px-2 py-2 text-sm outline-none transition-colors hover:bg-gray-800 ${t||""}`,...s})));hc.displayName=u.displayName;const uc=z.forwardRef((({className:t,...s},i)=>e.jsx(f,{ref:i,className:`my-1 h-px bg-gray-700 ${t||""}`,...s})));uc.displayName=f.displayName;const fc={username:"Rugal444",email:"rugal444@gmail.com",points:1250,avatar:"/pain.png",level:5,winRate:"78%",predictions:156},mc=()=>e.jsxs(lc,{children:[e.jsx(dc,{asChild:!0,children:e.jsx(rd,{variant:"ghost",size:"icon",className:"relative",children:e.jsx(yd,{className:"h-8 w-8"})})}),e.jsxs(cc,{className:"w-72",align:"end",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-red-900/20 to-black border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:fc.avatar,alt:fc.username,className:"h-20 w-20 rounded-full object-cover ring-2 ring-red-600"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-yellow-500 text-black text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold",children:fc.level})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-lg font-bold text-white",children:fc.username}),e.jsx("p",{className:"text-xs text-gray-400",children:fc.email}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ld,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-500",children:[fc.points.toLocaleString()," pts"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3 bg-gray-900/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx(dd,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Win Rate"}),e.jsx("p",{className:"text-sm font-medium text-white",children:fc.winRate})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-lg bg-gray-800/50",children:[e.jsx($d,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Predicciones"}),e.jsx("p",{className:"text-sm font-medium text-white",children:fc.predictions})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsx(hc,{asChild:!0,children:e.jsxs(Q,{to:"/profile",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(yd,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Mi Perfil"})]})}),e.jsx(hc,{asChild:!0,children:e.jsxs(Q,{to:"/rankings",className:"flex items-center text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-md",children:[e.jsx(Wd,{className:"mr-2 h-4 w-4 text-gray-300"}),e.jsx("span",{children:"Ranking Global"})]})})]}),e.jsx(uc,{}),e.jsx("div",{className:"p-2",children:e.jsxs(hc,{className:"text-red-500 hover:text-red-400 hover:bg-red-900/20 rounded-md",children:[e.jsx(Ld,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Cerrar Sesin"})]})})]})]}),gc=()=>{const t=[{name:"Inicio",path:"/",icon:null},{name:"Foro",path:"/forum",icon:Pd},{name:"Peleadores",path:"/fighters",icon:zd},{name:"Comparar",path:"/compare",icon:Ad},{name:"Clips Destacados",path:"/highlights",icon:$d},{name:"Eventos",path:"/events",icon:ud},{name:"Clips Guardados",path:"/clips",icon:Md},{name:"Ver en Vivo",path:"/live",icon:Cd}];return e.jsx(il.header,{initial:{y:-100},animate:{y:0},transition:{duration:.5},className:"fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-gray-800",children:e.jsxs("nav",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsx(Q,{to:"/",className:"flex items-center",children:e.jsx(ad,{className:"h-12 w-auto"})}),e.jsx("div",{className:"hidden lg:flex items-center space-x-1",children:t.map((t=>e.jsxs(J,{to:t.path,className:({isActive:e})=>"px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200 flex items-center "+(e?"text-red-500 bg-red-900/20":"text-gray-300 hover:text-white hover:bg-gray-800"),children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4 mr-2"}),t.name]},t.path)))})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[e.jsx(rd,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(Q,{to:"/login",children:"Iniciar Sesin"})}),e.jsx(rd,{size:"sm",className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsx(Q,{to:"/register",children:"Registrarse"})}),e.jsx(mc,{})]}),e.jsx("div",{className:"lg:hidden",children:e.jsx(oc,{trigger:e.jsx(rd,{variant:"ghost",size:"icon",children:e.jsx(yd,{className:"h-6 w-6"})}),navItems:t})})]})]})})},pc=T,yc=X.forwardRef((({className:t,...s},i)=>e.jsx(p,{ref:i,className:Zl("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s})));yc.displayName=p.displayName;const vc=sd("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),xc=X.forwardRef((({className:t,variant:s,...i},r)=>e.jsx(y,{ref:r,className:Zl(vc({variant:s}),t),...i})));xc.displayName=y.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(v,{ref:i,className:Zl("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}))).displayName=v.displayName;const bc=X.forwardRef((({className:t,...s},i)=>e.jsx(x,{ref:i,className:Zl("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(Xd,{className:"h-4 w-4"})})));bc.displayName=x.displayName;const Ec=X.forwardRef((({className:t,...s},i)=>e.jsx(b,{ref:i,className:Zl("text-sm font-semibold",t),...s})));Ec.displayName=b.displayName;const Tc=X.forwardRef((({className:t,...s},i)=>e.jsx(E,{ref:i,className:Zl("text-sm opacity-90",t),...s})));Tc.displayName=E.displayName;let Sc=0;const Ac={state:{toasts:[]},listeners:[],getState:()=>Ac.state,setState:e=>{Ac.state="function"==typeof e?e(Ac.state):{...Ac.state,...e},Ac.listeners.forEach((e=>e(Ac.state)))},subscribe:e=>(Ac.listeners.push(e),()=>{Ac.listeners=Ac.listeners.filter((t=>t!==e))})},wc=({...e})=>{const t=(Sc=(Sc+1)%Number.MAX_VALUE,Sc.toString()),s=()=>Ac.setState((e=>({...e,toasts:e.toasts.filter((e=>e.id!==t))})));return Ac.setState((i=>({...i,toasts:[{...e,id:t,dismiss:s},...i.toasts].slice(0,1)}))),{id:t,dismiss:s,update:e=>Ac.setState((s=>({...s,toasts:s.toasts.map((s=>s.id===t?{...s,...e}:s))})))}};function kc(){const{toasts:t}=function(){const[e,t]=z.useState(Ac.getState());return z.useEffect((()=>{const e=Ac.subscribe((e=>{t(e)}));return e}),[]),z.useEffect((()=>{const t=[];return e.toasts.forEach((e=>{if(e.duration===1/0)return;const s=setTimeout((()=>{e.dismiss()}),e.duration||5e3);t.push(s)})),()=>{t.forEach((e=>clearTimeout(e)))}}),[e.toasts]),{toast:wc,toasts:e.toasts}}();return e.jsxs(pc,{children:[t.map((({id:t,title:s,description:i,action:r,...a})=>e.jsxs(xc,{...a,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Ec,{children:s}),i&&e.jsx(Tc,{children:i})]}),r,e.jsx(bc,{})]},t))),e.jsx(yc,{})]})}const Lc=({children:t})=>e.jsxs("div",{className:"min-h-screen bg-black text-white font-sans",children:[e.jsx(gc,{}),e.jsx("main",{className:"pt-16",children:t}),e.jsx(kc,{})]}),Rc=()=>{const t=`JUNIO 29, ${(new Date).getFullYear()+1}`;return e.jsxs(il.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"relative flex flex-col items-center",children:[e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"bg-gradient-to-r from-red-700 via-red-600 to-red-700 rounded-full p-1",children:e.jsx("div",{className:"bg-black rounded-full p-4",children:e.jsx("span",{className:"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-700 filter drop-shadow-lg",children:"VS"})})})}),e.jsx(il.div,{animate:{scale:[1,1.2,1]},transition:{duration:10,repeat:1/0,ease:"linear",repeatType:"mirror"},className:"absolute inset-x-0 top-0 h-full bg-gradient-to-r from-red-600/20 to-red-800/20 rounded-full blur-xl",style:{top:"-10%",height:"120%"}}),e.jsx("p",{className:"mt-3 text-sm font-semibold text-gray-400 uppercase tracking-wider z-10",children:t})]})},Ic={A:62,B:38},Pc=()=>{const[t,s]=z.useState(null),[i,r]=z.useState(Ic),[a,n]=z.useState(!1),o=e=>{const i=t===e?null:e;s(i),n(!0),i&&r((e=>"A"===i&&e.A<95?{A:e.A+1,B:e.B-1}:"B"===i&&e.B<95?{A:e.A-1,B:e.B+1}:e))};return z.useEffect((()=>{let e;return a&&!t&&(e=setTimeout((()=>n(!1)),3e3)),()=>clearTimeout(e)}),[a,t]),e.jsxs("section",{className:"relative min-h-[90vh] mt-16 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:"UFC featured fight background octagon lights",src:"https://images.unsplash.com/photo-1687519930490-db2e9a2efa03"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/60 to-transparent"})]}),e.jsx("div",{className:"relative z-10 w-full max-w-5xl mx-auto px-4 py-8",children:e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs("div",{className:"bg-black/70 p-6 md:p-8 rounded-xl backdrop-blur-md border border-gray-800 shadow-lg shadow-red-900/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Wd,{className:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"text-lg font-bold tracking-wide uppercase",children:"Evento Principal"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400 animate-pulse",children:[e.jsx(Yd,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"Predicciones Abiertas"})]})]}),e.jsx("h2",{className:"text-3xl md:text-5xl font-black mb-2 text-center uppercase tracking-wider",children:"UFC 300: PELEA ESTELAR"}),e.jsx("p",{className:"text-lg md:text-xl mb-8 text-center text-gray-300 font-light",children:"Pelea estelar por el ttulo mundial"}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-4 md:gap-8 mb-8 items-center",children:[e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>o("A"),className:Zl("absolute -top-2 -left-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","A"===t&&"medal-selected"),"aria-label":"Seleccionar a Luchador A como favorito",children:e.jsx(ld,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:"Fighter A portrait",src:"/foto jon.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"Jon "}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Campen | 28-0-0"}),e.jsx(xe,{children:a&&e.jsxs(il.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(zd,{className:"w-4 h-4 mr-1.5"}),i.A,"% de los votos"]})})]}),e.jsx("div",{className:"flex flex-col items-center justify-center self-center pt-8 md:pt-0",children:e.jsx(Rc,{})}),e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsxs("div",{className:"relative inline-block mb-3",children:[e.jsx("button",{onClick:()=>o("B"),className:Zl("absolute -top-2 -right-2 z-20 p-1.5 rounded-full bg-gray-800/70 hover:bg-yellow-500/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 ring-offset-2 ring-offset-black/60","B"===t&&"medal-selected"),"aria-label":"Seleccionar a Luchador B como favorito",children:e.jsx(ld,{className:"h-7 w-7 md:h-8 md:w-8 text-yellow-500 transition-colors duration-300"})}),e.jsx("img",{className:"w-28 h-28 md:w-60 md:h-40 mx-auto object-contain shadow-md filter drop-shadow-[0_5px_5px_rgba(0,0,0,0.4)]",alt:"Fighter B portrait",src:"/foto khabib.png"})]}),e.jsx("p",{className:"font-bold text-lg md:text-2xl uppercase",children:"khabib "}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Retador | 25-2-0"}),e.jsx(xe,{children:a&&e.jsxs(il.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"flex items-center justify-center text-sm text-yellow-400 font-semibold mt-1",children:[e.jsx(zd,{className:"w-4 h-4 mr-1.5"}),i.B,"% de los votos"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 md:gap-4 justify-center mt-6",children:[e.jsx(rd,{size:"lg",className:"bg-red-600 hover:bg-red-700 text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(Q,{to:"/live",children:"Ver en Vivo"})}),e.jsx(rd,{size:"lg",variant:"outline",className:"border-red-600 text-red-600 hover:bg-red-600 hover:text-white text-base md:text-lg px-6 md:px-8 font-bold uppercase tracking-wider flex-grow sm:flex-grow-0",asChild:!0,children:e.jsx(Q,{to:"/predict",children:"Hacer Prediccin"})})]})]})})})]})},Dc=[{id:1,title:"UFC 303: McGregor vs. Chandler",date:"2025-06-29",fighters:"McGregor vs. Chandler",imageSlug:"arena-lights-crowd",altText:"Brightly lit arena packed with spectators for a UFC event",link:"/ufc303"},{id:2,title:"UFC Fight Night: Namajunas vs. Barber",date:"2025-07-13",fighters:"Namajunas vs. Barber",imageSlug:"octagon-side-view",altText:"Side view of the UFC octagon during a fight",link:"/ufcnamajunasbarber"},{id:3,title:"UFC 304: Edwards vs. Muhammad 2",date:"2025-07-27",fighters:"Edwards vs. Muhammad",imageSlug:"fighters-staredown",altText:"Two fighters facing off intensely before a match",link:"/ufc304"},{id:4,title:"UFC Fight Night: Sandhagen vs. Nurmagomedov",date:"2025-08-03",fighters:"Sandhagen vs. Nurmagomedov",imageSlug:"fighter-celebrating-victory",altText:"A victorious fighter celebrating in the octagon",link:"/ufcsandhagennurmagomedov"}],Cc=()=>e.jsxs("section",{className:"py-16 px-4 bg-gradient-to-b from-black via-gray-950 to-black",children:[" ",e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center text-white",children:[e.jsx(ud,{className:"mr-3 text-red-500"})," ","Prximos Eventos"]}),e.jsx(rd,{variant:"link",className:"text-red-400 hover:text-red-300",asChild:!0,children:e.jsx(Q,{to:"/events",children:"Ver Todos "})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Dc.slice(0,3).map(((t,s)=>e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s},className:"bg-black/60 rounded-lg overflow-hidden card-hover border border-gray-800 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[" ",e.jsx("img",{className:"w-full h-full object-cover",alt:t.altText,src:"https://images.unsplash.com/photo-1649190800807-6f1d42a4bc05"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h4",{className:"text-lg font-bold text-white shadow-text",children:t.title})})]}),e.jsxs("div",{className:"p-4",children:[" ",e.jsxs("div",{className:"flex items-center text-sm text-gray-400 mb-2",children:[e.jsx(ud,{className:"w-4 h-4 mr-2 text-red-500"}),new Date(t.date).toLocaleDateString("es-ES",{month:"short",day:"numeric"})]}),e.jsxs("p",{className:"text-gray-300 mb-3 text-sm flex items-center",children:[e.jsx(zd,{className:"w-4 h-4 mr-2 text-red-500"})," ",t.fighters]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(rd,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400 hover:bg-red-900/30",asChild:!0,children:e.jsxs(Q,{to:t.link,children:[" ","Ver Detalles"]})})})]})]},t.id)))})]})]}),Nc=()=>e.jsxs(il.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"bg-black text-white",children:[e.jsx(Pc,{}),e.jsx(Cc,{})]}),_c=X.forwardRef((({className:t,type:s,...i},r)=>e.jsx("input",{type:s,className:Zl("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})));_c.displayName="Input";const Mc=sd("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Fc=X.forwardRef((({className:t,...s},i)=>e.jsx(S,{ref:i,className:Zl(Mc(),t),...s})));Fc.displayName=S.displayName;const Oc=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:Zl("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})));Oc.displayName="Card";const jc=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:Zl("flex flex-col space-y-1.5 p-6",t),...s})));jc.displayName="CardHeader";const Bc=X.forwardRef((({className:t,...s},i)=>e.jsx("h3",{ref:i,className:Zl("text-2xl font-semibold leading-none tracking-tight",t),...s})));Bc.displayName="CardTitle";const Uc=X.forwardRef((({className:t,...s},i)=>e.jsx("p",{ref:i,className:Zl("text-sm text-muted-foreground",t),...s})));Uc.displayName="CardDescription";const $c=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:Zl("p-6 pt-0",t),...s})));$c.displayName="CardContent";const Gc=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{ref:i,className:Zl("flex items-center p-6 pt-0",t),...s})));Gc.displayName="CardFooter";const Vc=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(!1),a=Z();return e.jsxs(Oc,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(jc,{className:"space-y-3",children:[e.jsx(Bc,{className:"text-3xl font-black text-red-600 tracking-wider",children:"INICIAR SESIN"}),e.jsx(Uc,{className:"text-gray-400 text-base",children:"Ingresa tus credenciales para acceder a tu cuenta"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),r(!0);try{await new Promise((e=>setTimeout(e,1e3))),a("/")}catch(t){}finally{r(!1)}},children:[e.jsxs($c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"email",className:"text-sm font-medium text-gray-300",children:"Correo Electrnico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"email",type:"email",placeholder:"tu@email.com",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"password",className:"text-sm font-medium text-gray-300",children:"Contrasea"}),e.jsxs("div",{className:"relative",children:[e.jsx(kd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"password",type:t?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600"}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t?e.jsx(Td,{className:"h-5 w-5"}):e.jsx(Sd,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"remember",className:"rounded border-gray-700 bg-gray-900/50 text-red-600 focus:ring-red-600"}),e.jsx("label",{htmlFor:"remember",className:"text-gray-400",children:"Recordarme"})]}),e.jsx(Q,{to:"/forgot-password",className:"text-red-500 hover:text-red-400 hover:underline",children:"Olvidaste tu contrasea?"})]})]}),e.jsxs(Gc,{className:"flex flex-col space-y-4",children:[e.jsx(rd,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200",disabled:i,children:i?"Iniciando sesin...":"Iniciar Sesin"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-black/80 px-2 text-gray-400",children:"O contina con"})})]}),e.jsxs(rd,{type:"button",onClick:async()=>{r(!0);try{await new Promise((e=>setTimeout(e,1e3))),a("/")}catch(e){}finally{r(!1)}},className:"w-full bg-white hover:bg-gray-100 text-gray-900 font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center space-x-2",disabled:i,children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{children:"Continuar con Google"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["No tienes cuenta?"," ",e.jsx(Q,{to:"/register",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:"Regstrate aqu"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Al iniciar sesin, aceptas nuestros"," ",e.jsx(Q,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:"Trminos y Condiciones"})]})]})]})]})]})},Kc=()=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(il.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(ad,{className:"h-72 w-auto mx-auto"})}),e.jsxs(il.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:["Bienvenido a"," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(il.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:"Tu plataforma definitiva para el mundo del MMA"})]}),e.jsx(il.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(Vc,{})})]})})]}),Hc=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(!1),[a,n]=z.useState(!1),o=Z();return e.jsxs(Oc,{className:"w-full max-w-md bg-black/80 border-gray-800 text-white backdrop-blur-sm shadow-xl",children:[e.jsxs(jc,{className:"space-y-3",children:[e.jsx(Bc,{className:"text-3xl font-black text-red-600 tracking-wider",children:"CREAR CUENTA"}),e.jsx(Uc,{className:"text-gray-400 text-base",children:"Completa tus datos para unirte a la comunidad"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);try{await new Promise((e=>setTimeout(e,1e3))),o("/login")}catch(t){}finally{n(!1)}},children:[e.jsxs($c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"username",className:"text-sm font-medium text-gray-300",children:"Nombre de Usuario"}),e.jsxs("div",{className:"relative",children:[e.jsx(qd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"username",placeholder:"TuUsuario",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"email",className:"text-sm font-medium text-gray-300",children:"Correo Electrnico"}),e.jsxs("div",{className:"relative",children:[e.jsx(Rd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"email",type:"email",placeholder:"tu@email.com",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"password",className:"text-sm font-medium text-gray-300",children:"Contrasea"}),e.jsxs("div",{className:"relative",children:[e.jsx(kd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"password",type:t?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10"}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t?e.jsx(Td,{className:"h-5 w-5"}):e.jsx(Sd,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{htmlFor:"confirm-password",className:"text-sm font-medium text-gray-300",children:"Confirmar Contrasea"}),e.jsxs("div",{className:"relative",children:[e.jsx(kd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"}),e.jsx(_c,{id:"confirm-password",type:i?"text":"password",required:!0,className:"pl-10 bg-gray-900/50 border-gray-700 focus:ring-red-600 focus:border-red-600 pr-10"}),e.jsx("button",{type:"button",onClick:()=>r(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:i?e.jsx(Td,{className:"h-5 w-5"}):e.jsx(Sd,{className:"h-5 w-5"})})]})]})]}),e.jsxs(Gc,{className:"flex flex-col space-y-4",children:[e.jsx(rd,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200",disabled:a,children:a?"Registrando...":"Registrarse"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["Ya tienes cuenta?"," ",e.jsx(Q,{to:"/login",className:"text-red-500 hover:text-red-400 hover:underline font-medium",children:"Inicia sesin aqu"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Al registrarte, aceptas nuestros"," ",e.jsx(Q,{to:"/terms",className:"text-gray-400 hover:text-gray-300 hover:underline",children:"Trminos y Condiciones"})]})]})]})]})]})},Yc=()=>e.jsxs("div",{className:"min-h-screen flex items-center justify-center pt-16 relative auth-container overflow-hidden",children:[e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover opacity-40",children:e.jsx("source",{src:"/videos/ufc-background.mp4",type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/95 via-black/80 to-gray-900/90 z-0"}),e.jsx("div",{className:"z-10 w-full max-w-6xl mx-auto px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col lg:flex-row items-center justify-between gap-12",children:[e.jsxs("div",{className:"text-center lg:w-1/2",children:[e.jsx(il.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"mb-8",children:e.jsx(ad,{className:"h-72 w-auto mx-auto"})}),e.jsxs(il.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-4xl md:text-5xl font-black mb-4 text-white",children:["nete a la Comunidad"," ",e.jsx("span",{className:"text-red-600",children:"SMASH"})]}),e.jsx(il.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-xl text-gray-400 mb-8",children:"Crea tu cuenta y empieza a predecir resultados de MMA"})]}),e.jsx(il.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},className:"w-full lg:w-1/2",children:e.jsx(Hc,{})})]})})]}),Wc=X.forwardRef((({className:t,...s},i)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:i,className:Zl("w-full caption-bottom text-sm",t),...s})})));Wc.displayName="Table";const qc=X.forwardRef((({className:t,...s},i)=>e.jsx("thead",{ref:i,className:Zl("[&_tr]:border-b",t),...s})));qc.displayName="TableHeader";const zc=X.forwardRef((({className:t,...s},i)=>e.jsx("tbody",{ref:i,className:Zl("[&_tr:last-child]:border-0",t),...s})));zc.displayName="TableBody";X.forwardRef((({className:t,...s},i)=>e.jsx("tfoot",{ref:i,className:Zl("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}))).displayName="TableFooter";const Xc=X.forwardRef((({className:t,...s},i)=>e.jsx("tr",{ref:i,className:Zl("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s})));Xc.displayName="TableRow";const Qc=X.forwardRef((({className:t,...s},i)=>e.jsx("th",{ref:i,className:Zl("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s})));Qc.displayName="TableHead";const Jc=X.forwardRef((({className:t,...s},i)=>e.jsx("td",{ref:i,className:Zl("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s})));Jc.displayName="TableCell";X.forwardRef((({className:t,...s},i)=>e.jsx("caption",{ref:i,className:Zl("mt-4 text-sm text-muted-foreground",t),...s}))).displayName="TableCaption";const Zc=[{rank:1,user:"MMA_Master",points:15200,streak:5},{rank:2,user:"StrikerSupreme",points:14850,streak:3},{rank:3,user:"GrappleGod",points:14500,streak:0},{rank:4,user:"NostradamusUFC",points:13900,streak:8},{rank:5,user:"KOPredictor",points:13550,streak:2},{rank:6,user:"You",points:12500,streak:1},{rank:7,user:"CageWizard",points:12100,streak:0},{rank:8,user:"FightFanatic",points:11800,streak:4},{rank:9,user:"SubmissionSavvy",points:11500,streak:0},{rank:10,user:"OctagonOracle",points:11200,streak:6}],eh=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-4xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Wd,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Ranking Global de Predicciones"]}),e.jsx("div",{className:"bg-black/70 rounded-lg border border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:e.jsxs(Wc,{children:[e.jsx(qc,{children:e.jsxs(Xc,{className:"border-gray-700 hover:bg-gray-800/50",children:[e.jsx(Qc,{className:"w-[80px] text-center font-bold text-red-500",children:"Rank"}),e.jsx(Qc,{className:"font-bold text-red-500",children:"Usuario"}),e.jsx(Qc,{className:"text-right font-bold text-red-500",children:"Puntos"}),e.jsxs(Qc,{className:"text-center font-bold text-red-500",children:["Racha ",e.jsx($d,{className:"inline w-4 h-4 mb-1 ml-1 text-yellow-400"})]})]})}),e.jsx(zc,{children:Zc.map((t=>e.jsxs(Xc,{className:"border-gray-800 hover:bg-gray-700/50 transition-colors "+("You"===t.user?"bg-red-900/30 font-bold text-yellow-300":""),children:[e.jsx(Jc,{className:"text-center font-medium",children:t.rank}),e.jsx(Jc,{children:t.user}),e.jsx(Jc,{className:"text-right",children:t.points.toLocaleString()}),e.jsx(Jc,{className:"text-center",children:t.streak>0?`${t.streak} `:"-"})]},t.rank)))})]})}),e.jsx("p",{className:"text-center text-gray-500 mt-6 text-sm",children:"El ranking se actualiza despus de cada evento principal. Sigue prediciendo!"})]})}),th=X.forwardRef((({className:t,...s},i)=>e.jsx(A,{className:Zl("grid gap-2",t),...s,ref:i})));th.displayName=A.displayName;const sh=X.forwardRef((({className:t,...s},i)=>e.jsx(w,{ref:i,className:Zl("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(k,{className:"flex items-center justify-center",children:e.jsx(vd,{className:"h-2.5 w-2.5 fill-current text-current"})})})));sh.displayName=w.displayName;const ih=B,rh=U,ah=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(L,{ref:r,className:Zl("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[s,e.jsx(R,{asChild:!0,children:e.jsx(md,{className:"h-4 w-4 opacity-50"})})]})));ah.displayName=L.displayName;const nh=X.forwardRef((({className:t,...s},i)=>e.jsx(I,{ref:i,className:Zl("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(gd,{className:"h-4 w-4"})})));nh.displayName=I.displayName;const oh=X.forwardRef((({className:t,...s},i)=>e.jsx(P,{ref:i,className:Zl("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(md,{className:"h-4 w-4"})})));oh.displayName=P.displayName;const lh=X.forwardRef((({className:t,children:s,position:i="popper",...r},a)=>e.jsx(D,{children:e.jsxs(C,{ref:a,className:Zl("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[e.jsx(nh,{}),e.jsx(N,{className:Zl("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(oh,{})]})})));lh.displayName=C.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(_,{ref:i,className:Zl("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}))).displayName=_.displayName;const dh=X.forwardRef((({className:t,children:s,...i},r)=>e.jsxs(M,{ref:r,className:Zl("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(F,{children:e.jsx(fd,{className:"h-4 w-4"})})}),e.jsx(O,{children:s})]})));dh.displayName=M.displayName;X.forwardRef((({className:t,...s},i)=>e.jsx(j,{ref:i,className:Zl("-mx-1 my-1 h-px bg-muted",t),...s}))).displayName=j.displayName;const ch=X.forwardRef((({className:t,...s},i)=>e.jsxs($,{ref:i,className:Zl("relative flex w-full touch-none select-none items-center",t),...s,children:[e.jsx(G,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(V,{className:"absolute h-full bg-primary"})}),e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}),Array.isArray(s.value)&&s.value.length>1&&e.jsx(K,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})));ch.displayName=$.displayName;const hh={username:"Rugal444",email:"rugal444@gmail.com",joinedDate:"2024-01-15",points:1250,rank:"#6",notifications:!0,theme:"dark",privacy:"public"},uh=()=>{const[t,s]=z.useState(hh.notifications),[i,r]=z.useState(hh.theme),[a,n]=z.useState(hh.privacy),[o,l]=z.useState(!1),[d,c]=z.useState(hh.username),[h,u]=z.useState(hh.email);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsx(il.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsxs(jc,{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("img",{className:"w-32 h-32 rounded-full mx-auto border-4 border-red-600 object-cover",alt:"User Avatar",src:"/pain.png"}),e.jsx(rd,{variant:"ghost",size:"icon",className:"absolute bottom-0 right-0 bg-gray-700/80 rounded-full hover:bg-red-600",children:e.jsx(Ud,{className:"w-4 h-4"})})]}),e.jsx(Bc,{className:"text-3xl font-black uppercase tracking-wider text-red-500",children:hh.username}),e.jsxs(Uc,{className:"text-gray-300",children:["Miembro desde ",new Date(hh.joinedDate).toLocaleDateString()]})]}),e.jsxs($c,{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(qd,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Nombre de Usuario"}),o?e.jsx(_c,{className:"font-semibold text-white bg-gray-800 border-gray-700",value:d,onChange:e=>c(e.target.value)}):e.jsx("p",{className:"font-semibold text-white",children:hh.username})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(Rd,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Correo Electrnico"}),o?e.jsx(_c,{className:"font-semibold text-white bg-gray-800 border-gray-700",value:h,onChange:e=>u(e.target.value)}):e.jsx("p",{className:"font-semibold text-white",children:hh.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(ld,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Puntos Totales"}),e.jsx("p",{className:"font-semibold text-xl text-white",children:hh.points.toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(Wd,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Ranking"}),e.jsx("p",{className:"font-semibold text-xl text-white",children:hh.rank})]})]})]})]}),e.jsx(Gc,{className:"flex justify-between",children:e.jsx(rd,{className:"bg-red-600 hover:bg-red-700 font-bold uppercase tracking-wider",onClick:()=>{l(!o),o||(c(hh.username),u(hh.email))},children:o?"Guardar Cambios":"Editar Perfil"})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsx(jc,{children:e.jsxs(Bc,{className:"text-xl flex items-center gap-2 text-white",children:[e.jsx(hd,{className:"w-5 h-5 text-red-500"}),"Notificaciones"]})}),e.jsxs($c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Fc,{className:"text-gray-300",children:"Notificaciones Push"}),e.jsx(ch,{defaultValue:[50],max:100,step:1,className:"w-[60%]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Fc,{className:"text-gray-300",children:"Correos Electrnicos"}),e.jsx(ch,{defaultValue:[75],max:100,step:1,className:"w-[60%]"})]})]})]}),e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 backdrop-blur-sm shadow-lg",children:[e.jsx(jc,{children:e.jsxs(Bc,{className:"text-xl flex items-center gap-2 text-white",children:[e.jsx(Bd,{className:"w-5 h-5 text-red-500"}),"Seguridad"]})}),e.jsxs($c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fc,{className:"text-gray-300",children:"Cambiar Contrasea"}),e.jsx(_c,{type:"password",placeholder:"Nueva contrasea",className:"bg-gray-900/50 border-gray-700"})]}),e.jsx(rd,{variant:"outline",className:"w-full",children:"Actualizar Contrasea"})]})]})]})]})})})},fh=[{id:"jones",name:"Jon Jones",image:"https://images.unsplash.com/photo-1545191488-2682adc1dfe4",stats:{strikesLanded:12.5,accuracy:55,takedowns:2.8,defense:95,avgFightTime:18.2}},{id:"khabib",name:"Khabib Nurmagomedov",image:"https://images.unsplash.com/photo-1656968385791-eff0b664d0ba",stats:{strikesLanded:4.1,accuracy:48,takedowns:5.3,defense:65,avgFightTime:14.5}},{id:"mcgregor",name:"Conor McGregor",image:"https://images.unsplash.com/photo-1680022702604-292f21514497",stats:{strikesLanded:5.3,accuracy:50,takedowns:.7,defense:55,avgFightTime:8.1}},{id:"adesanya",name:"Israel Adesanya",image:"https://images.unsplash.com/photo-1692264895705-27017e9cf1be",stats:{strikesLanded:3.9,accuracy:49,takedowns:0,defense:85,avgFightTime:17.8}}],mh=({icon:t,label:s,value:i,unit:r="",highlight:a="none"})=>{const n="better"===a?"text-green-400":"worse"===a?"text-red-500":"text-white",o="better"===a?Yd:"worse"===a?Hd:Dd;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded mb-2 border-l-4 border-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{className:"w-5 h-5 mr-3 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:s})]}),e.jsxs("div",{className:`flex items-center font-semibold ${n}`,children:[e.jsx(o,{className:"w-4 h-4 mr-1 "+("none"===a?"opacity-0":"")}),i," ",r]})]})},gh=()=>{const[t,s]=z.useState(fh[0]),[i,r]=z.useState(fh[1]),a=(e,t)=>{const i=fh.find((t=>t.id===e));1===t?s(i):r(i)},n=e=>t&&i?t.stats[e]>i.stats[e]?"better":t.stats[e]<i.stats[e]?"worse":"none":"none",o=e=>t&&i?t.stats[e]<i.stats[e]?"better":t.stats[e]>i.stats[e]?"worse":"none":"none";return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"container mx-auto max-w-5xl",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider",children:"Comparador de Peleadores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-6 md:gap-10 items-start",children:[e.jsx("div",{children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(jc,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:void 0!==ih?e.jsxs(ih,{onValueChange:e=>a(e,1),value:t?.id,children:[e.jsx(ah,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(rh,{placeholder:"Seleccionar Peleador 1"})}),e.jsx(lh,{className:"bg-black border-gray-700 text-white",children:fh.map((t=>e.jsx(dh,{value:t.id,disabled:t.id===i?.id,children:t.name},t.id)))})]},t?.id):e.jsx("p",{className:"text-center text-gray-400",children:"Componente Select no encontrado"})}),e.jsx($c,{className:"p-4 text-center",children:t&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-48 h-48 mx-auto mb-4 object-cover"})," ",e.jsx("h3",{className:"text-2xl font-bold mb-4",children:t.name}),e.jsx(mh,{icon:cd,label:"Golpes / min",value:t.stats.strikesLanded.toFixed(1),highlight:n("strikesLanded")}),e.jsx(mh,{icon:Gd,label:"Precisin (%)",value:t.stats.accuracy,unit:"%",highlight:n("accuracy")}),e.jsx(mh,{icon:Qd,label:"Derribos / 15min",value:t.stats.takedowns.toFixed(1),highlight:n("takedowns")}),e.jsx(mh,{icon:Bd,label:"Defensa (%)",value:t.stats.defense,unit:"%",highlight:n("defense")}),e.jsx(mh,{icon:xd,label:"Tiempo Medio Pelea",value:t.stats.avgFightTime.toFixed(1),unit:"min",highlight:o("avgFightTime")})]})})]})}),e.jsx("div",{className:"hidden md:flex items-center justify-center h-full pt-24",children:e.jsx(Rc,{})}),e.jsx("div",{children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-700 shadow-lg backdrop-blur-sm overflow-hidden",children:[e.jsx(jc,{className:"p-4 bg-gray-900/50 border-b border-gray-700",children:void 0!==ih?e.jsxs(ih,{onValueChange:e=>a(e,2),value:i?.id,children:[e.jsx(ah,{className:"w-full bg-gray-800 border-gray-600 text-white font-bold text-lg",children:e.jsx(rh,{placeholder:"Seleccionar Peleador 2"})}),e.jsx(lh,{className:"bg-black border-gray-700 text-white",children:fh.map((s=>e.jsx(dh,{value:s.id,disabled:s.id===t?.id,children:s.name},s.id)))})]},i?.id):e.jsx("p",{className:"text-center text-gray-400",children:"Componente Select no encontrado"})}),e.jsx($c,{className:"p-4 text-center",children:i&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.image,alt:i.name,className:"w-48 h-48 mx-auto mb-4 object-cover"})," ",e.jsx("h3",{className:"text-2xl font-bold mb-4",children:i.name}),e.jsx(mh,{icon:cd,label:"Golpes / min",value:i.stats.strikesLanded.toFixed(1),highlight:"better"===n("strikesLanded")?"worse":"worse"===n("strikesLanded")?"better":"none"}),e.jsx(mh,{icon:Gd,label:"Precisin (%)",value:i.stats.accuracy,unit:"%",highlight:"better"===n("accuracy")?"worse":"worse"===n("accuracy")?"better":"none"}),e.jsx(mh,{icon:Qd,label:"Derribos / 15min",value:i.stats.takedowns.toFixed(1),highlight:"better"===n("takedowns")?"worse":"worse"===n("takedowns")?"better":"none"}),e.jsx(mh,{icon:Bd,label:"Defensa (%)",value:i.stats.defense,unit:"%",highlight:"better"===n("defense")?"worse":"worse"===n("defense")?"better":"none"}),e.jsx(mh,{icon:xd,label:"Tiempo Medio Pelea",value:i.stats.avgFightTime.toFixed(1),unit:"min",highlight:"better"===o("avgFightTime")?"worse":"worse"===o("avgFightTime")?"better":"none"})]})})]})})]})]})})},ph=sd("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function yh({className:t,variant:s,...i}){return e.jsx("div",{className:Zl(ph({variant:s}),t),...i})}const vh=[{rank:1,name:"Jon Jones",division:"Peso Pesado",record:"27-1-0 (1 NC)",points:2850,status:"Campen"},{rank:2,name:"Islam Makhachev",division:"Peso Ligero",record:"25-1-0",points:2780,status:"Campen"},{rank:3,name:"Alexander Volkanovski",division:"Peso Pluma",record:"26-4-0",points:2750,status:"Top Contender"},{rank:4,name:"Leon Edwards",division:"Peso Wlter",record:"22-3-0 (1 NC)",points:2710,status:"Campen"},{rank:5,name:"Alex Pereira",division:"Peso Semipesado",record:"10-2-0",points:2690,status:"Campen"},{rank:6,name:"Ilia Topuria",division:"Peso Pluma",record:"15-0-0",points:2650,status:"Campen"},{rank:7,name:"Sean O'Malley",division:"Peso Gallo",record:"18-1-0 (1 NC)",points:2620,status:"Campen"},{rank:8,name:"Charles Oliveira",division:"Peso Ligero",record:"34-10-0 (1 NC)",points:2600,status:"Top Contender"},{rank:9,name:"Dricus du Plessis",division:"Peso Mediano",record:"21-2-0",points:2580,status:"Campen"},{rank:10,name:"Alexandre Pantoja",division:"Peso Mosca",record:"27-5-0",points:2550,status:"Campen"}],xh=e=>{switch(e){case"Campen":return"destructive";case"Top Contender":return"secondary";default:return"outline"}},bh=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-8 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(wd,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Ranking Oficial de Peleadores (P4P)"]}),e.jsx("div",{className:"bg-black/70 rounded-lg border border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:void 0!==Wc&&void 0!==yh?e.jsxs(Wc,{children:[e.jsx(qc,{children:e.jsxs(Xc,{className:"border-gray-700 hover:bg-gray-800/50",children:[e.jsx(Qc,{className:"w-[80px] text-center font-bold text-red-500",children:"Rank"}),e.jsx(Qc,{className:"font-bold text-red-500",children:"Nombre"}),e.jsx(Qc,{className:"font-bold text-red-500 hidden md:table-cell",children:"Divisin"}),e.jsx(Qc,{className:"font-bold text-red-500 hidden lg:table-cell",children:"Rcord"}),e.jsx(Qc,{className:"text-center font-bold text-red-500",children:"Status"}),e.jsxs(Qc,{className:"text-right font-bold text-red-500",children:["Puntos ",e.jsx($d,{className:"inline w-4 h-4 mb-1 ml-1 text-yellow-400"})]})]})}),e.jsx(zc,{children:vh.map((t=>e.jsxs(Xc,{className:"border-gray-800 hover:bg-gray-700/50 transition-colors",children:[e.jsx(Jc,{className:"text-center font-medium",children:t.rank}),e.jsx(Jc,{className:"font-semibold",children:t.name}),e.jsx(Jc,{className:"hidden md:table-cell text-gray-400",children:t.division}),e.jsx(Jc,{className:"hidden lg:table-cell text-gray-400",children:t.record}),e.jsx(Jc,{className:"text-center",children:e.jsxs(yh,{variant:xh(t.status),className:"uppercase text-xs px-2 py-0.5",children:["Campen"===t.status&&e.jsx(jd,{className:"w-3 h-3 mr-1 inline"}),t.status]})}),e.jsx(Jc,{className:"text-right font-bold text-yellow-300",children:t.points.toLocaleString()})]},t.rank)))})]}):e.jsx("p",{className:"p-6 text-center text-gray-400",children:"Componentes de Tabla o Badge no encontrados. Por favor, cralos si no existen."})}),e.jsx("p",{className:"text-center text-gray-500 mt-6 text-sm",children:"Ranking Libra por Libra (P4P) basado en el rendimiento y dominio divisional."})]})}),Eh=[{id:1,title:"UFC 303: McGregor vs. Chandler",date:"2025-06-29",location:"Las Vegas, NV",mainEvent:"Conor McGregor vs. Michael Chandler",coMainEvent:"Jamahal Hill vs. Khalil Rountree Jr.",venue:"T-Mobile Arena",imageSlug:"arena-lights-crowd",altText:"Brightly lit arena packed with spectators for a UFC event"},{id:2,title:"UFC Fight Night: Namajunas vs. Barber",date:"2025-07-13",location:"Denver, CO",mainEvent:"Rose Namajunas vs. Maycee Barber",coMainEvent:"TBD",venue:"Ball Arena",imageSlug:"octagon-side-view",altText:"Side view of the UFC octagon during a fight"},{id:3,title:"UFC 304: Edwards vs. Muhammad 2",date:"2025-07-27",location:"Manchester, England",mainEvent:"Leon Edwards vs. Belal Muhammad",coMainEvent:"Tom Aspinall vs. Curtis Blaydes",venue:"Co-op Live",imageSlug:"fighters-staredown",altText:"Two fighters facing off intensely before a match"},{id:4,title:"UFC Fight Night: Sandhagen vs. Nurmagomedov",date:"2025-08-03",location:"Abu Dhabi, UAE",mainEvent:"Cory Sandhagen vs. Umar Nurmagomedov",coMainEvent:"TBD",venue:"Etihad Arena",imageSlug:"fighter-celebrating-victory",altText:"A victorious fighter celebrating in the octagon"}],Th=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-10 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(ud,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Prximos Eventos"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8",children:Eh.map(((t,s)=>e.jsx(il.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.1*s},children:e.jsxs(Oc,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col card-hover",children:[e.jsxs("div",{className:"relative h-48 md:h-56",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:t.altText,src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"}),e.jsx("div",{className:"absolute bottom-4 left-4",children:e.jsx("h2",{className:"text-2xl font-bold text-white shadow-text",children:t.title})})]}),e.jsxs($c,{className:"p-6 flex-grow flex flex-col",children:[e.jsxs("div",{className:"space-y-3 text-gray-300 mb-5 flex-grow",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(ud,{className:"w-4 h-4 mr-2 text-red-500"})," ",new Date(t.date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx(Id,{className:"w-4 h-4 mr-2 text-red-500"})," ",t.location," (",t.venue,")"]}),e.jsxs("p",{className:"flex items-start",children:[e.jsx(zd,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"})," ",e.jsx("span",{className:"font-semibold",children:"Pelea Principal:"}),"",t.mainEvent]}),"TBD"!==t.coMainEvent&&e.jsxs("p",{className:"flex items-start",children:[e.jsx(zd,{className:"w-4 h-4 mr-2 mt-1 text-red-500 flex-shrink-0"})," ",e.jsx("span",{className:"font-semibold",children:"Co-Estelar:"}),"",t.coMainEvent]})]}),e.jsx("div",{className:"mt-auto flex justify-end",children:"UFC 303: McGregor vs. Chandler"===t.title||"UFC Fight Night: Namajunas vs. Barber"===t.title||"UFC 304: Edwards vs. Muhammad 2"===t.title||"UFC Fight Night: Sandhagen vs. Nurmagomedov"===t.title?e.jsx(rd,{className:"bg-red-600 hover:bg-red-700",asChild:!0,children:e.jsxs("a",{href:"UFC 303: McGregor vs. Chandler"===t.title?"/ufc303":"UFC Fight Night: Namajunas vs. Barber"===t.title?"/ufcnamajunasbarber":"UFC 304: Edwards vs. Muhammad 2"===t.title?"/ufc304":"/ufcsandhagennurmagomedov",children:[e.jsx(Vd,{className:"w-4 h-4 mr-2"}),"Ver Detalles / Comprar"]})}):e.jsxs(rd,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Vd,{className:"w-4 h-4 mr-2"}),"Ver Detalles / Comprar"]})})]})]})},t.id)))})]})}),Sh=[{id:1,title:"KO pico: McGregor vs. Aldo",fighters:"McGregor, Aldo",views:"1.2M",imageSlug:"fighter-knockout-punch",altText:"Fighter landing a knockout punch in the octagon"},{id:2,title:"Sumisin Increble: Nurmagomedov",fighters:"Nurmagomedov",views:"980K",imageSlug:"fighter-submission-hold",altText:"Fighter applying a submission hold on the mat"},{id:3,title:"Guerra Total: Jones vs. Gustafsson I",fighters:"Jones, Gustafsson",views:"850K",imageSlug:"two-fighters-exchanging-blows",altText:"Two fighters intensely exchanging blows during a match"},{id:4,title:"Patada Voladora Sorpresa",fighters:"Pettis",views:"760K",imageSlug:"fighter-executing-flying-kick",altText:"Fighter executing a spectacular flying kick"},{id:5,title:"Remontada Histrica",fighters:"Silva",views:"690K",imageSlug:"fighter-celebrating-comeback-victory",altText:"Fighter celebrating an unlikely comeback victory"},{id:6,title:"Noche de Nocauts",fighters:"Varios",views:"550K",imageSlug:"multiple-fighters-highlight-reel",altText:"Montage of various fighters during exciting moments"}],Ah=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-10 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx($d,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Clips Destacados"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:Sh.map(((t,s)=>e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*s},className:"card-hover",children:e.jsxs(Oc,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm h-full flex flex-col",children:[e.jsxs("div",{className:"relative group aspect-video",children:[e.jsx("img",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",alt:t.altText,src:"https://images.unsplash.com/photo-1675023112817-52b789fd2ef0"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(Cd,{className:"w-16 h-16 text-white/80 drop-shadow-lg"})}),e.jsx("div",{className:"absolute bottom-2 left-3",children:e.jsx("h3",{className:"text-lg font-bold text-white shadow-text",children:t.title})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(Sd,{className:"w-3 h-3 mr-1 text-red-500"})," ",t.views]})]}),e.jsxs($c,{className:"p-4 flex-grow flex flex-col",children:[e.jsxs("p",{className:"text-sm text-gray-400 mb-3 flex-grow",children:["Peleadores: ",t.fighters]}),e.jsx(rd,{variant:"outline",className:"w-full border-red-600 text-red-500 hover:bg-red-600 hover:text-white mt-auto",children:"Ver Clip"})]})]})},t.id)))})]})}),wh=X.forwardRef((({className:t,...s},i)=>e.jsx("textarea",{className:Zl("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:i,...s})));wh.displayName="Textarea";const kh=({threadId:t})=>{const s=Z();return e.jsx("button",{onClick:e=>{e.stopPropagation(),s(`/thread/${t}`)},className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"45 respuestas"})},Lh=[{id:1,name:"Discusin General",description:"Habla de todo sobre UFC",icon:Pd},{id:2,name:"Predicciones y Apuestas",description:"Comparte tus pronsticos",icon:Yd},{id:3,name:"Noticias y Rumores",description:"ltimas novedades del octgono",icon:_d},{id:4,name:"Peleadores y Divisiones",description:"Anlisis por categora",icon:zd}],Rh=[{id:"1",title:"Quin gana en UFC 303?",author:"FanUFC_123",replies:45,category:"Predicciones",time:"hace 2 horas"},{id:"2",title:"El legado de Khabib",author:"MMA_Guru",replies:102,category:"General",time:"hace 5 horas"},{id:"3",title:"Posible regreso de GSP",author:"NostalgicFan",replies:30,category:"Rumores",time:"hace 1 da"},{id:"4",title:"Top 5 Peso Pluma Actual",author:"AnalistaX",replies:67,category:"Peleadores",time:"hace 1 da"}],Ih=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-white pt-24 pb-12 px-4",children:e.jsxs(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black mb-6 text-center uppercase text-red-500 tracking-wider flex items-center justify-center",children:[e.jsx(Pd,{className:"w-10 h-10 mr-4 text-yellow-400"}),"Foro de la Comunidad"]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(_c,{type:"text",placeholder:"Buscar en el foro...",className:"pl-10 bg-gray-900/50 border-gray-700 focus:border-red-500 focus:ring-red-500"}),e.jsx(Fd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsxs(rd,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Nd,{className:"w-5 h-5 mr-2"}),"Crear Nuevo Hilo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Categoras"}),Lh.map((t=>e.jsx(il.div,{whileHover:{scale:1.03},transition:{type:"spring",stiffness:300},children:e.jsxs(Q,{to:`/category/${t.id}`,children:[" ",e.jsxs(Oc,{className:"bg-black/60 border-gray-800 hover:border-red-600/50 transition-colors duration-200 cursor-pointer",children:[e.jsxs(jc,{className:"flex flex-row items-center gap-4 pb-2",children:[e.jsx(t.icon,{className:"w-6 h-6 text-red-500"}),e.jsx(Bc,{className:"text-lg text-white",children:t.name})]}),e.jsx($c,{children:e.jsx(Uc,{className:"text-gray-400",children:t.description})})]})]})},t.id)))]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"Hilos Recientes"}),e.jsx(Oc,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx($c,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:Rh.map((t=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(Q,{to:`/thread/${t.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["por ",e.jsx("span",{className:"font-medium text-gray-400",children:t.author})," en ",e.jsx("span",{className:"text-red-400",children:t.category})," - ",t.time]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(kh,{threadId:t.id})})]},t.id)))})})})]})]})]})}),Ph={id:1,fighter1:"Conor McGregor",fighter2:"Michael Chandler",event:"UFC 303",rounds:5},Dh=5e3,Ch={winner:1.8,method:2.5,round:3,firstStrike:1.5,firstTakedown:2,willBeKO:1.6,willBeSub:3.5,goToDecision:2.2,mostSignificantStrikes:1.9},Nh=["KO/TKO","Submission","Decision"],_h=({predictionKey:t,value:s,onChange:i,fighters:r,label:a,icon:n,iconColor:o})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Fc,{className:"text-lg font-semibold flex items-center text-gray-200",children:[n&&e.jsx(n,{className:`w-5 h-5 mr-2 ${o||"text-gray-400"}`}),a]}),e.jsxs(th,{value:s,onValueChange:e=>i(t,e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sh,{value:r.fighter1,id:`${t}-${r.fighter1}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(Fc,{htmlFor:`${t}-${r.fighter1}`,className:"text-gray-300",children:r.fighter1})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sh,{value:r.fighter2,id:`${t}-${r.fighter2}`,className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(Fc,{htmlFor:`${t}-${r.fighter2}`,className:"text-gray-300",children:r.fighter2})]})]})]}),Mh=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fc,{className:"text-lg font-semibold text-gray-200",children:"Cmo ganars?"}),e.jsxs(th,{value:t,onValueChange:e=>s("method",e),className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 pt-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sh,{value:"KO/TKO",id:"method-KO",className:"border-gray-600 text-red-500 focus:ring-red-500"}),e.jsx(Fc,{htmlFor:"method-KO",className:"text-gray-300",children:"KO/TKO"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sh,{value:"Submission",id:"method-Submission",className:"border-gray-600 text-blue-500 focus:ring-blue-500"}),e.jsx(Fc,{htmlFor:"method-Submission",className:"text-gray-300",children:"Sumisin"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sh,{value:"Decision",id:"method-Decision",className:"border-gray-600 text-green-500 focus:ring-green-500"}),e.jsx(Fc,{htmlFor:"method-Decision",className:"text-gray-300",children:"Decisin"})]})]})]}),Fh=({value:t,onChange:s,maxRounds:i})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(Fc,{htmlFor:"round",className:"text-lg font-semibold text-gray-200",children:"En qu round terminar?"}),e.jsxs("div",{className:"flex items-center space-x-4 pt-1",children:[e.jsx(ch,{id:"round",min:1,max:i,step:1,value:t,onValueChange:s,className:"flex-grow [&>span:first-child]:bg-red-600"}),e.jsx("span",{className:"font-bold text-xl text-red-400 w-8 text-center",children:t[0]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"(Solo aplica si no es decisin)"})]}),Oh=({betAmount:t,balance:s,potentialWinnings:i,onBetChange:r})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(Fc,{htmlFor:"betAmount",className:"text-lg font-semibold flex items-center text-gray-200",children:[e.jsx(bd,{className:"w-5 h-5 mr-2 text-yellow-500"})," Monto de la Apuesta"]}),e.jsxs("div",{className:"relative",children:[e.jsx(_c,{type:"text",id:"betAmount",value:t,onChange:r,placeholder:"0",className:"w-full bg-gray-900/50 border-gray-700 pl-4 pr-24 text-lg text-white",inputMode:"numeric"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-yellow-400 font-bold",children:"Monedas"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm mt-2",children:[e.jsxs("p",{className:"text-gray-400",children:["Saldo: ",e.jsx("span",{className:"font-semibold text-gray-200",children:s.toLocaleString()})," ",e.jsx(bd,{className:"inline h-3 w-3 ml-0.5 text-yellow-400"})]}),e.jsxs("p",{className:"text-gray-400",children:["Ganancia Potencial: ",e.jsx("span",{className:"font-bold text-green-400",children:i.toLocaleString()})," ",e.jsx(bd,{className:"inline h-4 w-4 ml-1 text-yellow-400"})]})]})]}),jh=()=>{const[t,s]=z.useState({winner:void 0,method:void 0,round:[Math.ceil(Ph.rounds/2)],firstStrike:void 0,firstTakedown:void 0,willBeKO:void 0,willBeSub:void 0,goToDecision:void 0,mostSignificantStrikes:void 0}),[i,r]=z.useState(""),[a,n]=z.useState(0),o=(e,t)=>{const s=Object.values(t).filter((e=>null!==e&&!Array.isArray(e))).length+(t.round?1:0);if(0===s||!e||e<=0)return 0;return(e*(Object.entries(Ch).filter((([e])=>null!==t[e]&&void 0!==t[e])).reduce(((e,[,t])=>e+t),0)/s||1)).toFixed(0)},l=(e,t)=>{try{let r=t;"method"!==e||Nh.includes(t)||(r=void 0),"round"!==e||Array.isArray(t)&&0!==t.length||(r=[Math.ceil(Ph.rounds/2)]),s((t=>{const s={...t,[e]:r},a=parseInt(i,10)||0;return n(o(a,s)),s}))}catch(r){return}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-2xl",children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsxs(jc,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(Bc,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Prediccin y Apuesta"}),e.jsxs(Uc,{className:"text-base sm:text-lg text-gray-300 mt-1",children:[Ph.event,": ",Ph.fighter1," vs. ",Ph.fighter2]})]}),e.jsxs($c,{className:"pt-6 space-y-8",children:[e.jsx(_h,{predictionKey:"winner",value:t.winner,onChange:l,fighters:Ph,label:"Quin ganar la pelea?",icon:ld,iconColor:"text-yellow-400"}),e.jsx(Mh,{value:t.method,onChange:l}),e.jsx(Fh,{value:t.round,onChange:e=>{l("round",e)},maxRounds:Ph.rounds}),e.jsx("hr",{className:"border-gray-700"}),e.jsx("h3",{className:"text-xl font-semibold text-center text-gray-300 pt-2 mb-6",children:"Predicciones Adicionales"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(_h,{predictionKey:"firstStrike",value:t.firstStrike,onChange:l,fighters:Ph,label:"Primer golpe significativo?",icon:Gd,iconColor:"text-blue-400"}),e.jsx(_h,{predictionKey:"firstTakedown",value:t.firstTakedown,onChange:l,fighters:Ph,label:"Primer derribo?",icon:pd,iconColor:"text-green-400"}),e.jsx(_h,{predictionKey:"mostSignificantStrikes",value:t.mostSignificantStrikes,onChange:l,fighters:Ph,label:"Ms golpes significativos?",icon:zd,iconColor:"text-purple-400"})]}),e.jsx("hr",{className:"border-gray-700 mt-8"}),e.jsx(Oh,{betAmount:i,balance:Dh,potentialWinnings:a,onBetChange:e=>{const s=e.target.value;if(/^\d*$/.test(s)){const e=parseInt(s,10)||0,i=Math.min(e,Dh),a=i>0?i.toString():"";r(a),n(o(i,t))}}})]}),e.jsx(Gc,{className:"border-t border-gray-700 pt-6",children:e.jsx(rd,{type:"submit",onClick:e=>{e.preventDefault();const t=parseInt(i,10)||0;t<=0?alert("Por favor, ingresa un monto vlido para apostar."):t>Dh?alert("No tienes suficientes monedas para esta apuesta."):alert(`Predicciones enviadas con apuesta de ${t} monedas (ver consola)`)},className:"w-full bg-red-600 hover:bg-red-700 text-lg py-3 font-bold uppercase tracking-wider",disabled:!i||parseInt(i,10)<=0,children:"Enviar Prediccin y Apuesta"})})]})})})},Bh=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Uh=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=$h},$h=Number.MAX_SAFE_INTEGER||9007199254740991;let Gh=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),Vh=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),Kh=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var Hh="manifest",Yh="level",Wh="audioTrack",qh="subtitleTrack",zh="main",Xh="audio",Qh="subtitle";class Jh{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Zh{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Jh(e),this.fast_=new Jh(t),this.defaultTTFB_=i,this.ttfb_=new Jh(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Jh(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Jh(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Jh(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function eu(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function tu(){return tu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},tu.apply(null,arguments)}function su(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function iu(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?su(Object(s),!0).forEach((function(t){eu(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):su(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class ru{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=au,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const au=function(){},nu={trace:au,debug:au,log:au,warn:au,info:au,error:au};function ou(){return tu({},nu)}function lu(e,t,s){return t[e]?t[e].bind(t):function(e,t){const s=self.console[e];return s?s.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):au}(e,s)}const du=ou();const cu=du;function hu(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function uu(e,t){const s=Object.keys(e),i=Object.keys(t),r=s.length,a=i.length;return!r||!a||r===a&&!s.some((e=>-1===i.indexOf(e)))}function fu(e,t=!1){if("undefined"!=typeof TextDecoder){const s=new TextDecoder("utf-8").decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let i,r,a,n="",o=0;for(;o<s;){if(i=e[o++],0===i&&t)return n;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=e[o++],n+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[o++],a=e[o++],n+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&a)}}return n}const mu=function(e){let t="";for(let s=0;s<e.length;s++){let i=e[s].toString(16);i.length<2&&(i="0"+i),t+=i}return t};function gu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pu,yu={exports:{}};var vu,xu,bu,Eu,Tu,Su=pu?yu.exports:(pu=1,vu=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,xu=/^(?=([^\/?#]*))\1([^]*)$/,bu=/(?:\/|^)\.(?=\/)/g,Eu=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,yu.exports=Tu={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var i=Tu.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=Tu.normalizePath(i.path),Tu.buildURLFromParts(i)}var r=Tu.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return s.alwaysNormalize?(r.path=Tu.normalizePath(r.path),Tu.buildURLFromParts(r)):t;var a=Tu.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var n=xu.exec(a.path);a.netLoc=n[1],a.path=n[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=a.netLoc,"/"!==r.path[0]))if(r.path){var l=a.path,d=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=Tu.normalizePath(d)}else o.path=a.path,r.params||(o.params=a.params,r.query||(o.query=a.query));return null===o.path&&(o.path=s.alwaysNormalize?Tu.normalizePath(r.path):r.path),Tu.buildURLFromParts(o)},parseURL:function(e){var t=vu.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(bu,"");e.length!==(e=e.replace(Eu,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}});class Au{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var wu="audio",ku="video",Lu="audiovideo";class Ru{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const s=Cu(e,t);s&&(s.enumerable=!0,Object.defineProperty(e,t,s))}(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;i=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[wu]:null,[ku]:null,[Lu]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Au),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Su.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[wu]=null,e[ku]=null,e[Lu]=null}}function Iu(e){return"initSegment"!==e.sn}class Pu extends Ru{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(Bh(e)&&Bh(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=Bh(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){Bh(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return Iu(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,s,i,r,a=!1){const{elementaryStreams:n}=this,o=n[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):n[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:a}}}class Du extends Ru{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Cu(e,t){const s=Object.getPrototypeOf(e);if(s){const e=Object.getOwnPropertyDescriptor(s,t);return e||Cu(s,t)}}const Nu=Math.pow(2,32)-1,_u=[].push,Mu={video:1,audio:2,id3:3,text:4};function Fu(e){return String.fromCharCode.apply(null,e)}function Ou(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function ju(e,t){const s=Uu(e,t);return s<0?4294967296+s:s}function Bu(e,t){let s=ju(e,t);return s*=Math.pow(2,32),s+=ju(e,t+4),s}function Uu(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function $u(e,t,s){e[t]=s>>24,e[t+1]=s>>16&255,e[t+2]=s>>8&255,e[t+3]=255&s}function Gu(e,t){const s=[];if(!t.length)return s;const i=e.byteLength;for(let r=0;r<i;){const a=ju(e,r),n=a>1?r+a:i;if(Fu(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,n));else{const i=Gu(e.subarray(r+8,n),t.slice(1));i.length&&_u.apply(s,i)}r=n}return s}function Vu(e){const t=[],s=e[0];let i=8;const r=ju(e,i);i+=4;let a=0,n=0;0===s?(a=ju(e,i),n=ju(e,i+4),i+=8):(a=Bu(e,i),n=Bu(e,i+8),i+=16),i+=2;let o=e.length+n;const l=Ou(e,i);i+=2;for(let d=0;d<l;d++){let s=i;const a=ju(e,s);s+=4;const n=2147483647&a;if(1===(2147483648&a)>>>31)return cu.warn("SIDX has hierarchical references (not supported)"),null;const l=ju(e,s);s+=4,t.push({referenceSize:n,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+n-1}}),o+=n,s+=4,i=s}return{earliestPresentationTime:a,timescale:r,version:s,referencesCount:l,references:t}}function Ku(e){const t=[],s=Gu(e,["moov","trak"]);for(let i=0;i<s.length;i++){const e=s[i],r=Gu(e,["tkhd"])[0];if(r){let s=r[0];const i=ju(r,0===s?12:20),a=Gu(e,["mdia","mdhd"])[0];if(a){s=a[0];const r=ju(a,0===s?12:20),n=Gu(e,["mdia","hdlr"])[0];if(n){const s=Fu(n.subarray(8,12)),a={soun:wu,vide:ku}[s],o=Hu(Gu(e,["mdia","minf","stbl","stsd"])[0]);a?(t[i]={timescale:r,type:a,stsd:o},t[a]=iu({timescale:r,id:i},o)):t[i]={timescale:r,type:s,stsd:o}}}}}return Gu(e,["moov","mvex","trex"]).forEach((e=>{const s=ju(e,4),i=t[s];i&&(i.default={duration:ju(e,12),flags:ju(e,20)})})),t}function Hu(e){const t=e.subarray(8),s=t.subarray(86),i=Fu(t.subarray(4,8));let r,a=i;const n="enca"===i||"encv"===i;if(n){const e=Gu(t,[i])[0];Gu(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=Gu(e,["schm"])[0];if(t){const s=Fu(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=Gu(e,["frma"])[0];t&&(a=Fu(t))}}}))}const o=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Gu(s,["avcC"])[0];e&&e.length>3&&(a+="."+qu(e[1])+qu(e[2])+qu(e[3]),r=Yu("avc1"===o?"dva1":"dvav",s));break}case"mp4a":{const e=Gu(t,[i])[0],s=Gu(e.subarray(28),["esds"])[0];if(s&&s.length>7){let e=4;if(3!==s[e++])break;e=Wu(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=Wu(s,e);const i=s[e++];if(64!==i)break;if(a+="."+qu(i),e+=12,5!==s[e++])break;e=Wu(s,e);const r=s[e++];let n=(248&r)>>3;31===n&&(n+=1+((7&r)<<3)+((224&s[e])>>5)),a+="."+n}break}case"hvc1":case"hev1":{const e=Gu(s,["hvcC"])[0];if(e&&e.length>12){const t=e[1],s=["","A","B","C"][t>>6],i=31&t,r=ju(e,2),n=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);a+="."+s+i,a+="."+r.toString(16).toUpperCase(),a+="."+n+o;let d="";for(let e=l.length;e--;){const t=l[e];if(t||d){d="."+t.toString(16).toUpperCase()+d}}a+=d}r=Yu("hev1"==o?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=Yu(a,s)||a;break;case"vp09":{const e=Gu(s,["vpcC"])[0];if(e&&e.length>6){const t=e[4],s=e[5],i=e[6]>>4&15;a+="."+zu(t)+"."+zu(s)+"."+zu(i)}break}case"av01":{const e=Gu(s,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],n=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,d=2===t&&o?l?12:10:o?10:8,c=(16&e[2])>>4,h=(8&e[2])>>3,u=(4&e[2])>>2,f=3&e[2],m=1,g=1,p=1,y=0;a+="."+t+"."+zu(i)+n+"."+zu(d)+"."+c+"."+h+u+f+"."+zu(m)+"."+zu(g)+"."+zu(p)+"."+y,r=Yu("dav1",s)}break}}return{codec:a,encrypted:n,supplemental:r}}function Yu(e,t){const s=Gu(t,["dvvC"]),i=s.length?s[0]:Gu(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return e+"."+zu(t)+"."+zu(s)}}function Wu(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function qu(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function zu(e){return(e<10?"0":"")+e}function Xu(e){const t=Gu(e,["schm"])[0];if(t){const s=Fu(t.subarray(4,8));if("cbcs"===s||"cenc"===s)return Gu(e,["schi","tenc"])[0]}return null}function Qu(e){const t=ju(e,0);let s=8;1&t&&(s+=4),4&t&&(s+=4);let i=0;const r=ju(e,4);for(let a=0;a<r;a++){if(256&t){i+=ju(e,s),s+=4}512&t&&(s+=4),1024&t&&(s+=4),2048&t&&(s+=4)}return i}function Ju(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function Zu(e,t){const s=[],i=t.samples,r=t.timescale,a=t.id;let n=!1;return Gu(i,["moof"]).map((o=>{const l=o.byteOffset-8;Gu(o,["traf"]).map((o=>{const d=Gu(o,["tfdt"]).map((e=>{const t=e[0];let s=ju(e,4);return 1===t&&(s*=Math.pow(2,32),s+=ju(e,8)),s/r}))[0];return void 0!==d&&(e=d),Gu(o,["tfhd"]).map((d=>{const c=ju(d,4),h=16777215&ju(d,0);let u=0;const f=!!(16&h);let m=0;const g=!!(32&h);let p=8;c===a&&(!!(1&h)&&(p+=8),!!(2&h)&&(p+=4),!!(8&h)&&(u=ju(d,p),p+=4),f&&(m=ju(d,p),p+=4),g&&(p+=4),"video"===t.type&&(n=ef(t.codec)),Gu(o,["trun"]).map((a=>{const o=a[0],d=16777215&ju(a,0),c=!!(1&d);let h=0;const f=!!(4&d),g=!!(256&d);let p=0;const y=!!(512&d);let v=0;const x=!!(1024&d),b=!!(2048&d);let E=0;const T=ju(a,4);let S=8;c&&(h=ju(a,S),S+=4),f&&(S+=4);let A=h+l;for(let l=0;l<T;l++){if(g?(p=ju(a,S),S+=4):p=u,y?(v=ju(a,S),S+=4):v=m,x&&(S+=4),b&&(E=0===o?ju(a,S):Uu(a,S),S+=4),t.type===ku){let t=0;for(;t<v;){const a=ju(i,A);if(A+=4,tf(n,i[A])){sf(i.subarray(A,A+a),n?2:1,e+E/r,s)}A+=a,t+=a+4}}e+=p/r}})))}))}))})),s}function ef(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function tf(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function sf(e,t,s,i){const r=rf(e);let a=0;a+=t;let n=0,o=0,l=0;for(;a<r.length;){n=0;do{if(a>=r.length)break;l=r[a++],n+=l}while(255===l);o=0;do{if(a>=r.length)break;l=r[a++],o+=l}while(255===l);const e=r.length-a;let t=a;if(o<e)a+=o;else if(o>e){cu.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===n){if(181===r[t++]){const e=Ou(r,t);if(t+=2,49===e){const e=ju(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const a=r[t++],o=64&a,l=o?2+3*(31&a):0,d=new Uint8Array(l);if(o){d[0]=a;for(let e=1;e<l;e++)d[e]=r[t++]}i.push({type:e,payloadType:n,pts:s,bytes:d})}}}}}else if(5===n&&o>16){const e=[];for(let s=0;s<16;s++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const a=o-16,l=new Uint8Array(a);for(let s=0;s<a;s++)l[s]=r[t++];i.push({payloadType:n,pts:s,uuid:e.join(""),userData:fu(l),userDataBytes:l})}}}function rf(e){const t=e.byteLength,s=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(s.push(i+2),i+=2):i++;if(0===s.length)return e;const r=t-s.length,a=new Uint8Array(r);let n=0;for(i=0;i<r;n++,i++)n===s[0]&&(n++,s.shift()),a[i]=e[n];return a}function af(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,a;i=0,r=new Uint8Array,a=new Uint8Array;const n=new Uint8Array(4);return s&&s.byteLength>0&&new DataView(n.buffer).setUint32(0,s.byteLength,!1),function(e,...t){const s=t.length;let i=8,r=s;for(;r--;)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4),r=0,i=8;r<s;r++)a.set(t[r],i),i+=t[r].byteLength;return a}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,r,n,s||new Uint8Array)}function nf(e){const t=e.getUint32(0),s=e.byteOffset,i=e.byteLength;if(i<t)return{offset:s,size:i};if(1886614376!==e.getUint32(4))return{offset:s,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:s,size:t};const a=e.buffer,n=mu(new Uint8Array(a,s+12,16)),o=e.getUint32(28);let l=null,d=null;if(0===r){if(t-32<o||o<22)return{offset:s,size:t};d=new Uint8Array(a,s+32,o)}else if(1===r){if(!o||i<s+32+16*o+16)return{offset:s,size:t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(a,s+32+16*e,16))}return{version:r,systemId:n,kids:l,data:d,offset:s,size:t}}const of=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),lf={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function df(e,t){const s=lf[t];return!!s&&!!s[e.slice(0,4)]}function cf(e,t,s=!0){return!e.split(",").some((e=>!hf(e,t,s)))}function hf(e,t,s=!0){var i;const r=hu(s);return null!=(i=null==r?void 0:r.isTypeSupported(uf(e,t)))&&i}function uf(e,t){return`${t}/mp4;codecs=${e}`}function ff(e){if(e){const t=e.substring(0,4);return lf.video[t]}return 2}function mf(e){const t=of();return e.split(",").reduce(((e,s)=>{const i=t&&ef(s)?9:lf.video[s];return i?(2*i+e)/(e?3:2):(lf.audio[s]+e)/(e?2:1)}),0)}const gf={};const pf=/flac|opus|mp4a\.40\.34/i;function yf(e,t=!0){return e.replace(pf,(e=>function(e,t=!0){if(gf[e])return gf[e];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<s.length;r++){var i;if(hf(s[r],"audio",t))return gf[e]=s[r],s[r];if("mp3"===s[r]&&null!=(i=hu(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t)))}function vf(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e)))return e;if(t){const s=t.split(",");if(s.length>1){if(e)for(let t=s.length;t--;)if(s[t].substring(0,4)===e.substring(0,4))return s[t];return s[0]}}return t||e}function xf(e){if(e.startsWith("av01.")){const t=e.split("."),s=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=s[e-4];return t.join(".")}return e}function bf(e){const t=hu(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ef(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Tf={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Sf(e,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:e}}const Af={};function wf(e,t,s,i,r,a){const n=e.audioCodec?e.audioGroups:null,o=null==a?void 0:a.audioCodec,l=null==a?void 0:a.channels,d=l?parseInt(l):o?1/0:2;let c=null;if(null!=n&&n.length)try{c=1===n.length&&n[0]?t.groups[n[0]].channels:n.reduce(((e,s)=>{if(s){const i=t.groups[s];if(!i)throw new Error(`Audio track group ${s} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{2:0})}catch(h){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(r,8e6))||!!c&&Bh(d)&&Object.keys(c).some((e=>parseInt(e)>d))}function kf(e,t,s){const i=e.videoCodec,r=e.audioCodec;if(!i&&!r||!s)return Promise.resolve(Tf);const a=[];if(i){const t={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},s=e.videoRange;"SDR"!==s&&(t.transferFunction=s.toLowerCase());const r=i.split(","),n=navigator.userAgent;if(r.some((e=>ef(e)))&&of())return Promise.resolve(Sf(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${n})`),a));a.push.apply(a,r.map((e=>({type:"media-source",video:iu(iu({},t),{},{contentType:uf(xf(e),"video")})}))))}return r&&e.audioGroups&&e.audioGroups.forEach((e=>{var s;e&&(null==(s=t.groups[e])||s.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",s=parseFloat(e);Bh(s)&&s>2&&a.push.apply(a,r.split(",").map((e=>({type:"media-source",audio:{contentType:uf(e,"audio"),channels:""+s}}))))}})))})),Promise.all(a.map((e=>{const t=function(e){const{audio:t,video:s}=e,i=s||t;if(i){const e=Ef(i.contentType);if(s)return`r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${e}_${Math.ceil(s.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return Af[t]||(Af[t]=s.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:a,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e})))}const Lf=["NONE","TYPE-0","TYPE-1",null];const Rf=["SDR","PQ","HLG"];var If="",Pf="YES",Df="v2";function Cf(e){const{canSkipUntil:t,canSkipDateRanges:s,age:i}=e;return t&&i<t/2?s?Df:Pf:If}class Nf{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class _f{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=null==(t=e.supplemental)?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Mf(this._audioGroups,e)}hasSubtitleGroup(e){return Mf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Mf(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Ff(e,t){let s=!1,i=[];if(e&&(s="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||Rf.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;s=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),s||(i=["SDR"])}return{preferHDR:s,allowedVideoRanges:i}}const Of=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(s,i)=>{if(e&&(i=e(s,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function jf(e,t){cu.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function Bf(e){return e.reduce(((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Uf(e){if(!e)return e;const{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:a}=e;return{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:a}}function $f(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let i=0;i<t.length;i++){if(Gf(e,t[i],s))return i}return-1}function Gf(e,t,s){const{groupId:i,name:r,lang:a,assocLang:n,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===a||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===n)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const s=e.split(","),i=t.split(",");return s.length===i.length&&!s.some((e=>-1===i.indexOf(e)))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function Vf(e,t){const{audioCodec:s,channels:i}=e;return!(void 0!==s&&(t.audioCodec||"").substring(0,4)!==s.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function Kf(e,t,s){for(let i=t;i>-1;i--)if(s(e[i]))return i;for(let i=t+1;i<e.length;i++)if(s(e[i]))return i;return-1}function Hf(e,t){var s;return!!e&&e!==(null==(s=t.loadLevelObj)?void 0:s.uri)}const Yf=function(e,t){let s=0,i=e.length-1,r=null,a=null;for(;s<=i;){r=(s+i)/2|0,a=e[r];const n=t(a);if(n>0)s=r+1;else{if(!(n<0))return a;i=r-1}}return null};function Wf(e,t,s=0,i=0,r=.005){let a=null;if(e){a=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-s;i>0&&i<15e-7&&(s+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===s&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===qf(s,i,a)||function(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),s);return e.start<=i}return!1}(a,e,Math.min(r,i))))return a;const n=Yf(t,qf.bind(null,s,i));return!n||n===e&&a?a:n}function qf(e=0,t=0,s){if(s.start<=e&&s.start+s.duration>e)return 0;const i=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-i<=e?1:s.start-i>e&&s.start?-1:0}function zf(e,t,s){const i=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-i>e}function Xf(e,t){return Yf(e,(e=>e.cc<t?1:e.cc>t?-1:0))}function Qf(e){switch(e.details){case Vh.FRAG_LOAD_TIMEOUT:case Vh.KEY_LOAD_TIMEOUT:case Vh.LEVEL_LOAD_TIMEOUT:case Vh.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Jf(e,t){const s=Qf(t);return e.default[(s?"timeout":"error")+"Retry"]}function Zf(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function em(e){return iu(iu({},e),{errorRetry:null,timeoutRetry:null})}function tm(e,t,s,i){if(!e)return!1;const r=null==i?void 0:i.code,a=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,i,a):a}var sm=0,im=2,rm=3,am=5,nm=0,om=1,lm=2;function dm(e){const t={action:sm,flags:nm};return e&&(t.resolved=!0),t}var cm="NOT_LOADED",hm="APPENDING",um="PARTIAL",fm="OK";class mm{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Kh.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Kh.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const t=s[i];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let a=r.length;a--;){const n=i[r[a]];if((null==n?void 0:n.body.type)===t&&(!s||n.buffered)){const t=n.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const a=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const n=this.fragments[i];if(!n)return;if(a>=n.body.sn)return;if(!n.buffered&&(!n.loaded||r))return void(n.body.type===s&&this.removeFragment(n.body));const o=n.range[e];o&&(0!==o.time.length?o.time.some((e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(n.body),s})):this.removeFragment(n.body))}))}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const s=e.frag,i=pm(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const a=!s.relurl;if(Object.keys(t).forEach((i=>{const n=s.elementaryStreams[i];if(!n)return;const o=t[i],l=a||!0===n.partial;r.range[i]=this.getBufferedTimes(s,e.part,l,o)})),r.loaded=null,Object.keys(r.range).length){r.buffered=!0;(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),gm(r)||this.removeParts(s.sn-1,s.type)}else this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=ym(s,(t=>t.fragment.sn>=e)))}fragBuffered(e,t){const s=pm(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},a=e.start,n=e.end,o=e.minEndPTS||n,l=e.maxStartPTS||a;for(let d=0;d<i.length;d++){const e=i.start(d)-this.bufferPadding,t=i.end(d)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(a,i.start(d)),endPTS:Math.min(n,i.end(d))});break}if(a<t&&n>e){const e=Math.max(a,i.start(d)),t=Math.min(n,i.end(d));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(n<=e)break}return r}getPartialFragment(e){let t,s,i,r=null,a=0;const{bufferPadding:n,fragments:o}=this;return Object.keys(o).forEach((l=>{const d=o[l];d&&gm(d)&&(s=d.body.start-n,i=d.body.end+n,e>=s&&e<=i&&(t=Math.min(e-s,i-e),a<=t&&(r=d.body,a=t)))})),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||gm(t))}getState(e){const t=pm(e),s=this.fragments[t];return s?s.buffered?gm(s)?um:fm:hm:cm}isTimeBuffered(e,t,s){let i,r;for(let a=0;a<s.length;a++){if(i=s.start(a)-this.bufferPadding,r=s.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=pm(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:a}=t;if("initSegment"===s.sn)return;const n=s.type;if(i){let e=this.activePartLists[n];e||(this.activePartLists[n]=e=[]),e.push(i)}this.timeRanges=r;const o=r[a];this.detectEvictedFragments(a,o,n,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=pm(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach((a=>{const n=this.fragments[a];if(!n)return;const o=n.body;o.type!==s||i&&!o.gap||o.start<t&&o.end>e&&(n.buffered||r)&&this.removeFragment(o)}))}removeFragment(e){const t=pm(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=ym(s,(e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=null==(e=this.hls)||null==(t=e.latestLevelDetails)?void 0:t.partList;s&&s.forEach((e=>e.clearElementaryStreamInfo()))}}function gm(e){var t,s,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(s=e.range.audio)?void 0:s.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function pm(e){return`${e.type}_${e.level}_${e.sn}`}function ym(e,t){return e.filter((e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s}))}var vm=0,xm=1;class bm{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case vm:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case xm:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class Em{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(4*i);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],a=s[2],n=s[3],o=this.invSubMix,l=o[0],d=o[1],c=o[2],h=o[3],u=new Uint32Array(256);let f=0,m=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let s=m^m<<1^m<<2^m<<3^m<<4;s=s>>>8^255&s^99,e[f]=s,t[s]=f;const o=u[f],g=u[o],p=u[g];let y=257*u[s]^16843008*s;i[f]=y<<24|y>>>8,r[f]=y<<16|y>>>16,a[f]=y<<8|y>>>24,n[f]=y,y=16843009*p^65537*g^257*o^16843008*f,l[s]=y<<24|y>>>8,d[s]=y<<16|y>>>16,c[s]=y<<8|y>>>24,h[s]=y,f?(f=o^u[u[u[p^o]]],m^=u[u[m]]):f=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const a=this.ksRows=4*(r+6+1);let n,o;const l=this.keySchedule=new Uint32Array(a),d=this.invKeySchedule=new Uint32Array(a),c=this.sBox,h=this.rcon,u=this.invSubMix,f=u[0],m=u[1],g=u[2],p=u[3];let y,v;for(n=0;n<a;n++)n<r?y=l[n]=t[n]:(v=y,n%r==0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=h[n/r|0]<<24):r>6&&n%r==4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[n]=y=(l[n-r]^v)>>>0);for(o=0;o<a;o++)n=a-o,v=3&o?l[n]:l[n-4],d[o]=o<4||n<=4?v:f[c[v>>>24]]^m[c[v>>>16&255]]^g[c[v>>>8&255]]^p[c[255&v]],d[o]=d[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,n=this.invSubMix,o=n[0],l=n[1],d=n[2],c=n[3],h=this.uint8ArrayToUint32Array_(s);let u=h[0],f=h[1],m=h[2],g=h[3];const p=new Int32Array(e),y=new Int32Array(p.length);let v,x,b,E,T,S,A,w,k,L,R,I,P,D;const C=this.networkToHostOrderSwap;for(;t<p.length;){for(k=C(p[t]),L=C(p[t+1]),R=C(p[t+2]),I=C(p[t+3]),T=k^r[0],S=I^r[1],A=R^r[2],w=L^r[3],P=4,D=1;D<i;D++)v=o[T>>>24]^l[S>>16&255]^d[A>>8&255]^c[255&w]^r[P],x=o[S>>>24]^l[A>>16&255]^d[w>>8&255]^c[255&T]^r[P+1],b=o[A>>>24]^l[w>>16&255]^d[T>>8&255]^c[255&S]^r[P+2],E=o[w>>>24]^l[T>>16&255]^d[S>>8&255]^c[255&A]^r[P+3],T=v,S=x,A=b,w=E,P+=4;v=a[T>>>24]<<24^a[S>>16&255]<<16^a[A>>8&255]<<8^a[255&w]^r[P],x=a[S>>>24]<<24^a[A>>16&255]<<16^a[w>>8&255]<<8^a[255&T]^r[P+1],b=a[A>>>24]<<24^a[w>>16&255]<<16^a[T>>8&255]<<8^a[255&S]^r[P+2],E=a[w>>>24]<<24^a[T>>16&255]<<16^a[S>>8&255]<<8^a[255&A]^r[P+3],y[t]=C(v^u),y[t+1]=C(E^f),y[t+2]=C(b^m),y[t+3]=C(x^g),u=k,f=L,m=R,g=I,t+=4}return y.buffer}}class Tm{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=function(e){switch(e){case vm:return"AES-CBC";case xm:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Sm{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(s){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?e.slice(0,t-s):e}(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise(((r,a)=>{const n=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(n,t,s,i);const o=this.flush();o?r(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:a,remainderData:n}=this;if(i!==vm||16!==t.byteLength)return cu.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),n&&(e=Ju(n,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(s=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Em),l.expandKey(t);const d=a;return this.currentResult=l.decrypt(o.buffer,0,s),this.currentIV=o.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new Tm(this.subtle,t,i)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new bm(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,t)})).catch((r=>(cu.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i))))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(cu.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Am=Math.pow(2,17);class wm{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Rm({type:Gh.NETWORK_ERROR,details:Vh.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(s?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise(((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(Lm(e));e.gap=!1}const l=this.loader=r?new r(i):new a(i),d=km(e);e.loader=l;const c=em(i.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Am};e.stats=l.stats;const u={onSuccess:(t,s,i,r)=>{this.resetLoader(e,l);let a=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),n({frag:e,part:null,payload:a,networkDetails:r})},onError:(t,i,r,a)=>{this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:iu({url:s,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:a}))},onAbort:(t,s,i)=>{this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,s,i)=>{this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:t}))}};t&&(u.onProgress=(s,i,r,a)=>t({frag:e,part:null,payload:r,networkDetails:a})),l.load(d,h,u)}))}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise(((n,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Lm(e,t));const l=this.loader=r?new r(i):new a(i),d=km(e,t);e.loader=l;const c=em(i.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Am};t.stats=l.stats,l.load(d,h,{onSuccess:(i,r,a,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const d={frag:e,part:t,payload:i.data,networkDetails:o};s(d),n(d)},onError:(s,i,r,a)=>{this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:iu({url:d.url,data:void 0},s),error:new Error(`HTTP Error ${s.code} ${s.text}`),networkDetails:r,stats:a}))},onAbort:(s,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:s}))},onTimeout:(s,i,r)=>{this.resetLoader(e,l),o(new Rm({type:Gh.NETWORK_ERROR,details:Vh.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:s}))}})}))}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),a=Math.min(Math.round(s.loaded/r),i),n=(i-a)*Math.round(s.loaded/a);s.total=s.loaded+n}else s.total=Math.max(s.loaded,s.total);const a=s.loading,n=i.loading;a.start?a.first+=n.first-n.start:(a.start=n.start,a.first=n.first),a.end=n.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function km(e,t=null){const s=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},r=s.byteRangeStartOffset,a=s.byteRangeEndOffset;if(Bh(r)&&Bh(a)){var n;let t=r,s=a;if("initSegment"===e.sn&&("AES-128"===(o=null==(n=e.decryptdata)?void 0:n.method)||"AES-256"===o)){const e=a-r;e%16&&(s=a+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=s}var o;return i}function Lm(e,t){const s=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:Gh.MEDIA_ERROR,details:Vh.FRAG_GAP,fatal:!1,frag:e,error:s,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Rm(i)}class Rm extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Im extends ru{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Pm{constructor(e,t,s,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=a}}const Dm={length:0,start:()=>0,end:()=>0};class Cm{static isBuffered(e,t){if(e){const s=Cm.getBuffered(e);for(let e=s.length;e--;)if(t>=s.start(e)&&t<=s.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Cm.getBuffered(e);return Cm.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=Cm.bufferedRanges(e);if(i.length)return Cm.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort(((e,t)=>e.start-t.start||t.end-e.end));let i=-1,r=[];if(s)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(i=d);const a=r.length;if(a){const t=r[a-1].end;e[d].start-t<s?e[d].end>t&&(r[a-1].end=e[d].end):r.push(e[d])}else r.push(e[d])}else r=e;let a,n=0,o=t,l=t;for(let d=0;d<r.length;d++){const e=r[d].start,c=r[d].end;if(-1===i&&t>=e&&t<=c&&(i=d),t+s>=e&&t<c)o=e,l=c,n=l-t;else if(t+s<e){a=e;break}}return{len:n,start:o||0,end:l||0,nextStart:a,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Dm}catch(t){return cu.log("failed to get media.buffered",t),Dm}}}const Nm=/\{\$([a-zA-Z0-9-_]+)\}/g;function _m(e){return Nm.test(e)}function Mm(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(Nm,(t=>{const i=t.substring(2,t.length-1),r=null==s?void 0:s[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r}))}return t}function Fm(e,t,s){let i,r,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`);r=e.get(i)}catch(n){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else i=t.NAME,r=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):a[i]=r||""}function Om(e,t,s){const i=t.IMPORT;if(s&&i in s){let t=e.variableList;t||(e.variableList=t={}),t[i]=s[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const jm=/^(\d+)x(\d+)$/,Bm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Um{constructor(e,t){"string"==typeof e&&(e=Um.parseAttrList(e,t)),tu(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce(((e,t)=>(e[t.toLowerCase()]=!0,e)),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=jm.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(Bm.lastIndex=0;null!==(s=Bm.exec(e));){const r=s[1].trim();let a=s[2];const n=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1;let o=!1;if(n)a=a.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(n||o))a=Mm(t,a);else if(!o&&!n)switch(r){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":cu.warn(`${e}: attribute ${r} is missing quotes`)}i[r]=a}return i}}function $m(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Gm{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(i=null==t?void 0:t.tagOrder)?i:s,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){cu.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=tu(new Um({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Bh(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(cu.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Bh(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&Bh(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Vm{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}get hasProgramDateTime(){return!!this.fragments.length&&Bh(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Km(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Hm(e){switch(e){case"AES-128":case"AES-256":return vm;case"AES-256-CTR":return xm;default:throw new Error(`invalid full segment method ${e}`)}}function Ym(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Wm(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}function qm(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),s=Ym(r)):s=function(e){const t=Wm(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}const zm="undefined"!=typeof self?self:void 0;var Xm={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Qm="org.w3.clearkey",Jm="com.apple.streamingkeydelivery",Zm="com.microsoft.playready",eg="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function tg(e){switch(e){case Jm:return Xm.FAIRPLAY;case Zm:return Xm.PLAYREADY;case eg:return Xm.WIDEVINE;case Qm:return Xm.CLEARKEY}}var sg="1077efecc0b24d02ace33c1e52e2fb4b",ig="e2719d58a985b3c9781ab030af78d30e",rg="9a04f07998404286ab92e65be0885f95",ag="edef8ba979d64acea3c827dcd51d21ed";function ng(e){return e===ag?Xm.WIDEVINE:e===rg?Xm.PLAYREADY:e===sg||e===ig?Xm.CLEARKEY:void 0}function og(e){switch(e){case Xm.FAIRPLAY:return Jm;case Xm.PLAYREADY:return Zm;case Xm.WIDEVINE:return eg;case Xm.CLEARKEY:return Qm}}function lg(e){const{drmSystems:t,widevineLicenseUrl:s}=e,i=t?[Xm.FAIRPLAY,Xm.WIDEVINE,Xm.PLAYREADY,Xm.CLEARKEY].filter((e=>!!t[e])):[];return!i[Xm.WIDEVINE]&&s&&i.push(Xm.WIDEVINE),i}const dg=null!=zm&&null!=(cg=zm.navigator)&&cg.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var cg;function hg(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),i=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=Ym(e).subarray(0,16);return function(e){const t=function(e,t,s){const i=e[t];e[t]=e[s],e[s]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}let ug={};class fg{static clearKeyUriToKeyIdMap(){ug={}}constructor(e,t,s,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Km(e)}isSupported(){if(this.method){if(Km(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Jm:case eg:case Zm:case Qm:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Km(this.method)&&this.uri&&!this.iv){"number"!=typeof e&&(cu.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e);return new fg(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=qm(this.uri);if(t)switch(this.keyFormat){case eg:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Zm:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=af(e,0,t),this.keyId=hg(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=ug[this.uri];if(!e){const t=Object.keys(ug).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),ug[this.uri]=e}this.keyId=e}return this}}const mg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,gg=/#EXT-X-MEDIA:(.*)/g,pg=/^#EXT(?:INF|-X-TARGETDURATION):/m,yg=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),vg=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class xg{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return Su.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return pg.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:_m(e)},i=[];let r;for(mg.lastIndex=0;null!=(r=mg.exec(e));)if(r[1]){var a;const e=new Um(r[1],s),n=Mm(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:xg.resolve(n,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Ag(e.CODECS,o);const d=e["SUPPLEMENTAL-CODECS"];d&&(o.supplemental={},Ag(d,o.supplemental)),null!=(a=o.unknownCodecs)&&a.length||i.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new Um(i,s),t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=Tg(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):cu.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":Fm(s,new Um(i,s),t);break;case"CONTENT-STEERING":{const e=new Um(i,s);s.contentSteering={uri:xg.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=Sg(i)}}const n=i.length>0&&i.length<s.levels.length;return s.levels=n?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,s){let i;const r={},a=s.levels,n={AUDIO:a.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:a.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(gg.lastIndex=0;null!==(i=gg.exec(e));){const e=new Um(i[1],s),a=e.TYPE;if(a){const s=n[a],i=r[a]||[];r[a]=i;const l=e.LANGUAGE,d=e["ASSOC-LANGUAGE"],c=e.CHANNELS,h=e.CHARACTERISTICS,u=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?xg.resolve(e.URI,t):""};if(d&&(f.assocLang=d),c&&(f.channels=c),h&&(f.characteristics=h),u&&(f.instreamId=u),null!=s&&s.length){const e=xg.findGroup(s,f.groupId)||s[0];wg(f,e,"audioCodec"),wg(f,e,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(e,t,s,i,r,a){var n;const o={url:t},l=new Vm(t),d=l.fragments,c=[];let h,u,f,m,g=null,p=0,y=0,v=0,x=0,b=0,E=null,T=new Pu(i,o),S=-1,A=!1,w=null;if(yg.lastIndex=0,l.m3u8=e,l.hasVariableRefs=_m(e),"#EXTM3U"!==(null==(n=yg.exec(e))?void 0:n[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=yg.exec(e));){A&&(A=!1,T=new Pu(i,o),T.playlistOffset=v,T.start=v,T.sn=p,T.cc=x,b&&(T.bitrate=b),T.level=s,g&&(T.initSegment=g,g.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),w&&(T.setByteRange(w),w=null)));const e=h[1];if(e){T.duration=parseFloat(e);const t=(" "+h[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(h[3]){if(Bh(T.duration)){T.playlistOffset=v,T.start=v,f&&Rg(T,f,l),T.sn=p,T.level=s,T.cc=x,d.push(T);const e=(" "+h[3]).slice(1);T.relurl=Mm(l,e),kg(T,E,c),E=T,v+=T.duration,p++,y=0,A=!0}}else{if(h=h[0].match(vg),!h){cu.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<h.length&&void 0===h[u];u++);const e=(" "+h[u]).slice(1),r=(" "+h[u+1]).slice(1),n=h[u+2]?(" "+h[u+2]).slice(1):null;switch(e){case"BYTERANGE":E?T.setByteRange(r,E):T.setByteRange(r);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=r,T.tagList.push(["PROGRAM-DATE-TIME",r]),-1===S&&(S=d.length);break;case"PLAYLIST-TYPE":l.type&&Ig(l,e,h),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?Ig(l,e,h):d.length>0&&Pg(l,e,h),p=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&Ig(l,e,h);const t=new Um(r,l),s=t.decimalInteger("SKIPPED-SEGMENTS");if(Bh(s)){l.skippedSegments+=s;for(let e=s;e--;)d.push(null);p+=s}const i=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(i.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&Ig(l,e,h),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&Ig(l,e,h),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Ig(l,e,h),l.live=!1;break;case"#":(r||n)&&T.tagList.push(n?[r,n]:[r]);break;case"DISCONTINUITY":x++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,r]),b=1e3*parseInt(r),Bh(b)?T.bitrate=b:b=0;break;case"DATERANGE":{const e=new Um(r,l),t=new Gm(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:cu.warn(`Ignoring invalid DATERANGE tag: "${r}"`),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new Um(r,l);"IMPORT"in e?Om(l,e,a):Fm(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?Ig(l,e,h):d.length>0&&Pg(l,e,h),l.startCC=x=parseInt(r);break;case"KEY":{const e=Tg(r,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={}),f[e.keyFormat]&&(f=tu({},f)),f[e.keyFormat]=e}else cu.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":l.startTimeOffset=Sg(r);break;case"MAP":{const e=new Um(r,l);if(T.duration){const t=new Pu(i,o);Lg(t,e,s,f),g=t,T.initSegment=g,g.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;w=`${t-e}@${e}`}else w=null;Lg(T,e,s,f),g=T,A=!0}g.cc=x;break}case"SERVER-CONTROL":m&&Ig(l,e,h),m=new Um(r),l.canBlockReload=m.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=m.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&m.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=m.optionalFloat("PART-HOLD-BACK",0),l.holdBack=m.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&Ig(l,e,h);const t=new Um(r);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=y>0?e[e.length-1]:void 0,s=y++,i=new Um(r,l),a=new Du(i,T,o,s,t);e.push(a),T.duration+=a.duration;break}case"PRELOAD-HINT":{const e=new Um(r,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Um(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:cu.warn(`line parsed but not handled: ${h}`)}}}E&&!E.relurl?(d.pop(),v-=E.duration,l.partList&&(l.fragmentHint=E)):l.partList&&(kg(T,E,c),T.cc=x,l.fragmentHint=T,f&&Rg(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const k=d.length,L=d[0],R=d[k-1];if(v+=l.skippedSegments*l.targetduration,v>0&&k&&R){l.averagetargetduration=v/k;const e=R.sn;l.endSN="initSegment"!==e?e:0,l.live||(R.endList=!0),L&&void 0===l.startCC&&(l.startCC=L.cc),S>0&&(!function(e,t){let s=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(d,S),L&&c.unshift(L))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(v+=l.fragmentHint.duration),l.totalduration=v,c.length&&l.dateRangeTagCount&&L&&bg(c,l),l.endCC=x,l}}function bg(e,t){const s=e.length,i=e[s-1],r=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let n=a.length;n--;){const o=t.dateRanges[a[n]],l=o.startDate.getTime();o.tagAnchor=i.ref;for(let i=s;i--;){const s=Eg(t,l,e,i,r);if(-1!==s){o.tagAnchor=t.fragments[s].ref;break}}}}function Eg(e,t,s,i,r){const a=s[i];if(a){const o=a.programDateTime;if(t>=o||0===i){var n;if(t<=o+1e3*(((null==(n=s[i+1])?void 0:n.start)||r)-a.start)){const r=s[i].sn-e.startSN,a=e.fragments;if(a.length>s.length){for(let n=(s[i+1]||a[a.length-1]).sn-e.startSN;n>r;n--){const e=a[n].programDateTime;if(t>=e&&t<e+1e3*a[n].duration)return n}}return r}}}return-1}function Tg(e,t,s){var i,r;const a=new Um(e,s),n=null!=(i=a.METHOD)?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,c=null!=(r=a.KEYFORMAT)?r:"identity";o&&a.IV&&!l&&cu.error(`Invalid IV: ${a.IV}`);const h=o?xg.resolve(o,t):"",u=(d||"1").split("/").map(Number).filter(Number.isFinite);return new fg(n,h,c,u,l)}function Sg(e){const t=new Um(e).decimalFloatingPoint("TIME-OFFSET");return Bh(t)?t:null}function Ag(e,t){let s=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=s.filter((t=>df(t,e)));i.length&&(t[`${e}Codec`]=i.map((e=>e.split("/")[0])).join(","),s=s.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=s}function wg(e,t,s){const i=t[s];i&&(e[s]=i)}function kg(e,t,s){e.rawProgramDateTime?s.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function Lg(e,t,s,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Rg(e,t,s){e.levelkeys=t;const{encryptedFragments:i}=s;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}function Ig(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${s[0]})`)}function Pg(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${s[0]})`)}function Dg(e,t){const s=t.startPTS;if(Bh(s)){let i,r=0;t.sn>e.sn?(r=s-e.start,i=e):(r=e.start-s,i=t),i.duration!==r&&i.setDuration(r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Cg(e,t,s,i,r,a){i-s<=0&&(cu.warn("Fragment should have a positive duration",t),i=s+t.duration,a=r+t.duration);let n=s,o=i;const l=t.startPTS,d=t.endPTS;if(Bh(l)){const e=Math.abs(l-s);Bh(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,n=Math.max(s,l),s=Math.min(s,l),r=Math.min(r,t.startDTS),o=Math.min(i,d),i=Math.max(i,d),a=Math.max(a,t.endDTS)}const c=s-t.start;0!==t.start&&t.setStart(s),t.setDuration(i-t.start),t.startPTS=s,t.maxStartPTS=n,t.startDTS=r,t.endPTS=i,t.minEndPTS=o,t.endDTS=a;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;const f=h-e.startSN,m=e.fragments;for(m[f]=t,u=f;u>0;u--)Dg(m[u],m[u-1]);for(u=f;u<m.length-1;u++)Dg(m[u],m[u+1]);return e.fragmentHint&&Dg(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function Ng(e,t){if(e===t)return;let s=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){s=e;break}}let r;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,s){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,n=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let d=r;d<=a;d++){const r=l[n+d];let a=o[d];if(i&&!a&&r&&(a=t.fragments[d]=r),r&&a){if(s(r,a,d,o),r.url&&r.url!==a.url)return void(t.playlistParsingError=_g(`media sequence mismatch ${a.sn}:`,e,t,r,a));if(r.cc!==a.cc)return void(t.playlistParsingError=_g(`discontinuity sequence mismatch (${r.cc}!=${a.cc})`,e,t,r,a))}}}(e,t,((i,a,n,o)=>{if(!t.startCC&&a.cc!==i.cc){var l,d;const s=i.cc-a.cc;for(let e=n;e<o.length;e++)o[e].cc+=s;t.startCC=null!=(l=null==(d=jg(e,t.startSN-1))?void 0:d.cc)?l:o[0].cc,t.endCC=o[o.length-1].cc}Bh(i.startPTS)&&Bh(i.endPTS)&&(a.setStart(a.startPTS=i.startPTS),a.startDTS=i.startDTS,a.maxStartPTS=i.maxStartPTS,a.endPTS=i.endPTS,a.endDTS=i.endDTS,a.minEndPTS=i.minEndPTS,a.setDuration(i.endPTS-i.startPTS),a.duration&&(r=a),t.PTSKnown=t.alignedSliding=!0),i.hasStreams&&(a.elementaryStreams=i.elementaryStreams),a.loader=i.loader,i.hasStats&&(a.stats=i.stats),i.initSegment&&(a.initSegment=i.initSegment,s=i.initSegment)}));const a=t.fragments,n=t.fragmentHint?a.concat(t.fragmentHint):a;if(s&&n.forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)})),t.skippedSegments)if(t.deltaUpdateFailed=a.some((e=>!e)),t.deltaUpdateFailed){cu.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.endCC=a[a.length-1].cc,t.canSkipDateRanges&&(t.dateRanges=function(e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=t,r=tu({},e);i&&i.forEach((e=>{delete r[e]}));const a=Object.keys(r).length;a&&Object.keys(s).forEach((e=>{const t=r[e],i=new Gm(s[e].attr,t);i.isValid?(r[e]=i,t||(i.tagOrder+=a)):cu.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Of(s[e].attr)}"`)}));return r}(e.dateRanges,t));const s=e.fragments.filter((e=>e.rawProgramDateTime));if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<n.length;e++)null===n[e].programDateTime&&kg(n[e],n[e-1],s);bg(s,t)}!function(e,t,s){if(e&&t){let i=0;for(let r=0,a=e.length;r<=a;r++){const a=e[r],n=t[r+i];a&&n&&a.index===n.index&&a.fragment.sn===n.fragment.sn?s(a,n):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),r?Cg(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Mg(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function _g(e,t,s,i,r){return new Error(`${e} ${r.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${s.startSN}\n${s.m3u8}`)}function Mg(e,t,s=!0){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,a=i>=0;let n=0;if(a&&i<r.length)n=r[i].start;else if(a&&t.startSN===e.endSN+1)n=e.fragmentEnd;else if(a&&s)n=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;n=e.fragmentStart}Fg(t,n)}function Fg(e,t){if(t){const s=e.fragments;for(let i=e.skippedSegments;i<s.length;i++)s[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Og(e,t=1/0){let s=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&s*r>t){const e=1e3*i[i.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}function jg(e,t,s){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t?i:t<e.startSN&&s&&s.sn===t?s:null)}function Bg(e,t,s){return e?Ug(e.partList,t,s):null}function Ug(e,t,s){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===s&&r.fragment.sn===t)return r}return null}function $g(e){e.forEach(((e,t)=>{var s;null==(s=e.details)||s.fragments.forEach((e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)}))}))}function Gg(e,t){for(let i=0,r=e.length;i<r;i++){var s;if((null==(s=e[i])?void 0:s.cc)===t)return e[i]}return null}function Vg(e,t){if(e){const s=e.start+t;e.start=e.startPTS=s,e.endPTS=s+e.duration}}function Kg(e,t){const s=t.fragments;for(let i=0,r=s.length;i<r;i++)Vg(s[i],e);t.fragmentHint&&Vg(t.fragmentHint,e),t.alignedSliding=!0}function Hg(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const s=Math.min(t.endCC,e.endCC),i=Gg(t.fragments,s),r=Gg(e.fragments,s);if(!i||!r)return;cu.log(`Aligning playlist at start of dicontinuity sequence ${s}`);Kg(i.start-r.start,e)}function Yg(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,i=t.fragments;if(!s.length||!i.length)return;let r,a;const n=Math.min(t.endCC,e.endCC);t.startCC<n&&e.startCC<n&&(r=Gg(i,n),a=Gg(s,n)),r&&a||(r=i[Math.floor(i.length/2)],a=Gg(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=a.programDateTime;if(!o||!l)return;Kg((l-o)/1e3-(a.start-r.start),e)}const Wg=function(e){let t="";const s=e.length;for(let i=0;i<s;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t},qg="STOPPED",zg="IDLE",Xg="KEY_LOADING",Qg="FRAG_LOADING",Jg="FRAG_LOADING_WAITING_RETRY",Zg="WAITING_TRACK",ep="PARSING",tp="PARSED",sp="ENDED",ip="ERROR",rp="WAITING_INIT_PTS",ap="WAITING_LEVEL";class np extends Im{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=qg,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:s,mediaBuffer:i,state:r}=this,a=s?s.currentTime:0,n=Cm.bufferInfo(i||s,a,e.maxBufferHole);if(this.log(`media seeking to ${Bh(a)?a.toFixed(3):a}, state: ${r}`),this.state===sp)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,i=t.start-s,r=t.start+t.duration+s;if(!n.len||r<n.start||i>n.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(s){this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0);if(a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts){const e=Math.max(n.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${a.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||n.len||(this.log(`setting startPosition to ${a} because of seek before start`),this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new wm(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Sm(e.config)}registerListeners(){const{hls:e}=this;e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Kh.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===qg)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=qg}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.nextStart;if(r&&r>i&&r<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Cm.isBuffered(this.media,e.start+e.duration/2)}const n=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===qg&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=qg,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){this._doFragLoad(e,t,s,(e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)})).then((e=>{if(!e)return;const t=this.state,s=e.frag;this.fragContextChanged(s)?(t===Qg||!this.fragCurrent&&t===ep)&&(this.fragmentTracker.removeFragment(s),this.state=zg):("payload"in e&&(this.log(`Loaded ${s.type} sn: ${s.sn} of ${this.playlistLabel()} ${s.level}`),this.hls.trigger(Kh.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))})).catch((t=>{this.state!==qg&&this.state!==ip&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===hm){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),a=this.backtrackFragment;(1===(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===um&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(Kh.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e})).then((e=>{const{hls:t}=this,{frag:s,payload:i}=e,r=s.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&Km(r.method)){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Hm(r.method)).catch((e=>{throw t.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e})).then((i=>{const r=self.performance.now();return t.trigger(Kh.FRAG_DECRYPTED,{frag:s,payload:i,stats:{tstart:a,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)}))}return this.completeInitSegmentLoad(e)})).catch((t=>{this.state!==qg&&this.state!==ip&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==qg&&(this.state=zg),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Wg(Cm.getBuffered(s)):"(detached)"})`),Iu(e)){var i;if(e.type!==Qh){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=zg)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=zg}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,a=!r||0===r.length||r.some((e=>!e)),n=new Pm(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(n)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let n=null;!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Xg,this.fragCurrent=e,n=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(Kh.KEY_LOADED,e),this.state===Xg&&(this.state=zg),e})),this.hls.trigger(Kh.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(n=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));const o=this.fragPrevious;if(Iu(e)&&(!o||e.sn!==o.sn)){const s=this.shouldLoadParts(t.details,e.end);s!==this.loadingParts&&(this.log(`LL-Part loading ${s?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=s)}if(s=Math.max(e.start,s||0),this.loadingParts&&Iu(e)){const r=a.partList;if(r&&i){s>e.end&&a.fragmentHint&&(e=a.fragmentHint);const o=this.getNextPart(r,e,s);if(o>-1){const l=r[o];let d;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${r.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=Qg,d=n?n.then((s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,l,t,i))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,i).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(Kh.FRAG_LOADING,{frag:e,part:l,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(r,s))return Promise.resolve(null)}}if(Iu(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),Bh(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Qg;const l=this.config.progressive;let d;return d=l&&n?n.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,l?i:void 0),n]).then((([e])=>(!l&&e&&i&&i(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(Kh.FRAG_LOADING,{frag:e,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,s,i){return new Promise(((r,a)=>{var n;const o=[],l=null==(n=s.details)?void 0:n.partList,d=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const a=i.part;this.hls.trigger(Kh.FRAG_LOADED,i);const n=Bg(s.details,e.sn,t.index+1)||Ug(l,e.sn,t.index+1);if(!n)return r({frag:e,part:a,partsLoaded:o});d(n)})).catch(a)};d(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Vh.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(Kh.ERROR,t)}else this.hls.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ep)return void(this.fragCurrent||this.state===qg||this.state===ip||(this.state=zg));const{frag:s,part:i,level:r}=t,a=self.performance.now();s.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const n=this.getLevelDetails(),o=n&&s.sn>n.endSN||this.shouldLoadParts(n,s.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(null!=e&&e.partList){var s;const r=e.partList[0];if(t>=r.end+((null==(s=e.fragmentHint)?void 0:s.duration)||0)){var i;if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:a}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const n=t[i],o=n.details,l=a>-1?Bg(o,r,a):null,d=l?l.fragment:jg(o,r,s);return d?(s&&s!==d&&(d.stats=s.stats),{frag:d,part:l,level:n}):null}bufferFragmentData(e,t,s,i,r){var a;if(!e||this.state!==ep)return;const{data1:n,data2:o}=e;let l=n;if(n&&o&&(l=Ju(n,o)),null==(a=l)||!a.length)return;const d={type:e.type,frag:t,part:s,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(Kh.BUFFER_APPENDING,d),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Cm.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,i=Cm.bufferInfo(t,s,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),n=Math.max(Math.min(e.start-a,i.end-a),s+a);e.start-n>a&&this.flushMainBuffer(n,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!Bh(i))return null;const r=this.lastCurrentTime>i||null!=(s=this.media)&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}getFwdBufferInfoAtPos(e,t,s,i){const r=Cm.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(r.nextStart<=a.end||a.gap)){const s=Math.max(Math.min(r.nextStart,a.end)-t,i);return Cm.bufferInfo(e,t,s)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,i);return r>=i&&(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=zh){var s;const i=null==(s=this.fragmentTracker)?void 0:s.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,a=s[0].start,n=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const d=r.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){var l;n&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t,s);const i=this.hls.startPosition,r=this.hls.liveSyncPosition,d=o?(-1!==i&&i>=a?i:r)||o.start:e;this.log(`Setting startPosition to ${d} to match start frag at live edge. mainStart: ${i} liveSyncPosition: ${r} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=d}}else e<=a&&(o=s[0]);if(!o){const s=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,s,t)}let d=this.filterReplacedPrimary(o,t);if(!d&&o){const e=o.sn-t.startSN;d=this.filterReplacedPrimary(s[e+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===fm||s===um&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(null!==e&&s.len+e.len>=r){const e=a.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(op(this.hls.config)){var e,t;if(null==(e=this.hls.interstitialsManager)||null==(t=e.playingItem)?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(op(this.hls.config)&&e.type!==Qh){const s=this.hls.interstitialsManager,i=null==s?void 0:s.bufferingItem;if(i){const s=i.event;if(s){if(s.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else{if(e.end<=i.start&&!1===(null==t?void 0:t.live))return null;if(e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}}const r=null==s?void 0:s.playerQueue;if(r)for(let t=r.length;t--;){const s=r[t].interstitial;if(s.appendInPlace&&e.start>=s.startTime&&e.end<=s.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,s){let i=-1,r=!1,a=!0;for(let n=0,o=e.length;n<o;n++){const o=e[n];if(a=a&&!o.independent,i>-1&&s<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||a)&&o.fragment===t&&(i=n),r=l}return i}loadedEndOfParts(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}getInitialLiveFragment(e,t){const s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=function(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!Bh(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;s=s||0;for(let i=0;i<e.length;++i){const r=e[i];if(zf(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];s.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Xf(t,s.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:n}=s;const{fragmentHint:o}=s,{maxFragLookUpTolerance:l}=i,d=s.partList,c=!!(this.loadingParts&&null!=d&&d.length&&o);let h;if(c&&o&&!this.bitrateTest&&d[d.length-1].fragment.sn===o.sn&&(a=a.concat(o),n=o.sn),e<t){var u;h=Wf(r,a,e,e<this.lastCurrentTime||e>t-l||null!=(u=this.media)&&u.paused||!this.startFragRequested?0:l)}else h=a[a.length-1];if(h){const e=h.sn-s.startSN,t=this.fragmentTracker.getState(h);if((t===fm||t===um&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!c||d[0].fragment.sn>h.sn||!s.live&&!c)){if(r&&h.level===r.level){const t=a[e+1];h=h.sn<n&&this.fragmentTracker.getState(t)!==fm?t:null}}}return h}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,n=e.alignedSliding&&Bh(r);if(a||!n&&!r){!function(e,t){e&&(Hg(t,e),!t.alignedSliding&&e&&Yg(t,e),t.alignedSliding||!e||t.skippedSegments||Mg(e,t,!1))}(s,e);const r=e.fragmentStart;return this.log(`Live playlist sliding: ${r.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),r}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(-1===s){const r=null!==this.startTimeOffset,a=r?this.startTimeOffset:e.startTimeOffset;null!==a&&Bh(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Iu(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Jg)||(this.state=zg)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var i;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===Vh.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction,{action:n,flags:o,retryCount:l=0,retryConfig:d}=a||{},c=!!a&&!!d,h=c&&n===am,u=c&&!a.resolved&&o===om;if(!h&&u&&Iu(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((h||u)&&l<d.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=Zf(d,l);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${l+1}/${d.maxNumRetry} in ${i}ms`),a.resolved=!0,this.retryDate=self.performance.now()+i,this.state=Jg}else if(d&&a){if(this.resetFragmentErrors(e),!(l<d.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${l})`);r||n===rm||(a.resolved=!0)}else this.state=n===im?ap:ip;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ep||this.state===tp){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Xh&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==qg&&(this.state=zg)}afterBufferFlushed(e,t,s){if(!e)return;const i=Cm.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===sp&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==qg&&(this.state=zg)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r)return void this.warn("level.details undefined");var a;if(!Object.keys(e.elementaryStreams).reduce(((t,a)=>{const n=e.elementaryStreams[a];if(n){const o=n.endPTS-n.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;const l=i?0:Cg(r,e,n.startPTS,n.endPTS,n.startDTS,n.endDTS);return this.hls.trigger(Kh.LEVEL_PTS_UPDATED,{details:r,level:s,drift:l,type:a,frag:e,start:n.startPTS,end:n.endPTS}),!0}return t}),!1)&&(0===s.fragmentError&&this.treatAsGap(e,s),null===(null==(a=this.transmuxer)?void 0:a.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=tp,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(Kh.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===zh?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${(null!=(i=t&&!s?e.startPTS:(s||e).start)?i:NaN).toFixed(3)}-${(null!=(r=t&&!s?e.endPTS:(s||e).end)?r:NaN).toFixed(3)}]${s&&"main"===e.type?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function op(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class lp{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;return e.length?(s=1===e.length?e[0]:function(e,t){const s=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];s.set(t,i),i+=t.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var dp,cp={exports:{}};var hp=(dp||(dp=1,function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function a(e,t,i,a,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,a||e,n),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,n=new Array(a);r<a;r++)n[r]=i[r].fn;return n},o.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,a,n){var o=s?s+e:e;if(!this._events[o])return!1;var l,d,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,a),!0;case 6:return c.fn.call(c.context,t,i,r,a,n),!0}for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var u,f=c.length;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),h){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,i);break;case 4:c[d].fn.call(c[d].context,t,i,r);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c[d].fn.apply(c[d].context,l)}}return!0},o.prototype.on=function(e,t,s){return a(this,e,t,s,!1)},o.prototype.once=function(e,t,s){return a(this,e,t,s,!0)},o.prototype.removeListener=function(e,t,i,r){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return n(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||n(this,a);else{for(var l=0,d=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&d.push(o[l]);d.length?this._events[a]=1===d.length?d[0]:d:n(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&n(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}(cp)),cp.exports),up=gu(hp);const fp="1.6.2",mp={};function gp(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function pp(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function yp(e,t){let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s}function vp(e,t){const s=t;let i=0;for(;pp(e,t);){i+=10;i+=yp(e,t+6),gp(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(s,s+i)}function xp(e,t){return 255===e[t]&&240==(246&e[t+1])}function bp(e,t){return 1&e[t+1]?7:9}function Ep(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Tp(e,t){return t+1<e.length&&xp(e,t)}function Sp(e,t){if(Tp(e,t)){const s=bp(e,t);if(t+s>=e.length)return!1;const i=Ep(e,t);if(i<=s)return!1;const r=t+i;return r===e.length||Tp(e,r)}return!1}function Ap(e,t,s,i,r){if(!e.samplerate){const a=function(e,t,s,i){const r=t[s+2],a=r>>2&15;if(a>12){const t=new Error(`invalid ADTS sampling index:${a}`);return void e.emit(Kh.ERROR,Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const n=1+(r>>6&3),o=t[s+3]>>6&3|(1&r)<<2,l="mp4a.40."+n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a];let c=a;5!==n&&29!==n||(c-=3);const h=[n<<3|(14&c)>>1,(1&c)<<7|o<<3];return cu.log(`manifest codec:${i}, parsed codec:${l}, channels:${o}, rate:${d} (ADTS object type:${n} sampling index:${a})`),{config:h,samplerate:d,channelCount:o,codec:l,parsedCodec:l,manifestCodec:i}}(t,s,i,r);if(!a)return;tu(e,a)}}function wp(e){return 9216e4/e}function kp(e,t,s,i,r){const a=i+r*wp(e.samplerate),n=function(e,t){const s=bp(e,t);if(t+s<=e.length){const i=Ep(e,t)-s;if(i>0)return{headerLength:s,frameLength:i}}}(t,s);let o;if(n){const{frameLength:i,headerLength:r}=n,l=r+i,d=Math.max(0,s+l-t.length);d?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const c={unit:o,pts:a};return d||e.samples.push(c),{sample:c,length:l,missing:d}}const l=t.length-s;o=new Uint8Array(l),o.set(t.subarray(s,t.length),0);return{sample:{unit:o,pts:a},length:l,missing:-1}}function Lp(e,t){return pp(e,t)&&yp(e,t+6)+10<=e.length-t}function Rp(e,t){if(e<0)return-Rp(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2==0?t:t+1)/s}return Math.round(e*s)/s}function Ip(e,t=0,s=1/0){return function(e,t,s,i){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const n=(h=e,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?e.byteOffset:0),o=(n+e.byteLength)/a,l=(n+t)/a,d=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(d+Math.max(s,0),o));var h;return new i(r,d,c-d)}(e,t,s,Uint8Array)}function Pp(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return;const s=e.data.subarray(1).indexOf(0);if(-1===s)return;const i=fu(Ip(e.data,1,s)),r=e.data[2+s],a=e.data.subarray(3+s).indexOf(0);if(-1===a)return;const n=fu(Ip(e.data,3+s,a));let o;return o="--\x3e"===i?fu(Ip(e.data,4+s+a)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+s+a)),t.mimeType=i,t.pictureType=r,t.description=n,t.data=o,t}function Dp(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=fu(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:s.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=fu(e.data.subarray(t),!0);t+=s.length+1;const i=fu(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=fu(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Pp(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=fu(e.data.subarray(t),!0);t+=s.length+1;const i=fu(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=fu(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function Cp(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=yp(e,4);return{type:t,size:s,data:e.subarray(10,10+s)}}function Np(e){let t=0;const s=[];for(;pp(e,t);){const i=yp(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const i=Cp(e.subarray(t)),r=Dp(i);r&&s.push(r),t+=i.size+10}gp(e,t)&&(t+=10)}return s}function _p(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Mp(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,s&&(i+=47721858.84),Math.round(i)}}function Fp(e){const t=Np(e);for(let s=0;s<t.length;s++){const e=t[s];if(_p(e))return Mp(e)}}let Op=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function jp(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Bp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Ju(this.cachedData,e),this.cachedData=null);let s,i=vp(e,0),r=i?i.length:0;const a=this._audioTrack,n=this._id3Track,o=i?Fp(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&Bh(o))&&(this.basePTS=Up(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Op.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(a,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,s=r):r=l}else Lp(e,r)?(i=vp(e,r),n.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Op.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const t=e.slice(s);this.cachedData?this.cachedData=Ju(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:jp(),id3Track:n,textTrack:jp()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:jp(),id3Track:this._id3Track,textTrack:jp()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Up=(e,t,s)=>{if(Bh(e))return 90*e;return 9e4*t+(s?9e4*s.baseTime/s.timescale:0)};let $p=null;const Gp=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Vp=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Kp=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Hp=[0,1,1,4];function Yp(e,t,s,i,r){if(s+24>t.length)return;const a=Wp(t,s);if(a&&s+a.frameLength<=t.length){const n=i+r*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(s,s+a.frameLength),pts:n,dts:n};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}function Wp(e,t){const s=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==a){const n=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Gp[14*(3===s?3-i:3===i?3:4)+r-1],d=Vp[3*(3===s?0:2===s?1:2)+a],c=3===o?1:2,h=Kp[s][i],u=Hp[i],f=8*h*u,m=Math.floor(h*l/d+n)*u;if(null===$p){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$p=e?parseInt(e[1]):0}return!!$p&&$p<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:c,frameLength:m,samplesPerFrame:f}}}function qp(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function zp(e,t){return t+1<e.length&&qp(e,t)}function Xp(e,t){if(t+1<e.length&&qp(e,t)){const s=4,i=Wp(e,t);let r=s;null!=i&&i.frameLength&&(r=i.frameLength);const a=t+r;return a===e.length||zp(e,a)}return!1}const Qp=(e,t)=>{let s=0,i=5;t+=i;const r=new Uint32Array(1),a=new Uint32Array(1),n=new Uint8Array(1);for(;i>0;){n[0]=e[t];const o=Math.min(i,8),l=8-o;a[0]=4278190080>>>24+l<<l,r[0]=(n[0]&a[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,i-=o}return s};class Jp extends Bp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=Zp(e,t,s,this.basePTS,this.frameIndex);if(-1!==i){return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}static probe(e){if(!e)return!1;const t=vp(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==Fp(t)&&Qp(e,s)<16}}function Zp(e,t,s,i,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const a=t[s+4]>>6;if(a>=3)return-1;const n=[48e3,44100,32e3][a],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+a];if(s+l>t.length)return-1;const d=t[s+6]>>5;let c=0;2===d?c+=2:(1&d&&1!==d&&(c+=2),4&d&&(c+=2));const h=(t[s+6]<<8|t[s+7])>>12-c&1,u=[2,1,2,3,3,4,4,5][d]+h,f=t[s+5]>>3,m=7&t[s+5],g=new Uint8Array([a<<6|f<<1|m>>2,(3&m)<<6|d<<3|h<<2|o>>4,o<<4&224]),p=i+r*(1536/n*9e4),y=t.subarray(s,s+l);return e.config=g,e.channelCount=u,e.samplerate=n,e.samples.push({unit:y,pts:p}),l}const ey=/\/emsg[-/]ID3/i;function ty(e,t){return Bh(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class sy{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Sm(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,vm)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then((r=>{const a=new Uint8Array(r);i.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}))}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const a=rf(r.data),n=this.getAvcEncryptedData(a);this.decryptBuffer(n.buffer).then((n=>{r.data=this.getAvcDecryptedUnit(a,n),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}))}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(s>=r.length);s++){const a=r[s];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,s,i,a),this.decrypter.isSync())))return}}}}class iy{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;s=e[e.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,i=s.length;if(!i)return void t.dropped++;{const t=s[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const a=r,n=[];let o,l,d,c=0,h=-1,u=0;for(-1===r&&(h=0,u=this.getNALuType(t,0),r=0,c=1);c<i;)if(o=t[c++],r)if(1!==r)if(o)if(1===o){if(l=c-r-1,h>=0){const e={data:t.subarray(h,l),type:u};n.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(a&&c<=4-a&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-a)),l>0&&(s.data=Ju(s.data,t.subarray(0,l)),s.state=0))}c<i?(d=this.getNALuType(t,c),h=c,u=d,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(h>=0&&r>=0){const e={data:t.subarray(h,i),type:u,state:r};n.push(e)}if(0===n.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=Ju(s.data,t))}return e.naluState=r,n}}class ry{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&cu.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class ay extends iy{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a,n=this.VideoSample,o=!1;s.data=null,n&&r.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 1:{let t=!1;a=!0;const r=i.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var d;if(t)null!=(d=n)&&d.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null);n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.frame=!0,n.key=t;break}case 5:a=!0,null!=(r=n)&&r.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 6:a=!0,sf(i.data,1,s.pts,t.samples);break;case 7:{var c,h;a=!0,o=!0;const t=i.data,s=this.readSPS(t);if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(c=e.pixelRatio)?void 0:c[0])!==s.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,null!=(l=n)&&l.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1}if(n&&a){n.units.push(i)}})),i&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new ry(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s,i=8,r=8;for(let a=0;a<e;a++)0!==r&&(s=t.readEG(),r=(i+s+256)%256),i=0===r?i:r}readSPS(e){const t=new ry(e);let s,i,r,a=0,n=0,o=0,l=0;const d=t.readUByte.bind(t),c=t.readBits.bind(t),h=t.readUEG.bind(t),u=t.readBoolean.bind(t),f=t.skipBits.bind(t),m=t.skipEG.bind(t),g=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);d();const y=d();if(c(5),f(3),d(),g(),100===y||110===y||122===y||244===y||44===y||83===y||86===y||118===y||128===y){const e=h();if(3===e&&f(1),g(),g(),f(1),u())for(i=3!==e?8:12,r=0;r<i;r++)u()&&p(r<6?16:64,t)}g();const v=h();if(0===v)h();else if(1===v)for(f(1),m(),m(),s=h(),r=0;r<s;r++)m();g(),f(1);const x=h(),b=h(),E=c(1);0===E&&f(1),f(1),u()&&(a=h(),n=h(),o=h(),l=h());let T=[1,1];if(u()&&u()){switch(d()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[d()<<8|d(),d()<<8|d()]}}return{width:Math.ceil(16*(x+1)-2*a-2*n),height:(2-E)*(b+1)*16-(E?2:4)*(o+l),pixelRatio:T}}}class ny extends iy{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let a,n=this.VideoSample,o=!1;s.data=null,n&&r.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:var d;if(a=!0,o)null!=(d=n)&&d.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null);n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 19:case 20:a=!0,null!=(r=n)&&r.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0,n.frame=!0;break;case 39:a=!0,sf(i.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=tu(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(a=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const s in t.params)e.params[s]=t.params[s]}this.pushParameterSet(e.sps,i.data,e.vps),n||(n=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),n.key=!0;break;case 34:if(a=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const s in t)e.params[s]=t[s]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:a=!0,e.audFound=!0,null!=(l=n)&&l.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1}if(n&&a){n.units.push(i)}})),i&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ry(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new ry(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),n=t.readUByte(),o=t.readUByte(),l=t.readUByte(),d=t.readUByte(),c=t.readUByte(),h=t.readUByte(),u=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),p=t.readUByte(),y=[],v=[];for(let H=0;H<s;H++)y.push(t.readBoolean()),v.push(t.readBoolean());if(s>0)for(let H=s;H<8;H++)t.readBits(2);for(let H=0;H<s;H++)y[H]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[H]&&t.readUByte();t.readUEG();const x=t.readUEG();3==x&&t.skipBits(1);const b=t.readUEG(),E=t.readUEG(),T=t.readBoolean();let S=0,A=0,w=0,k=0;T&&(S+=t.readUEG(),A+=t.readUEG(),w+=t.readUEG(),k+=t.readUEG());const L=t.readUEG(),R=t.readUEG(),I=t.readUEG();for(let H=t.readBoolean()?0:s;H<=s;H++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let s=0;s<(3===e?2:6);s++){if(t.readBoolean()){const s=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<s;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let D=0;for(let H=0;H<P;H++){let e=!1;if(0!==H&&(e=t.readBoolean()),e){H===P&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let s=0;s<=D;s++){const s=t.readBoolean();let i=!1;s||(i=t.readBoolean()),(s||i)&&e++}D=e}else{const e=t.readUEG(),s=t.readUEG();D=e+s;for(let i=0;i<e;i++)t.readUEG(),t.readBoolean();for(let i=0;i<s;i++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let s=0;s<e;s++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let C=0,N=1,_=1,M=!0,F=1,O=0;t.readBoolean(),t.readBoolean();let j=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(N=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],_=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(N=t.readBits(16),_=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),j=t.readBoolean(),j&&(S+=t.readUEG(),A+=t.readUEG(),w+=t.readUEG(),k+=t.readUEG());if(t.readBoolean()){F=t.readBits(32),O=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let a=0;a<=s;a++){M=t.readBoolean();let s=!1;M||t.readBoolean()?t.readEG():s=t.readBoolean();const a=s?1:t.readUEG()+1;if(e)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let B=b,U=E;if(T||j){let e=1,t=1;1===x?e=t=2:2==x&&(e=2),B=b-e*A-e*S,U=E-t*k-t*w}const $=i?["A","B","C"][i]:"",G=n<<24|o<<16|l<<8|d;let V=0;for(let H=0;H<32;H++)V=(V|(G>>H&1)<<31-H)>>>0;let K=V.toString(16);1===a&&"2"===K&&(K="6");return{codecString:`hvc1.${$}${a}.${K}.${r?"H":"L"}${p}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[n,o,l,d],general_constraint_indicator_flags:[c,h,u,f,m,g],general_level_idc:p,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:C,chroma_format_idc:x,frame_rate:{fixed:M,fps:O/F}},width:B,height:U,pixelRatio:[N,_]}}readPPS(e){const t=new ry(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let r=1;return i&&s?r=0:i?r=3:s&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const oy=188;class ly{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=ly.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),-1!==s}static syncOffset(e){const t=e.length;let s=Math.min(940,t-oy)+1,i=0;for(;i<s;){let r=!1,a=-1,n=0;for(let o=i;o<t;o+=oy){if(71!==e[o]||t-o!==oy&&71!==e[o+oy]){if(n)return-1;break}if(n++,-1===a&&(a=o,0!==a&&(s=Math.min(a+18612,e.length-oy)+1)),r||(r=0===dy(e,o)),r&&n>1&&(0===a&&n>2||o+oy>s))return a}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Mu[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ly.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=ly.createTrack("audio",i),this._id3Track=ly.createTrack("id3"),this._txtTrack=ly.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){let r;s||(this.sampleAes=null);const a=this._videoTrack,n=this._audioTrack,o=this._id3Track,l=this._txtTrack;let d=a.pid,c=a.pesData,h=n.pid,u=o.pid,f=n.pesData,m=o.pesData,g=null,p=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=Ju(this.remainderData,e)).length,this.remainderData=null),v<oy&&!i)return this.remainderData=e,{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l};const x=Math.max(0,ly.syncOffset(e));v-=(v-x)%oy,v<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let b=0;for(let T=x;T<v;T+=oy)if(71===e[T]){const t=!!(64&e[T+1]),i=dy(e,T);let v;if((48&e[T+3])>>4>1){if(v=T+5+e[T+4],v===T+oy)continue}else v=T+4;switch(i){case d:if(t){if(c&&(r=my(c,this.logger))){if(null===this.videoParser)switch(a.segmentCodec){case"avc":this.videoParser=new ay;break;case"hevc":this.videoParser=new ny}null!==this.videoParser&&this.videoParser.parsePES(a,l,r,!1)}c={data:[],size:0}}c&&(c.data.push(e.subarray(v,T+oy)),c.size+=T+oy-v);break;case h:if(t){if(f&&(r=my(f,this.logger)))switch(n.segmentCodec){case"aac":this.parseAACPES(n,r);break;case"mp3":this.parseMPEGPES(n,r);break;case"ac3":this.parseAC3PES(n,r)}f={data:[],size:0}}f&&(f.data.push(e.subarray(v,T+oy)),f.size+=T+oy-v);break;case u:t&&(m&&(r=my(m,this.logger))&&this.parseID3PES(o,r),m={data:[],size:0}),m&&(m.data.push(e.subarray(v,T+oy)),m.size+=T+oy-v);break;case 0:t&&(v+=e[v]+1),y=this._pmtId=cy(e,v);break;case y:{t&&(v+=e[v]+1);const i=hy(e,v,this.typeSupported,s,this.observer,this.logger);d=i.videoPid,d>0&&(a.pid=d,a.segmentCodec=i.segmentVideoCodec),h=i.audioPid,h>0&&(n.pid=h,n.segmentCodec=i.segmentAudioCodec),u=i.id3Pid,u>0&&(o.pid=u),null===g||p||(this.logger.warn(`MPEG-TS PMT found at ${T} after unknown PID '${g}'. Backtracking to sync byte @${x} to parse all TS packets.`),g=null,T=x-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i}}else b++;b>0&&uy(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=c,n.pesData=f,o.pesData=m;const E={audioTrack:n,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(E),E}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,a=s.pesData,n=t.pesData,o=i.pesData;let l;if(a&&(l=my(a,this.logger))){if(null===this.videoParser)switch(s.segmentCodec){case"avc":this.videoParser=new ay;break;case"hevc":this.videoParser=new ny}null!==this.videoParser&&(this.videoParser.parsePES(s,r,l,!0),s.pesData=null)}else s.pesData=a;if(n&&(l=my(n,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=n&&n.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=n;o&&(l=my(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new sy(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise((s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)})):s(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)}))}))}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r,a,n,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=Ju(i.sample.unit,o);else{const a=r-t;i.sample.unit.set(o.subarray(0,t),a),e.samples.push(i.sample),s=i.missing}}for(r=s,a=o.length;r<a-1&&!Tp(o,r);r++);if(r!==s){let e;const t=r<a-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",uy(this.observer,new Error(e),t,this.logger),!t)return}if(Ap(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)n=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=wp(e.samplerate);n=i.sample.pts+t}}let l,d=0;for(;r<a;){if(l=kp(e,o,r,n,d),r+=l.length,l.missing){this.aacOverFlow=l;break}for(d++;r<a-1&&!Tp(o,r);r++);}}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,a=0;const n=t.pts;if(void 0!==n)for(;a<i;)if(zp(s,a)){const t=Yp(e,s,a,n,r);if(!t)break;a+=t.length,r++}else a++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let a,n=0,o=0;for(;o<r&&(a=Zp(e,s,o,i,n++))>0;)o+=a}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=tu({},t,{type:this._videoTrack?Op.emsg:Op.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function dy(e,t){return((31&e[t+1])<<8)+e[t+2]}function cy(e,t){return(31&e[t+10])<<8|e[t+11]}function hy(e,t,s,i,r,a){const n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=dy(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){fy("ADTS AAC",a);break}case 15:-1===n.audioPid&&(n.audioPid=o);break;case 21:-1===n.id3Pid&&(n.id3Pid=o);break;case 219:if(!i){fy("H.264",a);break}case 27:-1===n.videoPid&&(n.videoPid=o);break;case 3:case 4:s.mpeg||s.mp3?-1===n.audioPid&&(n.audioPid=o,n.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){fy("AC-3",a);break}case 129:s.ac3?-1===n.audioPid&&(n.audioPid=o,n.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===n.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){if(106===e[i])!0!==s.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=o,n.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return uy(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),n;case 36:-1===n.videoPid&&(n.videoPid=o,n.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=l+5}return n}function uy(e,t,s,i){i.warn(`parsing error: ${t.message}`),e.emit(Kh.ERROR,Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:t,reason:t.message})}function fy(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function my(e,t){let s,i,r,a,n,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Ju(l[0],l[1]),l.splice(1,1);s=l[0];if(1===(s[0]<<16)+(s[1]<<8)+s[2]){if(i=(s[4]<<8)+s[5],i&&i>e.size-6)return null;const d=s[7];192&d&&(a=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&d?(n=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,a-n>54e5&&(t.warn(`${Math.round((a-n)/9e4)}s delta between PTS and DTS, align them`),a=n)):n=a),r=s[8];let c=r+9;if(e.size<=c)return null;e.size-=c;const h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){s=l[e];let t=s.byteLength;if(c){if(c>t){c-=t;continue}s=s.subarray(c),t-=c,c=0}h.set(s,o),o+=t}return i&&(i-=r+3),{data:h,pts:a,dts:n,len:i}}return null}class gy{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const py=Math.pow(2,32)-1;class yy{static init(){let e;for(e in yy.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},yy.types)yy.types.hasOwnProperty(e)&&(yy.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);yy.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);yy.STTS=yy.STSC=yy.STCO=r,yy.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),yy.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),yy.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),yy.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);yy.FTYP=yy.box(yy.types.ftyp,a,o,a,n),yy.DINF=yy.box(yy.types.dinf,yy.box(yy.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=255&s,a.set(e,4),i=0,s=8;i<r;i++)a.set(t[i],s),s+=t[i].byteLength;return a}static hdlr(e){return yy.box(yy.types.hdlr,yy.HDLR_TYPES[e])}static mdat(e){return yy.box(yy.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(py+1)),i=Math.floor(t%(py+1));return yy.box(yy.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return yy.box(yy.types.mdia,yy.mdhd(e.timescale||0,e.duration||0),yy.hdlr(e.type),yy.minf(e))}static mfhd(e){return yy.box(yy.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?yy.box(yy.types.minf,yy.box(yy.types.smhd,yy.SMHD),yy.DINF,yy.stbl(e)):yy.box(yy.types.minf,yy.box(yy.types.vmhd,yy.VMHD),yy.DINF,yy.stbl(e))}static moof(e,t,s){return yy.box(yy.types.moof,yy.mfhd(e),yy.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=yy.trak(e[t]);return yy.box.apply(null,[yy.types.moov,yy.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(yy.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=yy.trex(e[t]);return yy.box.apply(null,[yy.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(py+1)),i=Math.floor(t%(py+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return yy.box(yy.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return yy.box(yy.types.sdtp,s)}static stbl(e){return yy.box(yy.types.stbl,yy.stsd(e),yy.box(yy.types.stts,yy.STTS),yy.box(yy.types.stsc,yy.STSC),yy.box(yy.types.stsz,yy.STSZ),yy.box(yy.types.stco,yy.STCO))}static avc1(e){let t,s,i,r=[],a=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],i=s.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],i=s.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(s));const n=yy.box(yy.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,d=e.pixelRatio[0],c=e.pixelRatio[1];return yy.box(yy.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n,yy.box(yy.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),yy.box(yy.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return yy.box(yy.types.mp4a,yy.audioStsd(e),yy.box(yy.types.esds,yy.esds(e)))}static mp3(e){return yy.box(yy.types[".mp3"],yy.audioStsd(e))}static ac3(e){return yy.box(yy.types["ac-3"],yy.audioStsd(e),yy.box(yy.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return yy.box(yy.types.stsd,yy.STSD,yy.mp4a(e));if("ac3"===t&&e.config)return yy.box(yy.types.stsd,yy.STSD,yy.ac3(e));if("mp3"===t&&"mp3"===e.codec)return yy.box(yy.types.stsd,yy.STSD,yy.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return yy.box(yy.types.stsd,yy.STSD,yy.avc1(e));if("hevc"===t&&e.vps)return yy.box(yy.types.stsd,yy.STSD,yy.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,a=Math.floor(s/(py+1)),n=Math.floor(s%(py+1));return yy.box(yy.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const s=yy.sdtp(e),i=e.id,r=Math.floor(t/(py+1)),a=Math.floor(t%(py+1));return yy.box(yy.types.traf,yy.box(yy.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),yy.box(yy.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a])),yy.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,yy.box(yy.types.trak,yy.tkhd(e),yy.mdia(e))}static trex(e){const t=e.id;return yy.box(yy.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,a=new Uint8Array(r);let n,o,l,d,c,h;for(t+=8+r,a.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),n=0;n<i;n++)o=s[n],l=o.duration,d=o.size,c=o.flags,h=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,d>>>24&255,d>>>16&255,d>>>8&255,255&d,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*n);return yy.box(yy.types.trun,a)}static initSegment(e){yy.types||yy.init();const t=yy.moov(e);return Ju(yy.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let r=i.length;for(let u=0;u<s.length;u+=1){r+=3;for(let e=0;e<s[u].length;e+=1)r+=2+s[u][e].length}const a=new Uint8Array(r);a.set(i,0),r=i.length;const n=s.length-1;for(let u=0;u<s.length;u+=1){a.set(new Uint8Array([32+u|(u===n?128:0),0,s[u].length]),r),r+=3;for(let e=0;e<s[u].length;e+=1)a.set(new Uint8Array([s[u][e].length>>8,255&s[u][e].length]),r),r+=2,a.set(s[u][e],r),r+=s[u][e].length}const o=yy.box(yy.types.hvcC,a),l=e.width,d=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return yy.box(yy.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,yy.box(yy.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),yy.box(yy.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}}yy.types=void 0,yy.HDLR_TYPES=void 0,yy.STTS=void 0,yy.STSC=void 0,yy.STCO=void 0,yy.STSZ=void 0,yy.VMHD=void 0,yy.SMHD=void 0,yy.STSD=void 0,yy.FTYP=void 0,yy.DINF=void 0;function vy(e,t,s=1,i=!1){const r=e*t*s;return i?Math.round(r):r}function xy(e,t=!1){return vy(e,1e3,1/9e4,t)}let by,Ey=null,Ty=null;function Sy(e,t,s,i){return{duration:t,size:s,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class Ay{constructor(e,t,s,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.ISGenerated=!1,null===Ey){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ey=e?parseInt(e[1]):0}if(null===Ty){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Ty=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce(((e,i)=>{let r=i.pts,a=r-e;return a<-4294967296&&(t=!0,r=wy(r,s),a=r-e),a>0?e:r}),s);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,s,i,r,a,n,o){let l,d,c,h,u,f,m=r,g=r;const p=e.pid>-1,y=t.pid>-1,v=t.samples.length,x=e.samples.length>0,b=n&&v>0||v>1;if((!p||x)&&(!y||b)||this.ISGenerated||n){if(this.ISGenerated){var E,T,S,A;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(E=t.pixelRatio)?void 0:E[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(A=e.pixelRatio)?void 0:A[1]))||!e&&b||null===this.nextAudioPts&&x)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,r,a));const s=this.isVideoContiguous;let i,n=-1;if(b&&(n=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,n>0){this.logger.warn(`[mp4-remuxer]: Dropped ${n} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(n),t.dropped+=n,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===n&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(x&&b){const s=this.getVideoStartPts(t.samples),i=(wy(e.samples[0].pts,s)-s)/t.inputTimeScale;m+=Math.max(0,i),g+=Math.max(0,-i)}if(x){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,a)),d=this.remuxAudio(e,m,this.isAudioContiguous,a,y||b||o===Xh?g:void 0),b){const i=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,g,s,i)}}else b&&(l=this.remuxVideo(t,g,s,0));l&&(l.firstKeyFrame=n,l.independent=-1!==n,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(u=ky(s,r,this._initPTS,this._initDTS)),i.samples.length&&(h=Ly(i,r,this._initPTS))),{audio:d,video:l,initSegment:c,independent:f,text:h,id3:u}}generateIS(e,t,s,i){const r=e.samples,a=t.samples,n=this.typeSupported,o={},l=this._initPTS;let d,c,h,u=!l||i,f="audio/mp4";if(u&&(d=c=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":n.mpeg?(f="audio/mpeg",e.codec=""):n.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&n.mpeg?new Uint8Array(0):yy.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=e.inputTimeScale,l&&h===l.timescale?u=!1:d=c=r[0].pts-Math.round(h*s))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:yy.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(h=t.inputTimeScale,l&&h===l.timescale)u=!1;else{const e=this.getVideoStartPts(a),t=Math.round(h*s);c=Math.min(c,wy(a[0].dts,e)-t),d=Math.min(d,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:d,timescale:h},this._initDTS={baseTime:c,timescale:h}):d=h=void 0,{tracks:o,initPTS:d,timescale:h}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,a=e.samples,n=[],o=a.length,l=this._initPTS;let d,c,h=this.nextAvcDts,u=8,f=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=!1;if(!s||null===h){const e=t*r,i=a[0].pts-wy(a[0].dts,a[0].pts);Ey&&null!==h&&Math.abs(e-i-h)<15e3?s=!0:h=e-i}const y=l.baseTime*r/l.timescale;for(let N=0;N<o;N++){const e=a[N];e.pts=wy(e.pts-y,h),e.dts=wy(e.dts-y,h),e.dts<a[N>0?N-1:N].dts&&(p=!0)}p&&a.sort((function(e,t){const s=e.dts-t.dts,i=e.pts-t.pts;return s||i})),d=a[0].dts,c=a[a.length-1].dts;const v=c-d,x=v?Math.round(v/(o-1)):f||e.inputTimeScale/30;if(s){const s=d-h,i=s>x,r=s<-1;if((i||r)&&(i?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xy(s,!0)} ms (${s}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xy(-s,!0)} ms (${s}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||h>=a[0].pts||Ey)){d=h;const e=a[0].pts-s;if(i)a[0].dts=d,a[0].pts=e;else{let t=!0;for(let i=0;i<a.length&&!(a[i].dts>e&&t);i++){const e=a[i].pts;if(a[i].dts-=s,a[i].pts-=s,i<a.length-1){const s=a[i+1].pts;t=s<=a[i].pts==s<=e}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${xy(e,!0)}/${xy(d,!0)}, delta: ${xy(s,!0)} ms`)}}d=Math.max(0,d);let b=0,E=0,T=d;for(let N=0;N<o;N++){const e=a[N],t=e.units,s=t.length;let i=0;for(let r=0;r<s;r++)i+=t[r].data.length;E+=i,b+=s,e.length=i,e.dts<T?(e.dts=T,T+=x/4|0||1):T=e.dts,m=Math.min(e.pts,m),g=Math.max(e.pts,g)}c=a[o-1].dts;const S=E+4*b+8;let A;try{A=new Uint8Array(S)}catch(C){return void this.observer.emit(Kh.ERROR,Kh.ERROR,{type:Gh.MUX_ERROR,details:Vh.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:S,reason:`fail allocating video mdat ${S}`})}const w=new DataView(A.buffer);w.setUint32(0,S),A.set(yy.types.mdat,4);let k=!1,L=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,P=Number.NEGATIVE_INFINITY;for(let N=0;N<o;N++){const e=a[N],t=e.units;let s,l=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],s=e.data,r=e.data.byteLength;w.setUint32(u,r),u+=4,A.set(s,u),u+=r,l+=4+r}if(N<o-1)f=a[N+1].dts-e.dts,s=a[N+1].pts-e.pts;else{const t=this.config,n=N>0?e.dts-a[N-1].dts:x;if(s=N>0?e.pts-a[N-1].pts:x,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const s=Math.floor(t.maxBufferHole*r),a=(i?m+i*r:this.nextAudioPts)-e.pts;a>s?(f=a-n,f<0?f=n:k=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${a/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=n}else f=n}const d=Math.round(e.pts-e.dts);L=Math.min(L,f),I=Math.max(I,f),R=Math.min(R,s),P=Math.max(P,s),n.push(Sy(e.key,f,l,d))}if(n.length)if(Ey){if(Ey<70){const e=n[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Ty&&P-R<I-L&&x/I<.025&&0===n[0].cts){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=d;for(let t=0,s=n.length;t<s;t++){const i=e+n[t].duration,r=e+n[t].cts;if(t<s-1){const e=i+n[t+1].cts;n[t].duration=e-r}else n[t].duration=t?n[t-1].duration:x;n[t].cts=0,e=i}}f=k||!f?x:f,this.nextAvcDts=h=c+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const D={data1:yy.moof(e.sequenceNumber++,d,tu(e,{samples:n})),data2:A,startPTS:m/r,endPTS:(g+f)/r,startDTS:d/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:n.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,s,i,r){const a=e.inputTimeScale,n=a/(e.samplerate?e.samplerate:a),o=this.getSamplesPerFrame(e),l=o*n,d=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],u=void 0!==r;let f=e.samples,m=c?0:8,g=this.nextAudioPts||-1;const p=t*a,y=d.baseTime*a/d.timescale;if(this.isAudioContiguous=s=s||f.length&&g>0&&(i&&Math.abs(p-g)<9e3||Math.abs(wy(f[0].pts-y,p)-g)<20*l),f.forEach((function(e){e.pts=wy(e.pts-y,p)})),!s||g<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;g=0===r?0:i&&!u?Math.max(0,p):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,i=g;s<f.length;s++){const r=f[s],n=r.pts,o=n-i,d=Math.abs(1e3*o/a);if(o<=-t*l&&u)0===s&&(this.logger.warn(`Audio frame @ ${(n/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/a)} ms.`),this.nextAudioPts=g=i=n);else if(o>=t*l&&d<1e4&&u){let t=Math.round(o/l);i=n-t*l,i<0&&(t--,i+=l),0===s&&(this.nextAudioPts=g=i),this.logger.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/a).toFixed(3)}s due to ${Math.round(1e3*o/a)} ms gap.`);for(let a=0;a<t;a++){const t=Math.max(i,0);let a=gy.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);a||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),a=r.unit.subarray()),f.splice(s,0,{unit:a,pts:t}),i+=l,s++}}r.pts=i,i+=l}}let v,x=null,b=null,E=0,T=f.length;for(;T--;)E+=f[T].unit.byteLength;for(let P=0,D=f.length;P<D;P++){const t=f[P],i=t.unit;let r=t.pts;if(null!==b){h[P-1].duration=Math.round((r-b)/n)}else{if(s&&"aac"===e.segmentCodec&&(r=g),x=r,!(E>0))return;E+=m;try{v=new Uint8Array(E)}catch(I){return void this.observer.emit(Kh.ERROR,Kh.ERROR,{type:Gh.MUX_ERROR,details:Vh.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:E,reason:`fail allocating audio mdat ${E}`})}if(!c){new DataView(v.buffer).setUint32(0,E),v.set(yy.types.mdat,4)}}v.set(i,m);const a=i.byteLength;m+=a,h.push(Sy(!0,o,a,0)),b=r}const S=h.length;if(!S)return;const A=h[h.length-1];this.nextAudioPts=g=b+n*A.duration;const w=c?new Uint8Array(0):yy.moof(e.sequenceNumber++,x/n,tu({},e,{samples:h}));e.samples=[];const k=x/a,L=g/a,R={data1:w,data2:v,startPTS:k,endPTS:L,startDTS:k,endDTS:L,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,R}}function wy(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function ky(e,t,s,i){const r=e.samples.length;if(!r)return;const a=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=wy(r.pts-s.baseTime*a/s.timescale,t*a)/a,r.dts=wy(r.dts-i.baseTime*a/i.timescale,t*a)/a}const n=e.samples;return e.samples=[],{samples:n}}function Ly(e,t,s){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let n=0;n<i;n++){const i=e.samples[n];i.pts=wy(i.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const a=e.samples;return e.samples=[],{samples:a}}function Ry(e,t){const s=null==e?void 0:e.codec;if(s&&s.length>4)return s;if(t===wu){if("ec-3"===s||"ac-3"===s||"alac"===s)return s;if("fLaC"===s||"Opus"===s){return yf(s,!1)}return cu.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"}return cu.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1"}try{by=self.performance.now.bind(self.performance)}catch(Yb){by=Date.now}const Iy=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=jp("video",1),a=this.audioTrack=jp("audio",1),n=this.txtTrack=jp("text",1);if(this.id3Track=jp("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Ku(e);if(o.video){const{id:e,timescale:t,codec:s,supplemental:i}=o.video;r.id=e,r.timescale=n.timescale=t,r.codec=s,r.supplemental=i}if(o.audio){const{id:e,timescale:t,codec:s}=o.audio;a.id=e,a.timescale=t,a.codec=s}n.id=Mu.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let s=0;s<t;){const i=ju(e,s);if(i>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=i>1?s+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Ju(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},s=Gu(e,["moof"]);if(s.length<2)return t.remainder=e,t;const i=s[s.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(s);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=s;const a=this.extractID3Track(i,t);return r.samples=Zu(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=Zu(e,t),{videoTrack:t,audioTrack:jp(),id3Track:i,textTrack:jp()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=Gu(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function(e){const t=e[0];let s="",i="",r=0,a=0,n=0,o=0,l=0,d=0;if(0===t){for(;"\0"!==Fu(e.subarray(d,d+1));)s+=Fu(e.subarray(d,d+1)),d+=1;for(s+=Fu(e.subarray(d,d+1)),d+=1;"\0"!==Fu(e.subarray(d,d+1));)i+=Fu(e.subarray(d,d+1)),d+=1;i+=Fu(e.subarray(d,d+1)),d+=1,r=ju(e,12),a=ju(e,16),o=ju(e,20),l=ju(e,24),d=28}else if(1===t){d+=4,r=ju(e,d),d+=4;const t=ju(e,d);d+=4;const a=ju(e,d);for(d+=4,n=2**32*t+a,Uh(n)||(n=Number.MAX_SAFE_INTEGER,cu.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ju(e,d),d+=4,l=ju(e,d),d+=4;"\0"!==Fu(e.subarray(d,d+1));)s+=Fu(e.subarray(d,d+1)),d+=1;for(s+=Fu(e.subarray(d,d+1)),d+=1;"\0"!==Fu(e.subarray(d,d+1));)i+=Fu(e.subarray(d,d+1)),d+=1;i+=Fu(e.subarray(d,d+1)),d+=1}return{schemeIdUri:s,value:i,timeScale:r,presentationTime:n,presentationTimeDelta:a,eventDuration:o,id:l,payload:e.subarray(d,e.byteLength)}}(e);if(ey.test(i.schemeIdUri)){const e=ty(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const a=i.payload;s.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:Op.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=ty(i,t);s.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:Op.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class{constructor(e,t,s,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(function(e,t){if(!e||!t)return e;const s=t.keyId;s&&t.isCommonEncryption&&Gu(e,["moov","trak"]).forEach((e=>{const t=Gu(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=Gu(t,["enca"]);const r=i.length>0;r||(i=Gu(t,["encv"])),i.forEach((e=>{Gu(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=Xu(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(cu.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${mu(e)} -> ${mu(s)}`),t.set(s,8))}}))}))}));return e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=Ku(e);i.audio&&(t=Ry(i.audio,wu)),i.video&&(s=Ry(i.video,ku));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,i,r,a){var n,o;let{initPTS:l,lastEndTime:d}=this;const c={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};Bh(d)||(d=this.lastEndTime=r||0);const h=t.samples;if(null==h||!h.length)return c;const u={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(n=f)&&n.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);const m=function(e,t){let s=0,i=0,r=0;const a=Gu(e,["moof","traf"]);for(let n=0;n<a.length;n++){const e=a[n],o=Gu(e,["tfhd"])[0],l=t[ju(o,4)];if(!l)continue;const d=l.default,c=ju(o,0)|(null==d?void 0:d.flags);let h=null==d?void 0:d.duration;8&c&&(h=ju(o,2&c?12:8));const u=l.timescale||9e4,f=Gu(e,["trun"]);for(let t=0;t<f.length;t++)s=Qu(f[t]),!s&&h&&(s=h*ju(f[t],4)),l.type===ku?i+=s/u:l.type===wu&&(r+=s/u)}if(0===i&&0===r){let t=1/0,s=0,i=0;const r=Gu(e,["sidx"]);for(let e=0;e<r.length;e++){const a=Vu(r[e]);if(null!=a&&a.references){t=Math.min(t,a.earliestPresentationTime/a.timescale);const e=a.references.reduce(((e,t)=>e+t.info.duration||0),0);s=Math.max(s,e+a.earliestPresentationTime/a.timescale),i=s-t}}if(i&&Bh(i))return i}return i||r}(h,f),g=function(e,t){return Gu(t,["moof","traf"]).reduce(((t,s)=>{const i=Gu(s,["tfdt"])[0],r=i[0],a=Gu(s,["tfhd"]).reduce(((t,s)=>{const a=ju(s,4),n=e[a];if(n){let e=ju(i,4);if(1===r){if(e===Nu)return cu.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=Nu+1,e+=ju(i,8)}const s=e/(n.timescale||9e4);if(Bh(s)&&(null===t||s<t))return s}return t}),null);return null!==a&&Bh(a)&&(null===t||a<t)?a:t}),null)}(f,h),p=null===g?r:g;!a&&l||!function(e,t,s,i){if(null===e)return!0;const r=Math.max(i,1),a=t-e.baseTime/e.timescale;return Math.abs(a-s)>r}(l,p,r,m)&&u.timescale===l.timescale||(u.initPTS=p-r,l&&1===l.timescale&&this.logger.warn(`Adjusting initPTS @${r} from ${l.baseTime/l.timescale} to ${u.initPTS}`),this.initPTS=l={baseTime:u.initPTS,timescale:1});const y=e?p-l.baseTime/l.timescale:d,v=y+m;!function(e,t,s){Gu(t,["moof","traf"]).forEach((t=>{Gu(t,["tfhd"]).forEach((i=>{const r=ju(i,4),a=e[r];if(!a)return;const n=a.timescale||9e4;Gu(t,["tfdt"]).forEach((e=>{const t=e[0],i=s*n;if(i){let s=ju(e,4);if(0===t)s-=i,s=Math.max(s,0),$u(e,4,s);else{s*=Math.pow(2,32),s+=ju(e,8),s-=i,s=Math.max(s,0);const t=Math.floor(s/(Nu+1)),r=Math.floor(s%(Nu+1));$u(e,4,t),$u(e,8,r)}}}))}))}))}(f,h,l.baseTime/l.timescale),m>0?this.lastEndTime=v:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!f.audio,b=!!f.video;let E="";x&&(E+="audio"),b&&(E+="video");const T={data1:h,startPTS:y,startDTS:y,endPTS:v,endDTS:v,type:E,hasAudio:x,hasVideo:b,nb:1,dropped:0};return c.audio="audio"===T.type?T:void 0,c.video="audio"!==T.type?T:void 0,c.initSegment=u,c.id3=ky(s,r,l,l),i.samples.length&&(c.text=Ly(i,r,l)),c}}},{demux:ly,remux:Ay},{demux:class extends Bp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=vp(e,0);let i=(null==s?void 0:s.length)||0;if(Xp(e,i))return!1;for(let r=e.length;i<r;i++)if(Sp(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&xp(e,t)&&Ep(e,t)<=e.length-t}(e,t)}appendFrame(e,t,s){Ap(e,this.observer,t,s,e.manifestCodec);const i=kp(e,t,s,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:Ay},{demux:class extends Bp{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=vp(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==Fp(t)&&Qp(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(Xp(e,s))return cu.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return qp(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,s){if(null!==this.basePTS)return Yp(e,t,s,this.basePTS,this.frameIndex)}},remux:Ay}];Iy.splice(2,0,{demux:Jp,remux:Ay});class Py{constructor(e,t,s,i,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=by();let a=new Uint8Array(e);const{currentTransmuxState:n,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:d,trackSwitch:c,accurateTimeOffset:h,timeOffset:u,initSegmentChange:f}=i||n,{audioCodec:m,videoCodec:g,defaultInitPts:p,duration:y,initSegmentData:v}=o,x=function(e,t){let s=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t);return s}(a,t);if(x&&Km(x.method)){const e=this.getDecrypter(),t=Hm(x.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(a,x.key.buffer,x.iv.buffer,t).then((e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t})),this.decryptionPromise;{let i=e.softwareDecrypt(a,x.key.buffer,x.iv.buffer,t);if(s.part>-1){const t=e.flush();i=t?t.buffer:t}if(!i)return r.executeEnd=by(),Dy(s);a=new Uint8Array(i)}}const b=this.needsProbing(d,c);if(b){const e=this.configureTransmuxer(a);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(Kh.ERROR,Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=by(),Dy(s)}(d||c||f||b)&&this.resetInitSegment(v,m,g,y,t),(d||f||b)&&this.resetInitialTimestamp(p),l||this.resetContiguity();const E=this.transmux(a,x,u,h,s);this.asyncResult=Cy(E);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,r.executeEnd=by(),E}flush(e){const t=e.transmuxing;t.executeStart=by();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then((()=>this.flush(e)));const a=[],{timeOffset:n}=i;if(s){const t=s.flush();t&&a.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=by();const s=[Dy(e)];return this.asyncResult?Promise.resolve(s):s}const d=o.flush(n);return Cy(d)?(this.asyncResult=!0,d.then((t=>(this.flushRemux(a,t,e),a)))):(this.flushRemux(a,d,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:n}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===zh?"level":"track"} ${s.level}`);const d=this.remuxer.remux(i,r,a,n,l,o,!0,this.id);e.push({remuxResult:d,chunkMeta:s}),s.transmuxing.executeEnd=by()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:a,remuxer:n}=this;a&&n&&(a.resetInitSegment(e,t,s,i),n.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,i,r):this.transmuxUnencrypted(e,s,i,r),a}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:a,id3Track:n,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,n,o,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,i,!1,this.id),chunkMeta:r})))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let c=0,h=Iy.length;c<h;c++){var a;if(null!=(a=Iy[c].demux)&&a.probe(e,this.logger)){r=Iy[c];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const n=this.demuxer,o=this.remuxer,l=r.remux,d=r.demux;o&&o instanceof l||(this.remuxer=new l(s,t,i,this.logger)),n&&n instanceof d||(this.demuxer=new d(s,t,i,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Sm(this.config)),e}}const Dy=e=>({remuxResult:{},chunkMeta:e});function Cy(e){return"then"in e&&e.then instanceof Function}class Ny{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class _y{constructor(e,t,s,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}let My=0;class Fy{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=My++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,s=this.hls;if(s&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,s.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const a=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===Kh.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new up,this.observer.on(Kh.FRAG_DECRYPTED,a),this.observer.on(Kh.ERROR,a);const n=bf(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const s=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(s.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function(e){const t=mp[e];if(t)return t.clientCount++,t;const s=new self.URL(e,self.location.href).href,i={worker:new self.Worker(s),scriptURL:s,clientCount:1};return mp[e]=i,i}(r.workerPath)):(s.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=mp[fp];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(t),i={worker:new self.Worker(s),objectURL:s,clientCount:1};return mp[fp]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:n,id:t,config:Of(r)})}catch(Yb){s.warn(`Error setting up "${t}" Web Worker, fallback to inline`,Yb),this.terminateWorker(),this.error=null,this.transmuxer=new Py(this.observer,n,r,"",t,e.logger)}return}}this.transmuxer=new Py(this.observer,n,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=My++;const t=this.hls.config,s=bf(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Of(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=mp[e||fp];if(t&&1==t.clientCount--){const{worker:s,objectURL:i}=t;delete mp[e||fp],i&&self.URL.revokeObjectURL(i),s.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,a,n,o,l,d){var c,h;l.transmuxing.start=self.performance.now();const{instanceNo:u,transmuxer:f}=this,m=a?a.start:r.start,g=r.decryptdata,p=this.frag,y=!(p&&r.cc===p.cc),v=!(p&&l.level===p.level),x=p?l.sn-p.sn:-1,b=this.part?l.part-this.part.index:-1,E=0===x&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),T=!v&&(1===x||0===x&&(1===b||E&&b<=0)),S=self.performance.now();(v||x||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!a||!b&&T||(a.stats.parsing.start=S);const A=!(p&&(null==(c=r.initSegment)?void 0:c.url)===(null==(h=p.initSegment)?void 0:h.url)),w=new _y(y,T,o,v,m,A);if(!T||y||A){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===zh?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${y}\n        trackSwitch: ${v}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${m}\n        initSegmentChange: ${A}`);const e=new Ny(s,i,t,n,d);this.configureTransmuxer(e)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:u,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,g,l,w);Cy(t)?t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const t=s.flush(e);Cy(t)?t.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(t,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Oy extends ru{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=null==t?void 0:t.renditionReports;if(i){let a=-1;for(let s=0;s<i.length;s++){const n=i[s];let o;try{o=new self.URL(n.URI,t.url).href}catch(r){this.warn(`Could not construct new URL for Rendition Report: ${r}`),o=n.URI||""}if(o===e){a=s;break}o===e.substring(0,o.length)&&(a=s)}if(-1!==a){const e=i[a],r=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let n=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);n>=0&&e>t.partTarget&&(n+=1)}const o=s&&Cf(s);return new Nf(r,n>=0?n:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,a=self.performance.now(),n=r.loading.first?Math.max(0,a-r.loading.first):0;i.advancedDateTime=Date.now()-n;const o=this.hls.config.timelineOffset;if(o!==i.appliedTimelineOffset){const e=Math.max(o||0,0);i.appliedTimelineOffset=e,i.fragments.forEach((t=>{t.start=t.playlistOffset+e}))}if(i.live||null!=s&&s.live){const o="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){Ng(s,i);const e=i.playlistParsingError;if(e){this.warn(e);const s=this.hls;if(!s.config.ignorePlaylistParsingErrors){var l;const{networkDetails:a}=t;return void s.trigger(Kh.ERROR,{type:Gh.NETWORK_ERROR,details:Vh.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=i.fragments[0])?void 0:l.type,networkDetails:a,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const d=this.hls.mainForwardBufferInfo,c=d?d.end-d.len:0,h=Og(i,1e3*(i.edge-c));if(i.requestScheduled+h<a?i.requestScheduled=a:i.requestScheduled+=h,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let u,f,m;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,n=i.endSN,l=i.lastPartIndex,d=r===n;-1!==l?d?(f=n+1,m=e?0:l):(f=r,m=e?l+1:i.maxPartIndex):f=n+1;const c=i.age,h=c+i.ageHeader;let g=Math.min(h-i.partTarget,1.5*i.targetduration);if(g>0){if(h>3*i.targetduration)this.log(`Playlist last advanced ${c.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,m=void 0;else if(null!=s&&s.tuneInGoal&&h-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${g} with playlist age: ${i.age}`),g=0;else{const e=Math.floor(g/i.targetduration);if(f+=e,void 0!==m){m+=Math.round(g%i.targetduration/i.partTarget)}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${c.toFixed(2)}s goal: ${g} skip sn ${e} to part ${m}`)}i.tuneInGoal=g}if(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m),e||!d)return i.requestScheduled=a,void this.loadingPlaylist(o,u)}else(i.canBlockReload||i.canSkipUntil)&&(u=this.getDeliveryDirectives(i,t.deliveryDirectives,f,m));u&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(h-2*n,h/2)),this.scheduleLoading(o,u,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),a=i.requestScheduled;if(r>=a)return void this.loadingPlaylist(e,t);const n=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(n)} ms`),this.clearTimer(),this.timer=self.setTimeout((()=>this.loadingPlaylist(e,t)),n)}getDeliveryDirectives(e,t,s,i){let r=Cf(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=If),new Nf(s,i,r)}checkRetry(e){const t=e.details,s=Qf(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:n}=i||{},o=!!i&&!!n&&(r===am||!i.resolved&&r===im);if(o){var l;if(a>=n.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${n.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Zf(n,a);this.clearTimer(),this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${a+1}/${n.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}function jy(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!By(e[s].attrs,t[s].attrs))return!1;return!0}function By(e,t,s){const i=e["STABLE-RENDITION-ID"];return i&&!s?i===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((s=>e[s]!==t[s]))}function Uy(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class $y{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1!==i.length||s||this.executeNext(t)}appendBlocker(e){return new Promise((t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)}))}prependBlocker(e){return new Promise((t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}}))}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((e=>{var t;const s=null==(t=e[0])?void 0:t.label;"async-blocker"!==s&&"async-blocker-prepend"!==s||(e[0].execute(),e.splice(0,1))}))}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){var s;if(r.onError(i),null===this.queues||null===this.tracks)return;const t=null==(s=this.tracks[e])?void 0:s.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,s;return null!=(t=this.queues)&&t[e]||null!=(s=this.tracks)&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=null==(t=this.tracks)?void 0:t[e],i=null==s?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map((e=>e.label)).join(", "))||""}}const Gy=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Vy="HlsJsTrackRemovedError";class Ky extends Error{constructor(e){super(e),this.name=Vy}}function Hy(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}function Yy(e){return"audio"===e?1:0}class Wy{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Kh.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Kh.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Kh.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Kh.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Bh(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter(((t,s)=>this.isLevelAllowed(t)&&s<=e));return this.clientRect=null,Wy.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,s){if(null==e||!e.length)return-1;let i=e.length-1;const r=Math.max(t,s);for(let o=0;o<e.length;o+=1){const t=e[o];if((t.width>=r||t.height>=r)&&(a=t,!(n=e[o+1])||a.width!==n.width||a.height!==n.height)){i=o;break}}var a,n;return i}}const qy={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},zy={HLS:"h"},Xy="CMCD-Object",Qy="CMCD-Request",Jy="CMCD-Session",Zy="CMCD-Status",ev={[Xy]:["br","d","ot","tb"],[Qy]:["bl","dl","mtp","nor","nrr","su"],[Jy]:["cid","pr","sf","sid","st","v"],[Zy]:["bs","rtp"]};class tv{constructor(e,t){Array.isArray(e)&&(e=e.map((e=>e instanceof tv?e:new tv(e)))),this.value=e,this.params=t}}function sv(e,t,s,i){return new Error(`failed to ${e} "${r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"==typeof r?JSON.stringify(r):String(r)}" as ${s}`,{cause:i});var r}function iv(e,t,s){return sv("serialize",e,t,s)}class rv{constructor(e){this.description=e}}const av="Bare Item";function nv(e){if(!1===ArrayBuffer.isView(e))throw iv(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function ov(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw iv(e,"Integer");return e.toString()}function lv(e){const t=Rp(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw iv(e,"Decimal");const s=t.toString();return s.includes(".")?s:`${s}.0`}const dv=/[\x00-\x1f\x7f]+/;function cv(e){const t=(s=e).description||s.toString().slice(7,-1);var s;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw iv(t,"Token");return t}function hv(e){switch(typeof e){case"number":if(!Bh(e))throw iv(e,av);return Number.isInteger(e)?ov(e):lv(e);case"string":return function(e){if(dv.test(e))throw iv(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return cv(e);case"boolean":return function(e){if("boolean"!=typeof e)throw iv(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${ov(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return nv(e);if(e instanceof rv)return cv(e);default:throw iv(e,av)}}function uv(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw iv(e,"Key");return e}function fv(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${uv(e)}`:`;${uv(e)}=${hv(t)}`)).join("")}function mv(e){return e instanceof tv?`${hv(e.value)}${fv(e.params)}`:hv(e)}function gv(e,t={whitespace:!0}){if("object"!=typeof e)throw iv(e,"Dict");const s=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(s).map((([e,t])=>{t instanceof tv==!1&&(t=new tv(t));let s=uv(e);var i;return!0===t.value?s+=fv(t.params):(s+="=",Array.isArray(t.value)?s+=`(${(i=t).value.map(mv).join(" ")})${fv(i.params)}`:s+=mv(t)),s})).join(`,${i}`)}const pv=e=>Math.round(e),yv=e=>100*pv(e/100),vv={br:pv,d:pv,bl:yv,dl:yv,mtp:yv,nor:(e,t)=>((null==t?void 0:t.baseUrl)&&(e=function(e,t){const s=new URL(e),i=new URL(t);if(s.origin!==i.origin)return e;const r=s.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:yv,tb:pv};function xv(e,t){const s={};if(null==e||"object"!=typeof e)return s;const i=Object.keys(e).sort(),r=tu({},vv,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return i.forEach((i=>{if(null==a?void 0:a(i))return;let n=e[i];const o=r[i];o&&(n=o(n,t)),"v"===i&&1===n||"pr"==i&&1===n||function(e){return"number"==typeof e?Bh(e):null!=e&&""!==e&&!1!==e}(n)&&(function(e){return"ot"===e||"sf"===e||"st"===e}(i)&&"string"==typeof n&&(n=new rv(n)),s[i]=n)})),s}function bv(e,t={}){return e?function(e,t){return gv(e,t)}(xv(e,t),tu({whitespace:!1},t)):""}function Ev(e,t,s){return tu(e,function(e,t={}){const s={};if(!e)return s;const i=Object.entries(e),r=Object.entries(ev).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),a=i.reduce(((e,t)=>{var s,i;const[a,n]=t,o=(null===(s=r.find((e=>e[1].includes(a))))||void 0===s?void 0:s[0])||Qy;return null!==(i=e[o])&&void 0!==i||(e[o]={}),e[o][a]=n,e}),{});return Object.entries(a).reduce(((e,[s,i])=>(e[s]=bv(i,t),e)),s)}(t,s))}const Tv=/CMCD=[^&#]+/;function Sv(e,t,s){const i=function(e,t={}){if(!e)return"";const s=bv(e,t);return`CMCD=${encodeURIComponent(s)}`}(t,s);if(!i)return e;if(Tv.test(e))return e.replace(Tv,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}function Av(e,t,s,i){e&&Object.keys(t).forEach((r=>{const a=e.filter((e=>e.groupId===r)).map((e=>{const a=tu({},e);return a.details=void 0,a.attrs=new Um(a.attrs),a.url=a.attrs.URI=wv(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a}));e.push(...a)}))}function wv(e,t,s,i){const{HOST:r,PARAMS:a,[s]:n}=i;let o;t&&(o=null==n?void 0:n[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),a&&Object.keys(a).sort().forEach((e=>{e&&l.searchParams.set(e,a[e])})),l.href}class kv extends ru{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=kv.CDMCleanupPromise?[kv.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:t,initData:s}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=lg(this.config));const t=e.map(og).filter((e=>!!e));this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then((r=>{const a=tg(r);let n,o;if("sinf"===t){if(a!==Xm.FAIRPLAY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${a}`);const r=Fu(new Uint8Array(s));try{const e=Xu(Ym(JSON.parse(r).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");n=new Uint8Array(e.subarray(8,24)),o=Xm.FAIRPLAY}catch(u){return void this.warn(`${i} Failed to parse sinf: ${u}`)}}else{if(a!==Xm.WIDEVINE&&a!==Xm.PLAYREADY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${a}`);const r=function(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let i=0;for(;i+32<s;){const s=nf(new DataView(e,i));t.push(s),i+=s.size}}return t}(s),l=r.filter((e=>!!e.systemId&&ng(e.systemId)===a));l.length>1&&this.warn(`${i} Using first of ${l.length} pssh found for selected key-system ${a}`);const d=l[0];if(!d)return void(0===r.length||r.some((e=>!e.systemId))?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${r.map((e=>ng(e.systemId))).join(",")} pssh data in favor of playlist keys`));if(o=ng(d.systemId),0===d.version&&d.data)if(o===Xm.WIDEVINE){const e=d.data.length-22;n=new Uint8Array(d.data.subarray(e,e+16))}else o===Xm.PLAYREADY&&(n=hg(d.data))}if(!o||!n)return;const l=mu(n),{keyIdToKeySessionPromise:d,mediaKeySessions:c}=this;let h=d[l];for(let e=0;e<c.length;e++){const i=c[e],r=i.decryptdata;if(!r.keyId)continue;const a=mu(r.keyId);if(l===a||-1!==r.uri.replace(/-/g,"").indexOf(l)){if(h=d[a],r.pssh)break;delete d[a],r.pssh=new Uint8Array(s),r.keyId=n,h=d[l]=h.then((()=>this.generateRequestWithPreferredKeySession(i,t,s,"encrypted-event-key-match"))),h.catch((e=>this.handleError(e)));break}}if(!h){if(o!==a)return void this.log(`Ignoring "${e.type}" event with ${o} init data for selected key-system ${a}`);h=d[l]=this.getKeySystemSelectionPromise([o]).then((({keySystem:e,mediaKeys:i})=>{var r;this.throwIfDestroyed();const a=new fg("ISO-23001-7",l,null!=(r=og(e))?r:"");return a.pssh=new Uint8Array(s),a.keyId=n,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:a,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(r,t,s,"encrypted-event-no-match")}))})),h.catch((e=>this.handleError(e)))}}))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Kh.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Kh.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Kh.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Kh.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t[e];return i?i.licenseUrl:e===Xm.WIDEVINE&&s?s:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(e,t,s)=>!!e&&s.indexOf(e)===t,i=t.map((e=>e.audioCodec)).filter(s),r=t.map((e=>e.videoCodec)).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise(((t,s)=>{const a=e=>{const n=e.shift();this.getMediaKeysPromise(n,i,r).then((e=>t({keySystem:n,mediaKeys:e}))).catch((t=>{e.length?a(e):s(t instanceof Lv?t:new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};a(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!=typeof s){let e=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===dg&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return s(e,t)}getMediaKeysPromise(e,t,s){const i=function(e,t,s,i){let r;switch(e){case Xm.FAIRPLAY:r=["cenc","sinf"];break;case Xm.WIDEVINE:case Xm.PLAYREADY:r=["cenc"];break;case Xm.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,s,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs=${e}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}))),videoCapabilities:s.map((e=>({contentType:`video/mp4; codecs=${e}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null})))}]}(r,t,s,i)}(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let a=null==r?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Of(i)}`),a=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),a.then((s=>{this.log(`Access for key-system "${s.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=s.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((s=>s?this.setMediaKeysServerCertificate(t,e,s):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return a.then((()=>r.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${mu(e.keyId||[])}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return mu(e.keyId)}updateKeySession(e,t){var s;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${mu((null==(s=e.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,s)=>{const i=lg(this.config),r=e.map(tg).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({keySystem:e})=>{const i=og(e);i?t(i):s(new Error(`Unable to find format for key-system "${e}"`))})).catch(s)}))}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[s];if(!r){r=this.getKeySystemForKeyPromise(t).then((({keySystem:s,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(s,r).then((()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:s,mediaKeys:r,decryptdata:t})))))));(this.keyIdToKeySessionPromise[s]=r.then((e=>{const s=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",s,"playlist-key")}))).catch((e=>this.handleError(e)))}return r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Lv?this.hls.trigger(Kh.ERROR,e.data):this.hls.trigger(Kh.ERROR,{type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=tg(e.keyFormat),s=t?[t]:lg(this.config);return this.attemptKeySystemAccess(s)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=lg(this.config)),0===e.length)throw new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Of({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===s.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,s,i){var r,a;const n=null==(r=this.config.drmSystems)||null==(a=r[e.keySystem])?void 0:a.generateRequest;if(n)try{const i=n.call(this.hls,t,s,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,s=i.initData?i.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(f){var o;if(this.warn(f.message),null!=(o=this.hls)&&o.config.debug)throw f}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${s?s.byteLength:null})`);const d=new up,c=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void d.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${s.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch((e=>{d.eventNames().length?d.emit("error",e):this.handleError(e)})):"license-release"===i?e.keySystem===Xm.FAIRPLAY&&(this.updateKeySession(e,Wm("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},h=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const s=e.keyStatus;d.emit("keyStatus",s),"expired"===s&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",c),e.mediaKeysSession.addEventListener("keystatuseschange",h);const u=new Promise(((e,t)=>{d.on("error",t),d.on("keyStatus",(s=>{s.startsWith("usable")?e():"output-restricted"===s?t(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===s?t(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${s}"`)):"expired"===s?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${s}"`)}))}));return e.mediaKeysSession.generateRequest(t,s).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>u)).catch((t=>{throw d.removeAllListeners(),this.removeSession(e),t})).then((()=>(d.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,s)=>{if("string"==typeof s&&"object"==typeof t){const e=s;s=t,t=e}this.log(`key status change "${t}" for keyStatuses keyId: ${mu("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${mu(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,s=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((r,a)=>{const n={responseType:"arraybuffer",url:i},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(e,t,s,i)=>{r(e.data)},onError:(t,s,r,o)=>{a(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:iu({url:n.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,s,r)=>{a(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:n.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,s)=>{a(new Error("aborted"))}};s.load(n,l,d)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise(((i,r)=>{e.setServerCertificate(s).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${t}"`),i(e)})).catch((e=>{r(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,i=r.length;s<i;s++){var a,n;t=r[s];const i=null==(a=t.querySelector("name"))?void 0:a.textContent,o=null==(n=t.querySelector("value"))?void 0:n.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Wm(atob(l))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)})).catch((a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)})).then((s=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:s||i}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise(((i,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===n.readyState)if(200===n.status){this._requestLicenseFailureCount=0;let t=n.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,n,a,e)}catch(o){this.error(o)}i(t)}else{const o=s.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||n.status>=400&&n.status<500)r(new Lv({type:Gh.KEY_SYSTEM_ERROR,details:Vh.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:a,data:void 0,code:n.status,text:n.statusText}},`License Request XHR failed (${a}). Status: ${n.status} (${n.statusText})`));else{const s=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${s} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=n,this.setupLicenseXHR(n,a,e,t).then((({xhr:t,licenseChallenge:s})=>{e.keySystem==Xm.PLAYREADY&&(s=this.unpackPlayReadyKeyMessage(t,s)),t.send(s)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const s=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},fg.clearKeyUriToKeyIdMap();const i=s.length;kv.CDMCleanupPromise=Promise.all(s.map((e=>this.removeSession(e))).concat(null==e||null==(t=e.setMediaKeys(null))?void 0:t.catch((e=>{var t;this.log(`Could not clear media keys: ${e}`),null==(t=this.hls)||t.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),s.length=0)})).catch((e=>{var t;this.log(`Could not close sessions and clear media keys: ${e}`),null==(t=this.hls)||t.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:r}=this.config,a=function(e){var t;return"persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some((e=>"persistent-license"===e)))}(r)?new Promise(((e,s)=>{self.setTimeout((()=>s(new Error("MediaKeySession.remove() timeout"))),8e3),t.remove().then(e)})):Promise.resolve();return a.catch((e=>{var t;this.log(`Could not remove session: ${e}`),null==(t=this.hls)||t.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})})).then((()=>t.close())).catch((e=>{var t;this.log(`Could not close session: ${e}`),null==(t=this.hls)||t.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})}))}}}kv.CDMCleanupPromise=void 0;class Lv extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Rv(e,t){let s;try{s=new Event("addtrack")}catch(Yb){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function Iv(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(Yb){cu.debug(`[texttrack-utils]: ${Yb}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(i){cu.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===s&&(e.mode=s)}function Pv(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===s&&(e.mode=s)}function Dv(e,t,s,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,s){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let i,r=0,a=s;for(;r<=a;)if(i=Math.floor((a+r)/2),t<e[i].startTime)a=i-1;else{if(!(t>e[i].startTime&&r<s))return i;r=i+1}return e[r].startTime-t<t-e[a].startTime?r:a}(e,t);if(r>-1)for(let a=r,n=e.length;a<n;a++){const r=e[a];if(r.startTime>=t&&r.endTime<=s)i.push(r);else if(r.startTime>s)return i}return i}(e.cues,t,s);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function Cv(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[s])}return t}function Nv(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()}const _v=.025;let Mv=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function Fv(e,t,s){return`${e.identifier}-${s+1}-${Nv(t)}`}class Ov{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;if(e<=0||isNaN(t))return!1;return this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return jv(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-jv(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Bh(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return jv(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<_v))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?Mv.Range:Mv.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function jv(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<_v)?t.start:t.start+t.duration}function Bv(e,t,s){const i=new self.URL(e,s);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function Uv(e){const t=e.timelineStart,s=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+s).toFixed(2)}]`}class $v{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const e=this.interstitial.playoutLimit,t=this.currentTime;this.startOffset+t>=e&&this.hls.trigger(Kh.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;let a=i.uri;try{a=Bv(a,r.sessionId).href}catch(o){}r.loadSource(a);const n=()=>{this.hasDetails=!0};r.once(Kh.LEVEL_LOADED,n),r.once(Kh.AUDIO_TRACK_LOADED,n),r.once(Kh.SUBTITLE_TRACK_LOADED,n),r.on(Kh.MEDIA_ATTACHING,((e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&t.addEventListener("timeupdate",this.checkPlayout)}))}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const s=this.timelineOffset,i=Cm.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Cm.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,s){this.hls.on(e,t)}once(e,t,s){this.hls.once(e,t)}off(e,t,s){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${Uv(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${null!=(t=this.interstitial)&&t.appendInPlace?"append-in-place":""}`}}class Gv extends ru{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((e=>e.reset())),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce(((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s),0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(void 0===t&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&null!=(r=i[s])&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const e=s[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if((null==(s=t[i].event)?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const e=s[r];if(!e.error){const s=e.timelineStart;if(t===s||t>s&&t<s+(e.duration||0))return r}}return 0}get assetIdAtEnd(){var e,t;const s=null==(e=this.items)||null==(t=e[this.length-1])?void 0:t.event;if(s){const e=s.assetList,t=e[e.length-1];if(t)return t.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,a=this.parseDateRanges(i,{url:s.url},t),n=Object.keys(i),o=r?r.filter((e=>!n.includes(e.identifier))):[];a.length&&a.sort(((e,t)=>{const s=e.cue.pre,i=e.cue.post,r=t.cue.pre,a=t.cue.post;if(s&&!r)return-1;if(r&&!s)return 1;if(i&&!a)return 1;if(a&&!i)return-1;if(!(s||r||i||a)){const s=e.startTime,i=t.startTime;if(s!==i)return s-i}return e.dateRange.tagOrder-t.dateRange.tagOrder})),this.events=a,o.forEach((e=>{this.removeEvent(e)})),this.updateSchedule(e,o)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,r=this.parseSchedule(s,e);(t.length||(null==i?void 0:i.length)!==r.length||r.some(((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005)))&&(this.items=r,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const n=r[a],o=e[n];if(o.isInterstitial){let e=this.eventMap[n];e?e.setDateRange(o):(e=new Ov(o,t),this.eventMap[n]=e,!1===s&&(e.appendInPlace=s)),i.push(e)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let a=0;if((e=e.filter((e=>!(e.error||e.cue.once&&e.hasPlayed)))).length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach(((t,n)=>{const l=t.cue.pre,d=t.cue.post,c=e[n-1]||null,h=t.appendInPlace,u=d?r:t.startOffset,f=t.duration,m=t.timelineOccupancy===Mv.Range?f:0,g=t.resumptionOffset,p=(null==c?void 0:c.startTime)===u,y=u+t.cumulativeDuration;let v=h?y+f:u+g;if(l||!d&&u<=0){const e=o;o+=m,t.timelineStart=y;const i=a;a+=f,s.push({event:t,start:y,end:v,playout:{start:i,end:a},integrated:{start:e,end:o}})}else{if(!(u<=r))return;{if(!p){const r=u-i;if(r>.033){const l=i,d=o;o+=r;const c=a;a+=r;const h={previousEvent:e[n-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:c,end:a},integrated:{start:d,end:o}};s.push(h)}else r>0&&c&&(c.cumulativeDuration+=r,s[s.length-1].end=u)}d&&(v=y),t.timelineStart=y;const r=o;o+=m;const l=a;a+=f,s.push({event:t,start:y,end:v,playout:{start:l,end:a},integrated:{start:r,end:o}})}}const x=t.resumeTime;i=d||x>r?r:x})),i<r){var n;const e=i,t=o,l=r-i;o+=l;const d=a;a+=l,s.push({previousEvent:(null==(n=s[s.length-1])?void 0:n.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:d,end:a},integrated:{start:t,end:o}})}this.setDurations(r,a,o)}else{const e=0;s.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,a=-1;e.forEach(((n,o)=>{const l=n.cue.pre,d=n.cue.post,c=l?0:d?i:n.startTime;this.updateAssetDurations(n);if(a===c?n.cumulativeDuration=r:(r=0,a=c),!d&&n.snapOptions.in&&(n.resumeAnchor=Wf(null,s.fragments,n.startOffset+n.resumptionOffset,0,0)||void 0),n.appendInPlace&&!n.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(n,t)||(n.appendInPlace=!1)}if(!n.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${n}`))}const h=Bh(n.resumeOffset)?n.resumeOffset:n.duration;r+=h}))}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;if(Math.abs(s-i)>_v)return this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1;if(!t)return this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1;return!Object.keys(t).some((i=>{const r=t[i].details,a=r.edge;if(s>=a)return this.log(`"${e.identifier}" resumption ${s} past ${i} playlist end ${a}`),!1;const n=Wf(null,r.fragments,s);if(!n)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${i} playlist (${r.fragStart}-${r.fragmentEnd})`),!0;const o="audio"===i?.175:0;return!(Math.abs(n.start-s)<_v+o||Math.abs(n.end-s)<_v+o)&&(this.log(`"${e.identifier}" resumption ${s} not aligned with ${i} fragment bounds (${n.start}-${n.end} sn: ${n.sn} cc: ${n.cc})`),!0)}))}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;e.assetList.forEach(((e,a)=>{const n=t+s;e.startOffset=s,e.timelineStart=n,i||(i=null===e.duration),r||(r=!!e.error);const o=e.error?0:e.duration||0;s+=o})),e.duration=i&&!r?Math.max(s,e.duration):s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Vv(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class Kv{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=Bv(s,this.hls.sessionId,e.baseUrl)}catch(c){const t=this.assignAssetListError(e,Vh.ASSET_LIST_LOAD_ERROR,c,s);return void this.hls.trigger(Kh.ERROR,t)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=new(0,r.loader)(r),n={responseType:"json",url:i.href},o=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(t,s,i,r)=>{const a=t.data,n=null==a?void 0:a.ASSETS;if(Array.isArray(n))e.assetListResponse=a,this.hls.trigger(Kh.ASSET_LIST_LOADED,{event:e,assetListResponse:a,networkDetails:r});else{const t=this.assignAssetListError(e,Vh.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,s,r);this.hls.trigger(Kh.ERROR,t)}},onError:(t,s,i,r)=>{const a=this.assignAssetListError(e,Vh.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${s.url})`),s.url,r,i);this.hls.trigger(Kh.ERROR,a)},onTimeout:(t,s,i)=>{const r=this.assignAssetListError(e,Vh.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${s.url})`),s.url,t,i);this.hls.trigger(Kh.ERROR,r)}};return a.load(n,l,d),this.hls.trigger(Kh.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,i,r,a){return e.error=s,{type:Gh.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:a,stats:r}}}function Hv(e,t,s){Yv(e,t,s),e.addEventListener(t,s)}function Yv(e,t,s){e.removeEventListener(t,s)}function Wv(e){null==e||e.play().catch((()=>{}))}class qv{constructor(e){this.buffered=void 0;const t=(t,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][t]};this.buffered={get length(){return e.length},end:s=>t("end",s,e.length),start:s=>t("start",s,e.length)}}}const zv={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Xv=e=>String.fromCharCode(zv[e]||e),Qv=15,Jv=100,Zv={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ex={17:2,18:4,21:6,22:8,23:10,19:13,20:15},tx={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sx={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ix=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class rx{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s="function"==typeof t?t():t;cu.log(`${this.time} [${e}] ${s}`)}}}const ax=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class nx{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ox{constructor(){this.uchar=" ",this.penState=new nx}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class lx{constructor(e){this.chars=[],this.pos=0,this.currPenState=new nx,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Jv;t++)this.chars.push(new ox);this.logger=e}equals(e){for(let t=0;t<Jv;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Jv;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Jv;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Jv&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Jv)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Xv(e);this.pos>=Jv?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Jv;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Jv;s++){const i=this.chars[s].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class dx{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Qv;t++)this.rows.push(new lx(e));this.logger=e}reset(){for(let e=0;e<Qv;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let s=0;s<Qv;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Qv;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Qv;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+Of(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Qv;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const i=s.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(s.rows[e+a])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+Of(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<Qv;r++){const s=this.rows[r].getTextString();s&&(i=r+1,e?t.push("Row "+i+": '"+s+"'"):t.push(s.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}getTextAndFormat(){return this.rows}}class cx{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new dx(s),this.nonDisplayedMemory=new dx(s),this.lastOutputScreen=new dx(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+Of(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class hx{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new rx;this.channels=[null,new cx(e,t,i),new cx(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const e=127&t[s],i=127&t[s+1];let r=!1,a=null;if(0===e&&0===i)continue;this.logger.log(3,(()=>"["+ax([t[s],t[s+1]])+"] -> ("+ax([e,i])+")"));const n=this.cmdHistory;if(e>=16&&e<=31){if(fx(e,i,n)){ux(null,null,n),this.logger.log(3,(()=>"Repeated command ("+ax([e,i])+") is dropped"));continue}ux(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else ux(null,null,n);if(!r&&(a=this.parseChars(e,i),a)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,(()=>"Couldn't parse cleaned data "+ax([e,i])+" orig: "+ax([t[s],t[s+1]])))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,i=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+ax([e,t])+")")),!0)}return!1}parsePAC(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;s=t>=64&&t<=95?1===i?Zv[e]:tx[e]:1===i?ex[e]:sx[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return s=t>95?t-96:t-64,i.underline=!(1&~s),s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((s-16)/2),i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,(()=>"Special char '"+Xv(e)+"' in channel "+s)),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,(()=>"Char codes =  "+ax(i).join(","))),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let s;const i={};16===e||24===e?(s=Math.floor((t-32)/2),i.background=ix[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}ux(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function ux(e,t,s){s.a=e,s.b=t}function fx(e,t,s){return s.a===e&&s.b===t}var mx=function(){if(null!=zm&&zm.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function s(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function i(e){return s(t,e)}function r(e,...t){let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const s in t)e[s]=t[s]}return e}function a(t,a,n){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let d="",c=!1,h=t,u=a,f=n,m=null,g="",p=!0,y="auto",v="start",x=50,b="middle",E=50,T="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return d},set:function(e){d=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(t){const i=function(t){return s(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return v},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return x},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");x=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return b},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return T},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class gx{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function px(e){function t(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(i||0)}const s=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?t(s[2],s[3],0,s[4]):t(s[1],s[2],s[3],s[4]):null}class yx{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function vx(e,t,s,i){const r=i?e.split(i):[e];for(const a in r){if("string"!=typeof r[a])continue;const e=r[a].split(s);if(2!==e.length)continue;t(e[0],e[1])}}const xx=new mx(0,0,""),bx="middle"===xx.align?"middle":"center";function Ex(e,t,s){const i=e;function r(){const t=px(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),a(),t.endTime=r(),a(),function(e,t){const i=new yx;vx(e,(function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",bx,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",bx,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",bx,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===xx.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",bx);let a=i.get("position","auto");"auto"===a&&50===xx.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function Tx(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Sx{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new gx,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function s(){let e=t.buffer,s=0;for(e=Tx(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const i=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=s();const i=e.match(/^()?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=s(),t.state){case"HEADER":/:/.test(e)?vx(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new mx(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Ex(e,t.cue,t.regionList)}catch(i){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const s=-1!==e.indexOf("--\x3e");if(!e||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(i){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Ax=/\r\n|\n\r|\n|\r/g,wx=function(e,t,s=0){return e.slice(s,s+t.length)===t};function kx(e,t,s){return Nv(e.toString())+Nv(t.toString())+Nv(s)}function Lx(e,t,s,i,r,a,n){const o=new Sx,l=fu(new Uint8Array(e)).trim().replace(Ax,"\n").split("\n"),d=[],c=t?function(e,t=1){return vy(e,9e4,1/t)}(t.baseTime,t.timescale):0;let h,u="00:00.000",f=0,m=0,g=!0;o.oncue=function(e){const a=s[i];let n=s.ccOffset;const o=(f-c)/9e4;if(null!=a&&a.new&&(void 0!==m?n=s.ccOffset=a.start:function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(a=r)&&a.new;){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s}(s,i,o)),o){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));n=o-s.presentationOffset}const l=e.endTime-e.startTime,u=wy(9e4*(e.startTime+n-m),9e4*r)/9e4;e.startTime=Math.max(u,0),e.endTime=Math.max(u+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=kx(e.startTime,e.endTime,g)),e.endTime>0&&d.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?n(h):a(d)},l.forEach((e=>{if(g){if(wx(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((e=>{wx(e,"LOCAL:")?u=e.slice(6):wx(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{m=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(Bh(t)&&Bh(s)&&Bh(i)&&Bh(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=6e4*i,t+=36e5*r,t}(u)/1e3}catch(t){h=t}return}""===e&&(g=!1)}o.parse(e+"\n")})),o.flush()}const Rx="stpp.ttml.im1t",Ix=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Px=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Dx={left:"start",center:"center",right:"end",start:"start",end:"end"};function Cx(e,t,s,i){const r=Gu(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const a=r.map((e=>fu(e))),n=function(e,t,s=1,i=!1){return vy(e,t,1/s,i)}(t.baseTime,1,t.timescale);try{a.forEach((e=>s(function(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),i=s.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e)),{}),n="preserve"!==i.getAttribute("xml:space"),o=_x(Nx(i,"styling","style")),l=_x(Nx(i,"layout","region")),d=Nx(i,"body","[begin]");return[].map.call(d,(e=>{const s=Mx(e,n);if(!s||!e.hasAttribute("begin"))return null;const i=jx(e.getAttribute("begin"),a),r=jx(e.getAttribute("dur"),a);let d=jx(e.getAttribute("end"),a);if(null===i)throw Ox(e);if(null===d){if(null===r)throw Ox(e);d=i+r}const c=new mx(i-t,d-t,s);c.id=kx(c.startTime,c.endTime,c.text);const h=function(e,t,s){const i="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;n&&s.hasOwnProperty(n)&&(r=s[n]);return a.reduce(((s,a)=>{const n=Fx(t,i,a)||Fx(e,i,a)||Fx(r,i,a);return n&&(s[a]=n),s}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:u}=h;if(u){const e=Dx[u];e&&(c.lineAlign=e),c.align=u}return tu(c,h),c})).filter((e=>null!==e))}(e,n))))}catch(o){i(o)}}function Nx(e,t,s){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(s)):[]}function _x(e){return e.reduce(((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e}),{})}function Mx(e,t){return[].slice.call(e.childNodes).reduce(((e,s,i)=>{var r;return"br"===s.nodeName&&i?e+"\n":null!=(r=s.childNodes)&&r.length?Mx(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent}),"")}function Fx(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function Ox(e){return new Error(`Could not parse ttml timestamp ${e}`)}function jx(e,t){if(!e)return null;let s=px(e);return null===s&&(Ix.test(e)?s=function(e,t){const s=Ix.exec(e),i=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+i/t.frameRate}(e,t):Px.test(e)&&(s=function(e,t){const s=Px.exec(e),i=Number(s[1]);switch(s[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}class Bx{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function Ux(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function $x(e,t){return!!e&&e.kind===Ux(t)&&Uy(t,e)}const Gx=/\s/,Vx={newCue(e,t,s,i){const r=[];let a,n,o,l,d;const c=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(a=i.rows[u],o=!0,l=0,d="",!a.isEmpty()){var h;for(let e=0;e<a.chars.length;e++)Gx.test(a.chars[e].uchar)&&o?l++:(d+=a.chars[e].uchar,o=!1);a.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const i=Tx(d.trim()),f=kx(t,s,i);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(n=new c(t,s,i),n.id=f,n.line=u+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(n))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>Iv(e,t)))),r}};const Kx=/(\d+)-(\d+)\/(\d+)/;class Hx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Yx,this.controller=new self.AbortController,this.stats=new Au}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function(e,t){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(tu({},e.headers))};e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return s}(e,this.controller.signal),a="arraybuffer"===e.responseType,n=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=o&&Bh(o)?o:l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),t.timeout);(Cy(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((s=>{var r;this.response=this.loader=s;const n=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))}),l-(n-i.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new Wx(t||"fetch, bad network response",e,s)}i.loading.first=n,i.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=Kx.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(Bh(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(s.headers)||i.total;const o=null==(r=this.callbacks)?void 0:r.onProgress;return o&&Bh(t.highWaterMark)?this.loadProgressively(s,i,e,t.highWaterMark,o):a?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((s=>{var r,a;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=s[n];l&&(i.loaded=i.total=l);const d={url:o.url,data:s,code:o.status},c=null==(r=this.callbacks)?void 0:r.onProgress;c&&!Bh(t.highWaterMark)&&c(i,e,s,o),null==(a=this.callbacks)||a.onSuccess(d,i,e,o)})).catch((t=>{var s;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,a=t?t.message:null;null==(s=this.callbacks)||s.onError({code:r,text:a},e,t?t.details:null,i)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const a=new lp,n=e.body.getReader(),o=()=>n.read().then((n=>{if(n.done)return a.dataLength&&r(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=n.value,d=l.length;return t.loaded+=d,d<i||a.dataLength?(a.push(l),a.dataLength>=i&&r(t,s,a.flush().buffer,e)):r(t,s,l.buffer,e),o()})).catch((()=>Promise.reject()));return o()}}function Yx(e,t){return new self.Request(e.url,t)}class Wx extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const qx=/^age:\s*[\d.]+\s*$/im;class zx{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Au,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)})).catch((e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)})).then((()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)})).catch((e=>{var r;null==(r=this.callbacks)||r.onError({code:s.status,text:e.message},t,s,i)})):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=s.loadPolicy;if(i)for(const n in i)e.setRequestHeader(n,i[n]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&Bh(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var a,n;s.loading.end=Math.max(self.performance.now(),s.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;s.loaded=s.total=o,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first);const l=null==(a=this.callbacks)?void 0:a.onProgress;l&&l(s,e,r,t);const d={url:t.responseURL,data:r,code:i};return void(null==(n=this.callbacks)||n.onSuccess(d,s,e,t))}}const d=r.loadPolicy.errorRetry;var o;if(tm(d,s.retry,!1,{url:e.url,data:void 0,code:i}))this.retry(d);else cu.error(`${i} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,s)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(tm(e,this.stats.retry,!0))this.retry(e);else{var t;cu.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Zf(e,s.retry),s.retry++,cu.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&qx.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Xx=iu(iu({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:zx,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends ru{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:s,partCurrent:i,hls:r}=this,{autoLevelEnabled:a,media:n}=r;if(!s||!n)return;const o=performance.now(),l=i?i.stats:s.stats,d=i?i.duration:s.duration,c=o-l.loading.start,h=r.minAutoLevel,u=s.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||u<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const m=f>-1&&f!==u,g=!!e||m;if(!g&&(n.paused||!n.playbackRate||!n.readyState))return;const p=r.mainForwardBufferInfo;if(!g&&null===p)return;const y=this.bwEstimator.getEstimateTTFB(),v=Math.abs(n.playbackRate);if(c<=Math.max(y,d/(2*v)*1e3))return;const x=p?p.len/v:0,b=l.loading.first?l.loading.first-l.loading.start:-1,E=l.loaded&&b>-1,T=this.getBwEstimate(),S=r.levels,A=S[u],w=Math.max(l.loaded,Math.round(d*(s.bitrate||A.averageBitrate)/8));let k=E?c-b:c;k<1&&E&&(k=Math.min(c,8*l.loaded/T));const L=E?1e3*l.loaded/k:0,R=y/1e3,I=L?(w-l.loaded)/L:8*w/T+R;if(I<=x)return;const P=L?8*L:T,D=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),C=this.hls.config.abrBandWidthUpFactor;let N,_=Number.POSITIVE_INFINITY;for(N=u-1;N>h;N--){const e=S[N].maxBitrate,t=!S[N].details||D;if(_=this.getTimeToLoadFrag(R,P,d*e,t),_<Math.min(x,d+R))break}if(_>=I)return;if(_>10*d)return;E?this.bwEstimator.sample(c-Math.min(y,b),l.loaded):this.bwEstimator.sampleTTFB(c);const M=S[N].maxBitrate;this.getBwEstimate()*C>M&&this.resetEstimator(M);const F=this.findBestLevel(M,h,N,0,x,1,1);F>-1&&(N=F),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${u} is loading too slowly;\n      Fragment duration: ${s.duration.toFixed(3)}\n      Time to underbuffer: ${x.toFixed(3)} s\n      Estimated load time for current fragment: ${I.toFixed(3)} s\n      Estimated load time for down switch fragment: ${_.toFixed(3)} s\n      TTFB estimate: ${0|b} ms\n      Current BW estimate: ${Bh(T)?0|T:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${N} @ ${0|M} bps`),r.nextLoadLevel=r.nextAutoLevel=N,this.clearTimer();const O=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===N&&N>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${N>0?"and switching down":""}\n      Fragment duration: ${s.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,N>h){let t=this.findBestLevel(this.hls.levels[h].bitrate,h,N,0,e,1,1);-1===t&&(t=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};m||I>2*_?O():this.timer=self.setInterval(O,1e3*_),r.trigger(Kh.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Zh(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.FRAG_LOADING,this.onFragLoading,this),e.on(Kh.FRAG_LOADED,this.onFragLoaded,this),e.on(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Kh.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.FRAG_LOADING,this.onFragLoading,this),e.off(Kh.FRAG_LOADED,this.onFragLoaded,this),e.off(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Kh.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Kh.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){var i;if(!s.bitrateTest)this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Vh.BUFFER_ADD_CODEC_ERROR:case Vh.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Vh.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:s,partCurrent:i}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=i?i.stats:e.stats,r=t-s.loading.start,a=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&a>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,a),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,s,i){return e+s/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;Bh(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===zh&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=s?s.duration:t.duration,r=this.hls.levels[t.level],a=(r.loaded?r.loaded.bytes:0)+i.loaded,n=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:a,duration:n},r.realBitrate=Math.round(8*a/n)}if(t.bitrateTest){const e={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(Kh.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==zh||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,n=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${n}`),n}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&s&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:a}=s,n=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let d=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,a,i,l,0,d,c);if(e>=0)return this.rebufferNotice=-1,e}let h=n?Math.min(n,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){h=(n?Math.min(n,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),d=c=1}}const u=this.findBestLevel(o,a,i,l,h,d,c);if(this.rebufferNotice!==u&&(this.rebufferNotice=u,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${u}`)),u>-1)return u;const f=s.levels[a],m=s.loadLevelObj;return m&&(null==f?void 0:f.bitrate)<m.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,a,n){var o;const l=i+r,d=this.lastLoadedFragLevel,c=-1===d?this.hls.firstLevel:d,{fragCurrent:h,partCurrent:u}=this,{levels:f,allAudioTracks:m,loadLevel:g,config:p}=this.hls;if(1===f.length)return 0;const y=f[c],v=!(null==(o=this.hls.latestLevelDetails)||!o.live),x=-1===g||-1===d;let b,E="SDR",T=(null==y?void 0:y.frameRate)||0;const{audioPreference:S,videoPreference:A}=p,w=this.audioTracksByGroup||(this.audioTracksByGroup=Bf(m));let k=-1;if(x){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(e,t,s,i){return e.slice(s,i+1).reduce(((e,s,i)=>{if(!s.codecSet)return e;const r=s.audioGroups;let a=e[s.codecSet];a||(e[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const n=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,n),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.minIndex=Math.min(a.minIndex,i),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,r&&r.forEach((e=>{if(!e)return;const s=t.groups[e];s&&(a.hasDefaultAudio=a.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach((e=>{a.channels[e]=(a.channels[e]||0)+s.channels[e]})))})),e}),{})}(f,w,t,s)),r=function(e,t,s,i,r){const a=Object.keys(e),n=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,d=n&&2===parseInt(n);let c=!1,h=!1,u=1/0,f=1/0,m=1/0,g=1/0,p=0,y=[];const{preferHDR:v,allowedVideoRanges:x}=Ff(t,r);for(let S=a.length;S--;){const t=e[a[S]];c||(c=t.channels[2]>0),u=Math.min(u,t.minHeight),f=Math.min(f,t.minFramerate),m=Math.min(m,t.minBitrate),x.filter((e=>t.videoRanges[e]>0)).length>0&&(h=!0)}u=Bh(u)?u:0,f=Bh(f)?f:0;const b=Math.max(1080,u),E=Math.max(30,f);m=Bh(m)?m:s,s=Math.max(m,s),h||(t=void 0);const T=a.length>1;return{codecSet:a.reduce(((t,i)=>{const r=e[i];if(i===t)return t;if(y=h?x.filter((e=>r.videoRanges[e]>0)):[],T){if(r.minBitrate>s)return jf(i,`min bitrate of ${r.minBitrate} > current estimate of ${s}`),t;if(!r.hasDefaultAudio)return jf(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return jf(i,`audio codec preference "${o}" not found`),t;if(n&&!d){if(!r.channels[n])return jf(i,`no renditions with ${n} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||d)&&c&&0===r.channels[2])return jf(i,"no renditions with stereo sound found"),t;if(r.minHeight>b)return jf(i,`min resolution of ${r.minHeight} > maximum of ${b}`),t;if(r.minFramerate>E)return jf(i,`min framerate of ${r.minFramerate} > maximum of ${E}`),t;if(!y.some((e=>r.videoRanges[e]>0)))return jf(i,`no variants with VIDEO-RANGE of ${Of(y)} found`),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return jf(i,`video codec preference "${l}" not found`),t;if(r.maxScore<p)return jf(i,`max score of ${r.maxScore} < selected max of ${p}`),t}return t&&(mf(i)>=mf(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,p=r.maxScore,i)}),void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:m,minIndex:g}}(i,E,e,S,A),{codecSet:a,videoRanges:n,minFramerate:o,minBitrate:l,minIndex:d,preferHDR:c}=r;k=d,b=a,E=c?n[n.length-1]:n[0],T=o,e=Math.max(e,l),this.log(`picked start tier ${Of(r)}`)}else b=null==y?void 0:y.codecSet,E=null==y?void 0:y.videoRange;const L=u?u.duration:h?h.duration:0,R=this.bwEstimator.getEstimateTTFB()/1e3,I=[];for(let D=s;D>=t;D--){var P;const t=f[D],o=D>c;if(!t)continue;if(p.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"==typeof(null==s?void 0:s.decodingInfo)&&(wf(t,w,E,T,e,S)||ef(t.videoCodec))?(t.supportedPromise=kf(t,w,s),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,i=s.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${Of(e)}`):e.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${i} ${Of(e)}`),i>-1&&s.length>1&&(this.log(`Removing unsupported level ${i}`),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}))):t.supportedResult=Tf}if((b&&t.codecSet!==b||E&&t.videoRange!==E||o&&T>t.frameRate||!o&&T>0&&T<t.frameRate||t.supportedResult&&(null==(P=t.supportedResult.decodingInfoResults)||!P[0].smooth))&&(!x||D!==k)){I.push(D);continue}const h=t.details,m=(u?null==h?void 0:h.partTarget:null==h?void 0:h.averagetargetduration)||L;let y;y=o?n*e:a*e;const A=L&&i>=2*L&&0===r?t.averageBitrate:t.maxBitrate,C=this.getTimeToLoadFrag(R,y,A*m,void 0===h);if(y>=A&&(D===d||0===t.loadError&&0===t.fragmentError)&&(C<=R||!Bh(C)||v&&!this.bitrateTestDelay||C<l)){const e=this.forcedAutoLevel;return D===g||-1!==e&&e===g||(I.length&&this.trace(`Skipped level(s) ${I.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${f[I[0]].codecs}" ${f[I[0]].videoRange}; not compatible with "${b}" ${E}`),this.info(`switch candidate:${c}->${D} adjustedbw(${Math.round(y)})-bitrate=${Math.round(y-A)} ttfb:${R.toFixed(1)} avgDuration:${m.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${C.toFixed(1)} firstSelection:${x} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${g}`)),x&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}},bufferController:class extends ru{constructor(e,t){var s;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:s}=this;e&&this.log("Media source opened"),t&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Kh.MEDIA_ATTACHED,{media:t,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(s=hu(e.config.preferManagedMediaSource),"undefined"!=typeof self&&s===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.BUFFER_RESET,this.onBufferReset,this),e.on(Kh.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Kh.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Kh.BUFFER_EOS,this.onBufferEos,this),e.on(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Kh.FRAG_PARSED,this.onFragParsed,this),e.on(Kh.FRAG_CHANGED,this.onFragChanged,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.BUFFER_RESET,this.onBufferReset,this),e.off(Kh.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Kh.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Kh.BUFFER_EOS,this.onBufferEos,this),e.off(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Kh.FRAG_PARSED,this.onFragParsed,this),e.off(Kh.FRAG_CHANGED,this.onFragChanged,this),e.off(Kh.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?tu(s,i.tracks):this.sourceBuffers.forEach((e=>{const[t]=e;t&&(s[t]=tu({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null})),{media:e,mediaSource:t,tracks:s}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(s=this.transferData)&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media,i=hu(this.appendSource);if(this.transferData=this.overrides=void 0,s&&i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),e)this._objectUrl=s.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const t=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||t&&a instanceof t,Hy(s),function(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,e),s.load()}catch(r){s.src=e}else s.src=e}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(s=e.constructor)?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,a=r?r.length:0,n=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&r&&a){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${Of(s,((e,t)=>"initSegment"===e?void 0:t))};\ntransfer tracks: ${Of(i,((e,t)=>"initSegment"===e?void 0:t))}}`),!uu(i,s)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,a=this.details,n=Math.max(r,(null==a?void 0:a.fragments[0].start)||0);return n-r>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${r} -> ${n}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${n} currentTime: ${r}`),this.onMediaDetaching(Kh.MEDIA_DETACHING,{}),this.onMediaAttaching(Kh.MEDIA_ATTACHING,t),void(e.currentTime=n))}this.transferData=void 0,r.forEach((e=>{const t=e,s=i[t];if(s){const e=s.buffer;if(e){const i=this.fragmentTracker,r=s.id;if(i.hasFragments(r)||i.hasParts(r)){const s=Cm.getBuffered(e);i.detectEvictedFragments(t,s,r,null,!0)}const a=Yy(t),n=[t,e];this.sourceBuffers[a]=n,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,s)}}})),n(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),n()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach((([e])=>{e&&this.removeBuffer(e)})),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let s=t.length;s--;)e&&t[s].abort(),r.removeSourceBuffer(t[s]);e&&r.endOfStream()}catch(Yb){this.warn(`onMediaDetaching: ${Yb.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&Hy(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Kh.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach((([e])=>{e&&this.resetBuffer(e)})),this.initTracks()}resetBuffer(e){var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(Yb){this.warn(`onBufferReset ${e}`,Yb)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Yy(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new $y(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!r&&this.sourceBufferCount&&this.media&&i.some((e=>!s[e]));r||a?this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`):(i.forEach((e=>{var i,r,a;const n=t[e],{id:o,codec:l,levelCodec:d,container:c,metadata:h,supplemental:u}=n;let f=s[e];const m=null==(i=this.transferData)||null==(r=i.tracks)?void 0:r[e],g=null!=m&&m.buffer?m:f,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),y=null==g?void 0:g.levelCodec;f||(f=s[e]={buffer:void 0,listeners:[],codec:l,supplemental:u,container:c,levelCodec:d,metadata:h,id:o});const v=vf(p,y),x=null==v?void 0:v.replace(Gy,"$1");let b=vf(l,d);const E=null==(a=b)?void 0:a.replace(Gy,"$1");b&&v&&x!==E&&("audio"===e.slice(0,5)&&(b=yf(b,this.appendSource)),this.log(`switching codec ${p} to ${b}`),b!==(f.pendingCodec||f.codec)&&(f.pendingCodec=b),f.container=c,this.appendChangeType(e,c,b))})),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce(((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e}),{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const r=this.tracks[e];if(r){const a=r.buffer;null!=a&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),a.changeType(i),r.codec=s,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(s,zh))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&Cm.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,zh))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:a,frag:n,part:o,chunkMeta:l}=t,d=l.buffering[r],c=n.sn,h=self.performance.now();d.start=h;const u=n.stats.buffering,f=o?o.stats.buffering:null;0===u.start&&(u.start=h),f&&0===f.start&&(f.start=h);const m=s.audio;let g=!1;"audio"===r&&"audio/mpeg"===(null==m?void 0:m.container)&&(g=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const p=this.tracks.video,y=null==p?void 0:p.buffer;if(y&&"initSegment"!==c){const e=o||n,t=this.blockedAudioAppend;if("audio"!==r||"main"===a||this.blockedAudioAppend){if("video"===r){const s=e.end;if(t){const e=t.frag.start;(s>e||s<this.lastVideoAppendEnd||Cm.isBuffered(y,e))&&this.unblockAudio()}this.lastVideoAppendEnd=s}}else{const t=e.start+.05*e.duration,s=y.buffered,i=this.currentOp("video");s.length||i?!i&&!Cm.isBuffered(y,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const v=(o||n).start,x={label:`append-${r}`,execute:()=>{if(d.executeStart=self.performance.now(),g){const e=this.tracks[r];if(e){const t=e.buffer;if(t){const e=v-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${v} (delta: ${e}) sn: ${c})`),t.timestampOffset=v)}}}this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();d.executeEnd=d.end=e,0===u.first&&(u.first=e),f&&0===f.first&&(f.first=e);const t={};this.sourceBuffers.forEach((([e,s])=>{e&&(t[e]=Cm.getBuffered(s))})),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Kh.BUFFER_APPENDED,{type:r,frag:n,part:o,chunkMeta:l,parent:n.type,timeRanges:t})},onError:e=>{var t;const s={type:Gh.MEDIA_ERROR,parent:n.type,details:Vh.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:n,part:o,chunkMeta:l,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR)s.details=Vh.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)s.errorAction=dm(!0);else if(e.name===Vy&&0===this.sourceBufferCount)s.errorAction=dm(!0);else{const e=++this.appendErrors[r];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${i||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||i)&&(s.fatal=!0)}this.hls.trigger(Kh.ERROR,s)}};this.append(x,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Kh.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach((([e])=>{e&&this.append(this.getFlushOp(e,i,r),e)}))}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],a=i?i.elementaryStreams:s.elementaryStreams;a[Lu]?r.push("audiovideo"):(a[wu]&&r.push("audio"),a[ku]&&r.push("video"));0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers((()=>{const e=self.performance.now();s.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:s.stats;this.hls.trigger(Kh.FRAG_BUFFERED,{frag:s,part:i,stats:t,id:s.type})}),r).catch((e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}))}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t,s;return e&&(!(null!=(t=this.tracks[e])&&t.ended)||(null==(s=this.tracks[e])?void 0:s.ending))}))}onBufferEos(e,t){var s;this.sourceBuffers.forEach((([e])=>{if(e){const s=this.tracks[e];t.type&&t.type!==e||(s.ending=!0,s.ended||(s.ended=!0,this.log(`${e} buffer reached EOS`)))}}));const i=!1!==(null==(s=this.overrides)?void 0:s.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)}))&&(i?(this.log("Queueing EOS"),this.blockUntilOpen((()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(Kh.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))):(this.tracksEnded(),this.hls.trigger(Kh.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach((([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen((()=>this.updateMediaSource(e)))}onError(e,t){if(t.details===Vh.BUFFER_APPEND_ERROR&&t.frag){var s;const e=null==(s=t.errorAction)?void 0:s.nextAutoLevel;Bh(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||null===t)return;if(!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,a=t.levelTargetDuration,n=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(Bh(n)&&n>=0){const e=Math.max(n,a),t=Math.floor(r/a)*a-e;this.flushBackBuffer(r,a,t)}if(Bh(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const e=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),t=Math.max(e,a),s=Math.floor(r/a)*a+t;this.flushFrontBuffer(r,a,s)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach((([e,t])=>{if(t){const r=Cm.getBuffered(t);if(r.length>0&&s>r.start(0)){var i;this.hls.trigger(Kh.BACK_BUFFER_REACHED,{bufferEnd:s});const t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(Kh.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(Kh.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:e})}}}))}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach((([t,i])=>{if(i){const r=Cm.getBuffered(i),a=r.length;if(a<2)return;const n=r.start(a-1),o=r.end(a-1);if(s>n||e>=n&&e<=o)return;this.hls.trigger(Kh.BUFFER_FLUSHING,{startOffset:n,endOffset:1/0,type:t})}}))}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||"open"!==(null==s?void 0:s.readyState))return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&s.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,i)}}return{duration:1/0}}const r=null==(e=this.overrides)?void 0:e.duration;if(r)return Bh(r)?{duration:r}:null;const a=this.media.duration;return i>(Bh(s.duration)?s.duration:0)&&i>a||!Bh(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==e&&(Bh(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),void 0!==t&&void 0!==s&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Of(s)}`),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach((([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}})),this.hls.trigger(Kh.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach((([e])=>{this.executeNext(e)}))}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const n=a,o=e[n];if(this.isPending(o)){const e=this.getTrackCodec(o,n),a=`${o.container};codecs=${e}`;o.codec=e,this.log(`creating sourceBuffer(${a})${this.currentOp(n)?" Queued":""} ${Of(o)}`);try{const e=s.addSourceBuffer(a),i=Yy(n),r=[n,e];t[i]=r,o.buffer=e}catch(r){var i;return this.error(`error while trying to add sourceBuffer: ${r.message}`),this.shiftAndExecuteNext(n),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[n],void this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,sourceBufferName:n,mimeType:a,parent:o.id})}this.trackSourceBuffer(n,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&("video"===t||"audiovideo"===t)&&cf(s,"video")&&(i=function(e,t){const s=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)df(t[e],"video")||s.push(t[e])}return t&&s.push(t),s.join(",")}(i,s));const r=vf(i,e.levelCodec);return r?"audio"===t.slice(0,5)?yf(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",((e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(Kh.BUFFER_FLUSHED,{type:e})}))}get mediaSrc(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(s=this.mediaSource)?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,a=this.tracks[e],n=null==a?void 0:a.buffer;if(!i||!r||!n)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=Bh(i.duration)?i.duration:1/0,l=Bh(r.duration)?r.duration:1/0,d=Math.max(0,t),c=Math.min(s,o,l);c>d&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${d},${c}] from the ${e} SourceBuffer`),n.remove(d,c)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=null==s?void 0:s.buffer;if(!i)throw new Ky(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch((e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}));else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some((([e,t])=>e&&t.updating))}isQueued(){return this.sourceBuffers.some((([e])=>e&&!!this.currentOp(e)))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map((e=>this.appendBlocker(e)));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then((t=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))}))}stepOperationQueue(e){e.forEach((e=>{var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;s&&!s.updating&&this.shiftAndExecuteNext(e)}))}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce(((e,t)=>e+(this.isPending(this.tracks[t])?1:0)),0)}get sourceBufferCount(){return this.sourceBuffers.reduce(((e,[t])=>e+(t?1:0)),0)}get sourceBufferTypes(){return this.sourceBuffers.map((([e])=>e)).filter((e=>!!e))}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const a=s.bind(this,e);i.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach((e=>{s.removeEventListener(e.event,e.listener)})),t.listeners.length=0)}},capLevelController:Wy,errorController:class extends ru{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Kh.ERROR,this.onError,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Kh.ERROR,this.onError,this),e.off(Kh.ERROR,this.onErrorOut,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===zh?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case Vh.FRAG_LOAD_ERROR:case Vh.FRAG_LOAD_TIMEOUT:case Vh.KEY_LOAD_ERROR:case Vh.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case Vh.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction=dm());case Vh.FRAG_GAP:case Vh.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=im);case Vh.LEVEL_EMPTY_ERROR:case Vh.LEVEL_PARSING_ERROR:{var a,n;const e=t.parent===zh?t.level:i.loadLevel;t.details===Vh.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(n=a.levelDetails)&&n.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case Vh.LEVEL_LOAD_ERROR:case Vh.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case Vh.AUDIO_TRACK_LOAD_ERROR:case Vh.AUDIO_TRACK_LOAD_TIMEOUT:case Vh.SUBTITLE_LOAD_ERROR:case Vh.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===Wh&&e.hasAudioGroup(r.groupId)||r.type===qh&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=im,void(t.errorAction.flags=om)}return;case Vh.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.loadLevelObj,s=null==e?void 0:e.attrs["HDCP-LEVEL"];s?t.errorAction={action:im,flags:lm,hdcpLevel:s}:this.keySystemError(t)}return;case Vh.BUFFER_ADD_CODEC_ERROR:case Vh.REMUX_ALLOC_ERROR:case Vh.BUFFER_APPEND_ERROR:var o;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(o=t.level)?o:i.loadLevel);return;case Vh.INTERNAL_EXCEPTION:case Vh.BUFFER_APPENDING_ERROR:case Vh.BUFFER_FULL_ERROR:case Vh.LEVEL_SWITCH_ERROR:case Vh.BUFFER_STALLED_ERROR:case Vh.BUFFER_SEEK_OVER_HOLE:case Vh.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=dm())}t.type===Gh.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=Jf(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(tm(s,i,Qf(e),e.response))return{action:am,flags:nm,retryConfig:s,retryCount:i};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,n=Jf(e.details.startsWith("key")?a:r,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i){e.details!==Vh.FRAG_GAP&&i.fragmentError++;if(tm(n,o,Qf(e),e.response))return{action:am,flags:nm,retryConfig:n,retryCount:o}}const l=this.getLevelSwitchAction(e,s);return n&&(l.retryConfig=n,l.retryCount=o),l}getLevelSwitchAction(e,t){const s=this.hls;null==t&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const t=e.details;i.loadError++,t===Vh.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:d,loadLevel:c,minAutoLevel:h,maxAutoLevel:u}=s;s.autoLevelEnabled||(s.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,m=(f===Xh&&t===Vh.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===Vh.BUFFER_ADD_CODEC_ERROR||t===Vh.BUFFER_APPEND_ERROR))&&d.some((({audioCodec:e})=>i.audioCodec!==e)),g="video"===e.sourceBufferName&&(t===Vh.BUFFER_ADD_CODEC_ERROR||t===Vh.BUFFER_APPEND_ERROR)&&d.some((({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t)),{type:p,groupId:y}=null!=(a=e.context)?a:{};for(let s=d.length;s--;){const r=(s+c)%d.length;if(r!==c&&r>=h&&r<=u&&0===d[r].loadError){var n,o;const s=d[r];if(t===Vh.FRAG_GAP&&f===zh&&e.frag){const t=d[r].details;if(t){const s=Wf(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(p===Wh&&s.hasAudioGroup(y)||p===qh&&s.hasSubtitleGroup(y))continue;if(f===Xh&&null!=(n=i.audioGroups)&&n.some((e=>s.hasAudioGroup(e)))||f===Qh&&null!=(o=i.subtitleGroups)&&o.some((e=>s.hasSubtitleGroup(e)))||m&&i.audioCodec===s.audioCodec||!m&&i.audioCodec!==s.audioCodec||g&&i.codecSet===s.codecSet)continue}l=r;break}}if(l>-1&&s.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:im,flags:nm,nextAutoLevel:l}}return{action:im,flags:om}}onErrorOut(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case sm:break;case im:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===Vh.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i,hdcpLevel:r,nextAutoLevel:a}=s;switch(i){case nm:this.switchLevel(e,a);break;case lm:r&&(t.maxHdcpLevel=Lf[Lf.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}s.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Vh.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=Ef(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===t&&this.hls.removeLevel(i)}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,n=1e3*r/e,o=this.hls;if(o.trigger(Kh.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:s}),n>0&&r>o.config.fpsDroppedMonitoringThreshold*a){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(Kh.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:dg,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Vx,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends np{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Qh),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kh.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Kh.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Kh.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Kh.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kh.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Kh.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Kh.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Kh.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=zg,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(Iu(s)&&(this.fragPrevious=s),this.state=zg,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const n=s.start;for(let l=0;l<r.length;l++)if(n>=r[l].start&&n<=r[l].end){a=r[l];break}const o=s.start+s.duration;a?a.end=o:(a={start:n,end:o},r.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(0===s&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}})),this.fragmentTracker.removeFragmentsInRange(s,e,Qh)}}onError(e,t){const s=t.frag;(null==s?void 0:s.type)===Qh&&(t.details===Vh.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==qg&&(this.state=zg))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&jy(this.levels,t)?this.levels=t.map((e=>new _f(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new _f(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Qh),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==qg&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:a,id:n}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${n}`);const o=r[n];if(n>=r.length||!o)return;this.log(`Subtitle track ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(s=o.details)&&s.live){const e=this.mainDetails;if(a.deltaUpdateFailed||!e)return;const t=e.fragments[0];var d;if(o.details)l=this.alignPlaylists(a,o.details,null==(d=this.levelLastLoaded)?void 0:d.details),0===l&&t&&(l=t.start,Fg(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(Yg(a,e),l=a.fragmentStart):t&&(l=t.start,Fg(a,l))}if(o.details=a,this.levelLastLoaded=o,n===i&&(this.hls.trigger(Kh.SUBTITLE_TRACK_UPDATED,{details:a,id:n,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===zg)){Wf(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=i&&i.key&&i.iv&&Km(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,Hm(i.method)).catch((e=>{throw r.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((s=>{const i=performance.now();r.trigger(Kh.FRAG_DECRYPTED,{frag:t,payload:s,stats:{tstart:e,tdecrypt:i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=zg}))}}doTick(){if(this.media){if(this.state===zg){const{currentTrackId:e,levels:t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;if(this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),a=Cm.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:n,len:o}=a,l=s.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const d=l.fragments,c=d.length,h=l.edge;let u=null;const f=this.fragPrevious;if(n<h){const e=i.maxFragLookUpTolerance,t=n>h-e?0:e;u=Wf(f,d,Math.max(d[0].start,n),t),!u&&f&&f.start<d[0].start&&(u=d[0])}else u=d[c-1];if(u=this.filterReplacedPrimary(u,s.details),!u)return;const m=d[u.sn-l.startSN-1];if(m&&m.cc===u.cc&&this.fragmentTracker.getState(m)===cm&&(u=m),this.fragmentTracker.getState(u)===cm){const e=this.mapToInitFragWhenRequired(u);e&&this.loadFragment(e,s,n)}}}else this.state=zg}loadFragment(e,t,s){Iu(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new qv(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Oy{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=Cv(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.on(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Kh.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.off(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Kh.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Kh.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;Cv(s.textTracks).forEach((e=>{Pv(e)}))}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i)return void this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const n=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=$f(t,e);if(s>-1)r=e[s];else{const e=$f(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==s?void 0:s.join(",")}" group-id`),this.hls.trigger(Kh.SUBTITLE_TRACKS_UPDATED,a),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!s||r.default)&&(s||e)&&(!e||Gf(r,e)))return i}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(By(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(By(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){if(Uy(t[s],e))return s}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==qh||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Gf(e,s))return s;const i=$f(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(s)return null;{const s=$f(e,t);if(s>-1)return t[s]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,n=null==a?void 0:a.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(Kh.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Cv(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter((e=>Uy(s,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!Bh(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(Kh.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:n="",name:o,type:l,url:d}=i;this.hls.trigger(Kh.SUBTITLE_TRACK_SWITCH,{id:a,groupId:n,name:o,type:l,url:d});const c=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(c)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Kh.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Kh.FRAG_LOADING,this.onFragLoading,this),e.on(Kh.FRAG_LOADED,this.onFragLoaded,this),e.on(Kh.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Kh.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Kh.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Kh.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Kh.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Kh.FRAG_LOADING,this.onFragLoading,this),e.off(Kh.FRAG_LOADED,this.onFragLoaded,this),e.off(Kh.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Kh.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Kh.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Kh.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Bx(this,"textTrack1"),t=new Bx(this,"textTrack2"),s=new Bx(this,"textTrack3"),i=new Bx(this,"textTrack4");this.cea608Parser1=new hx(1,e,t),this.cea608Parser2=new hx(3,s,i)}addCues(e,t,s,i,r){let a=!1;for(let c=r.length;c--;){const e=r[c],i=(n=e[0],o=e[1],l=t,d=s,Math.min(o,d)-Math.max(n,l));if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],s),a=!0,i/(s-t)>.5))return}var n,o,l,d;if(a||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,i)}else{const r=this.Cues.newCue(null,t,s,i);this.hls.trigger(Kh.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){const{unparsedVttFrags:a}=this;s===zh&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),a.length&&(this.unparsedVttFrags=[],a.forEach((e=>{this.onFragLoaded(Kh.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if($x(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:a}=t[e],n=this.getExistingTrack(r,a);if(n)s[e]=n,Pv(s[e]),Rv(s[e],i);else{const t=this.createTextTrack("captions",r,a);t&&(t[e]=!0,s[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(Kh.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach((e=>{Pv(i[e]),delete i[e]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Pv(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some((e=>e.textCodec===Rx));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(jy(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?Cv(e.textTracks):null;if(this.tracks.forEach(((e,s)=>{let i;if(t){let s=null;for(let i=0;i<t.length;i++)if(t[i]&&$x(t[i],e)){s=t[i],t[i]=null;break}s&&(i=s)}if(i)Pv(i);else{const t=Ux(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(Kh.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s=`textTrack${t[1]}`,i=this.captionsProperties[s];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===zh){var s,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:a}=this,{cc:n,sn:o}=t.frag,l=null!=(s=null==(i=t.part)?void 0:i.index)?s:-1;e&&r&&(o!==a+1||o===a&&l!==this.lastPartIndex+1||n!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=n,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===Qh)if(i.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),e&&e.textCodec===Rx?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(Kh.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Cx(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),s.trigger(Kh.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{s.logger.log(`Failed to parse IMSC1: ${t}`),s.trigger(Kh.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,n=r.length-1;if(!r[s.cc]&&-1===n)return void a.push(e);const o=this.hls;Lx(null!=(t=s.initSegment)&&t.data?Ju(s.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,(e=>{this._appendCues(e,s.level),o.trigger(Kh.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?a.push(e):this._fallbackToIMSC1(s,i),o.logger.log(`Failed to parse VTT cue: ${t}`),r&&n>s.cc||o.trigger(Kh.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:t})}))}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Cx(t,this.initPTS[e.cc],(()=>{s.textCodec=Rx,this._parseIMSC1(e,t)}),(()=>{s.textCodec="wvtt"}))}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach((e=>Iv(s,e)))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(Kh.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Qh&&this.onFragLoaded(Kh.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(s.type!==zh||"NONE"!==this.closedCaptionsForLevel(s))for(let r=0;r<i.length;r++){const e=i[r].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(i[r].pts,t[0]),this.cea608Parser2.addData(i[r].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(a&&!(a.currentTime<s)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach((i=>Dv(e[i],t,s)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach((s=>Dv(e[s],t,i)))}}}extractCea608Data(e){const t=[[],[]],s=31&e[0];let i=2;for(let r=0;r<s;r++){const s=e[i++],r=127&e[i++],a=127&e[i++];if(0===r&&0===a)continue;if(!!(4&s)){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(a))}}return t}},audioStreamController:class extends np{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Xh),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kh.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Kh.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Kh.BUFFER_RESET,this.onBufferReset,this),e.on(Kh.BUFFER_CREATED,this.onBufferCreated,this),e.on(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Kh.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Kh.FRAG_LOADING,this.onFragLoading,this),e.on(Kh.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kh.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Kh.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Kh.BUFFER_RESET,this.onBufferReset,this),e.off(Kh.BUFFER_CREATED,this.onBufferCreated,this),e.off(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Kh.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Kh.FRAG_LOADING,this.onFragLoading,this),e.off(Kh.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){if(s===zh){const e=t.cc,s=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}/${r}`),this.mainAnchor=t,this.state===rp){const s=this.waitingData;(!s&&!this.loadingParts||s&&s.frag.cc!==e)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&s&&s.cc!==e?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,s.abortRequests(),this.resetLoadingState()):this.state===zg&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),s=e.cc;return function(e,t,s){if(e&&e.startCC<=t&&e.endCC>=t){const i=s.start,r=s.end;let a=e.fragments;if(!s.relurl){const{fragmentHint:t}=e;t&&(a=a.concat(t))}return Yf(a,(e=>e.cc<t||e.end<=i?1:e.cc>t||e.start>=r?-1:0))}return null}(t,s,e)||t&&Xf(t.fragments,s)||e}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=qg);const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),s>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=zg):this.state=Zg,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case zg:this.doTickIdle();break;case Zg:{const{levels:e,trackId:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=rp}break}case Jg:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=zg}break}case rp:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,a=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=Qg;const e={frag:t,part:s,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else a&&a.cc!==e.frag.cc&&(this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${a.cc}`),this.nextLoadPosition=this.findSyncFrag(a).start,this.clearWaitingFragment())}else this.state=zg}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==qg&&(this.state=zg))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||null==s||!s[r])return;const n=s[r],o=n.details;if(!o||this.waitForLive(n)||this.waitForCdnTuneIn(o))return this.state=Zg,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,wu,Xh));const d=this.getFwdBufferInfo(l,Xh);if(null===d)return;if(!this.switchingTrack&&this._streamEnded(d,o))return t.trigger(Kh.BUFFER_EOS,{type:"audio"}),void(this.state=sp);const c=d.len,h=t.maxBufferLength,u=o.fragments,f=u[0].start,m=this.getLoadPosition(),g=this.flushing?m:d.end;if(this.switchingTrack&&i){const e=m;o.PTSKnown&&e<f&&(d.end>f||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05)}if(c>=h&&!this.switchingTrack&&g<u[u.length-1].start)return;let p=this.getNextFragment(g,o);if(p&&this.isLoopLoading(p,g)&&(p=this.getNextFragmentLoopLoading(p,o,d,zh,h)),!p)return void(this.bufferFlushed=!0);let y=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Iu(p)&&!p.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===fm&&(this.mainFragLoading=y=null),y&&Iu(y))){if(p.start>y.end){const e=this.fragmentTracker.getFragAtPos(g,zh);e&&e.end>y.end&&(y=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(p.start>y.end)return}this.loadFragment(p,n,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new _f(e)))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==qg&&(this.setInterval(100),this.state=zg,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Kh.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:a,groupId:n,track:o}=t;if(!i)return void this.warn(`Audio tracks reset while loading track ${a} "${o.name}" of "${n}"`);const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==qg&&(this.state=Zg));this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${o.name}" of "${n}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const d=i[a];let c=0;if(r.live||null!=(s=d.details)&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var h;if(d.details)c=this.alignPlaylists(r,d.details,null==(h=this.levelLastLoaded)?void 0:h.details);r.alignedSliding||(Hg(r,l),r.alignedSliding||Yg(r,l),c=r.fragmentStart)}d.details=r,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(l,c),this.hls.trigger(Kh.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state!==Zg||this.waitForCdnTuneIn(r)||(this.state=zg),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:a,trackId:n,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const l=o[n];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const d=l.details;if(!d)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Fy(this.hls,Xh,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[s.cc],f=null==(t=s.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=i?i.index:-1,a=-1!==t,n=new Pm(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,a);h.push(r,f,c,"",s,i,d.totalduration,e,n,u)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${d.startSN} ,${d.endSN}],track ${n}`);const{cache:e}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new lp,complete:!1};e.push(new Uint8Array(r)),this.state!==qg&&(this.state=rp)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===zh&&Iu(t.frag)&&(this.mainFragLoading=t,this.state===zg&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type===Xh)if(this.fragContextChanged(s))this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(Iu(s)){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(Kh.AUDIO_TRACK_SWITCHED,iu({},e)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}else this.audioOnly||s.type!==zh||s.elementaryStreams.video||s.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var s;if(t.fatal)this.state=ip;else switch(t.details){case Vh.FRAG_GAP:case Vh.FRAG_PARSING_ERROR:case Vh.FRAG_DECRYPT_ERROR:case Vh.FRAG_LOAD_ERROR:case Vh.FRAG_LOAD_TIMEOUT:case Vh.KEY_LOAD_ERROR:case Vh.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xh,t);break;case Vh.AUDIO_TRACK_LOAD_ERROR:case Vh.AUDIO_TRACK_LOAD_TIMEOUT:case Vh.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Zg||(null==(s=t.context)?void 0:s.type)!==Wh||(this.state=zg);break;case Vh.BUFFER_ADD_CODEC_ERROR:case Vh.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.resetLoadingState();break;case Vh.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Vh.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==ku&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ku){this.flushing=!1,this.bufferFlushed=!0,this.state===sp&&(this.state=zg);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,Xh),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,n=this.getCurrentContext(a);if(!n)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:d}=n,{details:c}=d,{audio:h,text:u,id3:f,initSegment:m}=r;if(!this.fragContextChanged(o)&&c){if(this.state=ep,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(d,m.tracks,e,a),i.trigger(Kh.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=h;l&&(l.elementaryStreams[wu]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(wu,e,t,s,i),this.bufferFragmentData(h,o,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=tu({id:s,frag:o,details:c},f);i.trigger(Kh.FRAG_PARSING_METADATA,e)}if(u){const e=tu({id:s,frag:o,details:c},u);i.trigger(Kh.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,s,i){if(this.state!==ep)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=Xh;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&1===a.split(",").length&&(r.levelCodec=a),this.hls.trigger(Kh.BUFFER_CODECS,t);const n=r.initSegment;if(null!=n&&n.byteLength){const e={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:n};this.hls.trigger(Kh.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===cm||i===um)if(Iu(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=rp;const s=this.mainDetails;s&&s.fragmentStart!==t.details.fragmentStart&&Yg(t.details,s)}else super.loadFragment(e,t,s);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:n}=this.bufferedTrack;Gf({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:a,channels:n},e,Vf)||(Hf(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Kh.AUDIO_TRACK_SWITCHED,iu({},e))}},audioTrackController:class extends Oy{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.on(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Kh.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.off(Kh.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Kh.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Kh.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i)return void this.warn(`Audio track with id:${s} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const n=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,n)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=$f(t,e,Vf);if(s>-1)r=e[s];else{const e=$f(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const n={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==s?void 0:s.join(",")}`),this.hls.trigger(Kh.AUDIO_TRACKS_UPDATED,n);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var a;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Wh||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Gf(e,i,Vf))return i;const r=$f(e,this.tracksInGroup,Vf);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,s,i,r){const a=t[i],n=t.reduce(((e,t,s)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(s),e}),{})[a.uri];n.length>1&&(i=Math.max.apply(Math,n));const o=a.videoRange,l=a.frameRate,d=a.codecSet.substring(0,4),c=Kf(t,i,(t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==d)return!1;const i=t.audioGroups,a=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return $f(e,a,r)>-1}));return c>-1?c:Kf(t,i,(t=>{const i=t.audioGroups,a=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return $f(e,a,r)>-1}))}(e,t.levels,s,i,Vf);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=$f(e,s);if(t>-1)return s[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(Kh.AUDIO_TRACK_SWITCHING,iu({},i)),r)return;const a=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if((!this.selectDefaultTrack||i.default)&&(!e||Gf(e,i,Vf)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:o}=e;for(let e=0;e<t.length;e++){if(Gf({name:s,lang:i,assocLang:r,characteristics:a,audioCodec:n,channels:o},t[e],Vf))return e}for(let l=0;l<t.length;l++){const s=t[l];if(By(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const s=t[l];if(By(e.attrs,s.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Hf(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,n=null==a?void 0:a.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(Kh.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}},emeController:kv,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:qy.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:s}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),a={d:1e3*(s||t).duration,ot:r};r!==qy.VIDEO&&r!==qy.AUDIO&&r!=qy.MUXED||(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(r)/1e3,a.bl=this.getBufferLength(r));const n=s?this.getNextPart(s):this.getNextFrag(t);null!=n&&n.url&&n.url!==t.url&&(a.nor=n.url),this.apply(e,a)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Kh.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Kh.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:zy.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){tu(t,this.createData());const s=t.ot===qy.INIT||t.ot===qy.VIDEO||t.ot===qy.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce(((e,s)=>(i.includes(s)&&(e[s]=t[s]),e)),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Ev(e.headers,t,r)):e.url=Sv(e.url,t,r)}getNextFrag(e){var t;const s=null==(t=this.hls.levels[e.level])?void 0:t.details;if(s){const t=e.sn-s.startSN;return s.fragments[t+1]}}getNextPart(e){var t,s;const{index:i,fragment:r}=e,a=null==(t=this.hls.levels[r.level])||null==(s=t.details)?void 0:s.partList;if(a){const{sn:e}=r;for(let t=a.length-1;t>=0;t--){const s=a[t];if(s.index===i&&s.fragment.sn===e)return a[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?qy.TIMED_TEXT:"initSegment"===e.sn?qy.INIT:"audio"===t?qy.AUDIO:"main"===t?this.hls.audioTracks.length?qy.VIDEO:qy.MUXED:void 0}getTopBandwidth(e){let t,s=0;const i=this.hls;if(e===qy.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,s=e>-1?e+1:i.levels.length;t=i.levels.slice(0,s)}for(const r of t)r.bitrate>s&&(s=r.bitrate);return s>0?s:NaN}getBufferLength(e){const t=this.media,s=e===qy.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!t)return NaN;return 1e3*Cm.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}},contentSteeringController:class extends ru{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((null==s?void 0:s.action)===im&&s.flags===om){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:s,pathwayId:i,type:a}=t.context;s&&e?r=this.getPathwayForGroupId(s,a,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==r),s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${Of(i)} penalized: ${Of(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this._pathwayPriority=e;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach((e=>{i-s[e]>3e5&&delete s[e]}));for(let r=0;r<e.length;r++){const i=e[r];if(i in s)continue;if(i===this.pathwayId)return;const a=this.hls.nextLoadLevel,n=this.hls.levels[a];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,$g(t),this.hls.trigger(Kh.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];n&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==n.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==n.bitrate&&this.log(`Unstable Pathways change from bitrate ${n.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===Wh&&i[r].hasAudioGroup(e)||t===qh&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach((e=>{const{ID:r,"BASE-ID":a,"URI-REPLACEMENT":n}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(a).map((e=>{const t=new Um(e.attrs);t["PATHWAY-ID"]=r;const a=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;a&&(s[t.AUDIO]=a,t.AUDIO=a),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=wv(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",n),d=new _f({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let s=1;s<e.audioGroups.length;s++)d.addGroupId("audio",`${e.audioGroups[s]}_clone_${r}`);if(e.subtitleGroups)for(let s=1;s<e.subtitleGroups.length;s++)d.addGroupId("text",`${e.subtitleGroups[s]}_clone_${r}`);return d}));t.push(...o),Av(this.audioTracks,s,n,r),Av(this.subtitleTracks,i,n,r)}))}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new s(t);try{i=new self.URL(e)}catch(d){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,n=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},l={onSuccess:(e,t,s,r)=>{this.log(`Loaded steering manifest: "${i}"`);const a=e.data;if(1!==(null==a?void 0:a.VERSION))return void this.log(`Steering VERSION ${a.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":n,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=a;if(n)try{this.uri=new self.URL(n,i).href}catch(d){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${n}`)}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const c={steeringManifest:a,url:i.toString()};this.hls.trigger(Kh.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,s,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,s)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}},interstitialsController:class extends ru{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const s=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(s){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule()}if(this.checkBuffer(),s&&e<i.start||e>=i.end){var r;const e=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!s){const t=this.findItemIndex(i);if(e>t){const s=this.schedule.findJumpRestrictedIndex(t+1,e);if(s>t)return void this.setSchedulePosition(s)}}return void this.setSchedulePosition(e)}const a=this.playingAsset;if(!a){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const n=a.timelineStart,o=a.duration||0;(s&&e<n||e>=n+o)&&this.setScheduleToAssetAtTime(e,a)},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const s=this.playingAsset;if(!s)return;e>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(e,s)},this.onScheduleUpdate=(e,t)=>{const s=this.schedule,i=this.playingItem,r=s.events||[],a=s.items||[],n=s.durations,o=e.map((e=>e.identifier)),l=!(!r.length&&!o.length);if(l&&this.log(`INTERSTITIALS_UPDATED (${r.length}): ${r}\nSchedule: ${a.map((e=>Vv(e)))}`),o.length&&this.log(`Removed events ${o}`),this.playerQueue.forEach((e=>{if(e.interstitial.appendInPlace){const s=e.assetItem.timelineStart,i=e.timelineOffset-s;if(i)try{e.timelineOffset=s}catch(t){Math.abs(i)>_v&&this.warn(`${t} ("${e.assetId}" ${e.timelineOffset}->${s})`)}}})),i){const e=this.updateItem(i,this.timelinePos);this.itemsMatch(i,e)&&(this.playingItem=e,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d){const e=this.updateItem(d,this.bufferedPos);this.itemsMatch(d,e)?this.bufferingItem=e:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))}if(e.forEach((e=>{e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,null)}))})),l||t){if(this.hls.trigger(Kh.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:a.slice(0),durations:n,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn(`Interstitial "${i.event.identifier}" removed while playing`),void this.primaryFallback(i.event);this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Kv(e),this.schedule=new Gv(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Kh.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Kh.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Kh.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Kh.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Kh.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Kh.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Kh.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Kh.MEDIA_ENDED,this.onMediaEnded,this),e.on(Kh.ERROR,this.onError,this),e.on(Kh.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Kh.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Kh.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Kh.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Kh.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Kh.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Kh.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Kh.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Kh.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Kh.MEDIA_ENDED,this.onMediaEnded,this),e.off(Kh.ERROR,this.onError,this),e.off(Kh.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Yv(e,"play",this.onPlay),Yv(e,"pause",this.onPause),Yv(e,"seeking",this.onSeeking),Yv(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Hv(s,"seeking",this.onSeeking),Hv(s,"timeupdate",this.onTimeupdate),Hv(s,"play",this.onPlay),Hv(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===s)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(s);this.setSchedulePosition(e)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,r,n,o)=>{if(t){let l=t[i].start;const d=t.event;if(d){if("playout"===i||d.timelineOccupancy!==Mv.Point){const e=s(r);(null==e?void 0:e.interstitial)===d&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===n?a():e[n])-t.start}return l}return 0},r=(t,s)=>{if(0!==t&&"primary"!==s&&e.schedule.length){var i;const r=e.schedule.findItemIndexAtTime(t),a=null==(i=e.schedule.items)?void 0:i[r];if(a){return t+(a[s].start-a.start)}}return t},a=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?n("primary"):Math.max(t,0)},n=t=>{var s;return null!=(s=e.primaryDetails)&&s.live?e.primaryDetails.edge:e.schedule.durations[t]},o=(t,r)=>{var a,n;const o=e.effectivePlayingItem;if(null!=o&&null!=(a=o.event)&&a.restrictions.skip)return;e.log(`seek to ${t} "${r}"`);const l=e.effectivePlayingItem,d=e.schedule.findItemIndexAtTime(t,r),c=null==(n=e.schedule.items)?void 0:n[d],h=e.getBufferingPlayer(),u=null==h?void 0:h.interstitial,f=null==u?void 0:u.appendInPlace,m=l&&e.itemsMatch(l,c);if(l&&(f||m)){const a=s(e.playingAsset),n=(null==a?void 0:a.media)||e.primaryMedia;if(n){const s="primary"===r?n.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-s,d=(f?s:n.currentTime)+o;if(d>=0&&(!a||f||d<=a.duration))return void(n.currentTime=d)}}if(c){let s=t;if("primary"!==r){const e=t-c[r].start;s=c.start+e}const i=!e.isInterstitial(c);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!c.event.appendInPlace){if(l){const a=e.findItemIndex(l);if(d>a){const t=e.schedule.findJumpRestrictedIndex(a+1,d);if(t>a)return void e.setSchedulePosition(t)}let n=0;if(i)e.timelinePos=s,e.checkBuffer();else{var g;const e=null==c||null==(g=c.event)?void 0:g.assetList;if(e){const s=t-(c[r]||c).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&s>=i.startOffset&&s<i.startOffset+i.duration){n=t;break}}}}e.setSchedulePosition(d,n)}}else{const t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=s)}}},l=()=>{const s=e.effectivePlayingItem;if(e.isInterstitial(s))return s;const i=t();return e.isInterstitial(i)?i:null},d={get currentTime(){const t=l(),s=e.effectivePlayingItem;return s&&s===t?i(s,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-s.playout.start:0},set currentTime(t){const s=l(),i=e.effectivePlayingItem;i&&i===s&&o(t+i.playout.start,"playout")},get duration(){const e=l();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const s=null==(t=l())?void 0:t.event.assetList;return s?s.map((t=>e.getAssetPlayer(t.identifier))):[]},get playingIndex(){var t;const s=null==(t=l())?void 0:t.event;return s&&e.effectivePlayingAsset?s.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var t,s;return(null==(t=e.schedule)||null==(s=t.events)?void 0:s.slice(0))||[]},get schedule(){var t,s;return(null==(t=e.schedule)||null==(s=t.items)?void 0:s.slice(0))||[]},get interstitialPlayer(){return l()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const s=t();return e.findItemIndex(s)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return a()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){o(e,"primary")},get duration(){return n("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){o(e,"integrated")},get duration(){return n("integrated")},get seekableStart(){var t;return r((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,s=null==t?void 0:t.event;if(s&&!s.restrictions.skip){const i=e.findItemIndex(t);if(s.appendInPlace){const e=t.playout.start+t.event.duration;o(e+.001,"playout")}else e.advanceAfterAssetEnded(s,i,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&s)&&this.findItemIndex(t)===s.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t,s;if(null===this.mediaSelection)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(t=e.event)&&t.appendInPlace&&(r=this.primaryMedia);const a=null==(s=r)?void 0:s.currentTime;return void 0!==a&&Bh(a)?a:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Of(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const a=this.hls,n=e!==a,o=n&&e.interstitial.appendInPlace,l=null==(s=this.detachedData)?void 0:s.mediaSource;let d;if(a.media)o&&(r=a.transferMedia(),this.detachedData=r),d="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),d=`${e}`):d="detached MediaSource"}else d="detached media";if(!r)if(l)r=this.detachedData,this.log(`using detachedData: MediaSource ${Of(r)}`);else if(!this.detachedData||a.media===t){const e=this.playerQueue;e.length>1&&e.forEach((e=>{if(n&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}})),this.hls.detachMedia(),this.detachedData={media:t}}const c=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),h=c&&r?r:t;if(this.log(`${c?"transfering MediaSource":"attaching media"} to ${n?e:"Primary"} from ${d}`),h===r){const t=n&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!n||t,cueRemoval:!n}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(-1===s){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const s=e.findEventIndex(t[0].identifier);this.setSchedulePosition(s)}else if(s>=0||!this.primaryLive){const t=this.timelinePos=s>0?s:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAfterAssetEnded(e,t,s){const i=s+1;if(e.isAssetPastPlayoutLimit(i)||e.assetList[i].error){const s=this.schedule.items;if(s){const i=t+1;if(i>=s.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.timelinePos=r,this.checkBuffer()),this.setSchedulePosition(i)}}else this.setSchedulePosition(t,i)}setScheduleToAssetAtTime(e,t){const s=this.schedule,i=t.parentIdentifier,r=s.getEvent(i);if(r){const t=s.findEventIndex(i),a=s.findAssetIndex(r,e);this.setSchedulePosition(t,a)}}setSchedulePosition(e,t){const s=this.schedule.items;if(!s||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?s[e]:null,r=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(r)){var n;const l=r.event,d=this.playingAsset,c=null==d?void 0:d.identifier,h=c?this.getAssetPlayer(c):null;if(h&&c&&(!this.eventItemsMatch(r,i)||void 0!==t&&c!==(null==(n=l.assetList)?void 0:n[t].identifier))){var o;const t=l.findAssetIndex(d);this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${l.assetList.length} ${Uv(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(Kh.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(c,i),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(r,i)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${l} ${Vv(r)}`),l.hasPlayed=!0,this.hls.trigger(Kh.INTERSTITIAL_ENDED,{event:l,schedule:s.slice(0),scheduleIndex:e}),l.cue.once)){this.updateSchedule();const e=this.schedule.items;if(i&&e){const s=this.schedule.findItemIndex(i);this.advanceSchedule(s,e,t,r,a)}return}}this.advanceSchedule(e,s,t,r,a)}advanceSchedule(e,t,s,i,r){const a=e>=0?t[e]:null,n=this.primaryMedia,o=this.playerQueue;if(o.length&&o.forEach((t=>{const s=t.interstitial,i=this.schedule.findEventIndex(s.identifier);(i<e||i>e+1)&&this.clearInterstitial(s,a)})),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const r=a.event;void 0===s&&(s=this.schedule.findAssetIndex(r,this.timelinePos));const o=this.waitingItem;this.assetsBuffered(a,n)||this.setBufferingItem(a);let l=this.preloadAssets(r,s);if(this.eventItemsMatch(a,o||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Vv(a)} ${r.appendInPlace?"append in place":""}`),this.hls.trigger(Kh.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${r}`);if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!n)return void this.log(`Waiting for attachMedia to start Interstitial ${r}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const d=r.assetList[s];if(!d){const i=t[e+1],a=this.media;return i&&a&&!this.isInterstitial(i)&&a.currentTime<i.start&&(a.currentTime=this.timelinePos=i.start),void this.advanceAfterAssetEnded(r,e,s||0)}if(l||(l=this.getAssetPlayer(d.identifier)),null===l||l.destroyed){const e=r.assetList.length;this.warn(`asset ${s+1}/${e} player destroyed ${r}`),l=this.createAssetPlayer(r,d,s)}if(!this.eventItemsMatch(a,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(d))return;this.startAssetPlayer(l,s,t,e,n),this.shouldPlay&&Wv(l.media)}else null!==a?(this.resumePrimary(a,e,i),this.shouldPlay&&Wv(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e,t;return null==(e=this.mediaSelection)||null==(t=e.main)?void 0:t.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,s){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Vv(e)}`),null==(i=this.detachedData)||!i.mediaSource){let s=this.timelinePos;(s<e.start||s>=e.end)&&(s=this.getPrimaryResumption(e,t),this.timelinePos=s),this.attachPrimary(s,e)}if(!s)return;const r=this.schedule.items;r&&(this.log(`resumed ${Vv(e)}`),this.hls.trigger(Kh.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(s<e.fragmentStart||s>e.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Cm.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(s=i.mainForwardBufferInfo)?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Kh.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Kh.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level)return;const s=this.hls.levels[t.level],i=iu(iu({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=iu(iu({},this.altSelection),{},{audio:s}));const r=iu(iu({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=iu(iu({},this.altSelection),{},{subtitles:s}));const r=iu(iu({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Uf(t);this.playerQueue.forEach((e=>e.hls.setAudioOption(t)||e.hls.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Uf(t);this.playerQueue.forEach((e=>e.hls.setSubtitleOption(t)||-1!==t.id&&e.hls.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var s;const e=this.schedule.findEventIndex(i.identifier),t=null==(s=this.schedule.items)?void 0:s[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){const s=this.schedule.items;if(e&&s){return s[this.findItemIndex(e,t)]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===(null==(s=t.event)?void 0:s.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const s=Cm.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,t,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const a=this.playingItem,n=this.findItemIndex(a);let o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,d;const s=this.findItemIndex(r),i=Math.min(s+1,t.length-1),a=t[i];if((-1===o&&r&&e>=r.end||null!=(l=a.event)&&l.appendInPlace&&e+.01>=a.start)&&(o=i),i-n>1&&!1===(null==r||null==(d=r.event)?void 0:d.appendInPlace))return;if(this.bufferedPos=e,o>s&&o>n)this.bufferedToItem(a);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&a.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(a)&&this.preloadAssets(a.event,0)}}else s&&a&&!this.itemsMatch(a,r)&&(o===n?this.bufferedToItem(a):o===n+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some((e=>{const s=this.getAssetPlayer(e.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(t))}))}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:r}=s;if(!i||!r)return t;const a=this.isInterstitial(e),n=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const s=n?n.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${Vv(e)}`+(t?` (${s.toFixed(2)} remaining)`:"")),a?e.event.assetList.forEach((e=>{const t=this.getAssetPlayer(e.identifier);t&&t.resumeBuffering()})):(this.hls.resumeBuffering(),this.playerQueue.forEach((e=>e.pauseBuffering())))}this.hls.trigger(Kh.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==s){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=0===s.assetList.length&&!s.assetListLoader,r=s.cue.once;if(i||!r){const e=this.preloadAssets(s,t);if(null!=e&&e.interstitial.appendInPlace){const i=s.assetList[t],r=this.primaryMedia;i&&r&&this.bufferAssetPlayer(e,r)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,a=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var n;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(n=t.nextEvent)?void 0:n.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let a,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(a=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${a?` live-start: ${o} start-offset: ${a}`:""}`),s)return this.createAsset(e,0,0,r,e.duration,s);const l=this.assetListLoader.loadAssetList(e,a);l&&(e.assetListLoader=l)}else if(!a&&i){for(let s=t;s<i;s++){const t=e.assetList[s],i=this.getAssetPlayerQueueIndex(t.identifier);-1!==i&&!this.playerQueue[i].destroyed||t.error||this.createAssetPlayer(e,t,s)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach((t=>{this.hls.trigger(Kh.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s];return null}createAsset(e,t,s,i,r,a){const n={parentIdentifier:e.identifier,identifier:Fv(e,a,t),duration:r,startOffset:s,timelineStart:i,uri:a};return this.createAssetPlayer(e,n,t)}createAssetPlayer(e,t,s){this.log(`create HLSAssetPlayer for ${Uv(t)}`);const i=this.hls,r=i.userConfig;let a=r.videoPreference;const n=i.loadLevelObj||i.levels[i.currentLevel];(a||n)&&(a=tu({},a),n.videoCodec&&(a.videoCodec=n.videoCodec),n.videoRange&&(a.allowedVideoRanges=[n.videoRange]));const o=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const s=t.duration;s&&e<s&&(d=e)}}const c=t.identifier,h=iu(iu({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:c,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:o||r.audioPreference,subtitlePreference:l||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const u=h.cmcd;null!=u&&u.sessionId&&u.contentId&&(h.cmcd=tu({},u,{contentId:Nv(t.uri)})),this.getAssetPlayer(c)&&this.warn(`Duplicate date range identifier ${e} and asset ${c}`);const f=new $v(this.HlsPlayerClass,h,e,t);this.playerQueue.push(f),e.assetList[s]=t;const m=i=>{if(i.live){const t=new Error(`Interstitials MUST be VOD assets ${e}`),i={fatal:!0,type:Gh.OTHER_ERROR,details:Vh.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};return void this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)}const r=i.edge-i.fragmentStart,a=t.duration;(null===a||r>a)&&(this.log(`Interstitial asset "${c}" duration change ${a} > ${r}`),t.duration=r,this.updateSchedule())};f.on(Kh.LEVEL_UPDATED,((e,{details:t})=>m(t))),f.on(Kh.LEVEL_PTS_UPDATED,((e,{details:t})=>m(t)));const g=(e,t)=>{const s=this.getAssetPlayer(c);if(s&&t.tracks){s.off(Kh.BUFFER_CODECS,g),s.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===s.assetItem&&e&&!s.media&&this.bufferAssetPlayer(s,e)}};f.on(Kh.BUFFER_CODECS,g);const p=()=>{var s;const i=this.getAssetPlayer(c);if(this.log(`buffered to end of asset ${i}`),!i)return;const r=this.schedule.findEventIndex(e.identifier),a=e.findAssetIndex(t),n=a+1,o=null==(s=this.schedule.items)?void 0:s[r];if(this.isInterstitial(o))if(-1===a||e.isAssetPastPlayoutLimit(n)||e.assetList[n].error){var l;const e=null==(l=this.schedule.items)?void 0:l[r+1];e&&this.bufferedToItem(e)}else this.bufferedToItem(o,n)};f.on(Kh.BUFFERED_TO_END,p);const y=t=>()=>{if(!this.getAssetPlayer(c))return;this.shouldPlay=!0;const s=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,t)};return f.once(Kh.MEDIA_ENDED,y(s)),f.once(Kh.PLAYOUT_LIMIT_REACHED,y(1/0)),f.on(Kh.ERROR,((t,i)=>{const r=this.getAssetPlayer(c);if(i.details!==Vh.BUFFER_STALLED_ERROR)this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${i.error} ${e}`);else if(null!=r&&r.media){const t=r.currentTime,s=r.duration-t;t&&e.appendInPlace&&s/r.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${c} ${e} at ${r.media.currentTime}`),p()):(this.warn(`Stalled at ${t} of ${t+s} in asset ${c} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}})),f.on(Kh.DESTROYING,(()=>{if(!this.getAssetPlayer(c))return;const t=new Error(`Asset player destroyed unexpectedly ${c}`),i={fatal:!0,type:Gh.OTHER_ERROR,details:Vh.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)})),this.hls.trigger(Kh.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:f}),f}clearInterstitial(e,t){e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,t)})),e.reset()}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(-1!==s){this.log(`clearAssetPlayer "${e}" toSegment: ${t?Vv(t):t}`);const i=this.playerQueue[s];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:a,assetItem:n,assetId:o}=e,l=a.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=n,d&&d.identifier===o||(d&&(this.clearAssetPlayer(d.identifier,s[i]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${e}`),this.hls.trigger(Kh.INTERSTITIAL_ASSET_STARTED,{asset:n,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;const{interstitial:r,assetItem:a,assetId:n}=e,o=this.schedule.findEventIndex(r.identifier),l=null==(s=this.schedule.items)?void 0:s[o];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=a;const d=this.getBufferingPlayer();if(d===e)return;const c=r.appendInPlace;if(c&&!1===(null==d?void 0:d.interstitial.appendInPlace))return;const h=(null==d?void 0:d.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks)return;if(h&&!uu(h,e.tracks)){const t=new Error(`Asset "${n}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),s={fatal:!0,type:Gh.OTHER_ERROR,details:Vh.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(a);return void this.handleAssetItemError(s,r,o,i,t.message)}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,s,i,r){if(e.details===Vh.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;let n=null;if(a){const e=this.getAssetPlayerQueueIndex(a.identifier);n=this.playerQueue[e]||null}const o=this.schedule.items,l=tu({},e,{fatal:!1,errorAction:dm(!0),asset:a,assetListIndex:i,event:t,schedule:o,scheduleIndex:s,player:n});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(Kh.INTERSTITIAL_ASSET_ERROR,l),!e.fatal)return;const d=new Error(r);a&&(this.playingAsset!==a&&this.clearAssetPlayer(a.identifier,null),a.error=d),t.assetList.some((e=>!e.error))?t.appendInPlace&&(t.error=d):t.error=d,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${s?Vv(s):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(s,i);if(this.itemsMatch(s,r))this.clearInterstitial(e,null);else{const e=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(e)}}else this.checkStart()}onAssetListLoaded(e,t){var s;const i=t.event,r=i.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const n=i.timelineStart,o=i.duration;let l=0;a.forEach(((e,t)=>{const s=parseFloat(e.DURATION);this.createAsset(i,t,l,n+l,s,e.URI),l+=s})),i.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${o}) ${i}`);const d=this.waitingItem,c=(null==d?void 0:d.event.identifier)===r;this.updateSchedule();const h=null==(s=this.bufferingItem)?void 0:s.event;if(c){var u;const e=this.schedule.findEventIndex(r),t=null==(u=this.schedule.items)?void 0:u[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===r&&h.appendInPlace){const e=i.assetList[0],t=this.getAssetPlayer(e.identifier),s=this.primaryMedia;e&&t&&s&&this.bufferAssetPlayer(t,s)}}onError(e,t){switch(t.details){case Vh.ASSET_LIST_PARSING_ERROR:case Vh.ASSET_LIST_LOAD_ERROR:case Vh.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&this.primaryFallback(e);break}case Vh.BUFFER_STALLED_ERROR:this.onTimeupdate(),this.checkBuffer(!0)}}}});function Qx(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Qx):Object.keys(e).reduce(((t,s)=>(t[s]=Qx(e[s]),t)),{}):e}function Jx(e,t){const s=e.loader;if(s!==Hx&&s!==zx)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=Hx,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class Zx extends Im{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(Kh.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const s=this.media=t.media;Hv(s,"playing",this.onMediaPlaying),Hv(s,"waiting",this.onMediaWaiting),Hv(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Yv(s,"playing",this.onMediaPlaying),Yv(s,"waiting",this.onMediaWaiting),Yv(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=null==(s=this.hls)?void 0:s.config;if(!r)return;const{media:a,stalled:n}=this;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,d=!this.seeking&&o,c=a.paused&&!o||a.ended||0===a.playbackRate;if(this.seeking=o,e!==t)return t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(d||l)return void(l&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Kh.MEDIA_ENDED,{stalled:!1})));if(!Cm.getBuffered(a).length)return void(this.nudgeRetry=0);const h=Cm.bufferInfo(a,e,0),u=h.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const t=eb(this.hls.inFlightFragments,e),s=h.len>2,i=!u||t||u-e>2&&!f.getPartialFragment(e);if(s||i)return;this.moved=!1}const m=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(h.len>0)&&!u)return;const t=Math.max(u,h.start||0)-e,s=!(null==m||!m.live)?2*m.targetduration:2,i=f.getPartialFragment(e);if(t>0&&(t<=s||i))return void(a.paused||this._trySkipBufferHole(i))}const g=r.detectStallWithCurrentTimeMs,p=self.performance.now(),y=this.waiting;if(null===n)return void(this.stalled=y>0&&p-y<g?y:p);const v=p-n;if(!o&&(v>=g||y)&&this.hls){var x;if("ended"===(null==(x=this.mediaSource)?void 0:x.readyState)&&(null==m||!m.live)&&Math.abs(e-((null==m?void 0:m.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(Kh.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(h),!this.media||!this.hls)return}const b=Cm.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(b,v)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(Kh.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(s=this.buffered.audio)&&s.length&&i&&i.length>1&&e>i.end(0)){const s=Cm.bufferedInfo(Cm.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const s=Cm.timeRangesToArray(i),r=Cm.bufferedInfo(s,t,0).bufferedIndex;if(r>-1&&r<s.length-1){const t=Cm.bufferedInfo(s,e,0).bufferedIndex,i=s[r].end,a=s[r+1].start;if((-1===t||t>r)&&a-i<1&&e-i<2){const s=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${i} -> ${a} buffered index: ${t}`);this.warn(s.message),this.media.currentTime+=1e-6;const r=this.fragmentTracker.getPartialFragment(e)||void 0,n=Cm.bufferInfo(this.media,e,0);this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:r,buffer:n.len,bufferInfo:n})}}}}}_tryFixBufferStall(e,t){var s,i;const{fragmentTracker:r,media:a}=this,n=null==(s=this.hls)?void 0:s.config;if(!a||!r||!n)return;const o=a.currentTime,l=null==(i=this.hls)?void 0:i.latestLevelDetails,d=r.getPartialFragment(o);if(d||null!=l&&l.live&&o<l.fragmentStart){if(this._trySkipBufferHole(d)||!this.media)return}const c=e.buffered;(c&&c.length>1&&e.len>n.maxBufferHole||e.nextStart&&e.nextStart-o<n.maxBufferHole)&&(t>1e3*n.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&null!==r&&s&&t){this.stallReported=!0;const i=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Of(e)})`);this.warn(i.message),t.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!s||!r)return 0;const a=i.currentTime,n=Cm.bufferInfo(i,a,0),o=a<n.start?n.start:n.nextStart;if(o&&this.hls){const t=n.len<=r.maxBufferHole,d=n.len>0&&n.len<1&&i.readyState<3,c=o-a;if(c>0&&(t||d)){if(c>r.maxBufferHole){let t=!1;if(0===a){const e=s.getAppendedFrag(0,zh);e&&o<e.end&&(t=!0)}if(!t){const t=e||s.getAppendedFrag(a,zh);if(t){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(eb(this.hls.inFlightFragments,o))return 0;let e=!1,i=t.end;for(;i<o;){const t=s.getPartialFragment(i);if(!t){e=!0;break}i+=t.duration}if(e)return 0}}}const t=Math.max(o+.05,a+.1);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${t}`),this.moved=!0,i.currentTime=t,null==e||!e.gap){const s=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${t}`);this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:e||void 0,buffer:n.len,bufferInfo:n})}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!s||!r)return 0;const a=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const n=a+(i+1)*r.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${a} to ${n}`);this.warn(o.message),s.currentTime=n,t.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const s=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(s.message),t.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.BUFFER_STALLED_ERROR,error:s,fatal:!0,buffer:e.len,bufferInfo:e})}}}function eb(e,t){const s=tb(e.main);if(s&&s.start<=t)return s;const i=tb(e.audio);return i&&i.start<=t?i:null}function tb(e){if(!e)return null;switch(e.state){case zg:case qg:case sp:case ip:return null}return e.frag}function sb(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function ib(e,t,s,i,r){let a=new e(t,s,"");try{a.value=i,r&&(a.type=r)}catch(n){a=new e(t,s,Of(r?iu({type:r},i):i))}return a}const rb=(()=>{const e=sb();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class ab{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Kh.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Kh.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(Kh.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Kh.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Kh.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var s;this.media=t.media,!1===(null==(s=t.overrides)?void 0:s.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&Pv(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return Rv(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:i}}}=this;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=sb();if(a)for(let n=0;n<r.length;n++){const e=r[n].type;if(e===Op.emsg&&!s||!i)continue;const t=Np(r[n].data);if(t){const s=r[n].pts;let i=s+r[n].duration;i>rb&&(i=rb);i-s<=0&&(i=s+.25);for(let r=0;r<t.length;r++){const n=t[r];if(!_p(n)){this.updateId3CueEnds(s,e);const t=ib(a,s,i,n,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var s;const i=null==(s=this.id3Track)?void 0:s.cues;if(i)for(let r=i.length;r--;){const s=i[r];s.type===t&&s.startTime<e&&s.endTime===rb&&(s.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}=a;if(r&&(n||o)){let e;e="audio"===i?e=>e.type===Op.audioId3&&o:"video"===i?e=>e.type===Op.emsg&&n:e=>e.type===Op.audioId3&&o||e.type===Op.emsg&&n,Dv(r,t,s,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:s}=this,{dateRanges:i}=e,r=Object.keys(i);let a=this.dateRangeCuesAppended;var n;if(s&&t)if(null!=(n=s.cues)&&n.length){const e=Object.keys(a).filter((e=>!r.includes(e)));for(let t=e.length;t--;){const i=e[t],r=a[i].cues;delete a[i],Object.keys(r).forEach((e=>{try{const t=r[e];t.removeEventListener("enter",this.onEventCueEnter),s.removeCue(t)}catch(t){}}))}}else a=this.dateRangeCuesAppended={};const o=e.fragments[e.fragments.length-1];if(0===r.length||!Bh(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=sb();for(let h=0;h<r.length;h++){const e=r[h],t=i[e],s=t.startTime,n=a[e],o=(null==n?void 0:n.cues)||{};let u=(null==n?void 0:n.durationKnown)||!1,f=rb;const{duration:m,endDate:g}=t;if(g&&null!==m)f=s+m,u=!0;else if(t.endOnNext&&!u){const e=r.reduce(((e,s)=>{if(s!==t.id){const r=i[s];if(r.class===t.class&&r.startDate>t.startDate&&(!e||t.startDate<e.startDate))return r}return e}),null);e&&(f=e.startTime,u=!0)}const p=Object.keys(t.attr);for(let i=0;i<p.length;i++){const r=p[i];if("ID"===(c=r)||"CLASS"===c||"CUE"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;const a=o[r];if(a)u&&!n.durationKnown?a.endTime=f:Math.abs(a.startTime-s)>.01&&(a.startTime=s,a.endTime=f);else if(l){let i=t.attr[r];$m(r)&&(d=i,i=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const a=ib(l,s,f,{key:r,data:i},Op.dateRange);a&&(a.id=e,this.id3Track.addCue(a),o[r]=a,this.hls.config.interstitialsController&&("X-ASSET-LIST"!==r&&"X-ASSET-URL"!==r||a.addEventListener("enter",this.onEventCueEnter)))}}a[e]={cues:o,dateRange:t,durationKnown:u}}var d,c}}class nb{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const a=this.targetLatency;if(null===a)return;const n=s-a;if(n<Math.min(this.maxLatency,a+t.targetduration)&&n>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,s));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:n}=this.config,o=this.hls.userConfig;let l=n&&s||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:a*i);const d=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const s=this.levelDetails;if(null===s)return null;const i=s.edge,r=e-t-this.edgeStalled,a=i-s.totalduration,n=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,r),n)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Kh.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Kh.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Kh.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Kh.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Vh.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(s=this.levelDetails)&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&(null==(s=this.hls)||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class ob extends Oy{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Kh.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Kh.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Kh.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let n=!1,o=!1,l=!1;t.levels.forEach((e=>{var t;const d=e.attrs;let{audioCodec:c,videoCodec:h}=e;c&&(e.audioCodec=c=yf(c,s)||void 0),0===(null==(t=h)?void 0:t.indexOf("avc1"))&&(h=e.videoCodec=function(e){const t=e.split(",");for(let s=0;s<t.length;s++){const e=t[s].split(".");if(e.length>2){let i=e.shift()+".";i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t[s]=i}}return t.join(",")}(h));const{width:u,height:f,unknownCodecs:m}=e;let g=m?m.length:0;if(m)for(let s=g;s--;){const t=m[s];this.isAudioSupported(t)?(e.audioCodec=c=c?`${c},${t}`:t,g--,lf.audio[c.substring(0,4)]=2):this.isVideoSupported(t)&&(e.videoCodec=h=h?`${h},${t}`:t,g--,lf.video[h.substring(0,4)]=2)}if(n||(n=!(!u||!f)),o||(o=!!h),l||(l=!!c),g||c&&!this.isAudioSupported(c)||h&&!this.isVideoSupported(h))return void this.log(`Some or all CODECS not supported "${d.CODECS}"`);const{CODECS:p,"FRAME-RATE":y,"HDCP-LEVEL":v,"PATHWAY-ID":x,RESOLUTION:b,"VIDEO-RANGE":E}=d,T=`${`${x||"."}-`}${e.bitrate}-${b}-${y}-${p}-${E}-${v}`;if(r[T])if(r[T].uri===e.url||e.attrs["PATHWAY-ID"])r[T].addGroupId("audio",d.AUDIO),r[T].addGroupId("text",d.SUBTITLES);else{const t=a[T]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=this.createLevel(e);r[T]=s,i.push(s)}else{const t=this.createLevel(e);r[T]=t,a[T]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,n,o,l)}createLevel(e){const t=new _f(e),s=e.supplemental;if(null!=s&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(e.message),t.supportedResult=Sf(e,[])}return t}isAudioSupported(e){return cf(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return cf(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){let a=[],n=[],o=e;if((s||i)&&r&&(o=o.filter((({videoCodec:e,videoRange:t,width:s,height:i})=>{return(!!e||!(!s||!i))&&(!!(r=t)&&Rf.indexOf(r)>-1);var r}))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){let e="no level with compatible codecs found in manifest",s=e;t.levels.length&&(s=`one or more CODECS in variant not supported: ${Of(t.levels.map((e=>e.attrs.CODECS)).filter(((e,t,s)=>s.indexOf(e)===t)))}`,this.warn(s),e+=` (${s})`);const i=new Error(e);this.hls.trigger(Kh.ERROR,{type:Gh.MEDIA_ERROR,details:Vh.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:s})}}));t.audioTracks&&(a=t.audioTracks.filter((e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),lb(a)),t.subtitles&&(n=t.subtitles,lb(n));const l=o.slice(0);o.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Rf.indexOf(e.videoRange)-Rf.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=ff(e.videoCodec),i=ff(t.videoCodec);if(s!==i)return i-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=mf(e.codecSet),i=mf(t.codecSet);if(s!==i)return i-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let d=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let g=0;g<l.length;g++)if(l[g].pathwayId===o[0].pathwayId){d=l[g];break}this._levels=o;for(let g=0;g<o.length;g++)if(o[g]===d){var c;this._firstLevel=g;const e=d.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(c=this.hls.userConfig)?void 0:c.abrEwmaDefaultEstimate)){const s=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);s>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=s)}break}const h=r&&!i,u=this.hls.config,f=!(!u.audioStreamController||!u.audioTrackController),m={levels:o,audioTracks:a,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:f&&!h&&a.some((e=>!!e.url))};this.hls.trigger(Kh.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:s,reason:s.message}),i)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],n=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&i&&r===n)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${n?" with Pathway "+n:""} from level ${s}${r?" with Pathway "+r:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(Kh.LEVEL_SWITCHING,o);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter((e=>-1!==t.indexOf(e)));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=s}}onError(e,t){!t.fatal&&t.context&&t.context.type===Yh&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===zh){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const s=this._levels[t.level];null!=s&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,a=t.levelInfo;var n;if(!a)return this.warn(`Invalid level index ${i}`),void(null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0));if(a===this.currentLevel||t.withoutMultiVariant){0===a.fragmentError&&(a.loadError=0);let e=a.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,n=null==a?void 0:a.age;this.log(`Loading level index ${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${n&&a.live?" age "+n.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(Kh.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const s=this._levels.filter(((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));$g(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(Kh.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Kh.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function lb(e){const t={};e.forEach((e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++}))}function db(){return self.SourceBuffer||self.WebKitSourceBuffer}function cb(){if(!hu())return!1;const e=db();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class hb extends np{constructor(e,t,s){super(e,t,s,"stream-controller",zh),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!Bh(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const s=this.getFwdBufferInfoAtPos(e,t,zh,0);null!==s&&0!==s.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${s?s.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.on(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kh.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Kh.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Kh.BUFFER_CREATED,this.onBufferCreated,this),e.on(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Kh.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Kh.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kh.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kh.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Kh.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Kh.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Kh.BUFFER_CREATED,this.onBufferCreated,this),e.off(Kh.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Kh.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=zg,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=qg}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ap:{const{levels:e,level:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=zg;break}if(this.hls.nextLoadLevel!==this.level){this.state=zg;break}break}case Jg:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,s=null==e?void 0:e[t];this.resetStartWhenNotLoaded(s||null),this.state=zg}}}this.state===zg&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const a=s[r],n=this.getMainFwdBufferInfo();if(null===n)return;const o=this.getLevelDetails();if(o&&this._streamEnded(n,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(Kh.BUFFER_EOS,e),void(this.state=sp)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=a.details;if(!l||this.state===ap||this.waitForLive(a))return this.level=r,this.state=ap,void(this.startFragRequested=!1);const d=n.len,c=this.getMaxBufferLength(a.maxBitrate);if(d>=c)return;this.backtrackFragment&&this.backtrackFragment.start>n.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:n.end;let u=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&u&&Iu(u)&&this.fragmentTracker.getState(u)!==fm){var f;const e=(null!=(f=this.backtrackFragment)?f:u).sn-l.startSN,t=l.fragments[e-1];t&&u.cc===t.cc&&(u=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&n.len&&(this.backtrackFragment=null);if(u&&this.isLoopLoading(u,h)){if(!u.gap){const e=this.audioOnly&&!this.altAudio?wu:ku,t=(e===ku?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,zh)}u=this.getNextFragmentLoopLoading(u,l,n,zh,c)}u&&(!u.initSegment||u.initSegment.data||this.bitrateTest||(u=u.initSegment),this.loadFragment(u,a,h))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===cm||i===um?Iu(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,zh)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;s=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,i=Math.max(a.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Xg:case Qg:case Jg:case ep:case tp:this.state=zg}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Hv(s,"playing",this.onMediaPlaying),Hv(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Yv(s,"playing",this.onMediaPlaying),Yv(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Kh.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(s=s||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=s&&i&&!function(){var e;const t=db();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==zg)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ap)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,a=t.level,n=t.details,o=n.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${a}`);this.log(`Level ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${o}`);const l=t.levelInfo,d=this.fragCurrent;!d||this.state!==Qg&&this.state!==Jg||d.level!==t.level&&d.loader&&this.abortCurrentFrag();let c=0;if(n.live||null!=(s=l.details)&&s.live){var h;if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;c=this.alignPlaylists(n,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=n,this.levelLastLoaded=l,r||this.setStartPosition(n,c),this.hls.trigger(Kh.LEVEL_UPDATED,{details:n,level:a}),this.state===ap){if(this.waitForCdnTuneIn(n))return;this.state=zg}r&&n.live&&this.synchronizeToLiveEdge(n),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,n=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=n;if(null!==i&&s.duration>i&&(r<i||!o)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&s.readyState<4||r<n-a)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${n}, reset currentTime to : ${i.toFixed(3)}`),s.currentTime=i))}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:a}=this;if(!a)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const n=a[s.level];if(!n)return void this.warn(`Level ${s.level} not found on progress`);const o=n.details;if(!o)return this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),void this.fragmentTracker.removeFragment(s);const l=n.videoCodec,d=o.PTSKnown||!o.live,c=null==(t=s.initSegment)?void 0:t.data,h=this._getAudioCodec(n),u=this.transmuxer=this.transmuxer||new Fy(this.hls,zh,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,m=-1!==f,g=new Pm(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,m),p=this.initPTS[s.cc];u.push(r,c,h,l,s,i,o.totalduration,d,g,p)}onAudioTrackSwitching(e,t){const s=this.hls,i=2===this.altAudio;if(Hf(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),s.once(Kh.BUFFER_FLUSHED,(()=>{var e;null==(e=this.hls)||e.trigger(Kh.AUDIO_TRACK_SWITCHED,t)})),void s.trigger(Kh.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});s.trigger(Kh.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Hf(t.url,this.hls);if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,a=!1;for(const n in s){const e=s[n];if("main"===e.id){if(r=n,i=e,"video"===n){const e=s[n];e&&(this.videoBuffer=e.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===zh;if(r){if(this.fragContextChanged(s))return this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===tp&&(this.state=zg));const e=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),Iu(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const a=this.media;a&&(!this._hasEnoughToStart&&Cm.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal)this.state=ip;else switch(t.details){case Vh.FRAG_GAP:case Vh.FRAG_PARSING_ERROR:case Vh.FRAG_DECRYPT_ERROR:case Vh.FRAG_LOAD_ERROR:case Vh.FRAG_LOAD_TIMEOUT:case Vh.KEY_LOAD_ERROR:case Vh.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(zh,t);break;case Vh.LEVEL_LOAD_ERROR:case Vh.LEVEL_LOAD_TIMEOUT:case Vh.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ap||(null==(s=t.context)?void 0:s.type)!==Yh||(this.state=zg);break;case Vh.BUFFER_ADD_CODEC_ERROR:case Vh.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.resetLoadingState();break;case Vh.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Vh.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=zg,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==wu||!this.altAudio){const e=(t===ku?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,zh),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log(`could not seek to ${s}, already seeking at ${t}`);const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),a=Cm.getBuffered(e),n=a.length?a.start(0):0,o=n-s,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0))&&(this.log(`adjusting start position by ${o} to match buffer start`),s+=o,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${n}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((e=>{const{hls:s}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=zg,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(Kh.FRAG_LOADED,e),i.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,n=this.getCurrentContext(a);if(!n)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:d}=n,{video:c,text:h,id3:u,initSegment:f}=r,{details:m}=d,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=ep,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(d,f.tracks,e,a),i.trigger(Kh.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;Bh(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(Kh.INIT_PTS_FOUND,{frag:o,id:s,initPTS:e,timescale:t}))}if(c&&m){g&&"audiovideo"===c.type&&this.logMuxedErr(o);const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,s=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:n}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:n};else if(c.firstKeyFrame&&c.independent&&1===a.id&&!s&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),a=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&a<l-this.config.maxBufferHole&&!s)return void this.backtrack(o);s&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,i,o.start,n,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(c.type,e,i,r,n),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,a,t||s)}else{if(!t&&!s)return void this.backtrack(o);o.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=g;l&&(l.elementaryStreams[wu]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(wu,e,t,s,i),this.bufferFragmentData(g,o,l,a)}if(m&&null!=u&&null!=(t=u.samples)&&t.length){const e={id:s,frag:o,details:m,samples:u.samples};i.trigger(Kh.FRAG_PARSING_METADATA,e)}if(m&&h){const e={id:s,frag:o,details:m,samples:h.samples};i.trigger(Kh.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${Iu(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==ep)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:a,audiovideo:n}=t;if(r){let s=vf(r.codec,e.audioCodec);"mp4a"===s&&(s="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){s&&(s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(s="mp4a.40.5")}s&&-1!==s.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",this.log(`Android: force audio codec to ${s}`)),e.audioCodec&&e.audioCodec!==s&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${s}"`),r.levelCodec=s,r.id=zh,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${s||""}/${e.audioCodec||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=zh;const s=a.codec;if(4===(null==s?void 0:s.length))switch(s){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e"}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s}]${a.codec!==s?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}n&&(this.log(`Init audiovideo buffer, container:${n.container}, codecs[level/parsed]=[${e.codecs}/${n.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(Kh.BUFFER_CODECS,t),!this.hls)return;o.forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(Kh.BUFFER_APPENDING,{type:e,data:r,frag:s,part:null,chunkMeta:i,parent:s.type})}))}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,zh)}get maxBufferLength(){const{levels:e,level:t}=this,s=null==e?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=zg}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(Cm.isBuffered(e,s)?t=this.getAppendedFrag(s):Cm.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(Kh.FRAG_CHANGED,{frag:t}),e&&e.level===s||this.hls.trigger(Kh.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return Bh(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(Bh(t)){const e=this.getLevelDetails(),s=this.currentFrag||(e?Wf(null,e.fragments,t):null);if(s){const e=s.programDateTime;if(null!==e){const i=e+1e3*(t-s.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class ub{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[s].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Vh.KEY_LOAD_ERROR,s,i,r){return new Rm({type:Gh.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:s,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===s||"initSegment"===r.sn||s<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Vh.KEY_LOAD_ERROR,s))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Vh.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let n=this.keyUriToKeyInfo[a];if(null!=(s=n)&&s.decryptdata.key)return r.key=n.decryptdata.key,Promise.resolve({frag:e,keyInfo:n});var o;if(null!=(i=n)&&i.keyLoadPromise)switch(null==(o=n.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return n.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:n})))}switch(n=this.keyUriToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(n,e):this.loadKeyEME(n,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(n,e);default:return Promise.reject(this.createKeyLoadError(e,Vh.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(s);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,s)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=new(0,s.loader)(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((r,a)=>{const n={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=s.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(e,t,s,i)=>{const{frag:n,keyInfo:o,url:l}=s;if(!n.decryptdata||o!==this.keyUriToKeyInfo[l])return a(this.createKeyLoadError(n,Vh.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=n.decryptdata.key=new Uint8Array(e.data),n.keyLoader=null,o.loader=null,r({frag:n,keyInfo:o})},onError:(e,s,i,r)=>{this.resetLoader(s),a(this.createKeyLoadError(t,Vh.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,iu({url:n.url,data:void 0},e)))},onTimeout:(e,s,i)=>{this.resetLoader(s),a(this.createKeyLoadError(t,Vh.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,s,i)=>{this.resetLoader(s),a(this.createKeyLoadError(t,Vh.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(n,l,d)}))}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function fb(e){const{type:t}=e;switch(t){case Wh:return Xh;case qh:return Qh;default:return zh}}function mb(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class gb{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.on(Kh.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Kh.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Kh.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Kh.LEVEL_LOADING,this.onLevelLoading,this),e.off(Kh.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Kh.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Kh.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=new(s||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Hh,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:a,deliveryDirectives:n,levelInfo:o}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:Yh,url:a,deliveryDirectives:n,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:n}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:Wh,url:r,deliveryDirectives:a,levelOrTrack:n})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:a,track:n}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:qh,url:r,deliveryDirectives:a,levelOrTrack:n})}onLevelsUpdated(e,t){const s=this.loaders[Yh];if(s){const e=s.context;e&&!t.levels.some((t=>t===e.levelOrTrack))&&(s.abort(),delete this.loaders[Yh])}}load(e){var t;const s=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=this.hls.logger,s=r.context;if(s&&s.levelOrTrack===e.levelOrTrack&&(s.url===e.url||s.deliveryDirectives&&!e.deliveryDirectives))return void(s.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${s.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===Hh?s.manifestLoadPolicy.default:tu({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Bh(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Yh&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Wh&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===qh&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);i=tu({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},n={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(e,t,s,i)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const a=e.data;0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),xg.isMediaPlaylist(a)||s.type!==Hh?this.handleTrackOrLevelPlaylist(e,t,s,i||null,r):this.handleMasterPlaylist(e,t,s,i)):this.handleManifestParsingError(e,s,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,s,i)=>{this.handleNetworkError(t,s,!1,e,i)},onTimeout:(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};r.load(e,n,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,a=e.data,n=mb(e,s),o=xg.parseMasterPlaylist(a,n);if(o.playlistParsingError)return void this.handleManifestParsingError(e,s,o.playlistParsingError,i,t);const{contentSteering:l,levels:d,sessionData:c,sessionKeys:h,startTimeOffset:u,variableList:f}=o;this.variableList=f;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":p}=xg.parseMasterPlaylistMedia(a,n,o);if(m.length){m.some((e=>!e.url))||!d[0].audioCodec||d[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Um({}),bitrate:0,url:""}))}r.trigger(Kh.MANIFEST_LOADED,{levels:d,audioTracks:m,subtitles:g,captions:p,contentSteering:l,url:n,stats:t,networkDetails:i,sessionData:c,sessionKeys:h,startTimeOffset:u,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,i,r){const a=this.hls,{id:n,level:o,type:l}=s,d=mb(e,s),c=Bh(o)?o:Bh(n)?n:0,h=fb(s),u=xg.parseLevelPlaylist(e.data,d,c,h,0,this.variableList);if(l===Hh){const e={attrs:new Um({}),bitrate:0,details:u,name:"",url:d};u.requestScheduled=t.loading.start+Og(u,0),a.trigger(Kh.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=u,this.handlePlaylistLoaded(u,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(Kh.ERROR,{type:Gh.NETWORK_ERROR,details:Vh.MANIFEST_PARSING_ERROR,fatal:t.type===Hh,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let a=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Yh?a+=`: ${e.level} id: ${e.id}`:e.type!==Wh&&e.type!==qh||(a+=` id: ${e.id} group-id: "${e.groupId}"`);const n=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let o=Vh.UNKNOWN,l=!1;const d=this.getInternalLoader(e);switch(e.type){case Hh:o=s?Vh.MANIFEST_LOAD_TIMEOUT:Vh.MANIFEST_LOAD_ERROR,l=!0;break;case Yh:o=s?Vh.LEVEL_LOAD_TIMEOUT:Vh.LEVEL_LOAD_ERROR,l=!1;break;case Wh:o=s?Vh.AUDIO_TRACK_LOAD_TIMEOUT:Vh.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case qh:o=s?Vh.SUBTITLE_TRACK_LOAD_TIMEOUT:Vh.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);const c={type:Gh.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:d,context:e,error:n,networkDetails:t,stats:r};if(i){const s=(null==t?void 0:t.url)||e.url;c.response=iu({url:s,data:void 0},i)}this.hls.trigger(Kh.ERROR,c)}handlePlaylistLoaded(e,t,s,i,r,a){const n=this.hls,{type:o,level:l,id:d,groupId:c,deliveryDirectives:h}=i,u=mb(t,i),f=fb(i),m="number"==typeof i.level&&f===zh?l:void 0;if(!e.fragments.length){const a=e.playlistParsingError=new Error("No Segments found in Playlist");return void n.trigger(Kh.ERROR,{type:Gh.NETWORK_ERROR,details:Vh.LEVEL_EMPTY_ERROR,fatal:!1,url:u,error:a,reason:a.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){if(this.hls.logger.warn(g),!n.config.ignorePlaylistParsingErrors)return void n.trigger(Kh.ERROR,{type:Gh.NETWORK_ERROR,details:Vh.LEVEL_PARSING_ERROR,fatal:!1,url:u,error:g,reason:g.message,response:t,context:i,level:m,parent:f,networkDetails:r,stats:s});e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Hh:case Yh:n.trigger(Kh.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||n.levels[0],level:m||0,id:d||0,stats:s,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:o===Hh});break;case Wh:n.trigger(Kh.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:d||0,groupId:c||"",stats:s,networkDetails:r,deliveryDirectives:h});break;case qh:n.trigger(Kh.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:d||0,groupId:c||"",stats:s,networkDetails:r,deliveryDirectives:h})}}}class pb{static get version(){return fp}static isMSESupported(){return cb()}static isSupported(){return function(){if(!cb())return!1;const e=hu();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(uf(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(uf(t,"audio")))))}()}static getMediaSource(){return hu()}static get Events(){return Kh}static get MetadataSchema(){return Op}static get ErrorTypes(){return Gh}static get ErrorDetails(){return Vh}static get DefaultConfig(){return pb.defaultConfig?pb.defaultConfig:Xx}static set DefaultConfig(e){pb.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new up,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,s){const i=ou();if("object"==typeof console&&!0===e||"object"==typeof e){const a=["debug","log","info","warn","error"];a.forEach((t=>{i[t]=lu(t,e,s)}));try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.2`)}catch(r){return ou()}a.forEach((t=>{du[t]=lu(t,e)}))}else tu(du,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=function(e,t,s){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Qx(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const a=`${"level"===e?"playlist":e}LoadPolicy`,n=void 0===t[a],o=[];r.forEach((s=>{const r=`${e}Loading${s}`,l=t[r];if(void 0!==l&&n){o.push(r);const e=i[a].default;switch(t[a]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&s.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${a}": ${Of(t[a])}`)})),iu(iu({},i),t)}(pb.DefaultConfig,e,t);this.userConfig=e,s.progressive&&Jx(s,t);const{abrController:i,bufferController:r,capLevelController:a,errorController:n,fpsController:o}=s,l=new n(this),d=this.abrController=new i(this),c=new mm(this),h=s.interstitialsController,u=h?this.interstitialsController=new h(this,pb):null,f=this.bufferController=new r(this,c),m=this.capLevelController=new a(this),g=new o(this),p=new gb(this),y=s.contentSteeringController,v=y?new y(this):null,x=this.levelController=new ob(this,v),b=new ab(this),E=new ub(this.config),T=this.streamController=new hb(this,c,E),S=this.gapController=new Zx(this,c);m.setStreamController(T),g.setStreamController(T);const A=[p,x,T];u&&A.splice(1,0,u),v&&A.splice(1,0,v),this.networkControllers=A;const w=[d,f,S,m,g,b,c];this.audioTrackController=this.createController(s.audioTrackController,A);const k=s.audioStreamController;k&&A.push(this.audioStreamController=new k(this,c,E)),this.subtitleTrackController=this.createController(s.subtitleTrackController,A);const L=s.subtitleStreamController;L&&A.push(this.subtititleStreamController=new L(this,c,E)),this.createController(s.timelineController,w),E.emeController=this.emeController=this.createController(s.emeController,w),this.cmcdController=this.createController(s.cmcdController,w),this.latencyController=this.createController(nb,w),this.coreComponents=w,A.push(l);const R=l.onErrorOut;"function"==typeof R&&this.on(Kh.ERROR,R,l),this.on(Kh.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const t=e===Kh.ERROR;this.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.INTERNAL_EXCEPTION,fatal:t,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Kh.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(Kh.ERROR,{type:Gh.OTHER_ERROR,details:Vh.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(Kh.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Kh.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Kh.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=Su.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Kh.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),this.started&&this.networkControllers);s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((e=>{e.resumeBuffering&&e.resumeBuffering()})))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((e=>{e.pauseBuffering&&e.pauseBuffering()})))}get inFlightFragments(){const e={[zh]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Xh]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Qh]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}));return s}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Lf.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return kf(e,Bf(t),navigator.mediaCapabilities)}}pb.defaultConfig=void 0;const yb=z.createContext(),vb=()=>{const e=z.useContext(yb);if(!e)throw new Error("useClips debe ser usado dentro de un ClipsProvider");return e},xb=({children:t})=>{const[s,i]=z.useState((()=>{const e=localStorage.getItem("savedClips");return e?JSON.parse(e):[]}));z.useEffect((()=>{localStorage.setItem("savedClips",JSON.stringify(s))}),[s]);return e.jsx(yb.Provider,{value:{savedClips:s,addClip:e=>{i((t=>[...t,{id:Date.now(),...e,timestamp:(new Date).toISOString()}]))},deleteClip:e=>{i((t=>t.filter((t=>t.id!==e))))}},children:t})},bb=()=>{const[t,s]=z.useState(!1),[i,r]=z.useState(null),a=z.useRef(null),n=z.useRef(null),o=z.useRef([]),l=z.useRef(null),[d,c]=z.useState([]),[h,u]=z.useState(""),f=z.useRef(null),{addClip:m}=vb(),g="UsuarioDemo";z.useEffect((()=>{const e="https://x4bnd7lq.fubohd.com/foxsports2/mono.m3u8?token=eb1c7e07ae354055303a34818f4233d94fca4334-c3-1748834594-1748816594";return a.current&&(()=>{if(pb.isSupported()){const t=new pb({debug:!0,enableWorker:!0,lowLatencyMode:!0,backBufferLength:90});l.current=t,t.on(pb.Events.MEDIA_ATTACHED,(()=>{t.loadSource(e)})),t.on(pb.Events.MANIFEST_PARSED,((e,t)=>{a.current.play().catch((e=>{}))})),t.on(pb.Events.ERROR,((e,s)=>{if(s.fatal)switch(s.type){case pb.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case pb.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:t.destroy()}})),t.attachMedia(a.current)}else a.current.canPlayType("application/vnd.apple.mpegurl")?(a.current.src=e,a.current.addEventListener("loadedmetadata",(()=>{a.current.play().catch((e=>{}))}))):r("Tu navegador no soporta la reproduccin de video en vivo")})(),()=>{l.current&&l.current.destroy()}}),[]),z.useEffect((()=>{f.current&&f.current.scrollIntoView({behavior:"smooth"})}),[d]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(jc,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(Bc,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Transmisin en Vivo"})}),e.jsxs($c,{className:"pt-6",children:[i&&e.jsx("div",{className:"bg-red-900/50 border border-red-800 text-red-200 p-4 rounded-lg mb-6",children:i}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:a,className:"w-full h-full object-cover",controls:!0,autoPlay:!0,playsInline:!0}),e.jsxs("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center",children:[e.jsx(xd,{className:"w-4 h-4 mr-2 animate-pulse"}),"EN VIVO"]})]}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:e.jsxs(rd,{onClick:t?()=>{n.current&&t&&(n.current.stop(),s(!1))}:()=>{if(a.current)try{const e=a.current.captureStream(),t=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5});n.current=t,o.current=[],t.ondataavailable=e=>{e.data.size>0&&o.current.push(e.data)},t.onstop=()=>{const e=new Blob(o.current,{type:"video/webm"}),t=URL.createObjectURL(e),s=(new Date).toLocaleTimeString();m({url:t,title:`Clip ${s}`,duration:"0:45",timestamp:(new Date).toISOString()})},t.start(),s(!0)}catch(e){r("No se pudo iniciar la grabacin")}},className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Md,{className:"w-5 h-5 mr-2"}),t?"Detener Grabacin":"Grabar Clip"]})})]}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col h-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-200",children:"Chat en Vivo"}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-900/50 rounded-lg p-3 border border-gray-800 mb-2 max-h-96",children:[0===d.length&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay mensajes an. S el primero en comentar!"}),d.map(((t,s)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-bold text-red-400 mr-2",children:t.user}),e.jsx("span",{className:"text-gray-300",children:t.text}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:t.time})]},s))),e.jsx("div",{ref:f})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),""!==h.trim()&&(c((e=>[...e,{user:g,text:h,time:(new Date).toLocaleTimeString()}])),u(""))},className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:e=>u(e.target.value),placeholder:"Escribe tu mensaje...",className:"flex-1 rounded-md bg-gray-800 text-white px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsx(rd,{type:"submit",className:"bg-red-600 hover:bg-red-700 text-white font-bold px-4 py-2 rounded-md",children:"Enviar"})]})]})]})]})]})})})},Eb={"Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://static.ufcstats.com/images/athlete/Jamahal-Hill.png","Khalil Rountree Jr.":"https://static.ufcstats.com/images/athlete/Khalil-Rountree.png","Joe Pyfer":"https://static.ufcstats.com/images/athlete/Joe-Pyfer.png","Michel Pereira":"https://static.ufcstats.com/images/athlete/Michel-Pereira.png","Mayra Bueno Silva":"https://static.ufcstats.com/images/athlete/Mayra-Bueno-Silva.png","Irene Aldana":"https://static.ufcstats.com/images/athlete/Irene-Aldana.png","Ian Machado Garry":"https://static.ufcstats.com/images/athlete/Ian-Garry.png","Michael Page":"https://static.ufcstats.com/images/athlete/Michael-Page.png","Cub Swanson":"https://static.ufcstats.com/images/athlete/Cub-Swanson.png","Andre Fili":"https://static.ufcstats.com/images/athlete/Andre-Fili.png","Jessica Andrade":"https://static.ufcstats.com/images/athlete/Jessica-Andrade.png","Macy Chiasson":"https://static.ufcstats.com/images/athlete/Macy-Chiasson.png","Brandon Royval":"https://static.ufcstats.com/images/athlete/Brandon-Royval.png","Manel Kape":"https://static.ufcstats.com/images/athlete/Manel-Kape.png","Raul Rosas Jr.":"https://static.ufcstats.com/images/athlete/Raul-Rosas-Jr.png","Ricky Turcios":"https://static.ufcstats.com/images/athlete/Ricky-Turcios.png"},Tb=[{left:{name:"Conor McGregor",flag:"",rank:null},right:{name:"Michael Chandler",flag:"",rank:null},weight:"Peso ligero"},{left:{name:"Jamahal Hill",flag:"",rank:null},right:{name:"Khalil Rountree Jr.",flag:"",rank:null},weight:"Peso semipesado"},{left:{name:"Joe Pyfer",flag:"",rank:null},right:{name:"Michel Pereira",flag:"",rank:null},weight:"Peso medio"},{left:{name:"Mayra Bueno Silva",flag:"",rank:null},right:{name:"Irene Aldana",flag:"",rank:null},weight:"Peso gallo femenino"},{left:{name:"Ian Machado Garry",flag:"",rank:null},right:{name:"Michael Page",flag:"",rank:null},weight:"Peso welter"}],Sb=[{left:{name:"Cub Swanson",flag:"",rank:null},right:{name:"Andre Fili",flag:"",rank:null},weight:"Peso pluma"},{left:{name:"Jessica Andrade",flag:"",rank:null},right:{name:"Macy Chiasson",flag:"",rank:null},weight:"Peso gallo femenino"},{left:{name:"Brandon Royval",flag:"",rank:null},right:{name:"Manel Kape",flag:"",rank:null},weight:"Peso mosca"},{left:{name:"Raul Rosas Jr.",flag:"",rank:null},right:{name:"Ricky Turcios",flag:"",rank:null},weight:"Peso gallo"}],Ab=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(Oc,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC 303 Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(jc,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(Bc,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC 303: McGregor vs. Chandler"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"28 de junio de 2025 - Las Vegas, NV (T-Mobile Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs($c,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:Tb.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Eb[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Eb[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:Sb.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Eb[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Eb[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),wb=()=>{const{savedClips:t,deleteClip:s}=vb();return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto max-w-6xl",children:e.jsxs(Oc,{className:"bg-black/70 border border-gray-800 shadow-lg shadow-red-900/10 backdrop-blur-sm",children:[e.jsx(jc,{className:"text-center border-b border-gray-700 pb-4",children:e.jsx(Bc,{className:"text-2xl sm:text-3xl font-black uppercase text-red-500 tracking-wider",children:"Clips Guardados"})}),e.jsx($c,{className:"pt-6",children:0===t.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No tienes clips guardados an."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Graba clips durante las transmisiones en vivo para verlos aqu."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((t=>e.jsx(il.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},children:e.jsxs(Oc,{className:"bg-black/60 border-gray-800 shadow-lg overflow-hidden backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-video",children:[e.jsx("video",{src:t.url,className:"w-full h-full object-cover",controls:!0}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 px-2 py-1 rounded text-xs flex items-center text-gray-300",children:[e.jsx(xd,{className:"w-3 h-3 mr-1 text-red-500"}),t.duration]})]}),e.jsxs($c,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-white",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Grabado el ",new Date(t.timestamp).toLocaleString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(rd,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>((e,t)=>{const s=document.createElement("a");s.href=e,s.download=`${t}.webm`,document.body.appendChild(s),s.click(),document.body.removeChild(s)})(t.url,t.title),children:[e.jsx(Ed,{className:"w-4 h-4 mr-2"}),"Descargar"]}),e.jsxs(rd,{variant:"outline",className:"flex-1 border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>{return e=t.url,void(navigator.share?navigator.share({title:"Clip de UFC",url:e}):(navigator.clipboard.writeText(e),alert("URL copiada al portapapeles")));var e},children:[e.jsx(Od,{className:"w-4 h-4 mr-2"}),"Compartir"]}),e.jsx(rd,{variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>s(t.id),children:e.jsx(Kd,{className:"w-4 h-4"})})]})]})]})},t.id)))})})]})})})},kb=z.forwardRef((({className:t,...s},i)=>e.jsx(H,{ref:i,className:Zl("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s})));kb.displayName=H.displayName;const Lb=z.forwardRef((({className:t,...s},i)=>e.jsx(Y,{ref:i,className:Zl("aspect-square h-full w-full",t),...s})));Lb.displayName=Y.displayName;const Rb=z.forwardRef((({className:t,...s},i)=>e.jsx(W,{ref:i,className:Zl("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s})));Rb.displayName=W.displayName;const Ib=()=>{const{id:t}=ee(),s=[{id:"1",title:"Quin gana en UFC 303?",author:"FanUFC_123",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Hola a todos! Con UFC 303 a la vuelta de la esquina, me pregunto cules son sus predicciones para las peleas principales. Creen que habr alguna sorpresa? Quin creen que se llevar la victoria en el evento principal?\n\nCompartan sus pensamientos y anlisis!",replies:[{id:"1",author:"MMA_Guru",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Creo que el evento principal ser ms reido de lo que la gente espera. Mi prediccin es..."},{id:"2",author:"PredictionPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"Definitivamente una sorpresa en la co-estelar! No me fo de las cuotas."},{id:"3",author:"CasualFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 15 minutos",content:"Yo solo espero nocauts espectaculares. "}]},{id:"2",title:"El legado de Khabib",author:"MMA_Guru",authorAvatar:"https://github.com/shadcn.png",time:"hace 5 horas",content:"Cul creen que es el verdadero legado de Khabib Nurmagomedov en el UFC? Es el mejor de todos los tiempos en su categora? Debatamos!",replies:[{id:"1",author:"Fan_Histrico",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Invicto y dominante, no hay duda. Su impacto fue enorme."},{id:"2",author:"AnalistaPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Su control en el suelo era inigualable. Pocos podran compararse."}]},{id:"3",title:"Posible regreso de GSP",author:"NostalgicFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 da",content:"He escuchado rumores sobre un posible regreso de Georges St-Pierre. Creen que GSP podra volver al octgono y tener xito a su edad?",replies:[{id:"1",author:"OldSchoolMMA",authorAvatar:"https://github.com/shadcn.png",time:"hace 12 horas",content:"Sera emocionante, pero el nivel actual es muy alto."},{id:"2",author:"TrueFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 8 horas",content:"GSP siempre se mantuvo en forma. Podra sorprender a muchos."}]},{id:"4",title:"Top 5 Peso Pluma Actual",author:"AnalistaX",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 da",content:"Quiero armar mi top 5 de peleadores de peso pluma actuales. Quines creen que deberan estar en la lista y por qu? Compartan sus opiniones!",replies:[{id:"1",author:"FightFanatic",authorAvatar:"https://github.com/shadcn.png",time:"hace 10 horas",content:"Volkanovski, sin duda. Luego, Holloway."},{id:"2",author:"StatsMan",authorAvatar:"https://github.com/shadcn.png",time:"hace 6 horas",content:"Consideren a Topuria, est en ascenso."}]},{id:"101",title:"Opiniones sobre el ltimo evento?",author:"UFC_Fanatic",authorAvatar:"https://github.com/shadcn.png",time:"hace 3 horas",content:"Qu les pareci el ltimo evento de UFC? Hubo alguna pelea que les sorprendi o decepcion?",replies:[{id:"1",author:"MMA_Expert",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"La pelea co-estelar fue fantstica, super mis expectativas."},{id:"2",author:"FightWatcher",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"Pens que el evento principal sera mejor, pero aun as fue slido."}]},{id:"102",title:"Debate: Es Jon Jones el GOAT?",author:"MMA_Historian",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 da",content:"Con la trayectoria de Jon Jones, lo consideran el 'Greatest Of All Time' en el MMA? Por qu s o por qu no?",replies:[{id:"1",author:"Argumentador",authorAvatar:"https://github.com/shadcn.png",time:"hace 10 horas",content:"Sus logros son innegables, pero las controversias..."},{id:"2",author:"Fanatico_JJ",authorAvatar:"https://github.com/shadcn.png",time:"hace 5 horas",content:"Pura dominacin, no hay quien se le compare en su prime."}]},{id:"201",title:"Mis picks para el UFC 303",author:"BettingGuru",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Es hora de hacer mis predicciones para el UFC 303! Comparto mis favoritos y por qu creo que ganarn. Cules son sus picks?",replies:[{id:"1",author:"HighStakes",authorAvatar:"https://github.com/shadcn.png",time:"hace 30 minutos",content:"Coincido con el evento principal, pero la segunda pelea me parece un riesgo."}]},{id:"202",title:"Anlisis de cuotas para la pelea estelar",author:"OddsMaster",authorAvatar:"https://github.com/shadcn.png",time:"hace 6 horas",content:"He analizado las cuotas para la pelea estelar del prximo evento. Les doy mis perspectivas y dnde creo que hay valor.",replies:[{id:"1",author:"PunterPro",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Buen anlisis, creo que el underdog tiene ms chances de lo que indican."}]},{id:"301",title:"ltimos rumores de lesiones",author:"Insider_Info",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Se rumorea que X peleador podra estar lesionado y salir del prximo cartel. Qu han odo ustedes?",replies:[{id:"1",author:"NewsHound",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 hora",content:"Ojal que no sea cierto, esa pelea es clave."}]},{id:"302",title:"Posibles peleas para fin de ao",author:"FightNews",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 da",content:"Con el ao llegando a su fin, qu peleas soadas les gustara ver concretadas antes de 2025?",replies:[{id:"1",author:"DreamMatch",authorAvatar:"https://github.com/shadcn.png",time:"hace 8 horas",content:"Me encantara ver A vs B en peso ligero."}]},{id:"401",title:"Mejores strikers en Peso Ligero",author:"StrikingFan",authorAvatar:"https://github.com/shadcn.png",time:"hace 4 horas",content:"Abro debate: Quines son los 5 mejores strikers de la divisin de peso ligero actualmente en el UFC?",replies:[{id:"1",author:"Kickboxer",authorAvatar:"https://github.com/shadcn.png",time:"hace 2 horas",content:"Dustin Poirier tiene manos increbles."}]},{id:"402",title:"Comparativa de grappling en Peso Welter",author:"GrapplingKing",authorAvatar:"https://github.com/shadcn.png",time:"hace 1 da",content:"Hagamos una comparativa de los mejores grapplers en la divisin de peso wlter. Quin creen que tiene el mejor jiu-jitsu o lucha?",replies:[{id:"1",author:"BJJ_Lover",authorAvatar:"https://github.com/shadcn.png",time:"hace 9 horas",content:"Belal Muhammad ha mejorado mucho su lucha."}]}].find((e=>e.id===t));return s?e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(Oc,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(jc,{children:[e.jsx(Bc,{className:"text-3xl font-bold text-red-500 mb-2",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-400",children:["por ",e.jsx("span",{className:"font-medium text-red-400",children:s.author})," - ",s.time]})]})}),e.jsx(Oc,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs($c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(kb,{className:"h-10 w-10 mr-4",children:[e.jsx(Lb,{src:s.authorAvatar,alt:s.author}),e.jsx(Rb,{children:s.author.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.author}),e.jsx("p",{className:"text-xs text-gray-500",children:s.time})]})]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s.content})]})}),e.jsxs("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:["Respuestas (",s.replies.length,")"]}),e.jsx("div",{className:"space-y-4 mb-6",children:s.replies.map((t=>e.jsx(Oc,{className:"bg-gray-900 border-gray-800",children:e.jsxs($c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsxs(kb,{className:"h-9 w-9 mr-3",children:[e.jsx(Lb,{src:t.authorAvatar,alt:t.author}),e.jsx(Rb,{children:t.author.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.author}),e.jsx("p",{className:"text-xs text-gray-500",children:t.time})]})]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:t.content})]})},t.id)))}),e.jsxs(Oc,{className:"bg-gray-900 border-gray-800 mb-6",children:[e.jsx(jc,{children:e.jsx(Bc,{className:"text-xl font-bold text-white",children:"Deja tu respuesta"})}),e.jsxs($c,{children:[e.jsx(wh,{placeholder:"Escribe tu respuesta aqu...",className:"bg-gray-800 border-gray-700 text-white placeholder-gray-500 mb-4 focus:border-red-500 focus:ring-red-500",rows:5}),e.jsx(rd,{className:"bg-red-600 hover:bg-red-700 w-full sm:w-auto",children:"Enviar Respuesta"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:"Hilo no encontrado."})})},Pb=()=>{const{id:t}=ee(),s=[{id:"1",name:"Discusin General",description:"Habla de todo sobre UFC"},{id:"2",name:"Predicciones y Apuestas",description:"Comparte tus pronsticos"},{id:"3",name:"Noticias y Rumores",description:"ltimas novedades del octgono"},{id:"4",name:"Peleadores y Divisiones",description:"Anlisis por categora",icon:Nd}].find((e=>e.id===t)),i={1:[{id:"101",title:"Opiniones sobre el ltimo evento?",author:"UFC_Fanatic",replies:25,time:"hace 3 horas"},{id:"102",title:"Debate: Es Jon Jones el GOAT?",author:"MMA_Historian",replies:80,time:"hace 1 da"}],2:[{id:"201",title:"Mis picks para el UFC 303",author:"BettingGuru",replies:15,time:"hace 1 hora"},{id:"202",title:"Anlisis de cuotas para la pelea estelar",author:"OddsMaster",replies:35,time:"hace 6 horas"}],3:[{id:"301",title:"ltimos rumores de lesiones",author:"Insider_Info",replies:10,time:"hace 2 horas"},{id:"302",title:"Posibles peleas para fin de ao",author:"FightNews",replies:40,time:"hace 1 da"}],4:[{id:"401",title:"Mejores strikers en Peso Ligero",author:"StrikingFan",replies:50,time:"hace 4 horas"},{id:"402",title:"Comparativa de grappling en Peso Welter",author:"GrapplingKing",replies:20,time:"hace 1 da"}]}[t]||[];return s?e.jsx(il.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen bg-black text-white py-8 px-4 sm:px-6 lg:px-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(Oc,{className:"bg-gray-900 border-gray-800 mb-6",children:e.jsxs(jc,{className:"text-center",children:[e.jsx(Bc,{className:"text-4xl md:text-5xl font-black mb-2 uppercase text-red-500 tracking-wider",children:s.name}),e.jsx(Uc,{className:"text-lg text-gray-400 mb-4",children:s.description}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center mt-4",children:[e.jsxs("div",{className:"relative flex-grow max-w-md",children:[e.jsx(_c,{type:"text",placeholder:`Buscar en ${s.name}...`,className:"pl-10 bg-gray-800 border-gray-700 focus:border-red-500 focus:ring-red-500 text-white"}),e.jsx(Fd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-500"})]}),e.jsxs(rd,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Nd,{className:"w-5 h-5 mr-2"}),"Crear Nuevo Hilo"]})]})]})}),e.jsxs("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:["Hilos en ",s.name," (",i.length,")"]}),e.jsx(Oc,{className:"bg-black/60 border-gray-800 shadow-lg backdrop-blur-sm",children:e.jsx($c,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-gray-800",children:i.length>0?i.map((t=>e.jsxs("li",{className:"p-4 hover:bg-gray-800/50 transition-colors duration-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{children:[e.jsx(Q,{to:`/thread/${t.id}`,className:"text-lg font-semibold text-white hover:text-red-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["por ",e.jsx("span",{className:"font-medium text-gray-400",children:t.author})," - ",t.time]})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-2 sm:mt-0 text-right flex-shrink-0",children:e.jsx(kh,{threadId:t.id})})]},t.id))):e.jsx("li",{className:"p-4 text-center text-gray-500",children:"No hay hilos en esta categora todava."})})})})]})}):e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("h1",{className:"text-4xl font-bold text-red-500",children:"Categora no encontrada."})})},Db={"Rose Namajunas":"https://static.ufcstats.com/images/athlete/Rose-Namajunas.png","Maycee Barber":"https://static.ufcstats.com/images/athlete/Maycee-Barber.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://static.ufcstats.com/images/athlete/Jamahal-Hill.png","Khalil Rountree Jr.":"https://static.ufcstats.com/images/athlete/Khalil-Rountree.png","Joe Pyfer":"https://static.ufcstats.com/images/athlete/Joe-Pyfer.png","Michel Pereira":"https://static.ufcstats.com/images/athlete/Michel-Pereira.png","Mayra Bueno Silva":"https://static.ufcstats.com/images/athlete/Mayra-Bueno-Silva.png","Irene Aldana":"https://static.ufcstats.com/images/athlete/Irene-Aldana.png","Ian Machado Garry":"https://static.ufcstats.com/images/athlete/Ian-Garry.png","Michael Page":"https://static.ufcstats.com/images/athlete/Michael-Page.png","Cub Swanson":"https://static.ufcstats.com/images/athlete/Cub-Swanson.png","Andre Fili":"https://static.ufcstats.com/images/athlete/Andre-Fili.png","Jessica Andrade":"https://static.ufcstats.com/images/athlete/Jessica-Andrade.png","Macy Chiasson":"https://static.ufcstats.com/images/athlete/Macy-Chiasson.png","Brandon Royval":"https://static.ufcstats.com/images/athlete/Brandon-Royval.png","Manel Kape":"https://static.ufcstats.com/images/athlete/Manel-Kape.png","Raul Rosas Jr.":"https://static.ufcstats.com/images/athlete/Raul-Rosas-Jr.png","Ricky Turcios":"https://static.ufcstats.com/images/athlete/Ricky-Turcios.png"},Cb=[{left:{name:"Rose Namajunas",flag:"",rank:null},right:{name:"Maycee Barber",flag:"",rank:null},weight:"Peso mosca"}],Nb=[{left:{name:"Placeholder Fighter 1",flag:"",rank:null},right:{name:"Placeholder Fighter 2",flag:"",rank:null},weight:"Peso pluma"},{left:{name:"Placeholder Fighter 3",flag:"",rank:null},right:{name:"Placeholder Fighter 4",flag:"",rank:null},weight:"Peso gallo femenino"}],_b=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(Oc,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC Fight Night Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(jc,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(Bc,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC Fight Night: Namajunas vs. Barber"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"12 de julio de 2025 - Denver, CO (Ball Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs($c,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:Cb.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Db[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Db[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:Nb.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Db[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Db[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),Mb={"Leon Edwards":"https://static.ufcstats.com/images/athlete/Leon-Edwards.png","Belal Muhammad":"https://static.ufcstats.com/images/athlete/Belal-Muhammad.png","Tom Aspinall":"https://static.ufcstats.com/images/athlete/Tom-Aspinall.png","Curtis Blaydes":"https://static.ufcstats.com/images/athlete/Curtis-Blaydes.png","Paddy Pimblett":"https://static.ufcstats.com/images/athlete/Paddy-Pimblett.png","Bobby Green":"https://static.ufcstats.com/images/athlete/Bobby-Green.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://ufc.com/fighters/jamahal-hill.png","Khalil Rountree Jr.":"https://ufc.com/fighters/khalil-rountree-jr.png","Joe Pyfer":"https://ufc.com/fighters/joe-pyfer.png","Michel Pereira":"https://ufc.com/fighters/michel-pereira.png","Mayra Bueno Silva":"https://ufc.com/fighters/mayra-bueno-silva.png","Irene Aldana":"https://ufc.com/fighters/irene-aldana.png","Ian Machado Garry":"https://ufc.com/fighters/ian-machado-garry.png","Michael Page":"https://ufc.com/fighters/michael-page.png","Cub Swanson":"https://ufc.com/fighters/cub-swanson.png","Andre Fili":"https://ufc.com/fighters/andre-fili.png","Jessica Andrade":"https://ufc.com/fighters/jessica-andrade.png","Macy Chiasson":"https://ufc.com/fighters/macy-chiasson.png","Brandon Royval":"https://ufc.com/fighters/brandon-royval.png","Manel Kape":"https://ufc.com/fighters/manel-kape.png","Raul Rosas Jr.":"https://ufc.com/fighters/raul-rosas-jr.png","Ricky Turcios":"https://ufc.com/fighters/ricky-turcios.png"},Fb=[{left:{name:"Leon Edwards",flag:"",rank:null},right:{name:"Belal Muhammad",flag:"",rank:null},weight:"Peso welter"},{left:{name:"Tom Aspinall",flag:"",rank:null},right:{name:"Curtis Blaydes",flag:"",rank:null},weight:"Peso pesado"}],Ob=[{left:{name:"Paddy Pimblett",flag:"",rank:null},right:{name:"Bobby Green",flag:"",rank:null},weight:"Peso ligero"}],jb=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(Oc,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC 304 Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(jc,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(Bc,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC 304: Edwards vs. Muhammad 2"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"26 de julio de 2025 - Manchester, England (Co-op Live)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs($c,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:Fb.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Mb[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Mb[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:Ob.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Mb[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Mb[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),Bb={"Cory Sandhagen":"https://static.ufcstats.com/images/athlete/Cory-Sandhagen.png","Umar Nurmagomedov":"https://static.ufcstats.com/images/athlete/Umar-Nurmagomedov.png","Conor McGregor":"https://static.ufcstats.com/images/athlete/Conor-McGregor.png","Michael Chandler":"https://static.ufcstats.com/images/athlete/Michael-Chandler.png","Jamahal Hill":"https://ufc.com/fighters/jamahal-hill.png","Khalil Rountree Jr.":"https://ufc.com/fighters/khalil-rountree-jr.png","Joe Pyfer":"https://ufc.com/fighters/joe-pyfer.png","Michel Pereira":"https://ufc.com/fighters/michel-pereira.png","Mayra Bueno Silva":"https://ufc.com/fighters/mayra-bueno-silva.png","Irene Aldana":"https://ufc.com/fighters/irene-aldana.png","Ian Machado Garry":"https://ufc.com/fighters/ian-machado-garry.png","Michael Page":"https://ufc.com/fighters/michael-page.png","Cub Swanson":"https://ufc.com/fighters/cub-swanson.png","Andre Fili":"https://ufc.com/fighters/andre-fili.png","Jessica Andrade":"https://ufc.com/fighters/jessica-andrade.png","Macy Chiasson":"https://ufc.com/fighters/macy-chiasson.png","Brandon Royval":"https://ufc.com/fighters/brandon-royval.png","Manel Kape":"https://ufc.com/fighters/manel-kape.png","Raul Rosas Jr.":"https://ufc.com/fighters/raul-rosas-jr.png","Ricky Turcios":"https://ufc.com/fighters/ricky-turcios.png"},Ub=[{left:{name:"Cory Sandhagen",flag:"",rank:null},right:{name:"Umar Nurmagomedov",flag:"",rank:null},weight:"Peso gallo"}],$b=[],Gb=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-950 to-black text-white pt-24 pb-12 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(Oc,{className:"bg-black/80 border border-gray-800 shadow-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"relative h-56 md:h-72 w-full overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:"https://images.unsplash.com/photo-1696407254550-989e4543dc11",alt:"UFC Fight Night Arena",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),e.jsxs(jc,{className:"text-center border-b border-gray-700 pb-4",children:[e.jsx(Bc,{className:"text-3xl font-black uppercase text-red-500 tracking-wider",children:"UFC Fight Night: Sandhagen vs. Nurmagomedov"}),e.jsx("div",{className:"text-gray-300 mt-2 text-lg",children:"2 de agosto de 2025 - Abu Dhabi, UAE (Etihad Arena)"}),e.jsx("div",{className:"text-yellow-400 font-bold text-lg mt-1",children:"7:00 PM (hora local)"})]}),e.jsxs($c,{className:"pt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-4 text-center",children:"Cartelera Estelar"}),e.jsx("div",{className:"space-y-4 mb-8",children:Ub.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/60 rounded-lg px-4 py-3 border border-gray-700 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Bb[t.left.name],alt:t.left.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-lg md:text-2xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-base md:text-lg font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Bb[t.right.name],alt:t.right.name,className:"w-11 h-11 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-blue-300 font-semibold",children:t.weight})})]},s)))}),e.jsx("h2",{className:"text-xl font-bold text-blue-400 mb-4 text-center",children:"Preliminares"}),e.jsx("div",{className:"space-y-3",children:$b.map(((t,s)=>e.jsxs("div",{className:"bg-gray-900/40 rounded px-4 py-2 border border-gray-800 mb-2",children:[e.jsxs("div",{className:"grid grid-cols-12 items-center gap-2",children:[e.jsxs("div",{className:"col-span-5 flex items-center justify-end gap-2",children:[e.jsx("img",{src:Bb[t.left.name],alt:t.left.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.left.flag}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-right",children:t.left.name})]}),e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-200 text-base md:text-xl font-black tracking-wider",children:"VS"})}),e.jsxs("div",{className:"col-span-5 flex items-center justify-start gap-2",children:[e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow text-left",children:t.right.name}),e.jsx("span",{className:"text-white text-sm md:text-base font-bold drop-shadow",children:t.right.flag}),e.jsx("img",{src:Bb[t.right.name],alt:t.right.name,className:"w-9 h-9 rounded-full object-cover border-2 border-gray-700 bg-black"})]})]}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx("span",{className:"text-xs text-yellow-300 font-semibold",children:t.weight})})]},s)))})]})]})})}),Vb=()=>e.jsxs(te,{children:[e.jsx(se,{path:"/",element:e.jsx(Nc,{})}),e.jsx(se,{path:"/login",element:e.jsx(Kc,{})}),e.jsx(se,{path:"/register",element:e.jsx(Yc,{})}),e.jsx(se,{path:"/rankings",element:e.jsx(eh,{})}),e.jsx(se,{path:"/profile",element:e.jsx(uh,{})}),e.jsx(se,{path:"/compare",element:e.jsx(gh,{})}),e.jsx(se,{path:"/fighters",element:e.jsx(bh,{})}),e.jsx(se,{path:"/events",element:e.jsx(Th,{})}),e.jsx(se,{path:"/highlights",element:e.jsx(Ah,{})}),e.jsx(se,{path:"/forum",element:e.jsx(Ih,{})}),e.jsx(se,{path:"/predict",element:e.jsx(jh,{})}),e.jsx(se,{path:"/live",element:e.jsx(bb,{})}),e.jsx(se,{path:"/ufc303",element:e.jsx(Ab,{})}),e.jsx(se,{path:"/ufcnamajunasbarber",element:e.jsx(_b,{})}),e.jsx(se,{path:"/ufc304",element:e.jsx(jb,{})}),e.jsx(se,{path:"/ufcsandhagennurmagomedov",element:e.jsx(Gb,{})}),e.jsx(se,{path:"/clips",element:e.jsx(wb,{})}),e.jsx(se,{path:"/thread/:id",element:e.jsx(Ib,{})}),e.jsx(se,{path:"/category/:id",element:e.jsx(Pb,{})})]}),Kb=()=>e.jsx(Lc,{children:e.jsx(Vb,{})});re(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(ie,{children:e.jsx(xb,{children:e.jsx(Kb,{})})})}));
